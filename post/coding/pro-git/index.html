<!DOCTYPE html>
<html lang="zh-Hans">
<head><link rel=manifest href=/manifest.json>

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="墨问非名" />



<meta name="description" content="Pro Git LicenceThis work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License. To view a copy of this license, visit &amp;lt;http://creativecommons.org/licenses">
<meta property="og:type" content="article">
<meta property="og:title" content="Pro Git">
<meta property="og:url" content="https://comicfrenzy.github.io/post/coding/pro-git/index.html">
<meta property="og:site_name" content="非名榭">
<meta property="og:description" content="Pro Git LicenceThis work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License. To view a copy of this license, visit &amp;lt;http://creativecommons.org/licenses">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj9hb3xj20m80izq37.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjo3iirj20m80fgaae.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjl8scpj20ik0m80t6.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjvjruaj20m808mq33.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjss74rj20m808h74k.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclwf7ssj20m80c90sy.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmb99lgj20m80g4gmn.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjb0didj20m8096dfx.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck3sopmj20m80cbaae.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck6q9w3j20m807daab.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckbo5s6j20m80by0sr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckfyidpj20m8097mx4.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcklssd5j20m80czq2x.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckpjh75j20m80csmx5.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckrcx0aj20m809awef.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcktapbpj20m809adfr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcky2la0j20m80e8wee.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl1ngowj20m806gq2u.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl51tipj20m80aumx4.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl7l6i4j20m8080dfq.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclbi698j20m80anjrd.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclf8f55j20m80dcmx4.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclhhmkxj20m80aldfr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm7z0yyj20m80aljrf.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn4xpv4j20m808s0sm.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjz74jpj20m802w3ye.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnaghcej20m8084glm.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcndbl5dj20m80hmglw.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcifvci6j20ki0m874l.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnn7et9j20m80g1glv.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck5aa5qj20m80doaa8.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnq8cjrj20m80gcjrm.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnw30gmj20m80g1wet.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco063vrj20m80g1glx.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco3lk0mj20m80an749.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco7nfaoj20m808g0so.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco8qrkxj20m806fjrb.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcog9sg1j20m806ea9y.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcok9m5ej20m80cygln.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcon5mkyj20m808vt8p.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmyb66wj20m80750so.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmi3uwoj20m803nq2u.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjei8qgj20m802bmx0.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckuapv6j20m80d5q2z.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchhir7ej20m80e3jrk.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchik508j20m80e3mxd.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchlnnayj20m80bpaa7.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchkm70hj20m80bpwej.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchscbczj20m80fitaa.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchtoogyj20jx0b30sj.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci07uj7j20m804wq3g.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci52368j20m80bxtev.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciedkgfj20m80bx7af.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcimlzd5j20m809l3ym.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcik2zwhj20m807fmxf.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcino0ehj20m80bgjrp.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcirbdk9j20m80b83yr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciw17g8j20m80dg0su.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcix53pfj20m809ymx6.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj3tl2rj20m807yjre.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj8ir2dj20m8059t8o.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjc7559j20m806z74a.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjfzrwsj20m805zq2x.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjjikl2j20m805zq2x.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm0ywmcj20hf0m8t8y.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclrz7sjj20m809wdfw.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjy4wo2j20m80cjaa9.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck2d4kzj20m80agaa8.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn9didzj20jy0m83z1.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj5gjgqj20m808274d.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcohsq57j20m806pq2y.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchxit2yj20m806pglo.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckobjnej20m808gjre.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjhuas1j20m808laa3.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnlv0lrj20m80ajmx6.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnon8zvj20m808gdft.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciivn02j20m807tq2w.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjtymauj20m80d2t91.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcleb8btj20m80ctq3c.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclnfrgdj20m80ajq2z.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco155qwj20m80ajaa4.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcia1xquj20lo0fuaak.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnxteimj20m805i3yi.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmxifjqj20m80daq34.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcllaspbj20m80daq33.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnyy9w8j20m80d9jrl.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclpolngj20m809amxn.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclu6sl8j20m80byq3c.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclswszyj203s01g0si.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckeifhwj20m80fgjs3.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl8uj4hj20m80evaas.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm2jqi9j20m80keq3y.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclvb5l6j20m80dbgmi.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm59tegj20m807hmxg.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm9nkj9j20m80hv0tp.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn09mowj20l90m83zn.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmdopjoj20m802kt8p.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmgxq2bj20m808m74p.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmka1buj20m809qgly.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmn3p42j20m80cpmxr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcms18raj20m808fmxg.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmuuk4yj20m8095mxm.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck9nfawj20m8061aa2.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckn3f1lj20m804emx6.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjmth5ij20m80cet9b.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckd2mwpj20m8085wen.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn1g57bj20m806tweh.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci6d3woj20m80f7wf1.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciv3d9uj20jc076q2x.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmocf0hj20m80cf3z5.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnglnkkj20m80cqmxr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchmvywkj20m80duglp.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmjairjj20m806pglo.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmw8fx1j20m80ez0tg.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj2v56xj20m806xglp.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjpohw4j20m80bn3z9.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckhkgmmj20m80awgm0.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnrd4cuj20m807ddfz.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclijb4oj20i40c8aah.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn6g3muj20m80ayt93.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnt0pc9j20m80azaad.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck89tlnj20m809yaa8.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco552xej20m8054t8o.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcobhke7j20m8092dg4.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcksfcfsj20ap06ewef.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl6csf5j20m80ftwew.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjdfdnej20m808mweq.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcodbr2zj20m80m576t.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclai6brj20m807tt91.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcickn33j20m80cwq3a.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcion5jwj20m80epaaj.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj1j9guj20kz0m8jss.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchp0951j20m80cbgmc.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclohcm3j20m8035a9x.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmqg0o2j20m80b9q3d.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchv4ycaj20m8044jra.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci1r21kj20m80c9mx9.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci8cnzmj20m80hvt8r.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcihl1smj20m80j03yn.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoj2ss7j20m80ji74k.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcispl9vj20m80ji3ys.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoom7ctj20m80ji74k.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcilbidwj20m80jidg7.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjwy6qoj20m80ia3yw.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchwczxwj20m80jit97.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm3zt05j20m80jiq3g.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciu3dyij20m80jimxo.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn40o1wj20m80jijrp.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcni77m1j20m80jijrp.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjrajq3j20m80jimxn.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmlcwjfj20m80ip74r.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn2mervj20m80ka3z1.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj6kxdbj20jp0m8aal.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnu9uh5j20m80gt3yt.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchjdwdej20m80a3wef.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckk5hrgj20m80a3dfs.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoldx8bj20m808ewef.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckqhtmpj20m8076mx3.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoa29pzj20m8069wee.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl0mbz2j20m80bc748.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm6kjyej20m80cf3yl.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl41pbbj20m80cf74d.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnee653j20ln0m80sv.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclctzy4j20ln0m874f.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj0297pj20ln0m8q35.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckvr5fcj20m80ieglu.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchyiz15j20m80ieglr.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmto7hgj20dw0aat9k.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclr21fdj20m80apjrl.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckix8edj20m80ao0sy.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclxrrs3j20m80ismxi.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciyiinsj20m80clwff.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcljonsqj20m80cujrs.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmceohnj20m80gh3yo.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn7zq9qj20m80gh74m.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnc13avj20m80gj0t7.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmewfluj20m80brwes.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclzfmnuj20m80g3mzg.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco6p620j20m80czab5.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci31zpsj20m80ckmy2.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchqiknsj20m80c7js6.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnkpjisj205y024dft.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclg90r9j208w04hdfn.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcipvh53j209u09uglk.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl2qvpdj209h059web.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcof1pbfj20m80f2di2.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckz6k41j20gu05gt8j.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck0qwbfj20m80e0jrv.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco2dz2zj20ie062web.jpg">
<meta property="og:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcib8fuaj20bk06u3yc.jpg">
<meta property="og:updated_time" content="2012-06-01T15:20:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pro Git">
<meta name="twitter:description" content="Pro Git LicenceThis work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License. To view a copy of this license, visit &amp;lt;http://creativecommons.org/licenses">
<meta name="twitter:image" content="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj9hb3xj20m80izq37.jpg">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="非名榭" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Pro Git | 非名榭</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: false
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->






</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/uploads/avatar.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">墨问非名</a></h1>
        </hgroup>

        
        <p class="header-subtitle">墨问非名的Hexo博客</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives/">归档</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:anywaywillgo@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="http://weibo.com/alicewish" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/Alicewish" title="GitHub"></a>
                            
                                <a class="fa V2EX" href="https://www.v2ex.com/member/Alicewish" title="V2EX"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa 知乎" href="http://www.zhihu.com/people/mo-wen-fei-ming" title="知乎"></a>
                            
                                <a class="fa 豆瓣" href="http://douban.com/people/Alicewish" title="豆瓣"></a>
                            
                                <a class="fa 简书" href="http://www.jianshu.com/u/5d98f0cc5d37" title="简书"></a>
                            
                                <a class="fa Coding" href="https://coding.net/u/alicewish" title="Coding"></a>
                            
                                <a class="fa bilibili" href="https://space.bilibili.com/2329324/#/" title="bilibili"></a>
                            
                                <a class="fa Google" href="https://plus.google.com/anywaywillgo" title="Google"></a>
                            
                                <a class="fa Twitter" href="https://twitter.com/AnyWayWillGo" title="Twitter"></a>
                            
                                <a class="fa LOFTER" href="http://underdream.lofter.com/" title="LOFTER"></a>
                            
                        </ul>
                        
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>
                    
</div>
    </div>
    <div class="hide-left-col" title="隐藏侧栏">
        <i class="fa fa-angle-double-left"></i>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">墨问非名</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/uploads/avatar.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">墨问非名</a></h1>
            </hgroup>
            
            <p class="header-subtitle">墨问非名的Hexo博客</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">归档</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <ul class="social">
                    
                        <a class="fa Email" target="_blank" href="mailto:anywaywillgo@gmail.com" title="Email"></a>
                    
                        <a class="fa 新浪微博" target="_blank" href="http://weibo.com/alicewish" title="新浪微博"></a>
                    
                        <a class="fa GitHub" target="_blank" href="https://github.com/Alicewish" title="GitHub"></a>
                    
                        <a class="fa V2EX" target="_blank" href="https://www.v2ex.com/member/Alicewish" title="V2EX"></a>
                    
                        <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                    
                        <a class="fa 知乎" target="_blank" href="http://www.zhihu.com/people/mo-wen-fei-ming" title="知乎"></a>
                    
                        <a class="fa 豆瓣" target="_blank" href="http://douban.com/people/Alicewish" title="豆瓣"></a>
                    
                        <a class="fa 简书" target="_blank" href="http://www.jianshu.com/u/5d98f0cc5d37" title="简书"></a>
                    
                        <a class="fa Coding" target="_blank" href="https://coding.net/u/alicewish" title="Coding"></a>
                    
                        <a class="fa bilibili" target="_blank" href="https://space.bilibili.com/2329324/#/" title="bilibili"></a>
                    
                        <a class="fa Google" target="_blank" href="https://plus.google.com/anywaywillgo" title="Google"></a>
                    
                        <a class="fa Twitter" target="_blank" href="https://twitter.com/AnyWayWillGo" title="Twitter"></a>
                    
                        <a class="fa LOFTER" target="_blank" href="http://underdream.lofter.com/" title="LOFTER"></a>
                    
                </ul>
            </nav>
        </header>
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-pro-git" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/post/coding/pro-git/" class="article-date">
      <time datetime="2012-06-01T15:20:15.000Z" itemprop="datePublished">2012-06-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Pro Git
    </h1>
  

        
        	<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <span class="post-count">152,885字</span>
      </span>
    </span>

    <span>&nbsp; | &nbsp;</span>

    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">956分</span>
      </span>
    </span>
    
	                
		
			<span id="busuanzi_container_page_pv" style='display:none'>
				<span id="page-visit"  title="本文总阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span>&nbsp; | &nbsp;</span> 阅读次数：
					<span id="busuanzi_value_page_pv">
					</span>
				</span>
	  		</span>
		
	
</div>
        
      </header>
      
      <div class="article-info article-info-post">
        
        	<br>
        	<br>
        
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/coding/">Coding</a>
    </div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <link rel="stylesheet" href="/assets/css/hint.min.css"></link><p>Pro Git</p>
<h1 id="Licence"><a href="#Licence" class="headerlink" title="Licence"></a><strong>Licence</strong></h1><p>This work is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License. To view a copy of this license, visit &lt;<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="noopener">http://creativecommons.org/licenses/by-nc-sa/3.0/</a>&gt; or send a letter to Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.</p>
<a id="more"></a>
<h1 id="Preface-by-Scott-Chacon"><a href="#Preface-by-Scott-Chacon" class="headerlink" title="Preface by Scott Chacon"></a><strong>Preface</strong> <strong>by</strong> <strong>Scott</strong> <strong>Chacon</strong></h1><p>Welcome to the second edition of Pro Git. The first edition was published over four years ago now. Since then a lot has changed and yet many important things have not. While most of the core commands and concepts are still valid today as the Git core team is pretty fantastic at keeping things backward compatible, there have been some significant additions and changes in the community surrounding Git. The second edition of this book is meant to address those changes and update the book so it can be more helpful to the new user.</p>
<p>When I wrote the first edition, Git was still a relatively difficult to use and barely adopted tool for the harder core hacker. It was starting to gain steam in certain communities, but had not reached anywhere near the ubiquity it has today. Since then, nearly every open source community has adopted it. Git has made incredible progress on Windows, in the explosion of graphical user interfaces to it for all platforms, in IDE support and in business use. The Pro Git of four years ago knows about none of that. One of the main aims of this new edition is to touch on all of those new frontiers in the Git community.</p>
<p>The Open Source community using Git has also exploded. When I originally sat down to write the book nearly five years ago (it took me a while to get the first version out), I had just started working at a very little known company developing a Git hosting website called GitHub. At the time of publishing there were maybe a few thousand people using the site and just four of us working on it. As I write this introduction, GitHub is announcing our 10 millionth hosted project, with nearly 5 million registered developer accounts and over 230 employees. Love it or hate it, GitHub has heavily changed large swaths of the Open Source community in a way that was barely conceivable when I sat down to write the first edition.</p>
<p>I wrote a small section in the original version of Pro Git about GitHub as an example of hosted Git which I was never very comfortable with. I didn’t much like that I was writing what I felt was essentially a community resource and also talking about my company in it. While I still don’t love that conflict of interests, the importance of GitHub in the Git community is unavoidable. Instead of an example of Git hosting, I have decided to turn that part of the book into more deeply describing what GitHub is and how to effectively use it. If you are going to learn how to use Git then knowing how to use GitHub will help you take part in a huge community, which is valuable no matter which Git host you decide to use for your own code.</p>
<p>The other large change in the time since the last publishing has been the development and rise of the HTTP protocol for Git network transactions. Most of the examples in the book have been changed to HTTP from SSH because it’s so much simpler.</p>
<p>It’s been amazing to watch Git grow over the past few years from a relatively obscure version control system to basically dominating commercial and open source version control. I’m happy that Pro Git has done so well and has also been able to be one of the few technical books on the market that is both quite successful and fully open source.</p>
<p>I hope you enjoy this updated edition of Pro Git.</p>
<h1 id="Preface-by-Ben-Straub"><a href="#Preface-by-Ben-Straub" class="headerlink" title="Preface by Ben Straub"></a><strong>Preface</strong> <strong>by</strong> <strong>Ben</strong> <strong>Straub</strong></h1><p>The first edition of this book is what got me hooked on Git. This was my introduction to a style of making software that felt more natural than anything I had seen before. I had been a developer for several years by then, but this was the right turn that sent me down a much more interesting path than the one I was on.</p>
<p>Now, years later, I’m a contributor to a major Git implementation, I’ve worked for the largest Git hosting company, and I’ve traveled the world teaching people about Git. When Scott asked if I’d be interested in working on the second edition, I didn’t even have to think.</p>
<p>It’s been a great pleasure and privilege to work on this book. I hope it helps you as much as it did me.</p>
<h1 id="Dedications"><a href="#Dedications" class="headerlink" title="Dedications"></a><strong>Dedications</strong></h1><p><em>To my wife, Becky, without whom this adventure never would have begun. — Ben</em></p>
<p><em>This edition is dedicated to my girls. To my wife Jessica who has supported me for all of these years and to my daughter Josephine, who will support me when I’m too old to know what’s going on. — Scott</em></p>
<h1 id="Contributors"><a href="#Contributors" class="headerlink" title="Contributors"></a><strong>Contributors</strong></h1><p>Since this is an Open Source book, we have gotten several errata and content changes donated over the years. Here are all the people who have contributed to the English version of Pro Git as an open source project. Thank you everyone for helping make this a better book for everyone.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">4wk-                            Justin Clift                    Severino Lorilla Jr</span><br><span class="line">Adrien Ollier                   Kaartic Sivaraam                Shengbin Meng</span><br><span class="line">Akrom K                         Kausar Mehmood                  Siarhei Krukau</span><br><span class="line">Aleh Suprunovich                Kenneth Kin Lum                 Skyper</span><br><span class="line">Alexander Bezzubov              Klaus Frank                     Snehal Shekatkar</span><br><span class="line">Alexandre Garnier               Kristijan "Fremen" Velkovski    Song Li</span><br><span class="line">Andrei Dascalu                  Krzysztof Szumny                Stephan van Maris</span><br><span class="line">Andrew MacFie                   Kyrylo Yatsenko                 Steven Roddis</span><br><span class="line">Andrew Metcalf                  Lars Vogel                      SudarsanGP</span><br><span class="line">Andrew Murphy                   Laxman                          Sven Selberg</span><br><span class="line">AndyGee                         Lazar95                         Thanix</span><br><span class="line">AnneTheAgile                    Leonard Laszlo                  Thomas Ackermann</span><br><span class="line">Anthony Loiseau                 Linus Heckemann                 Thomas Hartmann</span><br><span class="line">Anton Trunov                    Logan Hasson                    Tom Schady</span><br><span class="line">Antonello Piemonte              Louise Corrigan                 Tomoki Aonuma</span><br><span class="line">Antonino Ingargiola             Luc Morin                       Tyler Cipriani</span><br><span class="line">Atul Varma                      Lukas Röllin                    Vadim Markovtsev</span><br><span class="line">Ben Sima                        Marcin Sędłak-Jakubowski        Vangelis Katsikaros</span><br><span class="line">Benjamin Dopplinger             Marius Žilėnas                  Victor Ma</span><br><span class="line">Borek Bernard                   Markus KARG                     Vitaly Kuznetsov</span><br><span class="line">Brett Cannon                    Marti Bolivar                   William Gathoye</span><br><span class="line">Buzut                           Mashrur Mia (Sa'ad)             William Turrell</span><br><span class="line">C Nguyen                        Masood Fallahpoor               Wlodek Bzyl</span><br><span class="line">Cadel Watson                    Mathieu Dubreuilh               Yann Soubeyrand</span><br><span class="line">Carlos Martín Nieto             Matthew Miner                   Yue Lin Ho</span><br><span class="line">Chaitanya Gurrapu               Matthieu Moy                    Yunhai Luo</span><br><span class="line">Changwoo Park                   Michael MacAskill               Yusuke SATO</span><br><span class="line">Christoph Prokop                Michael Sheaver                 allen joslin</span><br><span class="line">Christopher Wilson              Michael Welch                   atalakam</span><br><span class="line">Cory Donnelly                   Michiel van der Wulp            axmbo</span><br><span class="line">Cullen Rhodes                   Mike Charles                    brotherben</span><br><span class="line">Cyril                           Mike Pennisi                    delta4d</span><br><span class="line">Damien Tournoud                 Mike Thibodeau                  devwebcl</span><br><span class="line">Dan Schmidt                     Niels Widger                    dualsky</span><br><span class="line">Daniel Shahaf                   Nils Reuße                      eyherabh</span><br><span class="line">Daniel Sturm                    Owen                            flip111</span><br><span class="line">Daniele Tricoli                 Pablo Schläpfer                 flyingzumwalt</span><br><span class="line">Danny Lin                       Pascal Berger                   goekboet</span><br><span class="line">David Rogers                    Pascal Borreli                  grgbnc</span><br><span class="line">Denis Savitskiy                 Patrick Steinhardt              haripetrov</span><br><span class="line">DiamondeX                       Pavel Janík                     i-give-up</span><br><span class="line">Dino Karic                      Paweł Krupiński                 iprok</span><br><span class="line">Dmitri Tikhonov                 Peter Kokot                     jingsam</span><br><span class="line">Explorare                       Philippe Miossec                johnhar</span><br><span class="line">Felix Nehrke                    Rafi                            maks</span><br><span class="line">Fornost461                      Raphael R                       mmikeww</span><br><span class="line">Frederico Mazzone               Ray Chen                        mosdalsvsocld</span><br><span class="line">Frej Drejhammar                 Reza Ahmadi                     nicktime</span><br><span class="line">Guthrie McAfee Armstrong        Richard Hoyle                   patrick96</span><br><span class="line">HairyFotr                       Ricky Senft                     paveljanik</span><br><span class="line">Haruo Nakayama                  Rintze M. Zelle                 pedrorijo91</span><br><span class="line">Helmut K. C. Tessarek           Rob Blanco                      petsuter</span><br><span class="line">Howard                          Robert P. Goldman               rahrah</span><br><span class="line">Ilker Cat                       Robert P. J. Day                rmzelle</span><br><span class="line">Jan Groenewald                  Rohan D'Souza                   root</span><br><span class="line">Jaswinder Singh                 Roman Kosenko                   sanders@oreilly.com</span><br><span class="line">Jean-Noël Avila                 Ronald Wampler                  spacewander</span><br><span class="line">Jeroen Oortwijn                 Rüdiger Herrmann                td2014</span><br><span class="line">Jim Hill                        SATO Yusuke                     twekberg</span><br><span class="line">Joel Davies                     Sam Ford                        uerdogan</span><br><span class="line">Johannes Dewender               Sam Joseph                      un1versal</span><br><span class="line">Johannes Schindelin             Sanders Kleinfeld               xJom</span><br><span class="line">Jon Forrest                     Sarah Schneider                 xtreak</span><br><span class="line">Jon Freed                       Saurav Sachidanand              yakirwin</span><br><span class="line">Jordan Hayashi                  Scott Bronson                   zwPapEr</span><br><span class="line">Joris Valette                   Sean Head                       ᐯᕮᒪᗝᑕᕮᒣ</span><br><span class="line">Joshua Webb                     Sebastian Krause                狄卢</span><br></pre></td></tr></table></figure>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a><strong>Introduction</strong></h1><p>You’re about to spend several hours of your life reading about Git. Let’s take a minute to explain what we have in store for you. Here is a quick summary of the ten chapters and three appendices of this book.</p>
<p>In <strong>Chapter 1</strong>, we’re going to cover Version Control Systems (VCSs) and Git basics — no technical stuff, just what Git is, why it came about in a land full of VCSs, what sets it apart, and why so many people are using it. Then, we’ll explain how to download Git and set it up for the first time if you don’t already have it on your system.</p>
<p>In <strong>Chapter 2</strong>, we will go over basic Git usage — how to use Git in the 80% of cases you’ll encounter most often. After reading this chapter, you should be able to clone a repository, see what has happened in the history of the project, modify files, and contribute changes. If the book spontaneously combusts at this point, you should already be pretty useful wielding Git in the time it takes you to go pick up another copy.</p>
<p><strong>Chapter 3</strong> is about the branching model in Git, often described as Git’s killer feature. Here you’ll learn what truly sets Git apart from the pack. When you’re done, you may feel the need to spend a quiet moment pondering how you lived before Git branching was part of your life.</p>
<p><strong>Chapter 4</strong> will cover Git on the server. This chapter is for those of you who want to set up Git inside your organization or on your own personal server for collaboration. We will also explore various hosted options if you prefer to let someone else handle that for you.</p>
<p><strong>Chapter 5</strong> will go over in full detail various distributed workflows and how to accomplish them with Git. When you are done with this chapter, you should be able to work expertly with multiple remote repositories, use Git over email and deftly juggle numerous remote branches and contributed patches.</p>
<p><strong>Chapter 6</strong> covers the GitHub hosting service and tooling in depth. We cover signing up for and managing an account, creating and using Git repositories, common workflows to contribute to projects and to accept contributions to yours, GitHub’s programmatic interface and lots of little tips to make your life easier in general.</p>
<p><strong>Chapter 7</strong> is about advanced Git commands. Here you will learn about topics like mastering the scary <em>reset</em> command, using binary search to identify bugs, editing history, revision selection in detail, and a lot more. This chapter will round out your knowledge of Git so that you are truly a master.</p>
<p><strong>Chapter 8</strong> is about configuring your custom Git environment. This includes setting up hook scripts to enforce or encourage customized policies and using environment configuration settings so you can work the way you want to. We will also cover building your own set of scripts to enforce a custom committing policy.</p>
<p><strong>Chapter 9</strong> deals with Git and other VCSs. This includes using Git in a Subversion (SVN) world and converting projects from other VCSs to Git. A lot of organizations still use SVN and are not about to change, but by this point you’ll have learned the incredible power of Git — and this chapter shows you how to cope if you still have to use a SVN server. We also cover how to import projects from several different systems in case you do convince everyone to make the plunge.</p>
<p><strong>Chapter 10</strong> delves into the murky yet beautiful depths of Git internals. Now that you know all about Git and can wield it with power and grace, you can move on to discuss how Git stores its objects, what the object model is, details of packfiles, server protocols, and more. Throughout the book, we will refer to sections of this chapter in case you feel like diving deep at that point; but if you are like us and want to dive into the technical details, you may want to read Chapter 10 first. We leave that up to you.</p>
<p>In <strong>Appendix A</strong>, we look at a number of examples of using Git in various specific environments. We cover a number of different GUIs and IDE programming environments that you may want to use Git in and what is available for you. If you’re interested in an overview of using Git in your shell, in Visual Studio or Eclipse, take a look here.</p>
<p>In <strong>Appendix B</strong>, we explore scripting and extending Git through tools like libgit2 and JGit. If you’re interested in writing complex and fast custom tools and need low-level Git access, this is where you can see what that landscape looks like.</p>
<p>Finally, in <strong>Appendix C</strong>, we go through all the major Git commands one at a time and review where in the book we covered them and what we did with them. If you want to know where in the book we used any specific Git command you can look that up here.</p>
<p>Let’s get started.</p>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a><strong>Getting</strong> <strong>Started</strong></h1><p>This chapter will be about getting started with Git. We will begin by explaining some background on version control tools, then move on to how to get Git running on your system and finally how to get it set up to start working with. At the end of this chapter you should understand why Git is around, why you should use it and you should be all set up to do so.</p>
<h2 id="About-Version-Control"><a href="#About-Version-Control" class="headerlink" title="About Version Control"></a>About Version Control</h2><p>What is “version control”, and why should you care? Version control is a system that records changes to a file or set of files over time so that you can recall specific versions later. For the examples in this book, you will use software source code as the files being version controlled, though in reality you can do this with nearly any type of file on a computer.</p>
<p>If you are a graphic or web designer and want to keep every version of an image or layout (which you would most certainly want to), a Version Control System (VCS) is a very wise thing to use. It allows you to revert selected files back to a previous state, revert the entire project back to a previous state, compare changes over time, see who last modified something that might be causing a problem, who introduced an issue and when, and more. Using a VCS also generally means that if you screw things up or lose files, you can easily recover. In addition, you get all this for very little overhead.</p>
<h3 id="Local-Version-Control-Systems"><a href="#Local-Version-Control-Systems" class="headerlink" title="Local Version Control Systems"></a>Local Version Control Systems</h3><p>Many people’s version-control method of choice is to copy files into another directory (perhaps a time-stamped directory, if they’re clever). This approach is very common because it is so simple, but it is also incredibly error prone. It is easy to forget which directory you’re in and accidentally write to the wrong file or copy over files you don’t mean to.</p>
<p>To deal with this issue, programmers long ago developed local VCSs that had a simple database that kept all the changes to files under revision control.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj9hb3xj20m80izq37.jpg" alt="Local version control diagram"></p>
<p>Figure 1. Local version control.  One of the more popular VCS tools was a system called RCS, which is still distributed with many computers today. RCS works by keeping patch sets (that is, the differences between files) in a special format on disk; it can then re-create what any file looked like at any point in time by adding up all the patches.</p>
<h3 id="Centralized-Version-Control-Systems"><a href="#Centralized-Version-Control-Systems" class="headerlink" title="Centralized Version Control Systems"></a>Centralized Version Control Systems</h3><p>The next major issue that people encounter is that they need to collaborate with developers on other systems. To deal with this problem, Centralized Version Control Systems (CVCSs) were developed. These systems (such as CVS, Subversion, and Perforce) have a single server that contains all the versioned files, and a number of clients that check out files from that central place. For many years, this has been the standard for version control.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjo3iirj20m80fgaae.jpg" alt="Centralized version control diagram">  Figure 2. Centralized version control.  This setup offers many advantages, especially over local VCSs. For example, everyone knows to a certain degree what everyone else on the project is doing. Administrators have fine-grained control over who can do what, and it’s far easier to administer a CVCS than it is to deal with local databases on every client.</p>
<p>However, this setup also has some serious downsides. The most obvious is the single point of failure that the centralized server represents. If that server goes down for an hour, then during that hour nobody can collaborate at all or save versioned changes to anything they’re working on. If the hard disk the central database is on becomes corrupted, and proper backups haven’t been kept, you lose absolutely everything — the entire history of the project except whatever single snapshots people happen to have on their local machines. Local VCS systems suffer from this same problem — whenever you have the entire history of the project in a single place, you risk losing everything.</p>
<h3 id="Distributed-Version-Control-Systems"><a href="#Distributed-Version-Control-Systems" class="headerlink" title="Distributed Version Control Systems"></a>Distributed Version Control Systems</h3><p>This is where Distributed Version Control Systems (DVCSs) step in. In a DVCS (such as Git, Mercurial, Bazaar or Darcs), clients don’t just check out the latest snapshot of the files; rather, they fully mirror the repository, including its full history. Thus, if any server dies, and these systems were collaborating via that server, any of the client repositories can be copied back up to the server to restore it. Every clone is really a full backup of all the data.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjl8scpj20ik0m80t6.jpg" alt="Distributed version control diagram">  Figure 3. Distributed version control.  Furthermore, many of these systems deal pretty well with having several remote repositories they can work with, so you can collaborate with different groups of people in different ways simultaneously within the same project. This allows you to set up several types of workflows that aren’t possible in centralized systems, such as hierarchical models.</p>
<h2 id="A-Short-History-of-Git"><a href="#A-Short-History-of-Git" class="headerlink" title="A Short History of Git"></a>A Short History of Git</h2><p>As with many great things in life, Git began with a bit of creative destruction and fiery controversy.</p>
<p>The Linux kernel is an open source software project of fairly large scope. For most of the lifetime of the Linux kernel maintenance (1991–2002), changes to the software were passed around as patches and archived files. In 2002, the Linux kernel project began using a proprietary DVCS called BitKeeper.</p>
<p>In 2005, the relationship between the community that developed the Linux kernel and the commercial company that developed BitKeeper broke down, and the tool’s free-of-charge status was revoked. This prompted the Linux development community (and in particular Linus Torvalds, the creator of Linux) to develop their own tool based on some of the lessons they learned while using BitKeeper. Some of the goals of the new system were as follows:</p>
<ul>
<li>Speed</li>
<li>Simple design</li>
<li>Strong support for non-linear development (thousands of parallel branches)</li>
<li>Fully distributed</li>
<li>Able to handle large projects like the Linux kernel efficiently (speed and data size)<br>Since its birth in 2005, Git has evolved and matured to be easy to use and yet retain these initial qualities. It’s amazingly fast, it’s very efficient with large projects, and it has an incredible branching system for non-linear development (See 【Git Branching】).</li>
</ul>
<h2 id="Git-Basics"><a href="#Git-Basics" class="headerlink" title="Git Basics"></a>Git Basics</h2><p>So, what is Git in a nutshell? This is an important section to absorb, because if you understand what Git is and the fundamentals of how it works, then using Git effectively will probably be much easier for you. As you learn Git, try to clear your mind of the things you may know about other VCSs, such as CVS, Subversion or Perforce — doing so will help you avoid subtle confusion when using the tool. Even though Git’s user interface is fairly similar to these other VCSs, Git stores and thinks about information in a very different way, and understanding these differences will help you avoid becoming confused while using it.</p>
<h3 id="Snapshots-Not-Differences"><a href="#Snapshots-Not-Differences" class="headerlink" title="Snapshots, Not Differences"></a>Snapshots, Not Differences</h3><p>The major difference between Git and any other VCS (Subversion and friends included) is the way Git thinks about its data. Conceptually, most other systems store information as a list of file-based changes. These other systems (CVS, Subversion, Perforce, Bazaar, and so on) think of the information they store as a set of files and the changes made to each file over time (this is commonly described as <em>delta-based</em> version control).</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjvjruaj20m808mq33.jpg" alt="Storing data as changes to a base version of each file.">  Figure 4. Storing data as changes to a base version of each file.  Git doesn’t think of or store its data this way. Instead, Git thinks of its data more like a series of snapshots of a miniature filesystem. With Git, every time you commit, or save the state of your project, Git basically takes a picture of what all your files look like at that moment and stores a reference to that snapshot. To be efficient, if files have not changed, Git doesn’t store the file again, just a link to the previous identical file it has already stored. Git thinks about its data more like a <strong>stream of snapshots</strong>.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjss74rj20m808h74k.jpg" alt="Git stores data as snapshots of the project over time.">  Figure 5. Storing data as snapshots of the project over time.  This is an important distinction between Git and nearly all other VCSs. It makes Git reconsider almost every aspect of version control that most other systems copied from the previous generation. This makes Git more like a mini filesystem with some incredibly powerful tools built on top of it, rather than simply a VCS. We’ll explore some of the benefits you gain by thinking of your data this way when we cover Git branching in 【Git Branching】.</p>
<h3 id="Nearly-Every-Operation-Is-Local"><a href="#Nearly-Every-Operation-Is-Local" class="headerlink" title="Nearly Every Operation Is Local"></a>Nearly Every Operation Is Local</h3><p>Most operations in Git need only local files and resources to operate — generally no information is needed from another computer on your network. If you’re used to a CVCS where most operations have that network latency overhead, this aspect of Git will make you think that the gods of speed have blessed Git with unworldly powers. Because you have the entire history of the project right there on your local disk, most operations seem almost instantaneous.</p>
<p>For example, to browse the history of the project, Git doesn’t need to go out to the server to get the history and display it for you — it simply reads it directly from your local database. This means you see the project history almost instantly. If you want to see the changes introduced between the current version of a file and the file a month ago, Git can look up the file a month ago and do a local difference calculation, instead of having to either ask a remote server to do it or pull an older version of the file from the remote server to do it locally.</p>
<p>This also means that there is very little you can’t do if you’re offline or off VPN. If you get on an airplane or a train and want to do a little work, you can commit happily (to your <em>local</em> copy, remember?) until you get to a network connection to upload. If you go home and can’t get your VPN client working properly, you can still work. In many other systems, doing so is either impossible or painful. In Perforce, for example, you can’t do much when you aren’t connected to the server; and in Subversion and CVS, you can edit files, but you can’t commit changes to your database (because your database is offline). This may not seem like a huge deal, but you may be surprised what a big difference it can make.</p>
<h3 id="Git-Has-Integrity"><a href="#Git-Has-Integrity" class="headerlink" title="Git Has Integrity"></a>Git Has Integrity</h3><p>Everything in Git is check-summed before it is stored and is then referred to by that checksum. This means it’s impossible to change the contents of any file or directory without Git knowing about it. This functionality is built into Git at the lowest levels and is integral to its philosophy. You can’t lose information in transit or get file corruption without Git being able to detect it.</p>
<p>The mechanism that Git uses for this checksumming is called a SHA-1 hash. This is a 40-character string composed of hexadecimal characters (0–9 and a–f) and calculated based on the contents of a file or directory structure in Git. A SHA-1 hash looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24b9da6552252987aa493b52f8696cd6d3b00373</span><br></pre></td></tr></table></figure>
<p>You will see these hash values all over the place in Git because it uses them so much. In fact, Git stores everything in its database not by file name but by the hash value of its contents.</p>
<h3 id="Git-Generally-Only-Adds-Data"><a href="#Git-Generally-Only-Adds-Data" class="headerlink" title="Git Generally Only Adds Data"></a>Git Generally Only Adds Data</h3><p>When you do actions in Git, nearly all of them only <em>add</em> data to the Git database. It is hard to get the system to do anything that is not undoable or to make it erase data in any way. As with any VCS, you can lose or mess up changes you haven’t committed yet, but after you commit a snapshot into Git, it is very difficult to lose, especially if you regularly push your database to another repository.</p>
<p>This makes using Git a joy because we know we can experiment without the danger of severely screwing things up. For a more in-depth look at how Git stores its data and how you can recover data that seems lost, see 【Undoing Things】.</p>
<h3 id="The-Three-States"><a href="#The-Three-States" class="headerlink" title="The Three States"></a>The Three States</h3><p>Pay attention now — here is the main thing to remember about Git if you want the rest of your learning process to go smoothly. Git has three main states that your files can reside in: <em>committed</em>, <em>modified</em>, and <em>staged</em>:</p>
<ul>
<li>Committed means that the data is safely stored in your local database.</li>
<li>Modified means that you have changed the file but have not committed it to your database yet.</li>
<li>Staged means that you have marked a modified file in its current version to go into your next commit snapshot.<br>This leads us to the three main sections of a Git project: the Git directory, the working tree, and the staging area.</li>
</ul>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclwf7ssj20m80c90sy.jpg" alt="Working tree, staging area, and Git directory.">  Figure 6. Working tree, staging area, and Git directory.  The Git directory is where Git stores the metadata and object database for your project. This is the most important part of Git, and it is what is copied when you <em>clone</em> a repository from another computer.</p>
<p>The working tree is a single checkout of one version of the project. These files are pulled out of the compressed database in the Git directory and placed on disk for you to use or modify.</p>
<p>The staging area is a file, generally contained in your Git directory, that stores information about what will go into your next commit. Its technical name in Git parlance is the “index”, but the phrase “staging area” works just as well.</p>
<p>The basic Git workflow goes something like this:</p>
<ol start="2">
<li>You modify files in your working tree.</li>
<li>You selectively stage just those changes you want to be part of your next commit, which adds <em>only</em> those changes to the staging area.</li>
<li>You do a commit, which takes the files as they are in the staging area and stores that snapshot permanently to your Git directory.<br>If a particular version of a file is in the Git directory, it’s considered committed. If it has been modified and was added to the staging area, it is staged. And if it was changed since it was checked out but has not been staged, it is modified. In 【Git Basics】, you’ll learn more about these states and how you can either take advantage of them or skip the staged part entirely.</li>
</ol>
<h2 id="The-Command-Line"><a href="#The-Command-Line" class="headerlink" title="The Command Line"></a>The Command Line</h2><p>There are a lot of different ways to use Git. There are the original command-line tools, and there are many graphical user interfaces of varying capabilities. For this book, we will be using Git on the command line. For one, the command line is the only place you can run <em>all</em> Git commands — most of the GUIs implement only a partial subset of Git functionality for simplicity. If you know how to run the command-line version, you can probably also figure out how to run the GUI version, while the opposite is not necessarily true. Also, while your choice of graphical client is a matter of personal taste, <em>all</em> users will have the command-line tools installed and available.</p>
<p>So we will expect you to know how to open Terminal in Mac or Command Prompt or Powershell in Windows. If you don’t know what we’re talking about here, you may need to stop and research that quickly so that you can follow the rest of the examples and descriptions in this book.</p>
<h2 id="Installing-Git"><a href="#Installing-Git" class="headerlink" title="Installing Git"></a>Installing Git</h2><p>Before you start using Git, you have to make it available on your computer. Even if it’s already installed, it’s probably a good idea to update to the latest version. You can either install it as a package or via another installer, or download the source code and compile it yourself.</p>
<p>This book was written using Git version <strong>2.0.0</strong>. Though most of the commands we use should work even in ancient versions of Git, some of them might not or might act slightly differently if you’re using an older version. Since Git is quite excellent at preserving backwards compatibility, any version after 2.0 should work just fine.</p>
<h3 id="Installing-on-Linux"><a href="#Installing-on-Linux" class="headerlink" title="Installing on Linux"></a>Installing on Linux</h3><p>If you want to install the basic Git tools on Linux via a binary installer, you can generally do so through the package management tool that comes with your distribution. If you’re on Fedora (or any closely-related RPM-based distribution, such as RHEL or CentOS), you can use <code>dnf</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dnf install git-all</span><br></pre></td></tr></table></figure>
<p>If you’re on a Debian-based distribution, such as Ubuntu, try <code>apt</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install git-all</span><br></pre></td></tr></table></figure>
<p>For more options, there are instructions for installing on several different Unix distributions on the Git website, at &lt;<a href="http://git-scm.com/download/linux" target="_blank" rel="noopener">http://git-scm.com/download/linux</a>&gt;.</p>
<h3 id="Installing-on-Mac"><a href="#Installing-on-Mac" class="headerlink" title="Installing on Mac"></a>Installing on Mac</h3><p>There are several ways to install Git on a Mac. The easiest is probably to install the Xcode Command Line Tools. On Mavericks (10.9) or above you can do this simply by trying to run <em>git</em> from the Terminal the very first time.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git --version</span><br></pre></td></tr></table></figure>
<p>If you don’t have it installed already, it will prompt you to install it.</p>
<p>If you want a more up to date version, you can also install it via a binary installer. A macOS Git installer is maintained and available for download at the Git website, at &lt;<a href="http://git-scm.com/download/mac" target="_blank" rel="noopener">http://git-scm.com/download/mac</a>&gt;.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmb99lgj20m80g4gmn.jpg" alt="Git macOS installer.">  Figure 7. Git macOS Installer.  You can also install it as part of the GitHub for Mac install. Their GUI Git tool has an option to install command line tools as well. You can download that tool from the GitHub for Mac website, at &lt;<a href="http://mac.github.com" target="_blank" rel="noopener">http://mac.github.com</a>&gt;.</p>
<h3 id="Installing-on-Windows"><a href="#Installing-on-Windows" class="headerlink" title="Installing on Windows"></a>Installing on Windows</h3><p>There are also a few ways to install Git on Windows. The most official build is available for download on the Git website. Just go to &lt;<a href="http://git-scm.com/download/win" target="_blank" rel="noopener">http://git-scm.com/download/win</a>&gt; and the download will start automatically. Note that this is a project called Git for Windows, which is separate from Git itself; for more information on it, go to &lt;<a href="https://git-for-windows.github.io/" target="_blank" rel="noopener">https://git-for-windows.github.io/</a>&gt;.</p>
<p>To get an automated installation you can use the <a href="https://chocolatey.org/packages/git" target="_blank" rel="noopener">Git Chocolatey package</a>. Note that the Chocolatey package is community maintained.</p>
<p>Another easy way to get Git installed is by installing GitHub Desktop. The installer includes a command line version of Git as well as the GUI. It also works well with Powershell, and sets up solid credential caching and sane CRLF settings. We’ll learn more about those things a little later, but suffice it to say they’re things you want. You can download this from the <a href="https://desktop.github.com/" target="_blank" rel="noopener">GitHub Desktop website</a>.</p>
<h3 id="Installing-from-Source"><a href="#Installing-from-Source" class="headerlink" title="Installing from Source"></a>Installing from Source</h3><p>Some people may instead find it useful to install Git from source, because you’ll get the most recent version. The binary installers tend to be a bit behind, though as Git has matured in recent years, this has made less of a difference.</p>
<p>If you do want to install Git from source, you need to have the following libraries that Git depends on: autotools, curl, zlib, openssl, expat, and libiconv. For example, if you’re on a system that has <code>dnf</code> (such as Fedora) or <code>apt-get</code> (such as a Debian-based system), you can use one of these commands to install the minimal dependencies for compiling and installing the Git binaries:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dnf install dh-autoreconf curl-devel expat-devel gettext-devel \</span><br><span class="line">  openssl-devel perl-devel zlib-devel</span><br><span class="line">$ sudo apt-get install dh-autoreconf libcurl4-gnutls-dev libexpat1-dev \</span><br><span class="line">  gettext libz-dev libssl-dev</span><br></pre></td></tr></table></figure>
<p>In order to be able to add the documentation in various formats (doc, html, info), these additional dependencies are required (Note: users of RHEL and RHEL-derivatives like CentOS and Scientific Linux will have to <a href="https://fedoraproject.org/wiki/EPEL#How_can_I_use_these_extra_packages.3F" target="_blank" rel="noopener">enable the EPEL repository</a> to download the <code>docbook2X</code> package):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dnf install asciidoc xmlto docbook2X</span><br><span class="line">$ sudo apt-get install asciidoc xmlto docbook2x</span><br></pre></td></tr></table></figure>
<p>If you’re using a Debian-based distribution (Debian/Ubuntu/Ubuntu-derivatives), you also need the <code>install-info</code> package:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install install-info</span><br></pre></td></tr></table></figure>
<p>If you’re using a RPM-based distribution (Fedora/RHEL/RHEL-derivatives), you also need the <code>getopt</code> package (which is already installed on a Debian-based distro):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dnf install getopt</span><br><span class="line">$ sudo apt-get install getopt</span><br></pre></td></tr></table></figure>
<p>Additionally, if you’re using Fedora/RHEL/RHEL-derivatives, you need to do this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ln -s /usr/bin/db2x_docbook2texi /usr/bin/docbook2x-texi</span><br></pre></td></tr></table></figure>
<p>due to binary name differences.</p>
<p>When you have all the necessary dependencies, you can go ahead and grab the latest tagged release tarball from several places. You can get it via the kernel.org site, at &lt;<a href="https://www.kernel.org/pub/software/scm/git" target="_blank" rel="noopener">https://www.kernel.org/pub/software/scm/git</a>&gt;, or the mirror on the GitHub website, at &lt;<a href="https://github.com/git/git/releases" target="_blank" rel="noopener">https://github.com/git/git/releases</a>&gt;. It’s generally a little clearer what the latest version is on the GitHub page, but the kernel.org page also has release signatures if you want to verify your download.</p>
<p>Then, compile and install:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxf git-2.0.0.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> git-2.0.0</span><br><span class="line">$ make configure</span><br><span class="line">$ ./configure --prefix=/usr</span><br><span class="line">$ make all doc info</span><br><span class="line">$ sudo make install install-doc install-html install-info</span><br></pre></td></tr></table></figure>
<p>After this is done, you can also get Git via Git itself for updates:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://git.kernel.org/pub/scm/git/git.git</span><br></pre></td></tr></table></figure>
<h2 id="First-Time-Git-Setup"><a href="#First-Time-Git-Setup" class="headerlink" title="First-Time Git Setup"></a>First-Time Git Setup</h2><p>Now that you have Git on your system, you’ll want to do a few things to customize your Git environment. You should have to do these things only once on any given computer; they’ll stick around between upgrades. You can also change them at any time by running through the commands again.</p>
<p>Git comes with a tool called <code>git config</code> that lets you get and set configuration variables that control all aspects of how Git looks and operates. These variables can be stored in three different places:</p>
<ol start="2">
<li><code>/etc/gitconfig</code> file: Contains values applied to every user on the system and all their repositories. If you pass the option <code>--system</code> to <code>git config</code>, it reads and writes from this file specifically. (Because this is a system configuration file, you would need administrative or superuser privilege to make changes to it.)</li>
<li><code>~/.gitconfig</code> or <code>~/.config/git/config</code> file: Values specific personally to you, the user. You can make Git read and write to this file specifically by passing the <code>--global</code> option, and this affects <em>all</em> of the repositories you work with on your system.</li>
<li><code>config</code> file in the Git directory (that is, <code>.git/config</code>) of whatever repository you’re currently using: Specific to that single repository. You can force Git to read from and write to this file with the <code>--local</code> option, but that is in fact the default. (Unsurprisingly, you need to be located somewhere in a Git repository for this option to work properly.)<br>Each level overrides values in the previous level, so values in <code>.git/config</code> trump those in <code>/etc/gitconfig</code>.</li>
</ol>
<p>On Windows systems, Git looks for the <code>.gitconfig</code> file in the <code>$HOME</code> directory (<code>C:\Users\$USER</code> for most people). It also still looks for <code>/etc/gitconfig</code>, although it’s relative to the MSys root, which is wherever you decide to install Git on your Windows system when you run the installer. If you are using version 2.x or later of Git for Windows, there is also a system-level config file at <code>C:\Documents and Settings\All Users\Application Data\Git\config</code> on Windows XP, and in <code>C:\ProgramData\Git\config</code> on Windows Vista and newer. This config file can only be changed by <code>git config -f &lt;file&gt;</code> as an admin.</p>
<h3 id="Your-Identity"><a href="#Your-Identity" class="headerlink" title="Your Identity"></a>Your Identity</h3><p>The first thing you should do when you install Git is to set your user name and email address. This is important because every Git commit uses this information, and it’s immutably baked into the commits you start creating:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">"John Doe"</span></span><br><span class="line">$ git config --global user.email johndoe@example.com</span><br></pre></td></tr></table></figure>
<p>Again, you need to do this only once if you pass the <code>--global</code> option, because then Git will always use that information for anything you do on that system. If you want to override this with a different name or email address for specific projects, you can run the command without the <code>--global</code> option when you’re in that project.</p>
<p>Many of the GUI tools will help you do this when you first run them.</p>
<h3 id="Your-Editor"><a href="#Your-Editor" class="headerlink" title="Your Editor"></a>Your Editor</h3><p>Now that your identity is set up, you can configure the default text editor that will be used when Git needs you to type in a message. If not configured, Git uses your system’s default editor.</p>
<p>If you want to use a different text editor, such as Emacs, you can do the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.editor emacs</span><br></pre></td></tr></table></figure>
<p>On a Windows system, if you want to use a different text editor, you must specify the full path to its executable file. This can be different depending on how your editor is packaged.</p>
<p>In the case of Notepad++, a popular programming editor, you are likely to want to use the 32-bit version, since at the time of writing the 64-bit version doesn’t support all plug-ins. If you are on a 32-bit Windows system, or you have a 64-bit editor on a 64-bit system, you’ll type something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.editor <span class="string">"'C:/Program Files/Notepad++/notepad++.exe' -multiInst -nosession"</span></span><br></pre></td></tr></table></figure>
<p>If you have a 32-bit editor on a 64-bit system, the program will be installed in <code>C:\Program Files (x86)</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.editor <span class="string">"'C:/Program Files (x86)/Notepad++/notepad++.exe' -multiInst -nosession"</span></span><br></pre></td></tr></table></figure>
<p>Vim, Emacs and Notepad++ are popular text editors often used by developers on Unix-based systems like Linux and macOS or a Windows system. If you are not familiar with these editors, you may need to search for specific instructions for how to set up your favorite editor with Git.</p>
<p>You may find, if you don’t setup your editor like this, you get into a really confusing state when Git attempts to launch it. An example on a Windows system may include a prematurely terminated Git operation during a Git initiated edit.</p>
<h3 id="Checking-Your-Settings"><a href="#Checking-Your-Settings" class="headerlink" title="Checking Your Settings"></a>Checking Your Settings</h3><p>If you want to check your configuration settings, you can use the <code>git config --list</code> command to list all the settings Git can find at that point:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git config --list</span><br><span class="line">user.name=John Doe</span><br><span class="line">user.email=johndoe@example.com</span><br><span class="line">color.status=auto</span><br><span class="line">color.branch=auto</span><br><span class="line">color.interactive=auto</span><br><span class="line">color.diff=auto</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>You may see keys more than once, because Git reads the same key from different files (<code>/etc/gitconfig</code> and <code>~/.gitconfig</code>, for example). In this case, Git uses the last value for each unique key it sees.</p>
<p>You can also check what Git thinks a specific key’s value is by typing <code>git config &lt;key&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config user.name</span><br><span class="line">John Doe</span><br></pre></td></tr></table></figure>
<p>Since Git might read the same configuration variable value from more than one file, it’s possible that you have an unexpected value for one of these values and you don’t know why. In cases like that, you can query Git as to the <em>origin</em> for that value, and it will tell you which configuration file had the final say in setting that value:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --show-origin rerere.autoUpdate</span><br><span class="line">file:/home/johndoe/.gitconfig	<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="Getting-Help"><a href="#Getting-Help" class="headerlink" title="Getting Help"></a>Getting Help</h2><p>If you ever need help while using Git, there are two equivalent ways to get the comprehensive manual page (manpage) help for any of the Git commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">help</span> &lt;verb&gt;</span><br><span class="line">$ man git-&lt;verb&gt;</span><br></pre></td></tr></table></figure>
<p>For example, you can get the manpage help for the <code>git config</code> command by running</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">help</span> config</span><br></pre></td></tr></table></figure>
<p>These commands are nice because you can access them anywhere, even offline. If the manpages and this book aren’t enough and you need in-person help, you can try the <code>#git</code> or <code>#github</code> channel on the Freenode IRC server (irc.freenode.net). These channels are regularly filled with hundreds of people who are all very knowledgeable about Git and are often willing to help.</p>
<p>In addition, if you don’t need the full-blown manpage help, but just need a quick refresher on the available options for a Git command, you can ask for the more concise “help” output with the <code>-h</code> or <code>--help</code> options, as in:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git add -h</span><br><span class="line">usage: git add [&lt;options&gt;] [--] &lt;pathspec&gt;...</span><br><span class="line"></span><br><span class="line">    -n, --dry-run         dry run</span><br><span class="line">    -v, --verbose         be verbose</span><br><span class="line"></span><br><span class="line">    -i, --interactive     interactive picking</span><br><span class="line">    -p, --patch           select hunks interactively</span><br><span class="line">    -e, --edit            edit current diff and apply</span><br><span class="line">    -f, --force           allow adding otherwise ignored files</span><br><span class="line">    -u, --update          update tracked files</span><br><span class="line">    -N, --intent-to-add   record only the fact that the path will be added later</span><br><span class="line">    -A, --all             add changes from all tracked and untracked files</span><br><span class="line">    --ignore-removal      ignore paths removed <span class="keyword">in</span> the working tree (same as --no-all)</span><br><span class="line">    --refresh             don<span class="string">'t add, only refresh the index</span></span><br><span class="line"><span class="string">    --ignore-errors       just skip files which cannot be added because of errors</span></span><br><span class="line"><span class="string">    --ignore-missing      check if - even missing - files are ignored in dry run</span></span><br><span class="line"><span class="string">    --chmod &lt;(+/-)x&gt;      override the executable bit of the listed files</span></span><br></pre></td></tr></table></figure>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>You should have a basic understanding of what Git is and how it’s different from any centralized version control systems you may have been using previously. You should also now have a working version of Git on your system that’s set up with your personal identity. It’s now time to learn some Git basics.</p>
<h1 id="Git-Basics-1"><a href="#Git-Basics-1" class="headerlink" title="Git Basics"></a><strong>Git</strong> <strong>Basics</strong></h1><p>If you can read only one chapter to get going with Git, this is it. This chapter covers every basic command you need to do the vast majority of the things you’ll eventually spend your time doing with Git. By the end of the chapter, you should be able to configure and initialize a repository, begin and stop tracking files, and stage and commit changes. We’ll also show you how to set up Git to ignore certain files and file patterns, how to undo mistakes quickly and easily, how to browse the history of your project and view changes between commits, and how to push and pull from remote repositories.</p>
<h2 id="Getting-a-Git-Repository"><a href="#Getting-a-Git-Repository" class="headerlink" title="Getting a Git Repository"></a>Getting a Git Repository</h2><p>You typically obtain a Git repository in one of two ways:</p>
<ol start="2">
<li>You can take a local directory that is currently not under version control, and turn it into a Git repository, or</li>
<li>You can <em>clone</em> an existing Git repository from elsewhere.<br>In either case, you end up with a Git repository on your local machine, ready for work.</li>
</ol>
<h3 id="Initializing-a-Repository-in-an-Existing-Directory"><a href="#Initializing-a-Repository-in-an-Existing-Directory" class="headerlink" title="Initializing a Repository in an Existing Directory"></a>Initializing a Repository in an Existing Directory</h3><p>If you have a project directory that is currently not under version control and you want to start controlling it with Git, you first need to go to that project’s directory. If you’ve never done this, it looks a little different depending on which system you’re running:</p>
<p>for Linux:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/user/my_project</span><br></pre></td></tr></table></figure>
<p>for Mac:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /Users/user/my_project</span><br></pre></td></tr></table></figure>
<p>for Windows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /c/user/my_project</span><br></pre></td></tr></table></figure>
<p>and type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br></pre></td></tr></table></figure>
<p>This creates a new subdirectory named <code>.git</code> that contains all of your necessary repository files — a Git repository skeleton. At this point, nothing in your project is tracked yet. (See 【Git Internals】 for more information about exactly what files are contained in the <code>.git</code> directory you just created.)</p>
<p>If you want to start version-controlling existing files (as opposed to an empty directory), you should probably begin tracking those files and do an initial commit. You can accomplish that with a few <code>git add</code> commands that specify the files you want to track, followed by a <code>git commit</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add *.c</span><br><span class="line">$ git add LICENSE</span><br><span class="line">$ git commit -m <span class="string">'initial project version'</span></span><br></pre></td></tr></table></figure>
<p>We’ll go over what these commands do in just a minute. At this point, you have a Git repository with tracked files and an initial commit.</p>
<h3 id="Cloning-an-Existing-Repository"><a href="#Cloning-an-Existing-Repository" class="headerlink" title="Cloning an Existing Repository"></a>Cloning an Existing Repository</h3><p>If you want to get a copy of an existing Git repository — for example, a project you’d like to contribute to — the command you need is <code>git clone</code>. If you’re familiar with other VCS systems such as Subversion, you’ll notice that the command is “clone” and not “checkout”. This is an important distinction — instead of getting just a working copy, Git receives a full copy of nearly all data that the server has. Every version of every file for the history of the project is pulled down by default when you run <code>git clone</code>. In fact, if your server disk gets corrupted, you can often use nearly any of the clones on any client to set the server back to the state it was in when it was cloned (you may lose some server-side hooks and such, but all the versioned data would be there — see 【Getting Git on a Server】 for more details).</p>
<p>You clone a repository with <code>git clone &lt;url&gt;</code>. For example, if you want to clone the Git linkable library called <code>libgit2</code>, you can do so like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/libgit2/libgit2](https://github.com/libgit2/libgit2)</span><br></pre></td></tr></table></figure>
<p>That creates a directory named <code>libgit2</code>, initializes a <code>.git</code> directory inside it, pulls down all the data for that repository, and checks out a working copy of the latest version. If you go into the new <code>libgit2</code> directory that was just created, you’ll see the project files in there, ready to be worked on or used.</p>
<p>If you want to clone the repository into a directory named something other than <code>libgit2</code>, you can specify the new directory name as an additional argument:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/libgit2/libgit2](https://github.com/libgit2/libgit2) mylibgit</span><br></pre></td></tr></table></figure>
<p>That command does the same thing as the previous one, but the target directory is called <code>mylibgit</code>.</p>
<p>Git has a number of different transfer protocols you can use. The previous example uses the <code>https://</code> protocol, but you may also see <code>git://</code> or <code>user@server:path/to/repo.git</code>, which uses the SSH transfer protocol. 【Getting Git on a Server】 will introduce all of the available options the server can set up to access your Git repository and the pros and cons of each.</p>
<h2 id="Recording-Changes-to-the-Repository"><a href="#Recording-Changes-to-the-Repository" class="headerlink" title="Recording Changes to the Repository"></a>Recording Changes to the Repository</h2><p>At this point, you should have a <em>bona fide</em> Git repository on your local machine, and a checkout or <em>working copy</em> of all of its files in front of you. Typically, you’ll want to start making changes and committing snapshots of those changes into your repository each time the project reaches a state you want to record.</p>
<p>Remember that each file in your working directory can be in one of two states: <em>tracked</em> or <em>untracked</em>. Tracked files are files that were in the last snapshot; they can be unmodified, modified, or staged. In short, tracked files are files that Git knows about.</p>
<p>Untracked files are everything else — any files in your working directory that were not in your last snapshot and are not in your staging area. When you first clone a repository, all of your files will be tracked and unmodified because Git just checked them out and you haven’t edited anything.</p>
<p>As you edit files, Git sees them as modified, because you’ve changed them since your last commit. As you work, you selectively stage these modified files and then commit all those staged changes, and the cycle repeats.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjb0didj20m8096dfx.jpg" alt="The lifecycle of the status of your files.">  Figure 1. The lifecycle of the status of your files.</p>
<h3 id="Checking-the-Status-of-Your-Files"><a href="#Checking-the-Status-of-Your-Files" class="headerlink" title="Checking the Status of Your Files"></a>Checking the Status of Your Files</h3><p>The main tool you use to determine which files are in which state is the <code>git status</code> command. If you run this command directly after a clone, you should see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>
<p>This means you have a clean working directory — in other words, none of your tracked files are modified. Git also doesn’t see any untracked files, or they would be listed here. Finally, the command tells you which branch you’re on and informs you that it has not diverged from the same branch on the server. For now, that branch is always “master”, which is the default; you won’t worry about it here. 【Git Branching】 will go over branches and references in detail.</p>
<p>Let’s say you add a new file to your project, a simple <code>README</code> file. If the file didn’t exist before, and you run <code>git status</code>, you see your untracked file like so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'My Project'</span> &gt; README</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">    README</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<p>You can see that your new <code>README</code> file is untracked, because it’s under the “Untracked files” heading in your status output. Untracked basically means that Git sees a file you didn’t have in the previous snapshot (commit); Git won’t start including it in your commit snapshots until you explicitly tell it to do so. It does this so you don’t accidentally begin including generated binary files or other files that you did not mean to include. You do want to start including <code>README</code>, so let’s start tracking the file.</p>
<h3 id="Tracking-New-Files"><a href="#Tracking-New-Files" class="headerlink" title="Tracking New Files"></a>Tracking New Files</h3><p>In order to begin tracking a new file, you use the command <code>git add</code>. To begin tracking the <code>README</code> file, you can run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add README</span><br></pre></td></tr></table></figure>
<p>If you run your status command again, you can see that your <code>README</code> file is now tracked and staged to be committed:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    new file:   README</span><br></pre></td></tr></table></figure>
<p>You can tell that it’s staged because it’s under the “Changes to be committed” heading. If you commit at this point, the version of the file at the time you ran <code>git add</code> is what will be in the historical snapshot. You may recall that when you ran <code>git init</code> earlier, you then ran <code>git add &lt;files&gt;</code> — that was to begin tracking files in your directory. The <code>git add</code> command takes a path name for either a file or a directory; if it’s a directory, the command adds all the files in that directory recursively.</p>
<h3 id="Staging-Modified-Files"><a href="#Staging-Modified-Files" class="headerlink" title="Staging Modified Files"></a>Staging Modified Files</h3><p>Let’s change a file that was already tracked. If you change a previously tracked file called <code>CONTRIBUTING.md</code> and then run your <code>git status</code> command again, you get something that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    new file:   README</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>The <code>CONTRIBUTING.md</code> file appears under a section named “Changes not staged for commit” — which means that a file that is tracked has been modified in the working directory but not yet staged. To stage it, you run the <code>git add</code> command. <code>git add</code> is a multipurpose command — you use it to begin tracking new files, to stage files, and to do other things like marking merge-conflicted files as resolved. It may be helpful to think of it more as “add precisely this content to the next commit” rather than “add this file to the project”. Let’s run <code>git add</code> now to stage the <code>CONTRIBUTING.md</code> file, and then run <code>git status</code> again:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git add CONTRIBUTING.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    new file:   README</span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>Both files are staged and will go into your next commit. At this point, suppose you remember one little change that you want to make in <code>CONTRIBUTING.md</code> before you commit it. You open it again and make that change, and you’re ready to commit. However, let’s run <code>git status</code> one more time:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ vim CONTRIBUTING.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    new file:   README</span><br><span class="line">    modified:   CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>What the heck? Now <code>CONTRIBUTING.md</code> is listed as both staged <em>and</em> unstaged. How is that possible? It turns out that Git stages a file exactly as it is when you run the <code>git add</code> command. If you commit now, the version of <code>CONTRIBUTING.md</code> as it was when you last ran the <code>git add</code> command is how it will go into the commit, not the version of the file as it looks in your working directory when you run <code>git commit</code>. If you modify a file after you run <code>git add</code>, you have to run <code>git add</code> again to stage the latest version of the file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git add CONTRIBUTING.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    new file:   README</span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<h3 id="Short-Status"><a href="#Short-Status" class="headerlink" title="Short Status"></a>Short Status</h3><p>While the <code>git status</code> output is pretty comprehensive, it’s also quite wordy. Git also has a short status flag so you can see your changes in a more compact way. If you run <code>git status -s</code> or <code>git status --short</code> you get a far more simplified output from the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s</span><br><span class="line"> M README</span><br><span class="line">MM Rakefile</span><br><span class="line">A  lib/git.rb</span><br><span class="line">M  lib/simplegit.rb</span><br><span class="line">?? LICENSE.txt</span><br></pre></td></tr></table></figure>
<p>New files that aren’t tracked have a <code>??</code> next to them, new files that have been added to the staging area have an <code>A</code>, modified files have an <code>M</code> and so on. There are two columns to the output - the left-hand column indicates the status of the staging area and the right-hand column indicates the status of the working tree. So for example in that output, the <code>README</code> file is modified in the working directory but not yet staged, while the <code>lib/simplegit.rb</code> file is modified and staged. The <code>Rakefile</code> was modified, staged and then modified again, so there are changes to it that are both staged and unstaged.</p>
<h3 id="Ignoring-Files"><a href="#Ignoring-Files" class="headerlink" title="Ignoring Files"></a>Ignoring Files</h3><p>Often, you’ll have a class of files that you don’t want Git to automatically add or even show you as being untracked. These are generally automatically generated files such as log files or files produced by your build system. In such cases, you can create a file listing patterns to match them named <code>.gitignore</code>. Here is an example <code>.gitignore</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat .gitignore</span><br><span class="line">*.[oa]</span><br><span class="line">*~</span><br></pre></td></tr></table></figure>
<p>The first line tells Git to ignore any files ending in “.o” or “.a” — object and archive files that may be the product of building your code. The second line tells Git to ignore all files whose names end with a tilde (<code>~</code>), which is used by many text editors such as Emacs to mark temporary files. You may also include a log, tmp, or pid directory; automatically generated documentation; and so on. Setting up a <code>.gitignore</code> file for your new repository before you get going is generally a good idea so you don’t accidentally commit files that you really don’t want in your Git repository.</p>
<p>The rules for the patterns you can put in the <code>.gitignore</code> file are as follows:</p>
<ul>
<li>Blank lines or lines starting with <code>#</code> are ignored.</li>
<li>Standard glob patterns work, and will be applied recursively throughout the entire working tree.</li>
<li>You can start patterns with a forward slash (<code>/</code>) to avoid recursivity.</li>
<li>You can end patterns with a forward slash (<code>/</code>) to specify a directory.</li>
<li>You can negate a pattern by starting it with an exclamation point (<code>!</code>).<br>Glob patterns are like simplified regular expressions that shells use. An asterisk (<code>*</code>) matches zero or more characters; <code>[abc]</code> matches any character inside the brackets (in this case a, b, or c); a question mark (<code>?</code>) matches a single character; and brackets enclosing characters separated by a hyphen (<code>[0-9]</code>) matches any character between them (in this case 0 through 9). You can also use two asterisks to match nested directories; <code>a/**/z</code> would match <code>a/z</code>, <code>a/b/z</code>, <code>a/b/c/z</code>, and so on.</li>
</ul>
<p>Here is another example <code>.gitignore</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ignore all .a files</span></span><br><span class="line">*.a</span><br><span class="line"></span><br><span class="line"><span class="comment"># but do track lib.a, even though you're ignoring .a files above</span></span><br><span class="line">!lib.a</span><br><span class="line"></span><br><span class="line"><span class="comment"># only ignore the TODO file in the current directory, not subdir/TODO</span></span><br><span class="line">/TODO</span><br><span class="line"></span><br><span class="line"><span class="comment"># ignore all files in the build/ directory</span></span><br><span class="line">build/</span><br><span class="line"></span><br><span class="line"><span class="comment"># ignore doc/notes.txt, but not doc/server/arch.txt</span></span><br><span class="line">doc/*.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># ignore all .pdf files in the doc/ directory and any of its subdirectories</span></span><br><span class="line">doc/**/*.pdf</span><br></pre></td></tr></table></figure>
<p>GitHub maintains a fairly comprehensive list of good <code>.gitignore</code> file examples for dozens of projects and languages at &lt;<a href="https://github.com/github/gitignore" target="_blank" rel="noopener">https://github.com/github/gitignore</a>&gt; if you want a starting point for your project.</p>
<p>In the simple case, a repository might have a single <code>.gitignore</code> file in its root directory, which applies recursively to the entire repository. However, it is also possible to have additional <code>.gitignore</code> files in subdirectories. The rules in these nested <code>.gitignore</code> files apply only to the files under the directory where they are located. (The Linux kernel source repository has 206 <code>.gitignore</code> files.)</p>
<p>It is beyond the scope of this book to get into the details of multiple <code>.gitignore</code> files; see <code>man gitignore</code> for the details.</p>
<h3 id="Viewing-Your-Staged-and-Unstaged-Changes"><a href="#Viewing-Your-Staged-and-Unstaged-Changes" class="headerlink" title="Viewing Your Staged and Unstaged Changes"></a>Viewing Your Staged and Unstaged Changes</h3><p>If the <code>git status</code> command is too vague for you — you want to know exactly what you changed, not just which files were changed — you can use the <code>git diff</code> command. We’ll cover <code>git diff</code> in more detail later, but you’ll probably use it most often to answer these two questions: What have you changed but not yet staged? And what have you staged that you are about to commit? Although <code>git status</code> answers those questions very generally by listing the file names, <code>git diff</code> shows you the exact lines added and removed — the patch, as it were.</p>
<p>Let’s say you edit and stage the <code>README</code> file again and then edit the <code>CONTRIBUTING.md</code> file without staging it. If you run your <code>git status</code> command, you once again see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    modified:   README</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>To see what you’ve changed but not yet staged, type <code>git diff</code> with no other arguments:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md</span><br><span class="line">index 8ebb991..643e24f 100644</span><br><span class="line">--- a/CONTRIBUTING.md</span><br><span class="line">+++ b/CONTRIBUTING.md</span><br><span class="line">@@ -65,7 +65,8 @@ branch directly, things can get messy.</span><br><span class="line"> Please include a nice description of your changes when you submit your PR;</span><br><span class="line"> <span class="keyword">if</span> we have to <span class="built_in">read</span> the whole diff to figure out why you<span class="string">'re contributing</span></span><br><span class="line"><span class="string"> in the first place, you'</span>re less likely to get feedback and have your change</span><br><span class="line">-merged <span class="keyword">in</span>.</span><br><span class="line">+merged <span class="keyword">in</span>. Also, split your changes into comprehensive chunks <span class="keyword">if</span> your patch is</span><br><span class="line">+longer than a dozen lines.</span><br><span class="line"></span><br><span class="line"> If you are starting to work on a particular area, feel free to submit a PR</span><br><span class="line"> that highlights your work <span class="keyword">in</span> progress (and note <span class="keyword">in</span> the PR title that it<span class="string">'s</span></span><br></pre></td></tr></table></figure>
<p>That command compares what is in your working directory with what is in your staging area. The result tells you the changes you’ve made that you haven’t yet staged.</p>
<p>If you want to see what you’ve staged that will go into your next commit, you can use <code>git diff --staged</code>. This command compares your staged changes to your last commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --staged</span><br><span class="line">diff --git a/README b/README</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..03902a1</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/README</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+My Project</span><br></pre></td></tr></table></figure>
<p>It’s important to note that <code>git diff</code> by itself doesn’t show all changes made since your last commit — only changes that are still unstaged. If you’ve staged all of your changes, <code>git diff</code> will give you no output.</p>
<p>For another example, if you stage the <code>CONTRIBUTING.md</code> file and then edit it, you can use <code>git diff</code> to see the changes in the file that are staged and the changes that are unstaged. If our environment looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git add CONTRIBUTING.md</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'# test line'</span> &gt;&gt; CONTRIBUTING.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>Now you can use <code>git diff</code> to see what is still unstaged:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md</span><br><span class="line">index 643e24f..87f08c8 100644</span><br><span class="line">--- a/CONTRIBUTING.md</span><br><span class="line">+++ b/CONTRIBUTING.md</span><br><span class="line">@@ -119,3 +119,4 @@ at the</span><br><span class="line"> <span class="comment">## Starter Projects</span></span><br><span class="line"></span><br><span class="line"> See our [projects list](https://github.com/libgit2/libgit2/blob/development/PROJECTS.md).</span><br><span class="line">+<span class="comment"># test line</span></span><br></pre></td></tr></table></figure>
<p>and <code>git diff --cached</code> to see what you’ve staged so far (<code>--staged</code> and <code>--cached</code> are synonyms):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --cached</span><br><span class="line">diff --git a/CONTRIBUTING.md b/CONTRIBUTING.md</span><br><span class="line">index 8ebb991..643e24f 100644</span><br><span class="line">--- a/CONTRIBUTING.md</span><br><span class="line">+++ b/CONTRIBUTING.md</span><br><span class="line">@@ -65,7 +65,8 @@ branch directly, things can get messy.</span><br><span class="line"> Please include a nice description of your changes when you submit your PR;</span><br><span class="line"> <span class="keyword">if</span> we have to <span class="built_in">read</span> the whole diff to figure out why you<span class="string">'re contributing</span></span><br><span class="line"><span class="string"> in the first place, you'</span>re less likely to get feedback and have your change</span><br><span class="line">-merged <span class="keyword">in</span>.</span><br><span class="line">+merged <span class="keyword">in</span>. Also, split your changes into comprehensive chunks <span class="keyword">if</span> your patch is</span><br><span class="line">+longer than a dozen lines.</span><br><span class="line"></span><br><span class="line"> If you are starting to work on a particular area, feel free to submit a PR</span><br><span class="line"> that highlights your work <span class="keyword">in</span> progress (and note <span class="keyword">in</span> the PR title that it<span class="string">'s</span></span><br></pre></td></tr></table></figure>
<h2 id="Git-Diff-in-an-External-Tool"><a href="#Git-Diff-in-an-External-Tool" class="headerlink" title="Git Diff in an External Tool"></a>Git Diff in an External Tool</h2><p>We will continue to use the <code>git diff</code> command in various ways throughout the rest of the book. There is another way to look at these diffs if you prefer a graphical or external diff viewing program instead. If you run <code>git difftool</code> instead of <code>git diff</code>, you can view any of these diffs in software like emerge, vimdiff and many more (including commercial products). Run <code>git difftool --tool-help</code> to see what is available on your system.</p>
<h3 id="Committing-Your-Changes"><a href="#Committing-Your-Changes" class="headerlink" title="Committing Your Changes"></a>Committing Your Changes</h3><p>Now that your staging area is set up the way you want it, you can commit your changes. Remember that anything that is still unstaged — any files you have created or modified that you haven’t run <code>git add</code> on since you edited them — won’t go into this commit. They will stay as modified files on your disk. In this case, let’s say that the last time you ran <code>git status</code>, you saw that everything was staged, so you’re ready to commit your changes. The simplest way to commit is to type <code>git commit</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit</span><br></pre></td></tr></table></figure>
<p>Doing so launches your editor of choice. (This is set by your shell’s <code>EDITOR</code> environment variable — usually vim or emacs, although you can configure it with whatever you want using the <code>git config --global core.editor</code> command as you saw in 【Getting Started】).</p>
<p>The editor displays the following text (this example is a Vim screen):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Please enter the commit message for your changes. Lines starting</span></span><br><span class="line"><span class="comment"># with '#' will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line"><span class="comment"># Your branch is up-to-date with 'origin/master'.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Changes to be committed:</span></span><br><span class="line"><span class="comment">#	new file:   README</span></span><br><span class="line"><span class="comment">#	modified:   CONTRIBUTING.md</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line"><span class="string">".git/COMMIT_EDITMSG"</span> 9L, 283C</span><br></pre></td></tr></table></figure>
<p>You can see that the default commit message contains the latest output of the <code>git status</code> command commented out and one empty line on top. You can remove these comments and type your commit message, or you can leave them there to help you remember what you’re committing. (For an even more explicit reminder of what you’ve modified, you can pass the <code>-v</code> option to <code>git commit</code>. Doing so also puts the diff of your change in the editor so you can see exactly what changes you’re committing.) When you exit the editor, Git creates your commit with that commit message (with the comments and diff stripped out).</p>
<p>Alternatively, you can type your commit message inline with the <code>commit</code> command by specifying it after a <code>-m</code> flag, like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">"Story 182: Fix benchmarks for speed"</span></span><br><span class="line">[master 463dc4f] Story 182: Fix benchmarks <span class="keyword">for</span> speed</span><br><span class="line"> 2 files changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 README</span><br></pre></td></tr></table></figure>
<p>Now you’ve created your first commit! You can see that the commit has given you some output about itself: which branch you committed to (<code>master</code>), what SHA-1 checksum the commit has (<code>463dc4f</code>), how many files were changed, and statistics about lines added and removed in the commit.</p>
<p>Remember that the commit records the snapshot you set up in your staging area. Anything you didn’t stage is still sitting there modified; you can do another commit to add it to your history. Every time you perform a commit, you’re recording a snapshot of your project that you can revert to or compare to later.</p>
<h3 id="Skipping-the-Staging-Area"><a href="#Skipping-the-Staging-Area" class="headerlink" title="Skipping the Staging Area"></a>Skipping the Staging Area</h3><p>Although it can be amazingly useful for crafting commits exactly how you want them, the staging area is sometimes a bit more complex than you need in your workflow. If you want to skip the staging area, Git provides a simple shortcut. Adding the <code>-a</code> option to the <code>git commit</code> command makes Git automatically stage every file that is already tracked before doing the commit, letting you skip the <code>git add</code> part:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br><span class="line">$ git commit -a -m <span class="string">'added new benchmarks'</span></span><br><span class="line">[master 83e38c7] added new benchmarks</span><br><span class="line"> 1 file changed, 5 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>Notice how you don’t have to run <code>git add</code> on the <code>CONTRIBUTING.md</code> file in this case before you commit. That’s because the <code>-a</code> flag includes all changed files. This is convenient, but be careful; sometimes this flag will cause you to include unwanted changes.</p>
<h3 id="Removing-Files"><a href="#Removing-Files" class="headerlink" title="Removing Files"></a>Removing Files</h3><p>To remove a file from Git, you have to remove it from your tracked files (more accurately, remove it from your staging area) and then commit. The <code>git rm</code> command does that, and also removes the file from your working directory so you don’t see it as an untracked file the next time around.</p>
<p>If you simply remove the file from your working directory, it shows up under the “Changes not staged for commit” (that is, <em>unstaged</em>) area of your <code>git status</code> output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ rm PROJECTS.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add/rm &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">        deleted:    PROJECTS.md</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br></pre></td></tr></table></figure>
<p>Then, if you run <code>git rm</code>, it stages the file’s removal:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git rm PROJECTS.md</span><br><span class="line">rm <span class="string">'PROJECTS.md'</span></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    deleted:    PROJECTS.md</span><br></pre></td></tr></table></figure>
<p>The next time you commit, the file will be gone and no longer tracked. If you modified the file and added it to the staging area already, you must force the removal with the <code>-f</code> option. This is a safety feature to prevent accidental removal of data that hasn’t yet been recorded in a snapshot and that can’t be recovered from Git.</p>
<p>Another useful thing you may want to do is to keep the file in your working tree but remove it from your staging area. In other words, you may want to keep the file on your hard drive but not have Git track it anymore. This is particularly useful if you forgot to add something to your <code>.gitignore</code> file and accidentally staged it, like a large log file or a bunch of <code>.a</code> compiled files. To do this, use the <code>--cached</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rm --cached README</span><br></pre></td></tr></table></figure>
<p>You can pass files, directories, and file-glob patterns to the <code>git rm</code> command. That means you can do things such as:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rm <span class="built_in">log</span>/\*.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>
<p>Note the backslash (<code>\</code>) in front of the <code>*</code>. This is necessary because Git does its own filename expansion in addition to your shell’s filename expansion. This command removes all files that have the <code>.log</code> extension in the <code>log/</code> directory. Or, you can do something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rm \*~</span><br></pre></td></tr></table></figure>
<p>This command removes all files whose names end with a <code>~</code>.</p>
<h3 id="Moving-Files"><a href="#Moving-Files" class="headerlink" title="Moving Files"></a>Moving Files</h3><p>Unlike many other VCS systems, Git doesn’t explicitly track file movement. If you rename a file in Git, no metadata is stored in Git that tells it you renamed the file. However, Git is pretty smart about figuring that out after the fact — we’ll deal with detecting file movement a bit later.</p>
<p>Thus it’s a bit confusing that Git has a <code>mv</code> command. If you want to rename a file in Git, you can run something like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git mv file_from file_to</span><br></pre></td></tr></table></figure>
<p>and it works fine. In fact, if you run something like this and look at the status, you’ll see that Git considers it a renamed file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git mv README.md README</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    renamed:    README.md -&gt; README</span><br></pre></td></tr></table></figure>
<p>However, this is equivalent to running something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mv README.md README</span><br><span class="line">$ git rm README.md</span><br><span class="line">$ git add README</span><br></pre></td></tr></table></figure>
<p>Git figures out that it’s a rename implicitly, so it doesn’t matter if you rename a file that way or with the <code>mv</code> command. The only real difference is that <code>git mv</code> is one command instead of three — it’s a convenience function. More importantly, you can use any tool you like to rename a file, and address the add/rm later, before you commit.</p>
<h2 id="Viewing-the-Commit-History"><a href="#Viewing-the-Commit-History" class="headerlink" title="Viewing the Commit History"></a>Viewing the Commit History</h2><p>After you have created several commits, or if you have cloned a repository with an existing commit history, you’ll probably want to look back to see what has happened. The most basic and powerful tool to do this is the <code>git log</code> command.</p>
<p>These examples use a very simple project called “simplegit”. To get the project, run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/schacon/simplegit-progit](https://github.com/schacon/simplegit-progit)</span><br></pre></td></tr></table></figure>
<p>When you run <code>git log</code> in this project, you should get output that looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Mar 17 21:52:11 2008 -0700</span><br><span class="line"></span><br><span class="line">    changed the version number</span><br><span class="line"></span><br><span class="line">commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Sat Mar 15 16:40:33 2008 -0700</span><br><span class="line"></span><br><span class="line">    removed unnecessary <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">commit a11bef06a3f659402fe7563abf99ad00de2209e6</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Sat Mar 15 10:31:28 2008 -0700</span><br><span class="line"></span><br><span class="line">    first commit</span><br></pre></td></tr></table></figure>
<p>By default, with no arguments, <code>git log</code> lists the commits made in that repository in reverse chronological order — that is, the most recent commits show up first. As you can see, this command lists each commit with its SHA-1 checksum, the author’s name and email, the date written, and the commit message.</p>
<p>A huge number and variety of options to the <code>git log</code> command are available to show you exactly what you’re looking for. Here, we’ll show you some of the most popular.</p>
<p>One of the more helpful options is <code>-p</code> or <code>--patch</code>, which shows the difference (the <em>patch</em> output) introduced in each commit. You can also limit the number of log entries displayed, such as using <code>-2</code> to show only the last two entries.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -p -2</span><br><span class="line">commit ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Mar 17 21:52:11 2008 -0700</span><br><span class="line"></span><br><span class="line">    changed the version number</span><br><span class="line"></span><br><span class="line">diff --git a/Rakefile b/Rakefile</span><br><span class="line">index a874b73..8f94139 100644</span><br><span class="line">--- a/Rakefile</span><br><span class="line">+++ b/Rakefile</span><br><span class="line">@@ -5,7 +5,7 @@ require <span class="string">'rake/gempackagetask'</span></span><br><span class="line"> spec = Gem::Specification.new <span class="keyword">do</span> |s|</span><br><span class="line">     s.platform  =   Gem::Platform::RUBY</span><br><span class="line">     s.name      =   <span class="string">"simplegit"</span></span><br><span class="line">-    s.version   =   <span class="string">"0.1.0"</span></span><br><span class="line">+    s.version   =   <span class="string">"0.1.1"</span></span><br><span class="line">     s.author    =   <span class="string">"Scott Chacon"</span></span><br><span class="line">     s.email     =   <span class="string">"schacon@gee-mail.com"</span></span><br><span class="line">     s.summary   =   <span class="string">"A simple gem for using Git in Ruby code."</span></span><br><span class="line"></span><br><span class="line">commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Sat Mar 15 16:40:33 2008 -0700</span><br><span class="line"></span><br><span class="line">    removed unnecessary <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">diff --git a/lib/simplegit.rb b/lib/simplegit.rb</span><br><span class="line">index a0a60ae..47c6340 100644</span><br><span class="line">--- a/lib/simplegit.rb</span><br><span class="line">+++ b/lib/simplegit.rb</span><br><span class="line">@@ -18,8 +18,3 @@ class SimpleGit</span><br><span class="line">     end</span><br><span class="line"></span><br><span class="line"> end</span><br><span class="line">-</span><br><span class="line">-<span class="keyword">if</span> <span class="variable">$0</span> == __FILE__</span><br><span class="line">-  git = SimpleGit.new</span><br><span class="line">-  puts git.show</span><br><span class="line">-end</span><br></pre></td></tr></table></figure>
<p>This option displays the same information but with a diff directly following each entry. This is very helpful for code review or to quickly browse what happened during a series of commits that a collaborator has added. You can also use a series of summarizing options with <code>git log</code>. For example, if you want to see some abbreviated stats for each commit, you can use the <code>--stat</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line">commit ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Mar 17 21:52:11 2008 -0700</span><br><span class="line"></span><br><span class="line">    changed the version number</span><br><span class="line"></span><br><span class="line"> Rakefile | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Sat Mar 15 16:40:33 2008 -0700</span><br><span class="line"></span><br><span class="line">    removed unnecessary <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"> lib/simplegit.rb | 5 -----</span><br><span class="line"> 1 file changed, 5 deletions(-)</span><br><span class="line"></span><br><span class="line">commit a11bef06a3f659402fe7563abf99ad00de2209e6</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Sat Mar 15 10:31:28 2008 -0700</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line"></span><br><span class="line"> README           |  6 ++++++</span><br><span class="line"> Rakefile         | 23 +++++++++++++++++++++++</span><br><span class="line"> lib/simplegit.rb | 25 +++++++++++++++++++++++++</span><br><span class="line"> 3 files changed, 54 insertions(+)</span><br></pre></td></tr></table></figure>
<p>As you can see, the <code>--stat</code> option prints below each commit entry a list of modified files, how many files were changed, and how many lines in those files were added and removed. It also puts a summary of the information at the end.</p>
<p>Another really useful option is <code>--pretty</code>. This option changes the log output to formats other than the default. A few prebuilt options are available for you to use. The <code>oneline</code> option prints each commit on a single line, which is useful if you’re looking at a lot of commits. In addition, the <code>short</code>, <code>full</code>, and <code>fuller</code> options show the output in roughly the same format but with less or more information, respectively:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">ca82a6dff817ec66f44342007202690a93763949 changed the version number</span><br><span class="line">085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7 removed unnecessary <span class="built_in">test</span></span><br><span class="line">a11bef06a3f659402fe7563abf99ad00de2209e6 first commit</span><br></pre></td></tr></table></figure>
<p>The most interesting option is <code>format</code>, which allows you to specify your own log output format. This is especially useful when you’re generating output for machine parsing — because you specify the format explicitly, you know it won’t change with updates to Git:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=format:<span class="string">"%h - %an, %ar : %s"</span></span><br><span class="line">ca82a6d - Scott Chacon, 6 years ago : changed the version number</span><br><span class="line">085bb3b - Scott Chacon, 6 years ago : removed unnecessary <span class="built_in">test</span></span><br><span class="line">a11bef0 - Scott Chacon, 6 years ago : first commit</span><br></pre></td></tr></table></figure>
<p>【Useful options for <code>git log --pretty=format</code>】 lists some of the more useful options that <code>format</code> takes.</p>
<p>Table 1. Useful options for <code>git log --pretty=format</code>       Option Description of Output     <code>%H</code></p>
<p>Commit hash</p>
<p><code>%h</code></p>
<p>Abbreviated commit hash</p>
<p><code>%T</code></p>
<p>Tree hash</p>
<p><code>%t</code></p>
<p>Abbreviated tree hash</p>
<p><code>%P</code></p>
<p>Parent hashes</p>
<p><code>%p</code></p>
<p>Abbreviated parent hashes</p>
<p><code>%an</code></p>
<p>Author name</p>
<p><code>%ae</code></p>
<p>Author email</p>
<p><code>%ad</code></p>
<p>Author date (format respects the –date=option)</p>
<p><code>%ar</code></p>
<p>Author date, relative</p>
<p><code>%cn</code></p>
<p>Committer name</p>
<p><code>%ce</code></p>
<p>Committer email</p>
<p><code>%cd</code></p>
<p>Committer date</p>
<p><code>%cr</code></p>
<p>Committer date, relative</p>
<p><code>%s</code></p>
<p>Subject</p>
<p>You may be wondering what the difference is between <em>author</em> and <em>committer</em>. The author is the person who originally wrote the work, whereas the committer is the person who last applied the work. So, if you send in a patch to a project and one of the core members applies the patch, both of you get credit — you as the author, and the core member as the committer. We’ll cover this distinction a bit more in 【Distributed Git】.</p>
<p>The <code>oneline</code> and <code>format</code> options are particularly useful with another <code>log</code> option called <code>--graph</code>. This option adds a nice little ASCII graph showing your branch and merge history:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=format:<span class="string">"%h %s"</span> --graph</span><br><span class="line">* 2d3acf9 ignore errors from SIGCHLD on <span class="built_in">trap</span></span><br><span class="line">*  5e3ee11 Merge branch <span class="string">'master'</span> of git://github.com/dustin/grit</span><br><span class="line">|\</span><br><span class="line">| * 420eac9 Added a method <span class="keyword">for</span> getting the current branch.</span><br><span class="line">* | 30e367c timeout code and tests</span><br><span class="line">* | 5a09431 add timeout protection to grit</span><br><span class="line">* | e1193f8 support <span class="keyword">for</span> heads with slashes <span class="keyword">in</span> them</span><br><span class="line">|/</span><br><span class="line">* d6016bc require time <span class="keyword">for</span> xmlschema</span><br><span class="line">*  11d191e Merge branch <span class="string">'defunkt'</span> into <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p>This type of output will become more interesting as we go through branching and merging in the next chapter.</p>
<p>Those are only some simple output-formatting options to <code>git log</code> — there are many more. 【Common options to <code>git log</code>】 lists the options we’ve covered so far, as well as some other common formatting options that may be useful, along with how they change the output of the log command.</p>
<p>Table 2. Common options to <code>git log</code>       Option Description     <code>-p</code></p>
<p>Show the patch introduced with each commit.</p>
<p><code>--stat</code></p>
<p>Show statistics for files modified in each commit.</p>
<p><code>--shortstat</code></p>
<p>Display only the changed/insertions/deletions line from the –stat command.</p>
<p><code>--name-only</code></p>
<p>Show the list of files modified after the commit information.</p>
<p><code>--name-status</code></p>
<p>Show the list of files affected with added/modified/deleted information as well.</p>
<p><code>--abbrev-commit</code></p>
<p>Show only the first few characters of the SHA-1 checksum instead of all 40.</p>
<p><code>--relative-date</code></p>
<p>Display the date in a relative format (for example, “2 weeks ago”) instead of using the full date format.</p>
<p><code>--graph</code></p>
<p>Display an ASCII graph of the branch and merge history beside the log output.</p>
<p><code>--pretty</code></p>
<p>Show commits in an alternate format. Options include oneline, short, full, fuller, and format (where you specify your own format).</p>
<p><code>--oneline</code></p>
<p>Shorthand for <code>--pretty=oneline --abbrev-commit</code> used together.</p>
<h3 id="Limiting-Log-Output"><a href="#Limiting-Log-Output" class="headerlink" title="Limiting Log Output"></a>Limiting Log Output</h3><p>In addition to output-formatting options, <code>git log</code> takes a number of useful limiting options — that is, options that let you show only a subset of commits. You’ve seen one such option already — the <code>-2</code> option, which displays only the last two commits. In fact, you can do <code>-&lt;n&gt;</code>, where <code>n</code> is any integer to show the last <code>n</code> commits. In reality, you’re unlikely to use that often, because Git by default pipes all output through a pager so you see only one page of log output at a time.</p>
<p>However, the time-limiting options such as <code>--since</code> and <code>--until</code> are very useful. For example, this command gets the list of commits made in the last two weeks:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --since=2.weeks</span><br></pre></td></tr></table></figure>
<p>This command works with lots of formats — you can specify a specific date like <code>&quot;2008-01-15&quot;</code>, or a relative date such as <code>&quot;2 years 1 day 3 minutes ago&quot;</code>.</p>
<p>You can also filter the list to commits that match some search criteria. The <code>--author</code> option allows you to filter on a specific author, and the <code>--grep</code> option lets you search for keywords in the commit messages.</p>
<p>You can specify more than one instance of both the <code>--author</code> and <code>--grep</code> search criteria, which will limit the commit output to commits that match <em>any</em> of the <code>--author</code> patterns and <em>any</em> of the <code>--grep</code> patterns; however, adding the <code>--all-match</code> option further limits the output to just those commits that match <em>all</em> <code>--grep</code> patterns.</p>
<p>Another really helpful filter is the <code>-S</code> option (colloquially referred to as Git’s “pickaxe” option), which takes a string and shows only those commits that changed the number of occurrences of that string. For instance, if you wanted to find the last commit that added or removed a reference to a specific function, you could call:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -S function_name</span><br></pre></td></tr></table></figure>
<p>The last really useful option to pass to <code>git log</code> as a filter is a path. If you specify a directory or file name, you can limit the log output to commits that introduced a change to those files. This is always the last option and is generally preceded by double dashes (<code>--</code>) to separate the paths from the options.</p>
<p>In 【Options to limit the output of <code>git log</code>】 we’ll list these and a few other common options for your reference.</p>
<p>Table 3. Options to limit the output of <code>git log</code>       Option Description     <code>-&lt;n&gt;</code></p>
<p>Show only the last n commits</p>
<p><code>--since</code>, <code>--after</code></p>
<p>Limit the commits to those made after the specified date.</p>
<p><code>--until</code>, <code>--before</code></p>
<p>Limit the commits to those made before the specified date.</p>
<p><code>--author</code></p>
<p>Only show commits in which the author entry matches the specified string.</p>
<p><code>--committer</code></p>
<p>Only show commits in which the committer entry matches the specified string.</p>
<p><code>--grep</code></p>
<p>Only show commits with a commit message containing the string</p>
<p><code>-S</code></p>
<p>Only show commits adding or removing code matching the string</p>
<p>For example, if you want to see which commits modifying test files in the Git source code history were committed by Junio Hamano in the month of October 2008 and are not merge commits, you can run something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=<span class="string">"%h - %s"</span> --author=gitster --since=<span class="string">"2008-10-01"</span> \</span><br><span class="line">   --before=<span class="string">"2008-11-01"</span> --no-merges -- t/</span><br><span class="line">5610e3b - Fix testcase failure when extended attributes are <span class="keyword">in</span> use</span><br><span class="line">acd3b9e - Enhance hold_lock_file_for_&#123;update,append&#125;() API</span><br><span class="line">f563754 - demonstrate breakage of detached checkout with symbolic link HEAD</span><br><span class="line">d1a43f2 - reset --hard/<span class="built_in">read</span>-tree --reset -u: remove unmerged new paths</span><br><span class="line">51a94af - Fix <span class="string">"checkout --track -b newbranch"</span> on detached HEAD</span><br><span class="line">b0ad11e - pull: allow <span class="string">"git pull origin <span class="variable">$something</span>:<span class="variable">$current_branch</span>"</span> into an unborn branch</span><br></pre></td></tr></table></figure>
<p>Of the nearly 40,000 commits in the Git source code history, this command shows the 6 that match those criteria.</p>
<h2 id="Preventing-the-display-of-merge-commits"><a href="#Preventing-the-display-of-merge-commits" class="headerlink" title="Preventing the display of merge commits"></a>Preventing the display of merge commits</h2><p>Depending on the workflow used in your repository, it’s possible that a sizable percentage of the commits in your log history are just merge commits, which typically aren’t very informative. To prevent the display of merge commits cluttering up your log history, simply add the log option <code>--no-merges</code>.</p>
<h2 id="Undoing-Things"><a href="#Undoing-Things" class="headerlink" title="Undoing Things"></a>Undoing Things</h2><p>At any stage, you may want to undo something. Here, we’ll review a few basic tools for undoing changes that you’ve made. Be careful, because you can’t always undo some of these undos. This is one of the few areas in Git where you may lose some work if you do it wrong.</p>
<p>One of the common undos takes place when you commit too early and possibly forget to add some files, or you mess up your commit message. If you want to redo that commit, make the additional changes you forgot, stage them, and commit again using the <code>--amend</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<p>This command takes your staging area and uses it for the commit. If you’ve made no changes since your last commit (for instance, you run this command immediately after your previous commit), then your snapshot will look exactly the same, and all you’ll change is your commit message.</p>
<p>The same commit-message editor fires up, but it already contains the message of your previous commit. You can edit the message the same as always, but it overwrites your previous commit.</p>
<p>As an example, if you commit and then realize you forgot to stage the changes in a file you wanted to add to this commit, you can do something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">'initial commit'</span></span><br><span class="line">$ git add forgotten_file</span><br><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<p>You end up with a single commit — the second commit replaces the results of the first.</p>
<p>It’s important to understand that when you’re amending your last commit, you’re not so much fixing it as <em>replacing</em> it entirely with a new, improved commit that pushes the old commit out of the way and puts the new commit in its place. Effectively, it’s as if the previous commit never happened, and it won’t show up in your repository history.</p>
<p>The obvious value to amending commits is to make minor improvements to your last commit, without cluttering your repository history with commit messages of the form, “Oops, forgot to add a file” or “Darn, fixing a typo in last commit”.</p>
<h3 id="Unstaging-a-Staged-File"><a href="#Unstaging-a-Staged-File" class="headerlink" title="Unstaging a Staged File"></a>Unstaging a Staged File</h3><p>The next two sections demonstrate how to work with your staging area and working directory changes. The nice part is that the command you use to determine the state of those two areas also reminds you how to undo changes to them. For example, let’s say you’ve changed two files and want to commit them as two separate changes, but you accidentally type <code>git add *</code> and stage them both. How can you unstage one of the two? The <code>git status</code> command reminds you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git add *</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    renamed:    README.md -&gt; README</span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>Right below the “Changes to be committed” text, it says use <code>git reset HEAD &lt;file&gt;...</code> to unstage. So, let’s use that advice to unstage the <code>CONTRIBUTING.md</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git reset HEAD CONTRIBUTING.md</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	CONTRIBUTING.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    renamed:    README.md -&gt; README</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>The command is a bit strange, but it works. The <code>CONTRIBUTING.md</code> file is modified but once again unstaged.</p>
<p>It’s true that <code>git reset</code> can be a dangerous command, especially if you provide the <code>--hard</code> flag. However, in the scenario described above, the file in your working directory is not touched, so it’s relatively safe.</p>
<p>For now this magic invocation is all you need to know about the <code>git reset</code> command. We’ll go into much more detail about what <code>reset</code> does and how to master it to do really interesting things in 【Reset Demystified】.</p>
<h3 id="Unmodifying-a-Modified-File"><a href="#Unmodifying-a-Modified-File" class="headerlink" title="Unmodifying a Modified File"></a>Unmodifying a Modified File</h3><p>What if you realize that you don’t want to keep your changes to the <code>CONTRIBUTING.md</code> file? How can you easily unmodify it — revert it back to what it looked like when you last committed (or initially cloned, or however you got it into your working directory)? Luckily, <code>git status</code> tells you how to do that, too. In the last example output, the unstaged area looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">    modified:   CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<p>It tells you pretty explicitly how to discard the changes you’ve made. Let’s do what it says:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- CONTRIBUTING.md</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">    renamed:    README.md -&gt; README</span><br></pre></td></tr></table></figure>
<p>You can see that the changes have been reverted.</p>
<p>It’s important to understand that <code>git checkout -- &lt;file&gt;</code> is a dangerous command. Any changes you made to that file are gone — Git just copied another file over it. Don’t ever use this command unless you absolutely know that you don’t want the file.</p>
<p>If you would like to keep the changes you’ve made to that file but still need to get it out of the way for now, we’ll go over stashing and branching in 【Git Branching】; these are generally better ways to go.</p>
<p>Remember, anything that is <em>committed</em> in Git can almost always be recovered. Even commits that were on branches that were deleted or commits that were overwritten with an <code>--amend</code> commit can be recovered (see 【Data Recovery】 for data recovery). However, anything you lose that was never committed is likely never to be seen again.</p>
<h2 id="Working-with-Remotes"><a href="#Working-with-Remotes" class="headerlink" title="Working with Remotes"></a>Working with Remotes</h2><p>To be able to collaborate on any Git project, you need to know how to manage your remote repositories. Remote repositories are versions of your project that are hosted on the Internet or network somewhere. You can have several of them, each of which generally is either read-only or read/write for you. Collaborating with others involves managing these remote repositories and pushing and pulling data to and from them when you need to share work. Managing remote repositories includes knowing how to add remote repositories, remove remotes that are no longer valid, manage various remote branches and define them as being tracked or not, and more. In this section, we’ll cover some of these remote-management skills.</p>
<h2 id="Remote-repositories-can-be-on-your-local-machine"><a href="#Remote-repositories-can-be-on-your-local-machine" class="headerlink" title="Remote repositories can be on your local machine."></a>Remote repositories can be on your local machine.</h2><p>It is entirely possible that you can be working with a “remote” repository that is, in fact, on the same host you are. The word “remote” does not necessarily imply that the repository is somewhere else on the network or Internet, only that it is elsewhere. Working with such a remote repository would still involve all the standard pushing, pulling and fetching operations as with any other remote.</p>
<h3 id="Showing-Your-Remotes"><a href="#Showing-Your-Remotes" class="headerlink" title="Showing Your Remotes"></a>Showing Your Remotes</h3><p>To see which remote servers you have configured, you can run the <code>git remote</code> command. It lists the shortnames of each remote handle you’ve specified. If you’ve cloned your repository, you should at least see <code>origin</code> — that is the default name Git gives to the server you cloned from:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/schacon/ticgit](https://github.com/schacon/ticgit)</span><br><span class="line">Cloning into <span class="string">'ticgit'</span>...</span><br><span class="line">remote: Reusing existing pack: 1857, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 1857 (delta 0), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (1857/1857), 374.35 KiB | 268.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (772/772), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line">$ <span class="built_in">cd</span> ticgit</span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br></pre></td></tr></table></figure>
<p>You can also specify <code>-v</code>, which shows you the URLs that Git has stored for the shortname to be used when reading and writing to that remote:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">origin	[https://github.com/schacon/ticgit](https://github.com/schacon/ticgit) (fetch)</span><br><span class="line">origin	[https://github.com/schacon/ticgit](https://github.com/schacon/ticgit) (push)</span><br></pre></td></tr></table></figure>
<p>If you have more than one remote, the command lists them all. For example, a repository with multiple remotes for working with several collaborators might look something like this.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> grit</span><br><span class="line">$ git remote -v</span><br><span class="line">bakkdoor  [https://github.com/bakkdoor/grit](https://github.com/bakkdoor/grit) (fetch)</span><br><span class="line">bakkdoor  [https://github.com/bakkdoor/grit](https://github.com/bakkdoor/grit) (push)</span><br><span class="line">cho45     [https://github.com/cho45/grit](https://github.com/cho45/grit) (fetch)</span><br><span class="line">cho45     [https://github.com/cho45/grit](https://github.com/cho45/grit) (push)</span><br><span class="line">defunkt   [https://github.com/defunkt/grit](https://github.com/defunkt/grit) (fetch)</span><br><span class="line">defunkt   [https://github.com/defunkt/grit](https://github.com/defunkt/grit) (push)</span><br><span class="line">koke      git://github.com/koke/grit.git (fetch)</span><br><span class="line">koke      git://github.com/koke/grit.git (push)</span><br><span class="line">origin    git@github.com:mojombo/grit.git (fetch)</span><br><span class="line">origin    git@github.com:mojombo/grit.git (push)</span><br></pre></td></tr></table></figure>
<p>This means we can pull contributions from any of these users pretty easily. We may additionally have permission to push to one or more of these, though we can’t tell that here.</p>
<p>Notice that these remotes use a variety of protocols; we’ll cover more about this in 【Getting Git on a Server】.</p>
<h3 id="Adding-Remote-Repositories"><a href="#Adding-Remote-Repositories" class="headerlink" title="Adding Remote Repositories"></a>Adding Remote Repositories</h3><p>We’ve mentioned and given some demonstrations of how the <code>git clone</code> command implicitly adds the <code>origin</code> remote for you. Here’s how to add a new remote explicitly. To add a new remote Git repository as a shortname you can reference easily, run <code>git remote add &lt;shortname&gt; &lt;url&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git remote</span><br><span class="line">origin</span><br><span class="line">$ git remote add pb [https://github.com/paulboone/ticgit](https://github.com/paulboone/ticgit)</span><br><span class="line">$ git remote -v</span><br><span class="line">origin	[https://github.com/schacon/ticgit](https://github.com/schacon/ticgit) (fetch)</span><br><span class="line">origin	[https://github.com/schacon/ticgit](https://github.com/schacon/ticgit) (push)</span><br><span class="line">pb	[https://github.com/paulboone/ticgit](https://github.com/paulboone/ticgit) (fetch)</span><br><span class="line">pb	[https://github.com/paulboone/ticgit](https://github.com/paulboone/ticgit) (push)</span><br></pre></td></tr></table></figure>
<p>Now you can use the string <code>pb</code> on the command line in lieu of the whole URL. For example, if you want to fetch all the information that Paul has but that you don’t yet have in your repository, you can run <code>git fetch pb</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch pb</span><br><span class="line">remote: Counting objects: 43, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (36/36), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 43 (delta 10), reused 31 (delta 5)</span><br><span class="line">Unpacking objects: 100% (43/43), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/paulboone/ticgit](https://github.com/paulboone/ticgit)</span><br><span class="line"> * [new branch]      master     -&gt; pb/master</span><br><span class="line"> * [new branch]      ticgit     -&gt; pb/ticgit</span><br></pre></td></tr></table></figure>
<p>Paul’s master branch is now accessible locally as <code>pb/master</code> — you can merge it into one of your branches, or you can check out a local branch at that point if you want to inspect it. (We’ll go over what branches are and how to use them in much more detail in 【Git Branching】.)</p>
<h3 id="Fetching-and-Pulling-from-Your-Remotes"><a href="#Fetching-and-Pulling-from-Your-Remotes" class="headerlink" title="Fetching and Pulling from Your Remotes"></a>Fetching and Pulling from Your Remotes</h3><p>As you just saw, to get data from your remote projects, you can run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch &lt;remote&gt;</span><br></pre></td></tr></table></figure>
<p>The command goes out to that remote project and pulls down all the data from that remote project that you don’t have yet. After you do this, you should have references to all the branches from that remote, which you can merge in or inspect at any time.</p>
<p>If you clone a repository, the command automatically adds that remote repository under the name “origin”. So, <code>git fetch origin</code> fetches any new work that has been pushed to that server since you cloned (or last fetched from) it. It’s important to note that the <code>git fetch</code> command only downloads the data to your local repository — it doesn’t automatically merge it with any of your work or modify what you’re currently working on. You have to merge it manually into your work when you’re ready.</p>
<p>If your current branch is set up to track a remote branch (see the next section and 【Git Branching】 for more information), you can use the <code>git pull</code> command to automatically fetch and then merge that remote branch into your current branch. This may be an easier or more comfortable workflow for you; and by default, the <code>git clone</code> command automatically sets up your local master branch to track the remote master branch (or whatever the default branch is called) on the server you cloned from. Running <code>git pull</code> generally fetches data from the server you originally cloned from and automatically tries to merge it into the code you’re currently working on.</p>
<h3 id="Pushing-to-Your-Remotes"><a href="#Pushing-to-Your-Remotes" class="headerlink" title="Pushing to Your Remotes"></a>Pushing to Your Remotes</h3><p>When you have your project at a point that you want to share, you have to push it upstream. The command for this is simple: <code>git push &lt;remote&gt; &lt;branch&gt;</code>. If you want to push your master branch to your <code>origin</code> server (again, cloning generally sets up both of those names for you automatically), then you can run this to push any commits you’ve done back up to the server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>This command works only if you cloned from a server to which you have write access and if nobody has pushed in the meantime. If you and someone else clone at the same time and they push upstream and then you push upstream, your push will rightly be rejected. You’ll have to fetch their work first and incorporate it into yours before you’ll be allowed to push. See 【Git Branching】 for more detailed information on how to push to remote servers.</p>
<h3 id="Inspecting-a-Remote"><a href="#Inspecting-a-Remote" class="headerlink" title="Inspecting a Remote"></a>Inspecting a Remote</h3><p>If you want to see more information about a particular remote, you can use the <code>git remote show &lt;remote&gt;</code> command. If you run this command with a particular shortname, such as <code>origin</code>, you get something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: [https://github.com/schacon/ticgit](https://github.com/schacon/ticgit)</span><br><span class="line">  Push  URL: [https://github.com/schacon/ticgit](https://github.com/schacon/ticgit)</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branches:</span><br><span class="line">    master                               tracked</span><br><span class="line">    dev-branch                           tracked</span><br><span class="line">  Local branch configured <span class="keyword">for</span> <span class="string">'git pull'</span>:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured <span class="keyword">for</span> <span class="string">'git push'</span>:</span><br><span class="line">    master pushes to master (up to date)</span><br></pre></td></tr></table></figure>
<p>It lists the URL for the remote repository as well as the tracking branch information. The command helpfully tells you that if you’re on the master branch and you run <code>git pull</code>, it will automatically merge in the master branch on the remote after it fetches all the remote references. It also lists all the remote references it has pulled down.</p>
<p>That is a simple example you’re likely to encounter. When you’re using Git more heavily, however, you may see much more information from <code>git remote show</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  URL: [https://github.com/my-org/complex-project](https://github.com/my-org/complex-project)</span><br><span class="line">  Fetch URL: [https://github.com/my-org/complex-project](https://github.com/my-org/complex-project)</span><br><span class="line">  Push  URL: [https://github.com/my-org/complex-project](https://github.com/my-org/complex-project)</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branches:</span><br><span class="line">    master                           tracked</span><br><span class="line">    dev-branch                       tracked</span><br><span class="line">    markdown-strip                   tracked</span><br><span class="line">    issue-43                         new (next fetch will store <span class="keyword">in</span> remotes/origin)</span><br><span class="line">    issue-45                         new (next fetch will store <span class="keyword">in</span> remotes/origin)</span><br><span class="line">    refs/remotes/origin/issue-11     stale (use <span class="string">'git remote prune'</span> to remove)</span><br><span class="line">  Local branches configured <span class="keyword">for</span> <span class="string">'git pull'</span>:</span><br><span class="line">    dev-branch merges with remote dev-branch</span><br><span class="line">    master     merges with remote master</span><br><span class="line">  Local refs configured <span class="keyword">for</span> <span class="string">'git push'</span>:</span><br><span class="line">    dev-branch                     pushes to dev-branch                     (up to date)</span><br><span class="line">    markdown-strip                 pushes to markdown-strip                 (up to date)</span><br><span class="line">    master                         pushes to master                         (up to date)</span><br></pre></td></tr></table></figure>
<p>This command shows which branch is automatically pushed to when you run <code>git push</code> while on certain branches. It also shows you which remote branches on the server you don’t yet have, which remote branches you have that have been removed from the server, and multiple local branches that are able to merge automatically with their remote-tracking branch when you run <code>git pull</code>.</p>
<h3 id="Renaming-and-Removing-Remotes"><a href="#Renaming-and-Removing-Remotes" class="headerlink" title="Renaming and Removing Remotes"></a>Renaming and Removing Remotes</h3><p>You can run <code>git remote rename</code> to change a remote’s shortname. For instance, if you want to rename <code>pb</code> to <code>paul</code>, you can do so with <code>git remote rename</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git remote rename pb paul</span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br><span class="line">paul</span><br></pre></td></tr></table></figure>
<p>It’s worth mentioning that this changes all your remote-tracking branch names, too. What used to be referenced at <code>pb/master</code> is now at <code>paul/master</code>.</p>
<p>If you want to remove a remote for some reason — you’ve moved the server or are no longer using a particular mirror, or perhaps a contributor isn’t contributing anymore — you can either use <code>git remote remove</code> or <code>git remote rm</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote remove paul</span><br><span class="line">$ git remote</span><br><span class="line">origin</span><br></pre></td></tr></table></figure>
<p>Once you delete the reference to a remote this way, all remote-tracking branches and configuration settings associated with that remote are also deleted.</p>
<h2 id="Tagging"><a href="#Tagging" class="headerlink" title="Tagging"></a>Tagging</h2><p>Like most VCSs, Git has the ability to tag specific points in history as being important. Typically people use this functionality to mark release points (v1.0, and so on). In this section, you’ll learn how to list the available tags, how to create new tags, and what the different types of tags are.</p>
<h3 id="Listing-Your-Tags"><a href="#Listing-Your-Tags" class="headerlink" title="Listing Your Tags"></a>Listing Your Tags</h3><p>Listing the available tags in Git is straightforward. Just type <code>git tag</code> (with optional <code>-l</code> or <code>--list</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git tag</span><br><span class="line">v0.1</span><br><span class="line">v1.3</span><br></pre></td></tr></table></figure>
<p>This command lists the tags in alphabetical order; the order in which they appear has no real importance.</p>
<p>You can also search for tags that match a particular pattern. The Git source repo, for instance, contains more than 500 tags. If you’re only interested in looking at the 1.8.5 series, you can run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -l <span class="string">"v1.8.5*"</span></span><br><span class="line">v1.8.5</span><br><span class="line">v1.8.5-rc0</span><br><span class="line">v1.8.5-rc1</span><br><span class="line">v1.8.5-rc2</span><br><span class="line">v1.8.5-rc3</span><br><span class="line">v1.8.5.1</span><br><span class="line">v1.8.5.2</span><br><span class="line">v1.8.5.3</span><br><span class="line">v1.8.5.4</span><br><span class="line">v1.8.5.5</span><br></pre></td></tr></table></figure>
<h2 id="Listing-tag-wildcards-requires-l-or-list-option"><a href="#Listing-tag-wildcards-requires-l-or-list-option" class="headerlink" title="Listing tag wildcards requires -l or --list option"></a>Listing tag wildcards requires <code>-l</code> or <code>--list</code> option</h2><p>If you want just the entire list of tags, running the command <code>git tag</code> implicitly assumes you want a listing and provides one; the use of <code>-l</code> or <code>--list</code> in this case is optional.</p>
<p>If, however, you’re supplying a wildcard pattern to match tag names, the use of <code>-l</code> or <code>--list</code> is mandatory.</p>
<h3 id="Creating-Tags"><a href="#Creating-Tags" class="headerlink" title="Creating Tags"></a>Creating Tags</h3><p>Git supports two types of tags: <em>lightweight</em> and <em>annotated</em>.</p>
<p>A lightweight tag is very much like a branch that doesn’t change — it’s just a pointer to a specific commit.</p>
<p>Annotated tags, however, are stored as full objects in the Git database. They’re checksummed; contain the tagger name, email, and date; have a tagging message; and can be signed and verified with GNU Privacy Guard (GPG). It’s generally recommended that you create annotated tags so you can have all this information; but if you want a temporary tag or for some reason don’t want to keep the other information, lightweight tags are available too.</p>
<h3 id="Annotated-Tags"><a href="#Annotated-Tags" class="headerlink" title="Annotated Tags"></a>Annotated Tags</h3><p>Creating an annotated tag in Git is simple. The easiest way is to specify <code>-a</code> when you run the <code>tag</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v1.4 -m <span class="string">"my version 1.4"</span></span><br><span class="line">$ git tag</span><br><span class="line">v0.1</span><br><span class="line">v1.3</span><br><span class="line">v1.4</span><br></pre></td></tr></table></figure>
<p>The <code>-m</code> specifies a tagging message, which is stored with the tag. If you don’t specify a message for an annotated tag, Git launches your editor so you can type it in.</p>
<p>You can see the tag data along with the commit that was tagged by using the <code>git show</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git show v1.4</span><br><span class="line">tag v1.4</span><br><span class="line">Tagger: Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">Date:   Sat May 3 20:19:12 2014 -0700</span><br><span class="line"></span><br><span class="line">my version 1.4</span><br><span class="line"></span><br><span class="line">commit ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Mar 17 21:52:11 2008 -0700</span><br><span class="line"></span><br><span class="line">    changed the version number</span><br></pre></td></tr></table></figure>
<p>That shows the tagger information, the date the commit was tagged, and the annotation message before showing the commit information.</p>
<h3 id="Lightweight-Tags"><a href="#Lightweight-Tags" class="headerlink" title="Lightweight Tags"></a>Lightweight Tags</h3><p>Another way to tag commits is with a lightweight tag. This is basically the commit checksum stored in a file — no other information is kept. To create a lightweight tag, don’t supply any of the <code>-a</code>, <code>-s</code>, or <code>-m</code> options, just provide a tag name:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git tag v1.4-lw</span><br><span class="line">$ git tag</span><br><span class="line">v0.1</span><br><span class="line">v1.3</span><br><span class="line">v1.4</span><br><span class="line">v1.4-lw</span><br><span class="line">v1.5</span><br></pre></td></tr></table></figure>
<p>This time, if you run <code>git show</code> on the tag, you don’t see the extra tag information. The command just shows the commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git show v1.4-lw</span><br><span class="line">commit ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Mar 17 21:52:11 2008 -0700</span><br><span class="line"></span><br><span class="line">    changed the version number</span><br></pre></td></tr></table></figure>
<h3 id="Tagging-Later"><a href="#Tagging-Later" class="headerlink" title="Tagging Later"></a>Tagging Later</h3><p>You can also tag commits after you’ve moved past them. Suppose your commit history looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">15027957951b64cf874c3557a0f3547bd83b3ff6 Merge branch <span class="string">'experiment'</span></span><br><span class="line">a6b4c97498bd301d84096da251c98a07c7723e65 beginning write support</span><br><span class="line">0d52aaab4479697da7686c15f77a3d64d9165190 one more thing</span><br><span class="line">6d52a271eda8725415634dd79daabbc4d9b6008e Merge branch <span class="string">'experiment'</span></span><br><span class="line">0b7434d86859cc7b8c3d5e1dddfed66ff742fcbc added a commit <span class="keyword">function</span></span><br><span class="line">4682c3261057305bdd616e23b64b0857d832627b added a todo file</span><br><span class="line">166ae0c4d3f420721acbb115cc33848dfcc2121a started write support</span><br><span class="line">9fceb02d0ae598e95dc970b74767f19372d61af8 updated rakefile</span><br><span class="line">964f16d36dfccde844893cac5b347e7b3d44abbc commit the todo</span><br><span class="line">8a5cbc430f1a9c3d00faaeffd07798508422908a updated readme</span><br></pre></td></tr></table></figure>
<p>Now, suppose you forgot to tag the project at v1.2, which was at the “updated rakefile” commit. You can add it after the fact. To tag that commit, you specify the commit checksum (or part of it) at the end of the command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v1.2 9fceb02</span><br></pre></td></tr></table></figure>
<p>You can see that you’ve tagged the commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git tag</span><br><span class="line">v0.1</span><br><span class="line">v1.2</span><br><span class="line">v1.3</span><br><span class="line">v1.4</span><br><span class="line">v1.4-lw</span><br><span class="line">v1.5</span><br><span class="line"></span><br><span class="line">$ git show v1.2</span><br><span class="line">tag v1.2</span><br><span class="line">Tagger: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Feb 9 15:32:16 2009 -0800</span><br><span class="line"></span><br><span class="line">version 1.2</span><br><span class="line">commit 9fceb02d0ae598e95dc970b74767f19372d61af8</span><br><span class="line">Author: Magnus Chacon &lt;mchacon@gee-mail.com&gt;</span><br><span class="line">Date:   Sun Apr 27 20:43:35 2008 -0700</span><br><span class="line"></span><br><span class="line">    updated rakefile</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="Sharing-Tags"><a href="#Sharing-Tags" class="headerlink" title="Sharing Tags"></a>Sharing Tags</h3><p>By default, the <code>git push</code> command doesn’t transfer tags to remote servers. You will have to explicitly push tags to a shared server after you have created them. This process is just like sharing remote branches — you can run <code>git push origin &lt;tagname&gt;</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin v1.5</span><br><span class="line">Counting objects: 14, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (12/12), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (14/14), 2.05 KiB | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 14 (delta 3), reused 0 (delta 0)</span><br><span class="line">To git@github.com:schacon/simplegit.git</span><br><span class="line"> * [new tag]         v1.5 -&gt; v1.5</span><br></pre></td></tr></table></figure>
<p>If you have a lot of tags that you want to push up at once, you can also use the <code>--tags</code> option to the <code>git push</code> command. This will transfer all of your tags to the remote server that are not already there.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --tags</span><br><span class="line">Counting objects: 1, <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (1/1), 160 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 1 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@github.com:schacon/simplegit.git</span><br><span class="line"> * [new tag]         v1.4 -&gt; v1.4</span><br><span class="line"> * [new tag]         v1.4-lw -&gt; v1.4-lw</span><br></pre></td></tr></table></figure>
<p>Now, when someone else clones or pulls from your repository, they will get all your tags as well.</p>
<h3 id="Checking-out-Tags"><a href="#Checking-out-Tags" class="headerlink" title="Checking out Tags"></a>Checking out Tags</h3><p>If you want to view the versions of files a tag is pointing to, you can do a git checkout, though this puts your repository in “detached HEAD” state, which has some ill side effects:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout 2.0.0</span><br><span class="line">Note: checking out <span class="string">'2.0.0'</span>.</span><br><span class="line"></span><br><span class="line">You are <span class="keyword">in</span> <span class="string">'detached HEAD'</span> state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make <span class="keyword">in</span> this</span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"><span class="keyword">do</span> so (now or later) by using -b with the checkout <span class="built_in">command</span> again. Example:</span><br><span class="line"></span><br><span class="line">  git checkout -b &lt;new-branch&gt;</span><br><span class="line"></span><br><span class="line">HEAD is now at 99ada87... Merge pull request <span class="comment">#89 from schacon/appendix-final</span></span><br><span class="line"></span><br><span class="line">$ git checkout 2.0-beta-0.1</span><br><span class="line">Previous HEAD position was 99ada87... Merge pull request <span class="comment">#89 from schacon/appendix-final</span></span><br><span class="line">HEAD is now at df3f601... add atlas.json and cover image</span><br></pre></td></tr></table></figure>
<p>In “detached HEAD” state, if you make changes and then create a commit, the tag will stay the same, but your new commit won’t belong to any branch and will be unreachable, except by the exact commit hash. Thus, if you need to make changes — say you’re fixing a bug on an older version, for instance — you will generally want to create a branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b version2 v2.0.0</span><br><span class="line">Switched to a new branch <span class="string">'version2'</span></span><br></pre></td></tr></table></figure>
<p>If you do this and make a commit, your <code>version2</code> branch will be slightly different than your <code>v2.0.0</code> tag since it will move forward with your new changes, so do be careful.</p>
<h2 id="Git-Aliases"><a href="#Git-Aliases" class="headerlink" title="Git Aliases"></a>Git Aliases</h2><p>Before we finish this chapter on basic Git, there’s just one little tip that can make your Git experience simpler, easier, and more familiar: aliases. We won’t refer to them or assume you’ve used them later in the book, but you should probably know how to use them.</p>
<p>Git doesn’t automatically infer your command if you type it in partially. If you don’t want to type the entire text of each of the Git commands, you can easily set up an alias for each command using <code>git config</code>. Here are a couple of examples you may want to set up:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.co checkout</span><br><span class="line">$ git config --global alias.br branch</span><br><span class="line">$ git config --global alias.ci commit</span><br><span class="line">$ git config --global alias.st status</span><br></pre></td></tr></table></figure>
<p>This means that, for example, instead of typing <code>git commit</code>, you just need to type <code>git ci</code>. As you go on using Git, you’ll probably use other commands frequently as well; don’t hesitate to create new aliases.</p>
<p>This technique can also be very useful in creating commands that you think should exist. For example, to correct the usability problem you encountered with unstaging a file, you can add your own unstage alias to Git:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.unstage <span class="string">'reset HEAD --'</span></span><br></pre></td></tr></table></figure>
<p>This makes the following two commands equivalent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git unstage fileA</span><br><span class="line">$ git reset HEAD -- fileA</span><br></pre></td></tr></table></figure>
<p>This seems a bit clearer. It’s also common to add a <code>last</code> command, like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.last <span class="string">'log -1 HEAD'</span></span><br></pre></td></tr></table></figure>
<p>This way, you can see the last commit easily:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git last</span><br><span class="line">commit 66938dae3329c7aebe598c2246a8e6af90d04646</span><br><span class="line">Author: Josh Goebel &lt;dreamer3@example.com&gt;</span><br><span class="line">Date:   Tue Aug 26 19:48:51 2008 +0800</span><br><span class="line"></span><br><span class="line">    <span class="built_in">test</span> <span class="keyword">for</span> current head</span><br><span class="line"></span><br><span class="line">    Signed-off-by: Scott Chacon &lt;schacon@example.com&gt;</span><br></pre></td></tr></table></figure>
<p>As you can tell, Git simply replaces the new command with whatever you alias it for. However, maybe you want to run an external command, rather than a Git subcommand. In that case, you start the command with a <code>!</code> character. This is useful if you write your own tools that work with a Git repository. We can demonstrate by aliasing <code>git visual</code> to run <code>gitk</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.visual <span class="string">'!gitk'</span></span><br></pre></td></tr></table></figure>
<h2 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h2><p>At this point, you can do all the basic local Git operations — creating or cloning a repository, making changes, staging and committing those changes, and viewing the history of all the changes the repository has been through. Next, we’ll cover Git’s killer feature: its branching model.</p>
<h1 id="Git-Branching"><a href="#Git-Branching" class="headerlink" title="Git Branching"></a><strong>Git</strong> <strong>Branching</strong></h1><p>Nearly every VCS has some form of branching support. Branching means you diverge from the main line of development and continue to do work without messing with that main line. In many VCS tools, this is a somewhat expensive process, often requiring you to create a new copy of your source code directory, which can take a long time for large projects.</p>
<p>Some people refer to Git’s branching model as its “killer feature,” and it certainly sets Git apart in the VCS community. Why is it so special? The way Git branches is incredibly lightweight, making branching operations nearly instantaneous, and switching back and forth between branches generally just as fast. Unlike many other VCSs, Git encourages workflows that branch and merge often, even multiple times in a day. Understanding and mastering this feature gives you a powerful and unique tool and can entirely change the way that you develop.</p>
<h2 id="Branches-in-a-Nutshell"><a href="#Branches-in-a-Nutshell" class="headerlink" title="Branches in a Nutshell"></a>Branches in a Nutshell</h2><p>To really understand the way Git does branching, we need to take a step back and examine how Git stores its data.</p>
<p>As you may remember from 【Getting Started】, Git doesn’t store data as a series of changesets or differences, but instead as a series of <em>snapshots</em>.</p>
<p>When you make a commit, Git stores a commit object that contains a pointer to the snapshot of the content you staged. This object also contains the author’s name and email address, the message that you typed, and pointers to the commit or commits that directly came before this commit (its parent or parents): zero parents for the initial commit, one parent for a normal commit, and multiple parents for a commit that results from a merge of two or more branches.</p>
<p>To visualize this, let’s assume that you have a directory containing three files, and you stage them all and commit. Staging the files computes a checksum for each one (the SHA-1 hash we mentioned in 【Getting Started】), stores that version of the file in the Git repository (Git refers to them as <em>blobs</em>), and adds that checksum to the staging area:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add README test.rb LICENSE</span><br><span class="line">$ git commit -m <span class="string">'The initial commit of my project'</span></span><br></pre></td></tr></table></figure>
<p>When you create the commit by running <code>git commit</code>, Git checksums each subdirectory (in this case, just the root project directory) and stores those tree objects in the Git repository. Git then creates a commit object that has the metadata and a pointer to the root project tree so it can re-create that snapshot when needed.</p>
<p>Your Git repository now contains five objects: three blobs (each representing the contents of one of the three files), one tree that lists the contents of the directory and specifies which file names are stored as which blobs, and one commit with the pointer to that root tree and all the commit metadata.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck3sopmj20m80cbaae.jpg" alt="A commit and its tree.">  Figure 1. A commit and its tree  If you make some changes and commit again, the next commit stores a pointer to the commit that came immediately before it.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck6q9w3j20m807daab.jpg" alt="Commits and their parents.">  Figure 2. Commits and their parents  A branch in Git is simply a lightweight movable pointer to one of these commits. The default branch name in Git is <code>master</code>. As you start making commits, you’re given a <code>master</code> branch that points to the last commit you made. Every time you commit, the <code>master</code> branch pointer moves forward automatically.</p>
<p>The “master” branch in Git is not a special branch. It is exactly like any other branch. The only reason nearly every repository has one is that the <code>git init</code> command creates it by default and most people don’t bother to change it.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckbo5s6j20m80by0sr.jpg" alt="A branch and its commit history.">  Figure 3. A branch and its commit history</p>
<h3 id="Creating-a-New-Branch"><a href="#Creating-a-New-Branch" class="headerlink" title="Creating a New Branch"></a>Creating a New Branch</h3><p>What happens if you create a new branch? Well, doing so creates a new pointer for you to move around. Let’s say you want to create a new branch called <code>testing</code>. You do this with the <code>git branch</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch testing</span><br></pre></td></tr></table></figure>
<p>This creates a new pointer to the same commit you’re currently on.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckfyidpj20m8097mx4.jpg" alt="Two branches pointing into the same series of commits.">  Figure 4. Two branches pointing into the same series of commits  How does Git know what branch you’re currently on? It keeps a special pointer called <code>HEAD</code>. Note that this is a lot different than the concept of <code>HEAD</code> in other VCSs you may be used to, such as Subversion or CVS. In Git, this is a pointer to the local branch you’re currently on. In this case, you’re still on <code>master</code>. The <code>git branch</code> command only <em>created</em> a new branch — it didn’t switch to that branch.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcklssd5j20m80czq2x.jpg" alt="HEAD pointing to a branch.">  Figure 5. HEAD pointing to a branch  You can easily see this by running a simple <code>git log</code> command that shows you where the branch pointers are pointing. This option is called <code>--decorate</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --decorate</span><br><span class="line">f30ab (HEAD -&gt; master, testing) add feature <span class="comment">#32 - ability to add new formats to the central interface</span></span><br><span class="line">34ac2 Fixed bug <span class="comment">#1328 - stack overflow under certain conditions</span></span><br><span class="line">98ca9 The initial commit of my project</span><br></pre></td></tr></table></figure>
<p>You can see the “master” and “testing” branches that are right there next to the <code>f30ab</code> commit.</p>
<h3 id="Switching-Branches"><a href="#Switching-Branches" class="headerlink" title="Switching Branches"></a>Switching Branches</h3><p>To switch to an existing branch, you run the <code>git checkout</code> command. Let’s switch to the new <code>testing</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout testing</span><br></pre></td></tr></table></figure>
<p>This moves <code>HEAD</code> to point to the <code>testing</code> branch.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckpjh75j20m80csmx5.jpg" alt="HEAD points to the current branch.">  Figure 6. HEAD points to the current branch  What is the significance of that? Well, let’s do another commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim test.rb</span><br><span class="line">$ git commit -a -m <span class="string">'made a change'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckrcx0aj20m809awef.jpg" alt="The HEAD branch moves forward when a commit is made.">  Figure 7. The HEAD branch moves forward when a commit is made  This is interesting, because now your <code>testing</code> branch has moved forward, but your <code>master</code> branch still points to the commit you were on when you ran <code>git checkout</code> to switch branches. Let’s switch back to the <code>master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcktapbpj20m809adfr.jpg" alt="HEAD moves when you checkout.">  Figure 8. HEAD moves when you checkout  That command did two things. It moved the HEAD pointer back to point to the <code>master</code> branch, and it reverted the files in your working directory back to the snapshot that <code>master</code> points to. This also means the changes you make from this point forward will diverge from an older version of the project. It essentially rewinds the work you’ve done in your <code>testing</code> branch so you can go in a different direction.</p>
<h2 id="Switching-branches-changes-files-in-your-working-directory"><a href="#Switching-branches-changes-files-in-your-working-directory" class="headerlink" title="Switching branches changes files in your working directory"></a>Switching branches changes files in your working directory</h2><p>It’s important to note that when you switch branches in Git, files in your working directory will change. If you switch to an older branch, your working directory will be reverted to look like it did the last time you committed on that branch. If Git cannot do it cleanly, it will not let you switch at all.</p>
<p>Let’s make a few changes and commit again:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim test.rb</span><br><span class="line">$ git commit -a -m <span class="string">'made other changes'</span></span><br></pre></td></tr></table></figure>
<p>Now your project history has diverged (see 【Divergent history】). You created and switched to a branch, did some work on it, and then switched back to your main branch and did other work. Both of those changes are isolated in separate branches: you can switch back and forth between the branches and merge them together when you’re ready. And you did all that with simple <code>branch</code>, <code>checkout</code>, and <code>commit</code> commands.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcky2la0j20m80e8wee.jpg" alt="Divergent history.">  Figure 9. Divergent history  You can also see this easily with the <code>git log</code> command. If you run <code>git log --oneline --decorate --graph --all</code> it will print out the history of your commits, showing where your branch pointers are and how your history has diverged.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* c2b9e (HEAD, master) made other changes</span><br><span class="line">| * 87ab2 (testing) made a change</span><br><span class="line">|/</span><br><span class="line">* f30ab add feature <span class="comment">#32 - ability to add new formats to the</span></span><br><span class="line">* 34ac2 fixed bug <span class="comment">#1328 - stack overflow under certain conditions</span></span><br><span class="line">* 98ca9 initial commit of my project</span><br></pre></td></tr></table></figure>
<p>Because a branch in Git is actually a simple file that contains the 40 character SHA-1 checksum of the commit it points to, branches are cheap to create and destroy. Creating a new branch is as quick and simple as writing 41 bytes to a file (40 characters and a newline).</p>
<p>This is in sharp contrast to the way most older VCS tools branch, which involves copying all of the project’s files into a second directory. This can take several seconds or even minutes, depending on the size of the project, whereas in Git the process is always instantaneous. Also, because we’re recording the parents when we commit, finding a proper merge base for merging is automatically done for us and is generally very easy to do. These features help encourage developers to create and use branches often.</p>
<p>Let’s see why you should do so.</p>
<h2 id="Basic-Branching-and-Merging"><a href="#Basic-Branching-and-Merging" class="headerlink" title="Basic Branching and Merging"></a>Basic Branching and Merging</h2><p>Let’s go through a simple example of branching and merging with a workflow that you might use in the real world. You’ll follow these steps:</p>
<ol start="2">
<li>Do some work on a website.</li>
<li>Create a branch for a new story you’re working on.</li>
<li><p>Do some work in that branch.<br>At this stage, you’ll receive a call that another issue is critical and you need a hotfix. You’ll do the following:</p>
</li>
<li><p>Switch to your production branch.</p>
</li>
<li>Create a branch to add the hotfix.</li>
<li>After it’s tested, merge the hotfix branch, and push to production.</li>
<li>Switch back to your original story and continue working.</li>
</ol>
<h3 id="Basic-Branching"><a href="#Basic-Branching" class="headerlink" title="Basic Branching"></a>Basic Branching</h3><p>First, let’s say you’re working on your project and have a couple of commits already on the <code>master</code> branch.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl1ngowj20m806gq2u.jpg" alt="A simple commit history.">  Figure 10. A simple commit history  You’ve decided that you’re going to work on issue #53 in whatever issue-tracking system your company uses. To create a new branch and switch to it at the same time, you can run the <code>git checkout</code> command with the <code>-b</code> switch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b iss53</span><br><span class="line">Switched to a new branch <span class="string">"iss53"</span></span><br></pre></td></tr></table></figure>
<p>This is shorthand for:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch iss53</span><br><span class="line">$ git checkout iss53</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl51tipj20m80aumx4.jpg" alt="Creating a new branch pointer.">  Figure 11. Creating a new branch pointer  You work on your website and do some commits. Doing so moves the <code>iss53</code> branch forward, because you have it checked out (that is, your <code>HEAD</code> is pointing to it):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim index.html</span><br><span class="line">$ git commit -a -m <span class="string">'added a new footer [issue 53]'</span></span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl7l6i4j20m8080dfq.jpg" alt="The `iss53` branch has moved forward with your work.">  Figure 12. The <code>iss53</code> branch has moved forward with your work  Now you get the call that there is an issue with the website, and you need to fix it immediately. With Git, you don’t have to deploy your fix along with the <code>iss53</code> changes you’ve made, and you don’t have to put a lot of effort into reverting those changes before you can work on applying your fix to what is in production. All you have to do is switch back to your <code>master</code> branch.</p>
<p>However, before you do that, note that if your working directory or staging area has uncommitted changes that conflict with the branch you’re checking out, Git won’t let you switch branches. It’s best to have a clean working state when you switch branches. There are ways to get around this (namely, stashing and commit amending) that we’ll cover later on, in 【Stashing and Cleaning】. For now, let’s assume you’ve committed all your changes, so you can switch back to your <code>master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br></pre></td></tr></table></figure>
<p>At this point, your project working directory is exactly the way it was before you started working on issue #53, and you can concentrate on your hotfix. This is an important point to remember: when you switch branches, Git resets your working directory to look like it did the last time you committed on that branch. It adds, removes, and modifies files automatically to make sure your working copy is what the branch looked like on your last commit to it.</p>
<p>Next, you have a hotfix to make. Let’s create a <code>hotfix</code> branch on which to work until it’s completed:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b hotfix</span><br><span class="line">Switched to a new branch <span class="string">'hotfix'</span></span><br><span class="line">$ vim index.html</span><br><span class="line">$ git commit -a -m <span class="string">'fixed the broken email address'</span></span><br><span class="line">[hotfix 1fb7853] fixed the broken email address</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclbi698j20m80anjrd.jpg" alt="Hotfix branch based on `master`.">  Figure 13. Hotfix branch based on <code>master</code>  You can run your tests, make sure the hotfix is what you want, and finally merge the <code>hotfix</code> branch back into your <code>master</code> branch to deploy to production. You do this with the <code>git merge</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge hotfix</span><br><span class="line">Updating f42c576..3a0874c</span><br><span class="line">Fast-forward</span><br><span class="line"> index.html | 2 ++</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br></pre></td></tr></table></figure>
<p>You’ll notice the phrase “fast-forward” in that merge. Because the commit <code>C4</code> pointed to by the branch <code>hotfix</code> you merged in was directly ahead of the commit <code>C2</code> you’re on, Git simply moves the pointer forward. To phrase that another way, when you try to merge one commit with a commit that can be reached by following the first commit’s history, Git simplifies things by moving the pointer forward because there is no divergent work to merge together — this is called a “fast-forward.”</p>
<p>Your change is now in the snapshot of the commit pointed to by the <code>master</code> branch, and you can deploy the fix.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclf8f55j20m80dcmx4.jpg" alt="`master` is fast-forwarded to `hotfix`.">  Figure 14. <code>master</code> is fast-forwarded to <code>hotfix</code>  After your super-important fix is deployed, you’re ready to switch back to the work you were doing before you were interrupted. However, first you’ll delete the <code>hotfix</code> branch, because you no longer need it — the <code>master</code> branch points at the same place. You can delete it with the <code>-d</code> option to <code>git branch</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d hotfix</span><br><span class="line">Deleted branch hotfix (3a0874c).</span><br></pre></td></tr></table></figure>
<p>Now you can switch back to your work-in-progress branch on issue #53 and continue working on it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout iss53</span><br><span class="line">Switched to branch <span class="string">"iss53"</span></span><br><span class="line">$ vim index.html</span><br><span class="line">$ git commit -a -m <span class="string">'finished the new footer [issue 53]'</span></span><br><span class="line">[iss53 ad82d7a] finished the new footer [issue 53]</span><br><span class="line">1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclhhmkxj20m80aldfr.jpg" alt="Work continues on `iss53`.">  Figure 15. Work continues on <code>iss53</code>  It’s worth noting here that the work you did in your <code>hotfix</code> branch is not contained in the files in your <code>iss53</code> branch. If you need to pull it in, you can merge your <code>master</code> branch into your <code>iss53</code> branch by running <code>git merge master</code>, or you can wait to integrate those changes until you decide to pull the <code>iss53</code> branch back into <code>master</code> later.</p>
<h3 id="Basic-Merging"><a href="#Basic-Merging" class="headerlink" title="Basic Merging"></a>Basic Merging</h3><p>Suppose you’ve decided that your issue #53 work is complete and ready to be merged into your <code>master</code> branch. In order to do that, you’ll merge your <code>iss53</code> branch into <code>master</code>, much like you merged your <code>hotfix</code> branch earlier. All you have to do is check out the branch you wish to merge into and then run the <code>git merge</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line">$ git merge iss53</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line">index.html |    1 +</span><br><span class="line">1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<p>This looks a bit different than the <code>hotfix</code> merge you did earlier. In this case, your development history has diverged from some older point. Because the commit on the branch you’re on isn’t a direct ancestor of the branch you’re merging in, Git has to do some work. In this case, Git does a simple three-way merge, using the two snapshots pointed to by the branch tips and the common ancestor of the two.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm7z0yyj20m80aljrf.jpg" alt="Three snapshots used in a typical merge.">  Figure 16. Three snapshots used in a typical merge  Instead of just moving the branch pointer forward, Git creates a new snapshot that results from this three-way merge and automatically creates a new commit that points to it. This is referred to as a merge commit, and is special in that it has more than one parent.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn4xpv4j20m808s0sm.jpg" alt="A merge commit.">  Figure 17. A merge commit  Now that your work is merged in, you have no further need for the <code>iss53</code> branch. You can close the ticket in your ticket-tracking system, and delete the branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d iss53</span><br></pre></td></tr></table></figure>
<h3 id="Basic-Merge-Conflicts"><a href="#Basic-Merge-Conflicts" class="headerlink" title="Basic Merge Conflicts"></a>Basic Merge Conflicts</h3><p>Occasionally, this process doesn’t go smoothly. If you changed the same part of the same file differently in the two branches you’re merging together, Git won’t be able to merge them cleanly. If your fix for issue #53 modified the same part of a file as the <code>hotfix</code> branch, you’ll get a merge conflict that looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git merge iss53</span><br><span class="line">Auto-merging index.html</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> index.html</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>Git hasn’t automatically created a new merge commit. It has paused the process while you resolve the conflict. If you want to see which files are unmerged at any point after a merge conflict, you can run <code>git status</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">You have unmerged paths.</span><br><span class="line">  (fix conflicts and run <span class="string">"git commit"</span>)</span><br><span class="line"></span><br><span class="line">Unmerged paths:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to mark resolution)</span><br><span class="line"></span><br><span class="line">    both modified:      index.html</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br></pre></td></tr></table></figure>
<p>Anything that has merge conflicts and hasn’t been resolved is listed as unmerged. Git adds standard conflict-resolution markers to the files that have conflicts, so you can open them manually and resolve those conflicts. Your file contains a section that looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:index.html</span><br><span class="line">&lt;div id=<span class="string">"footer"</span>&gt;contact : email.support@github.com&lt;/div&gt;</span><br><span class="line">=======</span><br><span class="line">&lt;div id=<span class="string">"footer"</span>&gt;</span><br><span class="line"> please contact us at support@github.com</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; iss53:index.html</span><br></pre></td></tr></table></figure>
<p>This means the version in <code>HEAD</code> (your <code>master</code> branch, because that was what you had checked out when you ran your merge command) is the top part of that block (everything above the <code>=======</code>), while the version in your <code>iss53</code> branch looks like everything in the bottom part. In order to resolve the conflict, you have to either choose one side or the other or merge the contents yourself. For instance, you might resolve this conflict by replacing the entire block with this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"footer"</span>&gt;</span><br><span class="line">please contact us at email.support@github.com</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>This resolution has a little of each section, and the <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>, <code>=======</code>, and <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> lines have been completely removed. After you’ve resolved each of these sections in each conflicted file, run <code>git add</code> on each file to mark it as resolved. Staging the file marks it as resolved in Git.</p>
<p>If you want to use a graphical tool to resolve these issues, you can run <code>git mergetool</code>, which fires up an appropriate visual merge tool and walks you through the conflicts:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git mergetool</span><br><span class="line"></span><br><span class="line">This message is displayed because <span class="string">'merge.tool'</span> is not configured.</span><br><span class="line">See <span class="string">'git mergetool --tool-help'</span> or <span class="string">'git help config'</span> <span class="keyword">for</span> more details.</span><br><span class="line"><span class="string">'git mergetool'</span> will now attempt to use one of the following tools:</span><br><span class="line">opendiff kdiff3 tkdiff xxdiff meld tortoisemerge gvimdiff diffuse diffmerge ecmerge p4merge araxis bc3 codecompare vimdiff emerge</span><br><span class="line">Merging:</span><br><span class="line">index.html</span><br><span class="line"></span><br><span class="line">Normal merge conflict <span class="keyword">for</span> <span class="string">'index.html'</span>:</span><br><span class="line">  &#123;<span class="built_in">local</span>&#125;: modified file</span><br><span class="line">  &#123;remote&#125;: modified file</span><br><span class="line">Hit <span class="built_in">return</span> to start merge resolution tool (opendiff):</span><br></pre></td></tr></table></figure>
<p>If you want to use a merge tool other than the default (Git chose <code>opendiff</code> in this case because the command was run on a Mac), you can see all the supported tools listed at the top after “one of the following tools.” Just type the name of the tool you’d rather use.</p>
<p>If you need more advanced tools for resolving tricky merge conflicts, we cover more on merging in 【Advanced Merging】.</p>
<p>After you exit the merge tool, Git asks you if the merge was successful. If you tell the script that it was, it stages the file to mark it as resolved for you. You can run <code>git status</code> again to verify that all conflicts have been resolved:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">All conflicts fixed but you are still merging.</span><br><span class="line">  (use <span class="string">"git commit"</span> to conclude merge)</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line"></span><br><span class="line">    modified:   index.html</span><br></pre></td></tr></table></figure>
<p>If you’re happy with that, and you verify that everything that had conflicts has been staged, you can type <code>git commit</code> to finalize the merge commit. The commit message by default looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Merge branch <span class="string">'iss53'</span></span><br><span class="line"></span><br><span class="line">Conflicts:</span><br><span class="line">    index.html</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It looks like you may be committing a merge.</span></span><br><span class="line"><span class="comment"># If this is not correct, please remove the file</span></span><br><span class="line"><span class="comment">#	.git/MERGE_HEAD</span></span><br><span class="line"><span class="comment"># and try again.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Please enter the commit message for your changes. Lines starting</span></span><br><span class="line"><span class="comment"># with '#' will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line"><span class="comment"># All conflicts fixed but you are still merging.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Changes to be committed:</span></span><br><span class="line"><span class="comment">#	modified:   index.html</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>If you think it would be helpful to others looking at this merge in the future, you can modify this commit message with details about how you resolved the merge and explain why you did the changes you made if these are not obvious.</p>
<h2 id="Branch-Management"><a href="#Branch-Management" class="headerlink" title="Branch Management"></a>Branch Management</h2><p>Now that you’ve created, merged, and deleted some branches, let’s look at some branch-management tools that will come in handy when you begin using branches all the time.</p>
<p>The <code>git branch</code> command does more than just create and delete branches. If you run it with no arguments, you get a simple listing of your current branches:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br><span class="line">  iss53</span><br><span class="line">* master</span><br><span class="line">  testing</span><br></pre></td></tr></table></figure>
<p>Notice the <code>*</code> character that prefixes the <code>master</code> branch: it indicates the branch that you currently have checked out (i.e., the branch that <code>HEAD</code> points to). This means that if you commit at this point, the <code>master</code> branch will be moved forward with your new work. To see the last commit on each branch, you can run <code>git branch -v</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -v</span><br><span class="line">  iss53   93b412c fix javascript issue</span><br><span class="line">* master  7a98805 Merge branch <span class="string">'iss53'</span></span><br><span class="line">  testing 782fd34 add scott to the author list <span class="keyword">in</span> the readmes</span><br></pre></td></tr></table></figure>
<p>The useful <code>--merged</code> and <code>--no-merged</code> options can filter this list to branches that you have or have not yet merged into the branch you’re currently on. To see which branches are already merged into the branch you’re on, you can run <code>git branch --merged</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch --merged</span><br><span class="line">  iss53</span><br><span class="line">* master</span><br></pre></td></tr></table></figure>
<p>Because you already merged in <code>iss53</code> earlier, you see it in your list. Branches on this list without the <code>*</code> in front of them are generally fine to delete with <code>git branch -d</code>; you’ve already incorporated their work into another branch, so you’re not going to lose anything.</p>
<p>To see all the branches that contain work you haven’t yet merged in, you can run <code>git branch --no-merged</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch --no-merged</span><br><span class="line">  testing</span><br></pre></td></tr></table></figure>
<p>This shows your other branch. Because it contains work that isn’t merged in yet, trying to delete it with <code>git branch -d</code> will fail:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d testing</span><br><span class="line">error: The branch <span class="string">'testing'</span> is not fully merged.</span><br><span class="line">If you are sure you want to delete it, run <span class="string">'git branch -D testing'</span>.</span><br></pre></td></tr></table></figure>
<p>If you really do want to delete the branch and lose that work, you can force it with <code>-D</code>, as the helpful message points out.</p>
<p>The options described above, <code>--merged</code> and <code>--no-merged</code> will, if not given a commit or branch name as an argument, show you what is, respectively, merged or not merged into your <em>current</em> branch.</p>
<p>You can always provide an additional argument to ask about the merge state with respect to some other branch without checking that other branch out first, as in, what is not merged into the <code>master</code> branch?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout testing</span><br><span class="line">$ git branch --no-merged master</span><br><span class="line">  topicA</span><br><span class="line">  featureB</span><br></pre></td></tr></table></figure>
<h2 id="Branching-Workflows"><a href="#Branching-Workflows" class="headerlink" title="Branching Workflows"></a>Branching Workflows</h2><p>Now that you have the basics of branching and merging down, what can or should you do with them? In this section, we’ll cover some common workflows that this lightweight branching makes possible, so you can decide if you would like to incorporate them into your own development cycle.</p>
<h3 id="Long-Running-Branches"><a href="#Long-Running-Branches" class="headerlink" title="Long-Running Branches"></a>Long-Running Branches</h3><p>Because Git uses a simple three-way merge, merging from one branch into another multiple times over a long period is generally easy to do. This means you can have several branches that are always open and that you use for different stages of your development cycle; you can merge regularly from some of them into others.</p>
<p>Many Git developers have a workflow that embraces this approach, such as having only code that is entirely stable in their <code>master</code> branch — possibly only code that has been or will be released. They have another parallel branch named <code>develop</code> or <code>next</code> that they work from or use to test stability — it isn’t necessarily always stable, but whenever it gets to a stable state, it can be merged into <code>master</code>. It’s used to pull in topic branches (short-lived branches, like your earlier <code>iss53</code> branch) when they’re ready, to make sure they pass all the tests and don’t introduce bugs.</p>
<p>In reality, we’re talking about pointers moving up the line of commits you’re making. The stable branches are farther down the line in your commit history, and the bleeding-edge branches are farther up the history.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjz74jpj20m802w3ye.jpg" alt="A linear view of progressive-stability branching.">  Figure 18. A linear view of progressive-stability branching  It’s generally easier to think about them as work silos, where sets of commits graduate to a more stable silo when they’re fully tested.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnaghcej20m8084glm.jpg" alt="A ``silo&#39;&#39; view of progressive-stability branching.">  Figure 19. A “silo” view of progressive-stability branching  You can keep doing this for several levels of stability. Some larger projects also have a <code>proposed</code> or <code>pu</code> (proposed updates) branch that has integrated branches that may not be ready to go into the <code>next</code> or <code>master</code> branch. The idea is that your branches are at various levels of stability; when they reach a more stable level, they’re merged into the branch above them. Again, having multiple long-running branches isn’t necessary, but it’s often helpful, especially when you’re dealing with very large or complex projects.</p>
<h3 id="Topic-Branches"><a href="#Topic-Branches" class="headerlink" title="Topic Branches"></a>Topic Branches</h3><p>Topic branches, however, are useful in projects of any size. A topic branch is a short-lived branch that you create and use for a single particular feature or related work. This is something you’ve likely never done with a VCS before because it’s generally too expensive to create and merge branches. But in Git it’s common to create, work on, merge, and delete branches several times a day.</p>
<p>You saw this in the last section with the <code>iss53</code> and <code>hotfix</code> branches you created. You did a few commits on them and deleted them directly after merging them into your main branch. This technique allows you to context-switch quickly and completely — because your work is separated into silos where all the changes in that branch have to do with that topic, it’s easier to see what has happened during code review and such. You can keep the changes there for minutes, days, or months, and merge them in when they’re ready, regardless of the order in which they were created or worked on.</p>
<p>Consider an example of doing some work (on <code>master</code>), branching off for an issue (<code>iss91</code>), working on it for a bit, branching off the second branch to try another way of handling the same thing (<code>iss91v2</code>), going back to your <code>master</code> branch and working there for a while, and then branching off there to do some work that you’re not sure is a good idea (<code>dumbidea</code> branch). Your commit history will look something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcndbl5dj20m80hmglw.jpg" alt="Multiple topic branches.">  Figure 20. Multiple topic branches  Now, let’s say you decide you like the second solution to your issue best (<code>iss91v2</code>); and you showed the <code>dumbidea</code> branch to your coworkers, and it turns out to be genius. You can throw away the original <code>iss91</code> branch (losing commits <code>C5</code> and <code>C6</code>) and merge in the other two. Your history then looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcifvci6j20ki0m874l.jpg" alt="History after merging `dumbidea` and `iss91v2`.">  Figure 21. History after merging <code>dumbidea</code> and <code>iss91v2</code>  We will go into more detail about the various possible workflows for your Git project in 【Distributed Git】, so before you decide which branching scheme your next project will use, be sure to read that chapter.</p>
<p>It’s important to remember when you’re doing all this that these branches are completely local. When you’re branching and merging, everything is being done only in your Git repository — no server communication is happening.</p>
<h2 id="Remote-Branches"><a href="#Remote-Branches" class="headerlink" title="Remote Branches"></a>Remote Branches</h2><p>Remote references are references (pointers) in your remote repositories, including branches, tags, and so on. You can get a full list of remote references explicitly with <code>git ls-remote [remote]</code>, or <code>git remote show [remote]</code> for remote branches as well as more information. Nevertheless, a more common way is to take advantage of remote-tracking branches.</p>
<p>Remote-tracking branches are references to the state of remote branches. They’re local references that you can’t move; Git moves them for you whenever you do any network communication, to make sure they accurately represent the state of the remote repository. Think of them as bookmarks, to remind you where the branches in your remote repositories were the last time you connected to them.</p>
<p>Remote-tracking branches take the form <code>&lt;remote&gt;/&lt;branch&gt;</code>. For instance, if you wanted to see what the <code>master</code> branch on your <code>origin</code> remote looked like as of the last time you communicated with it, you would check the <code>origin/master</code> branch. If you were working on an issue with a partner and they pushed up an <code>iss53</code> branch, you might have your own local <code>iss53</code> branch, but the branch on the server would be represented by the remote-tracking branch <code>origin/iss53</code>.</p>
<p>This may be a bit confusing, so let’s look at an example. Let’s say you have a Git server on your network at <code>git.ourcompany.com</code>. If you clone from this, Git’s <code>clone</code> command automatically names it <code>origin</code> for you, pulls down all its data, creates a pointer to where its <code>master</code> branch is, and names it <code>origin/master</code> locally. Git also gives you your own local <code>master</code> branch starting at the same place as origin’s <code>master</code> branch, so you have something to work from.</p>
<h2 id="“origin”-is-not-special"><a href="#“origin”-is-not-special" class="headerlink" title="“origin” is not special"></a>“origin” is not special</h2><p>Just like the branch name “master” does not have any special meaning in Git, neither does “origin”. While “master” is the default name for a starting branch when you run <code>git init</code> which is the only reason it’s widely used, “origin” is the default name for a remote when you run <code>git clone</code>. If you run <code>git clone -o booyah</code> instead, then you will have <code>booyah/master</code> as your default remote branch.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnn7et9j20m80g1glv.jpg" alt="Server and local repositories after cloning.">  Figure 22. Server and local repositories after cloning  If you do some work on your local <code>master</code> branch, and, in the meantime, someone else pushes to <code>git.ourcompany.com</code> and updates its <code>master</code> branch, then your histories move forward differently. Also, as long as you stay out of contact with your origin server, your <code>origin/master</code> pointer doesn’t move.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck5aa5qj20m80doaa8.jpg" alt="Local and remote work can diverge.">  Figure 23. Local and remote work can diverge  To synchronize your work, you run a <code>git fetch origin</code> command. This command looks up which server “origin” is (in this case, it’s <code>git.ourcompany.com</code>), fetches any data from it that you don’t yet have, and updates your local database, moving your <code>origin/master</code> pointer to its new, more up-to-date position.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnq8cjrj20m80gcjrm.jpg" alt="`git fetch` updates your remote references.">  Figure 24. <code>git fetch</code> updates your remote-tracking branches  To demonstrate having multiple remote servers and what remote branches for those remote projects look like, let’s assume you have another internal Git server that is used only for development by one of your sprint teams. This server is at <code>git.team1.ourcompany.com</code>. You can add it as a new remote reference to the project you’re currently working on by running the <code>git remote add</code> command as we covered in 【Git Basics】. Name this remote <code>teamone</code>, which will be your shortname for that whole URL.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnw30gmj20m80g1wet.jpg" alt="Adding another server as a remote.">  Figure 25. Adding another server as a remote  Now, you can run <code>git fetch teamone</code> to fetch everything the remote <code>teamone</code> server has that you don’t have yet. Because that server has a subset of the data your <code>origin</code> server has right now, Git fetches no data but sets a remote-tracking branch called <code>teamone/master</code> to point to the commit that <code>teamone</code> has as its <code>master</code> branch.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco063vrj20m80g1glx.jpg" alt="Remote tracking branch for `teamone/master`.">  Figure 26. Remote-tracking branch for <code>teamone/master</code></p>
<h3 id="Pushing"><a href="#Pushing" class="headerlink" title="Pushing"></a>Pushing</h3><p>When you want to share a branch with the world, you need to push it up to a remote that you have write access to. Your local branches aren’t automatically synchronized to the remotes you write to — you have to explicitly push the branches you want to share. That way, you can use private branches for work you don’t want to share, and push up only the topic branches you want to collaborate on.</p>
<p>If you have a branch named <code>serverfix</code> that you want to work on with others, you can push it up the same way you pushed your first branch. Run <code>git push &lt;remote&gt; &lt;branch&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin serverfix</span><br><span class="line">Counting objects: 24, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (15/15), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (24/24), 1.91 KiB | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 24 (delta 2), reused 0 (delta 0)</span><br><span class="line">To [https://github.com/schacon/simplegit](https://github.com/schacon/simplegit)</span><br><span class="line"> * [new branch]      serverfix -&gt; serverfix</span><br></pre></td></tr></table></figure>
<p>This is a bit of a shortcut. Git automatically expands the <code>serverfix</code> branchname out to <code>refs/heads/serverfix:refs/heads/serverfix</code>, which means, “Take my serverfix local branch and push it to update the remote’s serverfix branch.” We’ll go over the <code>refs/heads/</code> part in detail in 【Git Internals】, but you can generally leave it off. You can also do <code>git push origin serverfix:serverfix</code>, which does the same thing — it says, “Take my serverfix and make it the remote’s serverfix.” You can use this format to push a local branch into a remote branch that is named differently. If you didn’t want it to be called <code>serverfix</code> on the remote, you could instead run <code>git push origin serverfix:awesomebranch</code> to push your local <code>serverfix</code> branch to the <code>awesomebranch</code> branch on the remote project.</p>
<h2 id="Don’t-type-your-password-every-time"><a href="#Don’t-type-your-password-every-time" class="headerlink" title="Don’t type your password every time"></a>Don’t type your password every time</h2><p>If you’re using an HTTPS URL to push over, the Git server will ask you for your username and password for authentication. By default it will prompt you on the terminal for this information so the server can tell if you’re allowed to push.</p>
<p>If you don’t want to type it every single time you push, you can set up a “credential cache”. The simplest is just to keep it in memory for a few minutes, which you can easily set up by running <code>git config --global credential.helper cache</code>.</p>
<p>For more information on the various credential caching options available, see 【Credential Storage】.</p>
<p>The next time one of your collaborators fetches from the server, they will get a reference to where the server’s version of <code>serverfix</code> is under the remote branch <code>origin/serverfix</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">remote: Counting objects: 7, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3 (delta 0), reused 3 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/schacon/simplegit](https://github.com/schacon/simplegit)</span><br><span class="line"> * [new branch]      serverfix    -&gt; origin/serverfix</span><br></pre></td></tr></table></figure>
<p>It’s important to note that when you do a fetch that brings down new remote-tracking branches, you don’t automatically have local, editable copies of them. In other words, in this case, you don’t have a new <code>serverfix</code> branch — you only have an <code>origin/serverfix</code> pointer that you can’t modify.</p>
<p>To merge this work into your current working branch, you can run <code>git merge origin/serverfix</code>. If you want your own <code>serverfix</code> branch that you can work on, you can base it off your remote-tracking branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b serverfix origin/serverfix</span><br><span class="line">Branch serverfix <span class="built_in">set</span> up to track remote branch serverfix from origin.</span><br><span class="line">Switched to a new branch <span class="string">'serverfix'</span></span><br></pre></td></tr></table></figure>
<p>This gives you a local branch that you can work on that starts where <code>origin/serverfix</code> is.</p>
<h3 id="Tracking-Branches"><a href="#Tracking-Branches" class="headerlink" title="Tracking Branches"></a>Tracking Branches</h3><p>Checking out a local branch from a remote-tracking branch automatically creates what is called a “tracking branch” (and the branch it tracks is called an “upstream branch”). Tracking branches are local branches that have a direct relationship to a remote branch. If you’re on a tracking branch and type <code>git pull</code>, Git automatically knows which server to fetch from and which branch to merge in.</p>
<p>When you clone a repository, it generally automatically creates a <code>master</code> branch that tracks <code>origin/master</code>. However, you can set up other tracking branches if you wish — ones that track branches on other remotes, or don’t track the <code>master</code> branch. The simple case is the example you just saw, running <code>git checkout -b &lt;branch&gt; &lt;remote&gt;/&lt;branch&gt;</code>. This is a common enough operation that Git provides the <code>--track</code> shorthand:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --track origin/serverfix</span><br><span class="line">Branch serverfix <span class="built_in">set</span> up to track remote branch serverfix from origin.</span><br><span class="line">Switched to a new branch <span class="string">'serverfix'</span></span><br></pre></td></tr></table></figure>
<p>In fact, this is so common that there’s even a shortcut for that shortcut. If the branch name you’re trying to checkout (a) doesn’t exist and (b) exactly matches a name on only one remote, Git will create a tracking branch for you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout serverfix</span><br><span class="line">Branch serverfix <span class="built_in">set</span> up to track remote branch serverfix from origin.</span><br><span class="line">Switched to a new branch <span class="string">'serverfix'</span></span><br></pre></td></tr></table></figure>
<p>To set up a local branch with a different name than the remote branch, you can easily use the first version with a different local branch name:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b sf origin/serverfix</span><br><span class="line">Branch sf <span class="built_in">set</span> up to track remote branch serverfix from origin.</span><br><span class="line">Switched to a new branch <span class="string">'sf'</span></span><br></pre></td></tr></table></figure>
<p>Now, your local branch <code>sf</code> will automatically pull from <code>origin/serverfix</code>.</p>
<p>If you already have a local branch and want to set it to a remote branch you just pulled down, or want to change the upstream branch you’re tracking, you can use the <code>-u</code> or <code>--set-upstream-to</code> option to <code>git branch</code> to explicitly set it at any time.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -u origin/serverfix</span><br><span class="line">Branch serverfix <span class="built_in">set</span> up to track remote branch serverfix from origin.</span><br></pre></td></tr></table></figure>
<h2 id="Upstream-shorthand"><a href="#Upstream-shorthand" class="headerlink" title="Upstream shorthand"></a>Upstream shorthand</h2><p>When you have a tracking branch set up, you can reference its upstream branch with the <code>@{upstream}</code> or <code>@{u}</code> shorthand. So if you’re on the <code>master</code> branch and it’s tracking <code>origin/master</code>, you can say something like <code>git merge @{u}</code> instead of <code>git merge origin/master</code> if you wish.</p>
<p>If you want to see what tracking branches you have set up, you can use the <code>-vv</code> option to <code>git branch</code>. This will list out your local branches with more information including what each branch is tracking and if your local branch is ahead, behind or both.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -vv</span><br><span class="line">  iss53     7e424c3 [origin/iss53: ahead 2] forgot the brackets</span><br><span class="line">  master    1ae2a45 [origin/master] deploying index fix</span><br><span class="line">* serverfix f8674d9 [teamone/server-fix-good: ahead 3, behind 1] this should <span class="keyword">do</span> it</span><br><span class="line">  testing   5ea463a trying something new</span><br></pre></td></tr></table></figure>
<p>So here we can see that our <code>iss53</code> branch is tracking <code>origin/iss53</code> and is “ahead” by two, meaning that we have two commits locally that are not pushed to the server. We can also see that our <code>master</code> branch is tracking <code>origin/master</code> and is up to date. Next we can see that our <code>serverfix</code> branch is tracking the <code>server-fix-good</code> branch on our <code>teamone</code> server and is ahead by three and behind by one, meaning that there is one commit on the server we haven’t merged in yet and three commits locally that we haven’t pushed. Finally we can see that our <code>testing</code> branch is not tracking any remote branch.</p>
<p>It’s important to note that these numbers are only since the last time you fetched from each server. This command does not reach out to the servers, it’s telling you about what it has cached from these servers locally. If you want totally up to date ahead and behind numbers, you’ll need to fetch from all your remotes right before running this. You could do that like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch --all; git branch -vv</span><br></pre></td></tr></table></figure>
<h3 id="Pulling"><a href="#Pulling" class="headerlink" title="Pulling"></a>Pulling</h3><p>While the <code>git fetch</code> command will fetch down all the changes on the server that you don’t have yet, it will not modify your working directory at all. It will simply get the data for you and let you merge it yourself. However, there is a command called <code>git pull</code> which is essentially a <code>git fetch</code> immediately followed by a <code>git merge</code> in most cases. If you have a tracking branch set up as demonstrated in the last section, either by explicitly setting it or by having it created for you by the <code>clone</code> or <code>checkout</code> commands, <code>git pull</code> will look up what server and branch your current branch is tracking, fetch from that server and then try to merge in that remote branch.</p>
<p>Generally it’s better to simply use the <code>fetch</code> and <code>merge</code> commands explicitly as the magic of <code>git pull</code> can often be confusing.</p>
<h3 id="Deleting-Remote-Branches"><a href="#Deleting-Remote-Branches" class="headerlink" title="Deleting Remote Branches"></a>Deleting Remote Branches</h3><p>Suppose you’re done with a remote branch – say you and your collaborators are finished with a feature and have merged it into your remote’s <code>master</code> branch (or whatever branch your stable codeline is in). You can delete a remote branch using the <code>--delete</code> option to <code>git push</code>. If you want to delete your <code>serverfix</code> branch from the server, you run the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --delete serverfix</span><br><span class="line">To [https://github.com/schacon/simplegit](https://github.com/schacon/simplegit)</span><br><span class="line"> - [deleted]         serverfix</span><br></pre></td></tr></table></figure>
<p>Basically all this does is remove the pointer from the server. The Git server will generally keep the data there for a while until a garbage collection runs, so if it was accidentally deleted, it’s often easy to recover.</p>
<h2 id="Rebasing"><a href="#Rebasing" class="headerlink" title="Rebasing"></a>Rebasing</h2><p>In Git, there are two main ways to integrate changes from one branch into another: the <code>merge</code> and the <code>rebase</code>. In this section you’ll learn what rebasing is, how to do it, why it’s a pretty amazing tool, and in what cases you won’t want to use it.</p>
<h3 id="The-Basic-Rebase"><a href="#The-Basic-Rebase" class="headerlink" title="The Basic Rebase"></a>The Basic Rebase</h3><p>If you go back to an earlier example from 【Basic Merging】, you can see that you diverged your work and made commits on two different branches.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco3lk0mj20m80an749.jpg" alt="Simple divergent history.">  Figure 27. Simple divergent history  The easiest way to integrate the branches, as we’ve already covered, is the <code>merge</code> command. It performs a three-way merge between the two latest branch snapshots (<code>C3</code> and <code>C4</code>) and the most recent common ancestor of the two (<code>C2</code>), creating a new snapshot (and commit).</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco7nfaoj20m808g0so.jpg" alt="Merging to integrate diverged work history.">  Figure 28. Merging to integrate diverged work history  However, there is another way: you can take the patch of the change that was introduced in <code>C4</code> and reapply it on top of <code>C3</code>. In Git, this is called <em>rebasing</em>. With the <code>rebase</code> command, you can take all the changes that were committed on one branch and replay them on another one.</p>
<p>In this example, you’d run the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout experiment</span><br><span class="line">$ git rebase master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: added staged <span class="built_in">command</span></span><br></pre></td></tr></table></figure>
<p>It works by going to the common ancestor of the two branches (the one you’re on and the one you’re rebasing onto), getting the diff introduced by each commit of the branch you’re on, saving those diffs to temporary files, resetting the current branch to the same commit as the branch you are rebasing onto, and finally applying each change in turn.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco8qrkxj20m806fjrb.jpg" alt="Rebasing the change introduced in `C4` onto `C3`.">  Figure 29. Rebasing the change introduced in <code>C4</code> onto <code>C3</code>  At this point, you can go back to the <code>master</code> branch and do a fast-forward merge.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge experiment</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcog9sg1j20m806ea9y.jpg" alt="Fast-forwarding the master branch.">  Figure 30. Fast-forwarding the master branch  Now, the snapshot pointed to by <code>C4&#39;</code> is exactly the same as the one that was pointed to by <code>C5</code> in the merge example. There is no difference in the end product of the integration, but rebasing makes for a cleaner history. If you examine the log of a rebased branch, it looks like a linear history: it appears that all the work happened in series, even when it originally happened in parallel.</p>
<p>Often, you’ll do this to make sure your commits apply cleanly on a remote branch — perhaps in a project to which you’re trying to contribute but that you don’t maintain. In this case, you’d do your work in a branch and then rebase your work onto <code>origin/master</code> when you were ready to submit your patches to the main project. That way, the maintainer doesn’t have to do any integration work — just a fast-forward or a clean apply.</p>
<p>Note that the snapshot pointed to by the final commit you end up with, whether it’s the last of the rebased commits for a rebase or the final merge commit after a merge, is the same snapshot – it’s only the history that is different. Rebasing replays changes from one line of work onto another in the order they were introduced, whereas merging takes the endpoints and merges them together.</p>
<h3 id="More-Interesting-Rebases"><a href="#More-Interesting-Rebases" class="headerlink" title="More Interesting Rebases"></a>More Interesting Rebases</h3><p>You can also have your rebase replay on something other than the rebase target branch. Take a history like 【A history with a topic branch off another topic branch】, for example. You branched a topic branch (<code>server</code>) to add some server-side functionality to your project, and made a commit. Then, you branched off that to make the client-side changes (<code>client</code>) and committed a few times. Finally, you went back to your server branch and did a few more commits.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcok9m5ej20m80cygln.jpg" alt="A history with a topic branch off another topic branch.">  Figure 31. A history with a topic branch off another topic branch  Suppose you decide that you want to merge your client-side changes into your mainline for a release, but you want to hold off on the server-side changes until it’s tested further. You can take the changes on client that aren’t on server (<code>C8</code> and <code>C9</code>) and replay them on your <code>master</code> branch by using the <code>--onto</code> option of <code>git rebase</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase --onto master server client</span><br></pre></td></tr></table></figure>
<p>This basically says, “Take the <code>client</code> branch, figure out the patches since it diverged from the <code>server</code> branch, and replay these patches in the <code>client</code> branch as if it was based directly off the <code>master</code> branch instead.” It’s a bit complex, but the result is pretty cool.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcon5mkyj20m808vt8p.jpg" alt="Rebasing a topic branch off another topic branch.">  Figure 32. Rebasing a topic branch off another topic branch  Now you can fast-forward your <code>master</code> branch (see 【Fast-forwarding your master branch to include the client branch changes】):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge client</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmyb66wj20m80750so.jpg" alt="Fast-forwarding your master branch to include the client branch changes.">  Figure 33. Fast-forwarding your master branch to include the client branch changes  Let’s say you decide to pull in your server branch as well. You can rebase the server branch onto the <code>master</code> branch without having to check it out first by running <code>git rebase &lt;basebranch&gt; &lt;topicbranch&gt;</code> — which checks out the topic branch (in this case, <code>server</code>) for you and replays it onto the base branch (<code>master</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase master server</span><br></pre></td></tr></table></figure>
<p>This replays your <code>server</code> work on top of your <code>master</code> work, as shown in 【Rebasing your server branch on top of your master branch】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmi3uwoj20m803nq2u.jpg" alt="Rebasing your server branch on top of your master branch.">  Figure 34. Rebasing your server branch on top of your master branch  Then, you can fast-forward the base branch (<code>master</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge server</span><br></pre></td></tr></table></figure>
<p>You can remove the <code>client</code> and <code>server</code> branches because all the work is integrated and you don’t need them anymore, leaving your history for this entire process looking like 【Final commit history】:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d client</span><br><span class="line">$ git branch -d server</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjei8qgj20m802bmx0.jpg" alt="Final commit history.">  Figure 35. Final commit history</p>
<h3 id="The-Perils-of-Rebasing"><a href="#The-Perils-of-Rebasing" class="headerlink" title="The Perils of Rebasing"></a>The Perils of Rebasing</h3><p>Ahh, but the bliss of rebasing isn’t without its drawbacks, which can be summed up in a single line:</p>
<p><strong>Do not rebase commits that exist outside your repository.</strong></p>
<p>If you follow that guideline, you’ll be fine. If you don’t, people will hate you, and you’ll be scorned by friends and family.</p>
<p>When you rebase stuff, you’re abandoning existing commits and creating new ones that are similar but different. If you push commits somewhere and others pull them down and base work on them, and then you rewrite those commits with <code>git rebase</code> and push them up again, your collaborators will have to re-merge their work and things will get messy when you try to pull their work back into yours.</p>
<p>Let’s look at an example of how rebasing work that you’ve made public can cause problems. Suppose you clone from a central server and then do some work off that. Your commit history looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckuapv6j20m80d5q2z.jpg" alt="Clone a repository, and base some work on it.">  Figure 36. Clone a repository, and base some work on it  Now, someone else does more work that includes a merge, and pushes that work to the central server. You fetch it and merge the new remote branch into your work, making your history look something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchhir7ej20m80e3jrk.jpg" alt="Fetch more commits, and merge them into your work.">  Figure 37. Fetch more commits, and merge them into your work  Next, the person who pushed the merged work decides to go back and rebase their work instead; they do a <code>git push --force</code> to overwrite the history on the server. You then fetch from that server, bringing down the new commits.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchik508j20m80e3mxd.jpg" alt="Someone pushes rebased commits, abandoning commits you&#39;ve based your work on.">  Figure 38. Someone pushes rebased commits, abandoning commits you’ve based your work on  Now you’re both in a pickle. If you do a <code>git pull</code>, you’ll create a merge commit which includes both lines of history, and your repository will look like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchlnnayj20m80bpaa7.jpg" alt="You merge in the same work again into a new merge commit.">  Figure 39. You merge in the same work again into a new merge commit  If you run a <code>git log</code> when your history looks like this, you’ll see two commits that have the same author, date, and message, which will be confusing. Furthermore, if you push this history back up to the server, you’ll reintroduce all those rebased commits to the central server, which can further confuse people. It’s pretty safe to assume that the other developer doesn’t want <code>C4</code> and <code>C6</code> to be in the history; that’s why they rebased in the first place.</p>
<h3 id="Rebase-When-You-Rebase"><a href="#Rebase-When-You-Rebase" class="headerlink" title="Rebase When You Rebase"></a>Rebase When You Rebase</h3><p>If you <strong>do</strong> find yourself in a situation like this, Git has some further magic that might help you out. If someone on your team force pushes changes that overwrite work that you’ve based work on, your challenge is to figure out what is yours and what they’ve rewritten.</p>
<p>It turns out that in addition to the commit SHA-1 checksum, Git also calculates a checksum that is based just on the patch introduced with the commit. This is called a “patch-id”.</p>
<p>If you pull down work that was rewritten and rebase it on top of the new commits from your partner, Git can often successfully figure out what is uniquely yours and apply them back on top of the new branch.</p>
<p>For instance, in the previous scenario, if instead of doing a merge when we’re at 【Someone pushes rebased commits, abandoning commits you’ve based your work on】 we run <code>git rebase teamone/master</code>, Git will:</p>
<ul>
<li>Determine what work is unique to our branch (C2, C3, C4, C6, C7)</li>
<li>Determine which are not merge commits (C2, C3, C4)</li>
<li>Determine which have not been rewritten into the target branch (just C2 and C3, since C4 is the same patch as C4’)</li>
<li>Apply those commits to the top of <code>teamone/master</code><br>So instead of the result we see in 【You merge in the same work again into a new merge commit】, we would end up with something more like 【Rebase on top of force-pushed rebase work.】.</li>
</ul>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchkm70hj20m80bpwej.jpg" alt="Rebase on top of force-pushed rebase work.">  Figure 40. Rebase on top of force-pushed rebase work.  This only works if C4 and C4’ that your partner made are almost exactly the same patch. Otherwise the rebase won’t be able to tell that it’s a duplicate and will add another C4-like patch (which will probably fail to apply cleanly, since the changes would already be at least somewhat there).</p>
<p>You can also simplify this by running a <code>git pull --rebase</code> instead of a normal <code>git pull</code>. Or you could do it manually with a <code>git fetch</code> followed by a <code>git rebase teamone/master</code> in this case.</p>
<p>If you are using <code>git pull</code> and want to make <code>--rebase</code> the default, you can set the <code>pull.rebase</code> config value with something like <code>git config --global pull.rebase true</code>.</p>
<p>If you treat rebasing as a way to clean up and work with commits before you push them, and if you only rebase commits that have never been available publicly, then you’ll be fine. If you rebase commits that have already been pushed publicly, and people may have based work on those commits, then you may be in for some frustrating trouble, and the scorn of your teammates.</p>
<p>If you or a partner does find it necessary at some point, make sure everyone knows to run <code>git pull --rebase</code> to try to make the pain after it happens a little bit simpler.</p>
<h3 id="Rebase-vs-Merge"><a href="#Rebase-vs-Merge" class="headerlink" title="Rebase vs. Merge"></a>Rebase vs. Merge</h3><p>Now that you’ve seen rebasing and merging in action, you may be wondering which one is better. Before we can answer this, let’s step back a bit and talk about what history means.</p>
<p>One point of view on this is that your repository’s commit history is a <strong>record of what actually happened.</strong> It’s a historical document, valuable in its own right, and shouldn’t be tampered with. From this angle, changing the commit history is almost blasphemous; you’re <em>lying</em> about what actually transpired. So what if there was a messy series of merge commits? That’s how it happened, and the repository should preserve that for posterity.</p>
<p>The opposing point of view is that the commit history is the <strong>story of how your project was made.</strong> You wouldn’t publish the first draft of a book, and the manual for how to maintain your software deserves careful editing. This is the camp that uses tools like rebase and filter-branch to tell the story in the way that’s best for future readers.</p>
<p>Now, to the question of whether merging or rebasing is better: hopefully you’ll see that it’s not that simple. Git is a powerful tool, and allows you to do many things to and with your history, but every team and every project is different. Now that you know how both of these things work, it’s up to you to decide which one is best for your particular situation.</p>
<p>In general the way to get the best of both worlds is to rebase local changes you’ve made but haven’t shared yet before you push them in order to clean up your story, but never rebase anything you’ve pushed somewhere.</p>
<h2 id="Summary-2"><a href="#Summary-2" class="headerlink" title="Summary"></a>Summary</h2><p>We’ve covered basic branching and merging in Git. You should feel comfortable creating and switching to new branches, switching between branches and merging local branches together. You should also be able to share your branches by pushing them to a shared server, working with others on shared branches and rebasing your branches before they are shared. Next, we’ll cover what you’ll need to run your own Git repository-hosting server.</p>
<h1 id="Git-on-the-Server"><a href="#Git-on-the-Server" class="headerlink" title="Git on the Server"></a><strong>Git</strong> <strong>on</strong> <strong>the</strong> <strong>Server</strong></h1><p>At this point, you should be able to do most of the day-to-day tasks for which you’ll be using Git. However, in order to do any collaboration in Git, you’ll need to have a remote Git repository. Although you can technically push changes to and pull changes from individuals’ repositories, doing so is discouraged because you can fairly easily confuse what they’re working on if you’re not careful. Furthermore, you want your collaborators to be able to access the repository even if your computer is offline — having a more reliable common repository is often useful. Therefore, the preferred method for collaborating with someone is to set up an intermediate repository that you both have access to, and push to and pull from that.</p>
<p>Running a Git server is fairly straightforward. First, you choose which protocols you want your server to communicate with. The first section of this chapter will cover the available protocols and the pros and cons of each. The next sections will explain some typical setups using those protocols and how to get your server running with them. Last, we’ll go over a few hosted options, if you don’t mind hosting your code on someone else’s server and don’t want to go through the hassle of setting up and maintaining your own server.</p>
<p>If you have no interest in running your own server, you can skip to the last section of the chapter to see some options for setting up a hosted account and then move on to the next chapter, where we discuss the various ins and outs of working in a distributed source control environment.</p>
<p>A remote repository is generally a <em>bare repository</em> — a Git repository that has no working directory. Because the repository is only used as a collaboration point, there is no reason to have a snapshot checked out on disk; it’s just the Git data. In the simplest terms, a bare repository is the contents of your project’s <code>.git</code> directory and nothing else.</p>
<h2 id="The-Protocols"><a href="#The-Protocols" class="headerlink" title="The Protocols"></a>The Protocols</h2><p>Git can use four distinct protocols to transfer data: Local, HTTP, Secure Shell (SSH) and Git. Here we’ll discuss what they are and in what basic circumstances you would want (or not want) to use them.</p>
<h3 id="Local-Protocol"><a href="#Local-Protocol" class="headerlink" title="Local Protocol"></a>Local Protocol</h3><p>The most basic is the <em>Local protocol</em>, in which the remote repository is in another directory on the same host. This is often used if everyone on your team has access to a shared filesystem such as an NFS mount, or in the less likely case that everyone logs in to the same computer. The latter wouldn’t be ideal, because all your code repository instances would reside on the same computer, making a catastrophic loss much more likely.</p>
<p>If you have a shared mounted filesystem, then you can clone, push to, and pull from a local file-based repository. To clone a repository like this, or to add one as a remote to an existing project, use the path to the repository as the URL. For example, to clone a local repository, you can run something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> /srv/git/project.git</span><br></pre></td></tr></table></figure>
<p>Or you can do this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [file:///srv/git/project.git](file:///srv/git/project.git)</span><br></pre></td></tr></table></figure>
<p>Git operates slightly differently if you explicitly specify <code>file://</code> at the beginning of the URL. If you just specify the path, Git tries to use hardlinks or directly copy the files it needs. If you specify <code>file://</code>, Git fires up the processes that it normally uses to transfer data over a network, which is generally much less efficient. The main reason to specify the <code>file://</code> prefix is if you want a clean copy of the repository with extraneous references or objects left out — generally after an import from another VCS or something similar (see 【Git Internals】 for maintenance tasks). We’ll use the normal path here because doing so is almost always faster.</p>
<p>To add a local repository to an existing Git project, you can run something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add local_proj /srv/git/project.git</span><br></pre></td></tr></table></figure>
<p>Then, you can push to and pull from that remote via your new remote name <code>local_proj</code> as though you were doing so over a network.</p>
<h4 id="The-Pros"><a href="#The-Pros" class="headerlink" title="The Pros"></a>The Pros</h4><p>The pros of file-based repositories are that they’re simple and they use existing file permissions and network access. If you already have a shared filesystem to which your whole team has access, setting up a repository is very easy. You stick the bare repository copy somewhere everyone has shared access to and set the read/write permissions as you would for any other shared directory. We’ll discuss how to export a bare repository copy for this purpose in 【Getting Git on a Server】.</p>
<p>This is also a nice option for quickly grabbing work from someone else’s working repository. If you and a co-worker are working on the same project and they want you to check something out, running a command like <code>git pull /home/john/project</code> is often easier than them pushing to a remote server and you subsequently fetching from it.</p>
<h4 id="The-Cons"><a href="#The-Cons" class="headerlink" title="The Cons"></a>The Cons</h4><p>The cons of this method are that shared access is generally more difficult to set up and reach from multiple locations than basic network access. If you want to push from your laptop when you’re at home, you have to mount the remote disk, which can be difficult and slow compared to network-based access.</p>
<p>It’s important to mention that this isn’t necessarily the fastest option if you’re using a shared mount of some kind. A local repository is fast only if you have fast access to the data. A repository on NFS is often slower than the repository over SSH on the same server, allowing Git to run off local disks on each system.</p>
<p>Finally, this protocol does not protect the repository against accidental damage. Every user has full shell access to the “remote” directory, and there is nothing preventing them from changing or removing internal Git files and corrupting the repository.</p>
<h3 id="The-HTTP-Protocols"><a href="#The-HTTP-Protocols" class="headerlink" title="The HTTP Protocols"></a>The HTTP Protocols</h3><p>Git can communicate over HTTP using two different modes. Prior to Git 1.6.6, there was only one way it could do this which was very simple and generally read-only. In version 1.6.6, a new, smarter protocol was introduced that involved Git being able to intelligently negotiate data transfer in a manner similar to how it does over SSH. In the last few years, this new HTTP protocol has become very popular since it’s simpler for the user and smarter about how it communicates. The newer version is often referred to as the <em>Smart</em> HTTP protocol and the older way as <em>Dumb</em> HTTP. We’ll cover the newer Smart HTTP protocol first.</p>
<h4 id="Smart-HTTP"><a href="#Smart-HTTP" class="headerlink" title="Smart HTTP"></a>Smart HTTP</h4><p>Smart HTTP operates very similarly to the SSH or Git protocols but runs over standard HTTPS ports and can use various HTTP authentication mechanisms, meaning it’s often easier on the user than something like SSH, since you can use things like username/password authentication rather than having to set up SSH keys.</p>
<p>It has probably become the most popular way to use Git now, since it can be set up to both serve anonymously like the <code>git://</code> protocol, and can also be pushed over with authentication and encryption like the SSH protocol. Instead of having to set up different URLs for these things, you can now use a single URL for both. If you try to push and the repository requires authentication (which it normally should), the server can prompt for a username and password. The same goes for read access.</p>
<p>In fact, for services like GitHub, the URL you use to view the repository online (for example, &lt;<a href="https://github.com/schacon/simplegit" target="_blank" rel="noopener">https://github.com/schacon/simplegit</a>&gt;) is the same URL you can use to clone and, if you have access, push over.</p>
<h4 id="Dumb-HTTP"><a href="#Dumb-HTTP" class="headerlink" title="Dumb HTTP"></a>Dumb HTTP</h4><p>If the server does not respond with a Git HTTP smart service, the Git client will try to fall back to the simpler <em>Dumb</em> HTTP protocol. The Dumb protocol expects the bare Git repository to be served like normal files from the web server. The beauty of Dumb HTTP is the simplicity of setting it up. Basically, all you have to do is put a bare Git repository under your HTTP document root and set up a specific <code>post-update</code> hook, and you’re done (See 【Git Hooks】). At that point, anyone who can access the web server under which you put the repository can also clone your repository. To allow read access to your repository over HTTP, do something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /var/www/htdocs/</span><br><span class="line">$ git <span class="built_in">clone</span> --bare /path/to/git_project gitproject.git</span><br><span class="line">$ <span class="built_in">cd</span> gitproject.git</span><br><span class="line">$ mv hooks/post-update.sample hooks/post-update</span><br><span class="line">$ chmod a+x hooks/post-update</span><br></pre></td></tr></table></figure>
<p>That’s all. The <code>post-update</code> hook that comes with Git by default runs the appropriate command (<code>git update-server-info</code>) to make HTTP fetching and cloning work properly. This command is run when you push to this repository (over SSH perhaps); then, other people can clone via something like</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://example.com/gitproject.git](https://example.com/gitproject.git)</span><br></pre></td></tr></table></figure>
<p>In this particular case, we’re using the <code>/var/www/htdocs</code> path that is common for Apache setups, but you can use any static web server — just put the bare repository in its path. The Git data is served as basic static files (see the 【Git Internals】 chapter for details about exactly how it’s served).</p>
<p>Generally you would either choose to run a read/write Smart HTTP server or simply have the files accessible as read-only in the Dumb manner. It’s rare to run a mix of the two services.</p>
<h4 id="The-Pros-1"><a href="#The-Pros-1" class="headerlink" title="The Pros"></a>The Pros</h4><p>We’ll concentrate on the pros of the Smart version of the HTTP protocol.</p>
<p>The simplicity of having a single URL for all types of access and having the server prompt only when authentication is needed makes things very easy for the end user. Being able to authenticate with a username and password is also a big advantage over SSH, since users don’t have to generate SSH keys locally and upload their public key to the server before being able to interact with it. For less sophisticated users, or users on systems where SSH is less common, this is a major advantage in usability. It is also a very fast and efficient protocol, similar to the SSH one.</p>
<p>You can also serve your repositories read-only over HTTPS, which means you can encrypt the content transfer; or you can go so far as to make the clients use specific signed SSL certificates.</p>
<p>Another nice thing is that HTTPS are such commonly used protocols that corporate firewalls are often set up to allow traffic through these ports.</p>
<h4 id="The-Cons-1"><a href="#The-Cons-1" class="headerlink" title="The Cons"></a>The Cons</h4><p>Git over HTTPS can be a little more tricky to set up compared to SSH on some servers. Other than that, there is very little advantage that other protocols have over Smart HTTP for serving Git content.</p>
<p>If you’re using HTTP for authenticated pushing, providing your credentials is sometimes more complicated than using keys over SSH. There are, however, several credential caching tools you can use, including Keychain access on macOS and Credential Manager on Windows, to make this pretty painless. Read 【Credential Storage】 to see how to set up secure HTTP password caching on your system.</p>
<h3 id="The-SSH-Protocol"><a href="#The-SSH-Protocol" class="headerlink" title="The SSH Protocol"></a>The SSH Protocol</h3><p>A common transport protocol for Git when self-hosting is over SSH. This is because SSH access to servers is already set up in most places — and if it isn’t, it’s easy to do. SSH is also an authenticated network protocol and, because it’s ubiquitous, it’s generally easy to set up and use.</p>
<p>To clone a Git repository over SSH, you can specify an <code>ssh://</code> URL like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> ssh://[user@]server/project.git</span><br></pre></td></tr></table></figure>
<p>Or you can use the shorter scp-like syntax for the SSH protocol:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [user@]server:project.git</span><br></pre></td></tr></table></figure>
<p>In both cases above, if you don’t specify the optional username, Git assumes the user you’re currently logged in as.</p>
<h4 id="The-Pros-2"><a href="#The-Pros-2" class="headerlink" title="The Pros"></a>The Pros</h4><p>The pros of using SSH are many. First, SSH is relatively easy to set up — SSH daemons are commonplace, many network admins have experience with them, and many OS distributions are set up with them or have tools to manage them. Next, access over SSH is secure — all data transfer is encrypted and authenticated. Last, like the HTTPS, Git and Local protocols, SSH is efficient, making the data as compact as possible before transferring it.</p>
<h4 id="The-Cons-2"><a href="#The-Cons-2" class="headerlink" title="The Cons"></a>The Cons</h4><p>The negative aspect of SSH is that it doesn’t support anonymous access to your Git repository. If you’re using SSH, people <em>must</em> have SSH access to your machine, even in a read-only capacity, which doesn’t make SSH conducive to open source projects for which people might simply want to clone your repository to examine it. If you’re using it only within your corporate network, SSH may be the only protocol you need to deal with. If you want to allow anonymous read-only access to your projects and also want to use SSH, you’ll have to set up SSH for you to push over but something else for others to fetch from.</p>
<h3 id="The-Git-Protocol"><a href="#The-Git-Protocol" class="headerlink" title="The Git Protocol"></a>The Git Protocol</h3><p>Next is the Git protocol. This is a special daemon that comes packaged with Git; it listens on a dedicated port (9418) that provides a service similar to the SSH protocol, but with absolutely no authentication. In order for a repository to be served over the Git protocol, you must create a <code>git-daemon-export-ok</code> file — the daemon won’t serve a repository without that file in it — but other than that there is no security. Either the Git repository is available for everyone to clone, or it isn’t. This means that there is generally no pushing over this protocol. You can enable push access but, given the lack of authentication, anyone on the internet who finds your project’s URL could push to that project. Suffice it to say that this is rare.</p>
<h4 id="The-Pros-3"><a href="#The-Pros-3" class="headerlink" title="The Pros"></a>The Pros</h4><p>The Git protocol is often the fastest network transfer protocol available. If you’re serving a lot of traffic for a public project or serving a very large project that doesn’t require user authentication for read access, it’s likely that you’ll want to set up a Git daemon to serve your project. It uses the same data-transfer mechanism as the SSH protocol but without the encryption and authentication overhead.</p>
<h4 id="The-Cons-3"><a href="#The-Cons-3" class="headerlink" title="The Cons"></a>The Cons</h4><p>The downside of the Git protocol is the lack of authentication. It’s generally undesirable for the Git protocol to be the only access to your project. Generally, you’ll pair it with SSH or HTTPS access for the few developers who have push (write) access and have everyone else use <code>git://</code> for read-only access. It’s also probably the most difficult protocol to set up. It must run its own daemon, which requires <code>xinetd</code> configuration or the like, which isn’t always a walk in the park. It also requires firewall access to port 9418, which isn’t a standard port that corporate firewalls always allow. Behind big corporate firewalls, this obscure port is commonly blocked.</p>
<h2 id="Getting-Git-on-a-Server"><a href="#Getting-Git-on-a-Server" class="headerlink" title="Getting Git on a Server"></a>Getting Git on a Server</h2><p>Now we’ll cover setting up a Git service running these protocols on your own server.</p>
<p>Here we’ll be demonstrating the commands and steps needed to do basic, simplified installations on a Linux-based server, though it’s also possible to run these services on Mac or Windows servers. Actually setting up a production server within your infrastructure will certainly entail differences in security measures or operating system tools, but hopefully this will give you the general idea of what’s involved.</p>
<p>In order to initially set up any Git server, you have to export an existing repository into a new bare repository — a repository that doesn’t contain a working directory. This is generally straightforward to do. In order to clone your repository to create a new bare repository, you run the clone command with the <code>--bare</code> option. By convention, bare repository directory names end with the suffix <code>.git</code>, like so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> --bare my_project my_project.git</span><br><span class="line">Cloning into bare repository <span class="string">'my_project.git'</span>...</span><br><span class="line"><span class="keyword">done</span>.</span><br></pre></td></tr></table></figure>
<p>You should now have a copy of the Git directory data in your <code>my_project.git</code> directory.</p>
<p>This is roughly equivalent to something like</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp -Rf my_project/.git my_project.git</span><br></pre></td></tr></table></figure>
<p>There are a couple of minor differences in the configuration file but, for your purpose, this is close to the same thing. It takes the Git repository by itself, without a working directory, and creates a directory specifically for it alone.</p>
<h3 id="Putting-the-Bare-Repository-on-a-Server"><a href="#Putting-the-Bare-Repository-on-a-Server" class="headerlink" title="Putting the Bare Repository on a Server"></a>Putting the Bare Repository on a Server</h3><p>Now that you have a bare copy of your repository, all you need to do is put it on a server and set up your protocols. Let’s say you’ve set up a server called <code>git.example.com</code> to which you have SSH access, and you want to store all your Git repositories under the <code>/srv/git</code> directory. Assuming that <code>/srv/git</code> exists on that server, you can set up your new repository by copying your bare repository over:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp -r my_project.git user@git.example.com:/srv/git</span><br></pre></td></tr></table></figure>
<p>At this point, other users who have SSH-based read access to the <code>/srv/git</code> directory on that server can clone your repository by running</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> user@git.example.com:/srv/git/my_project.git</span><br></pre></td></tr></table></figure>
<p>If a user SSHs into a server and has write access to the <code>/srv/git/my_project.git</code> directory, they will also automatically have push access.</p>
<p>Git will automatically add group write permissions to a repository properly if you run the <code>git init</code> command with the <code>--shared</code> option.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh user@git.example.com</span><br><span class="line">$ <span class="built_in">cd</span> /srv/git/my_project.git</span><br><span class="line">$ git init --bare --shared</span><br></pre></td></tr></table></figure>
<p>You see how easy it is to take a Git repository, create a bare version, and place it on a server to which you and your collaborators have SSH access. Now you’re ready to collaborate on the same project.</p>
<p>It’s important to note that this is literally all you need to do to run a useful Git server to which several people have access — just add SSH-able accounts on a server, and stick a bare repository somewhere that all those users have read and write access to. You’re ready to go — nothing else needed.</p>
<p>In the next few sections, you’ll see how to expand to more sophisticated setups. This discussion will include not having to create user accounts for each user, adding public read access to repositories, setting up web UIs and more. However, keep in mind that to collaborate with a couple of people on a private project, all you <em>need</em> is an SSH server and a bare repository.</p>
<h3 id="Small-Setups"><a href="#Small-Setups" class="headerlink" title="Small Setups"></a>Small Setups</h3><p>If you’re a small outfit or are just trying out Git in your organization and have only a few developers, things can be simple for you. One of the most complicated aspects of setting up a Git server is user management. If you want some repositories to be read-only for certain users and read/write for others, access and permissions can be a bit more difficult to arrange.</p>
<h4 id="SSH-Access"><a href="#SSH-Access" class="headerlink" title="SSH Access"></a>SSH Access</h4><p>If you have a server to which all your developers already have SSH access, it’s generally easiest to set up your first repository there, because you have to do almost no work (as we covered in the last section). If you want more complex access control type permissions on your repositories, you can handle them with the normal filesystem permissions of your server’s operating system.</p>
<p>If you want to place your repositories on a server that doesn’t have accounts for everyone on your team for whom you want to grant write access, then you must set up SSH access for them. We assume that if you have a server with which to do this, you already have an SSH server installed, and that’s how you’re accessing the server.</p>
<p>There are a few ways you can give access to everyone on your team. The first is to set up accounts for everybody, which is straightforward but can be cumbersome. You may not want to run <code>adduser</code> and set temporary passwords for every user.</p>
<p>A second method is to create a single <em>git</em> user account on the machine, ask every user who is to have write access to send you an SSH public key, and add that key to the <code>~/.ssh/authorized_keys</code> file of that new account. At that point, everyone will be able to access that machine via the <em>git</em> account. This doesn’t affect the commit data in any way — the SSH user you connect as doesn’t affect the commits you’ve recorded.</p>
<p>Another way to do it is to have your SSH server authenticate from an LDAP server or some other centralized authentication source that you may already have set up. As long as each user can get shell access on the machine, any SSH authentication mechanism you can think of should work.</p>
<h2 id="Generating-Your-SSH-Public-Key"><a href="#Generating-Your-SSH-Public-Key" class="headerlink" title="Generating Your SSH Public Key"></a>Generating Your SSH Public Key</h2><p>Many Git servers authenticate using SSH public keys. In order to provide a public key, each user in your system must generate one if they don’t already have one. This process is similar across all operating systems. First, you should check to make sure you don’t already have a key. By default, a user’s SSH keys are stored in that user’s <code>~/.ssh</code> directory. You can easily check to see if you have a key already by going to that directory and listing the contents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/.ssh</span><br><span class="line">$ ls</span><br><span class="line">authorized_keys2  id_dsa       known_hosts</span><br><span class="line">config            id_dsa.pub</span><br></pre></td></tr></table></figure>
<p>You’re looking for a pair of files named something like <code>id_dsa</code> or <code>id_rsa</code> and a matching file with a <code>.pub</code> extension. The <code>.pub</code> file is your public key, and the other file is your private key. If you don’t have these files (or you don’t even have a <code>.ssh</code> directory), you can create them by running a program called <code>ssh-keygen</code>, which is provided with the SSH package on Linux/Mac systems and comes with Git for Windows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/home/schacon/.ssh/id_rsa):</span><br><span class="line">Created directory <span class="string">'/home/schacon/.ssh'</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /home/schacon/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /home/schacon/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">d0:82:24:8e:d7:f1:bb:9b:33:53:96:93:49:da:9b:e3 schacon@mylaptop.local</span><br></pre></td></tr></table></figure>
<p>First it confirms where you want to save the key (<code>.ssh/id_rsa</code>), and then it asks twice for a passphrase, which you can leave empty if you don’t want to type a password when you use the key.</p>
<p>Now, each user that does this has to send their public key to you or whoever is administrating the Git server (assuming you’re using an SSH server setup that requires public keys). All they have to do is copy the contents of the <code>.pub</code> file and email it. The public keys look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.ssh/id_rsa.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSU</span><br><span class="line">GPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3</span><br><span class="line">Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XA</span><br><span class="line">t3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/En</span><br><span class="line">mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbx</span><br><span class="line">NrRFi9wrf+M7Q== schacon@mylaptop.local</span><br></pre></td></tr></table></figure>
<p>For a more in-depth tutorial on creating an SSH key on multiple operating systems, see the GitHub guide on SSH keys at &lt;<a href="https://help.github.com/articles/generating-ssh-keys" target="_blank" rel="noopener">https://help.github.com/articles/generating-ssh-keys</a>&gt;.</p>
<h2 id="Setting-Up-the-Server"><a href="#Setting-Up-the-Server" class="headerlink" title="Setting Up the Server"></a>Setting Up the Server</h2><p>Let’s walk through setting up SSH access on the server side. In this example, you’ll use the <code>authorized_keys</code> method for authenticating your users. We also assume you’re running a standard Linux distribution like Ubuntu.</p>
<p>A good deal of what is described here can be automated by using the <code>ssh-copy-id</code> command, rather than manually copying and installing public keys.</p>
<p>First, you create a <code>git</code> user and a <code>.ssh</code> directory for that user.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser git</span><br><span class="line">$ su git</span><br><span class="line">$ <span class="built_in">cd</span></span><br><span class="line">$ mkdir .ssh &amp;&amp; chmod 700 .ssh</span><br><span class="line">$ touch .ssh/authorized_keys &amp;&amp; chmod 600 .ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>Next, you need to add some developer SSH public keys to the <code>authorized_keys</code> file for the <code>git</code> user. Let’s assume you have some trusted public keys and have saved them to temporary files. Again, the public keys look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/id_rsa.john.pub</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCB007n/ww+ouN4gSLKssMxXnBOvf9LGt4L</span><br><span class="line">ojG6rs6hPB09j9R/T17/x4lhJA0F3FR1rP6kYBRsWj2aThGw6HXLm9/5zytK6Ztg3RPKK+4k</span><br><span class="line">Yjh6541NYsnEAZuXz0jTTyAUfrtU3Z5E003C4oxOj6H0rfIF1kKI9MAQLMdpGW1GYEIgS9Ez</span><br><span class="line">Sdfd8AcCIicTDWbqLAcU4UpkaX8KyGlLwsNuuGztobF8m72ALC/nLF6JLtPofwFBlgc+myiv</span><br><span class="line">O7TCUSBdLQlgMVOFq1I2uPWQOkOWQAHukEOmfjy2jctxSDBQ220ymjaNsHT4kgtZg2AYYgPq</span><br><span class="line">dAv8JggJICUvax2T9va5 gsg-keypair</span><br></pre></td></tr></table></figure>
<p>You just append them to the <code>git</code> user’s <code>authorized_keys</code> file in its <code>.ssh</code> directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/id_rsa.john.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">$ cat /tmp/id_rsa.josie.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">$ cat /tmp/id_rsa.jessica.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>Now, you can set up an empty repository for them by running <code>git init</code> with the <code>--bare</code> option, which initializes the repository without a working directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /srv/git</span><br><span class="line">$ mkdir project.git</span><br><span class="line">$ <span class="built_in">cd</span> project.git</span><br><span class="line">$ git init --bare</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /srv/git/project.git/</span><br></pre></td></tr></table></figure>
<p>Then, John, Josie, or Jessica can push the first version of their project into that repository by adding it as a remote and pushing up a branch. Note that someone must shell onto the machine and create a bare repository every time you want to add a project. Let’s use <code>gitserver</code> as the hostname of the server on which you’ve set up your <code>git</code> user and repository. If you’re running it internally, and you set up DNS for <code>gitserver</code> to point to that server, then you can use the commands pretty much as is (assuming that <code>myproject</code> is an existing project with files in it):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on John's computer</span></span><br><span class="line">$ <span class="built_in">cd</span> myproject</span><br><span class="line">$ git init</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">'initial commit'</span></span><br><span class="line">$ git remote add origin git@gitserver:/srv/git/project.git</span><br><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>At this point, the others can clone it down and push changes back up just as easily:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@gitserver:/srv/git/project.git</span><br><span class="line">$ <span class="built_in">cd</span> project</span><br><span class="line">$ vim README</span><br><span class="line">$ git commit -am <span class="string">'fix for the README file'</span></span><br><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>With this method, you can quickly get a read/write Git server up and running for a handful of developers.</p>
<p>You should note that currently all these users can also log into the server and get a shell as the <code>git</code> user. If you want to restrict that, you will have to change the shell to something else in the <code>passwd</code> file.</p>
<p>You can easily restrict the <code>git</code> user to only doing Git activities with a limited shell tool called <code>git-shell</code> that comes with Git. If you set this as your <code>git</code> user’s login shell, then the <code>git</code> user can’t have normal shell access to your server. To use this, specify <code>git-shell</code> instead of bash or csh for your user’s login shell. To do so, you must first add <code>git-shell</code> to <code>/etc/shells</code> if it’s not already there:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/shells   <span class="comment"># see if `git-shell` is already in there.  If not...</span></span><br><span class="line">$ <span class="built_in">which</span> git-shell   <span class="comment"># make sure git-shell is installed on your system.</span></span><br><span class="line">$ sudo vim /etc/shells  <span class="comment"># and add the path to git-shell from last command</span></span><br></pre></td></tr></table></figure>
<p>Now you can edit the shell for a user using <code>chsh &lt;username&gt; -s &lt;shell&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chsh git -s $(<span class="built_in">which</span> git-shell)</span><br></pre></td></tr></table></figure>
<p>Now, the <code>git</code> user can only use the SSH connection to push and pull Git repositories and can’t shell onto the machine. If you try, you’ll see a login rejection like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh git@gitserver</span><br><span class="line">fatal: Interactive git shell is not enabled.</span><br><span class="line">hint: ~/git-shell-commands should exist and have <span class="built_in">read</span> and execute access.</span><br><span class="line">Connection to gitserver closed.</span><br></pre></td></tr></table></figure>
<p>Now Git network commands will still work just fine but the users won’t be able to get a shell. As the output states, you can also set up a directory in the <code>git</code> user’s home directory that customizes the <code>git-shell</code> command a bit. For instance, you can restrict the Git commands that the server will accept or you can customize the message that users see if they try to SSH in like that. Run <code>git help shell</code> for more information on customizing the shell.</p>
<h2 id="Git-Daemon"><a href="#Git-Daemon" class="headerlink" title="Git Daemon"></a>Git Daemon</h2><p>Next we’ll set up a daemon serving repositories using the “Git” protocol. This is a common choice for fast, unauthenticated access to your Git data. Remember that since this is not an authenticated service, anything you serve over this protocol is public within its network.</p>
<p>If you’re running this on a server outside your firewall, it should be used only for projects that are publicly visible to the world. If the server you’re running it on is inside your firewall, you might use it for projects that a large number of people or computers (continuous integration or build servers) have read-only access to, when you don’t want to have to add an SSH key for each.</p>
<p>In any case, the Git protocol is relatively easy to set up. Basically, you need to run this command in a daemonized manner:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git daemon --reuseaddr --base-path=/srv/git/ /srv/git/</span><br></pre></td></tr></table></figure>
<p>The <code>--reuseaddr</code> option allows the server to restart without waiting for old connections to time out, while the <code>--base-path</code> option allows people to clone projects without specifying the entire path, and the path at the end tells the Git daemon where to look for repositories to export. If you’re running a firewall, you’ll also need to punch a hole in it at port 9418 on the box you’re setting this up on.</p>
<p>You can daemonize this process a number of ways, depending on the operating system you’re running.</p>
<p>Since <code>systemd</code> is the most common init system among modern Linux distributions, you can use it for that purpose. Simply place a file in <code>/etc/systemd/system/git-daemon.service</code> with these contents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Start Git Daemon</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/git daemon --reuseaddr --base-path=/srv/git/ /srv/git/</span><br><span class="line"></span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=500ms</span><br><span class="line"></span><br><span class="line">StandardOutput=syslog</span><br><span class="line">StandardError=syslog</span><br><span class="line">SyslogIdentifier=git-daemon</span><br><span class="line"></span><br><span class="line">User=git</span><br><span class="line">Group=git</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>You might have noticed that Git daemon is started here with <code>git</code> as both group and user. Modify it to fit your needs and make sure the provided user exists on the system. Also, check that the Git binary is indeed located at <code>/usr/bin/git</code> and change the path if necessary.</p>
<p>Finally, you’ll run <code>systemctl enable git-daemon</code> to automatically start the service on boot, and can start and stop the service with, respectively, <code>systemctl start git-daemon</code> and <code>systemctl stop git-daemon</code>.</p>
<p>Until LTS 14.04, Ubuntu used upstart service unit configuration. Therefore, on Ubuntu ⇐ 14.04 you can use an Upstart script. So, in the following file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init/<span class="built_in">local</span>-git-daemon.conf</span><br></pre></td></tr></table></figure>
<p>you put this script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">start on startup</span><br><span class="line">stop on shutdown</span><br><span class="line"><span class="built_in">exec</span> /usr/bin/git daemon \</span><br><span class="line">    --user=git --group=git \</span><br><span class="line">    --reuseaddr \</span><br><span class="line">    --base-path=/srv/git/ \</span><br><span class="line">    /srv/git/</span><br><span class="line">respawn</span><br></pre></td></tr></table></figure>
<p>For security reasons, it is strongly encouraged to have this daemon run as a user with read-only permissions to the repositories — you can easily do this by creating a new user <em>git-ro</em> and running the daemon as them. For the sake of simplicity we’ll simply run it as the same <em>git</em> user that <code>git-shell</code> is running as.</p>
<p>When you restart your machine, your Git daemon will start automatically and respawn if it goes down. To get it running without having to reboot, you can run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ initctl start <span class="built_in">local</span>-git-daemon</span><br></pre></td></tr></table></figure>
<p>On other systems, you may want to use <code>xinetd</code>, a script in your <code>sysvinit</code> system, or something else — as long as you get that command daemonized and watched somehow.</p>
<p>Next, you have to tell Git which repositories to allow unauthenticated Git server-based access to. You can do this in each repository by creating a file named <code>git-daemon-export-ok</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /path/to/project.git</span><br><span class="line">$ touch git-daemon-export-ok</span><br></pre></td></tr></table></figure>
<p>The presence of that file tells Git that it’s OK to serve this project without authentication.</p>
<h2 id="Smart-HTTP-1"><a href="#Smart-HTTP-1" class="headerlink" title="Smart HTTP"></a>Smart HTTP</h2><p>We now have authenticated access through SSH and unauthenticated access through <code>git://</code>, but there is also a protocol that can do both at the same time. Setting up Smart HTTP is basically just enabling a CGI script that is provided with Git called <code>git-http-backend</code> on the server. This CGI will read the path and headers sent by a <code>git fetch</code> or <code>git push</code> to an HTTP URL and determine if the client can communicate over HTTP (which is true for any client since version 1.6.6). If the CGI sees that the client is smart, it will communicate smartly with it; otherwise it will fall back to the dumb behavior (so it is backward compatible for reads with older clients).</p>
<p>Let’s walk through a very basic setup. We’ll set this up with Apache as the CGI server. If you don’t have Apache setup, you can do so on a Linux box with something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install apache2 apache2-utils</span><br><span class="line">$ a2enmod cgi <span class="built_in">alias</span> env</span><br></pre></td></tr></table></figure>
<p>This also enables the <code>mod_cgi</code>, <code>mod_alias</code>, and <code>mod_env</code> modules, which are all needed for this to work properly.</p>
<p>You’ll also need to set the Unix user group of the <code>/srv/git</code> directories to <code>www-data</code> so your web server can read- and write-access the repositories, because the Apache instance running the CGI script will (by default) be running as that user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chgrp -R www-data /srv/git</span><br></pre></td></tr></table></figure>
<p>Next we need to add some things to the Apache configuration to run the <code>git-http-backend</code> as the handler for anything coming into the <code>/git</code> path of your web server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SetEnv GIT_PROJECT_ROOT /srv/git</span><br><span class="line">SetEnv GIT_HTTP_EXPORT_ALL</span><br><span class="line">ScriptAlias /git/ /usr/lib/git-core/git-http-backend/</span><br></pre></td></tr></table></figure>
<p>If you leave out <code>GIT_HTTP_EXPORT_ALL</code> environment variable, then Git will only serve to unauthenticated clients the repositories with the <code>git-daemon-export-ok</code> file in them, just like the Git daemon did.</p>
<p>Finally you’ll want to tell Apache to allow requests to <code>git-http-backend</code> and make writes be authenticated somehow, possibly with an Auth block like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files <span class="string">"git-http-backend"</span>&gt;</span><br><span class="line">    AuthType Basic</span><br><span class="line">    AuthName <span class="string">"Git Access"</span></span><br><span class="line">    AuthUserFile /srv/git/.htpasswd</span><br><span class="line">    Require expr !(%&#123;QUERY_STRING&#125; -strmatch <span class="string">'*service=git-receive-pack*'</span> || %&#123;REQUEST_URI&#125; =~ m<span class="comment">#/git-receive-pack$#)</span></span><br><span class="line">    Require valid-user</span><br><span class="line">&lt;/Files&gt;</span><br></pre></td></tr></table></figure>
<p>That will require you to create a <code>.htpasswd</code> file containing the passwords of all the valid users. Here is an example of adding a “schacon” user to the file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ htpasswd -c /srv/git/.htpasswd schacon</span><br></pre></td></tr></table></figure>
<p>There are tons of ways to have Apache authenticate users, you’ll have to choose and implement one of them. This is just the simplest example we could come up with. You’ll also almost certainly want to set this up over SSL so all this data is encrypted.</p>
<p>We don’t want to go too far down the rabbit hole of Apache configuration specifics, since you could well be using a different server or have different authentication needs. The idea is that Git comes with a CGI called <code>git-http-backend</code> that when invoked will do all the negotiation to send and receive data over HTTP. It does not implement any authentication itself, but that can easily be controlled at the layer of the web server that invokes it. You can do this with nearly any CGI-capable web server, so go with the one that you know best.</p>
<p>For more information on configuring authentication in Apache, check out the Apache docs here: &lt;<a href="http://httpd.apache.org/docs/current/howto/auth.html" target="_blank" rel="noopener">http://httpd.apache.org/docs/current/howto/auth.html</a>&gt;</p>
<h2 id="GitWeb"><a href="#GitWeb" class="headerlink" title="GitWeb"></a>GitWeb</h2><p>Now that you have basic read/write and read-only access to your project, you may want to set up a simple web-based visualizer. Git comes with a CGI script called GitWeb that is sometimes used for this.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchscbczj20m80fitaa.jpg" alt="The GitWeb web-based user interface.">  Figure 1. The GitWeb web-based user interface.  If you want to check out what GitWeb would look like for your project, Git comes with a command to fire up a temporary instance if you have a lightweight web server on your system like <code>lighttpd</code> or <code>webrick</code>. On Linux machines, <code>lighttpd</code> is often installed, so you may be able to get it to run by typing <code>git instaweb</code> in your project directory. If you’re running a Mac, Leopard comes preinstalled with Ruby, so <code>webrick</code> may be your best bet. To start <code>instaweb</code> with a non-lighttpd handler, you can run it with the <code>--httpd</code> option.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git instaweb --httpd=webrick</span><br><span class="line">[2009-02-21 10:02:21] INFO  WEBrick 1.3.1</span><br><span class="line">[2009-02-21 10:02:21] INFO  ruby 1.8.6 (2008-03-03) [universal-darwin9.0]</span><br></pre></td></tr></table></figure>
<p>That starts up an HTTPD server on port 1234 and then automatically starts a web browser that opens on that page. It’s pretty easy on your part. When you’re done and want to shut down the server, you can run the same command with the <code>--stop</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git instaweb --httpd=webrick --stop</span><br></pre></td></tr></table></figure>
<p>If you want to run the web interface on a server all the time for your team or for an open source project you’re hosting, you’ll need to set up the CGI script to be served by your normal web server. Some Linux distributions have a <code>gitweb</code> package that you may be able to install via <code>apt</code> or <code>dnf</code>, so you may want to try that first. We’ll walk through installing GitWeb manually very quickly. First, you need to get the Git source code, which GitWeb comes with, and generate the custom CGI script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://git.kernel.org/pub/scm/git/git.git</span><br><span class="line">$ <span class="built_in">cd</span> git/</span><br><span class="line">$ make GITWEB_PROJECTROOT=<span class="string">"/srv/git"</span> prefix=/usr gitweb</span><br><span class="line">    SUBDIR gitweb</span><br><span class="line">    SUBDIR ../</span><br><span class="line">make[2]: `GIT-VERSION-FILE<span class="string">' is up to date.</span></span><br><span class="line"><span class="string">    GEN gitweb.cgi</span></span><br><span class="line"><span class="string">    GEN static/gitweb.js</span></span><br><span class="line"><span class="string">$ sudo cp -Rf gitweb /var/www/</span></span><br></pre></td></tr></table></figure>
<p>Notice that you have to tell the command where to find your Git repositories with the <code>GITWEB_PROJECTROOT</code> variable. Now, you need to make Apache use CGI for that script, for which you can add a VirtualHost:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName gitserver</span><br><span class="line">    DocumentRoot /var/www/gitweb</span><br><span class="line">    &lt;Directory /var/www/gitweb&gt;</span><br><span class="line">        Options +ExecCGI +FollowSymLinks +SymLinksIfOwnerMatch</span><br><span class="line">        AllowOverride All</span><br><span class="line">        order allow,deny</span><br><span class="line">        Allow from all</span><br><span class="line">        AddHandler cgi-script cgi</span><br><span class="line">        DirectoryIndex gitweb.cgi</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<p>Again, GitWeb can be served with any CGI or Perl capable web server; if you prefer to use something else, it shouldn’t be difficult to set up. At this point, you should be able to visit <code>[http://gitserver/](http://gitserver/)</code> to view your repositories online.</p>
<h2 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h2><p>GitWeb is pretty simplistic though. If you’re looking for a more modern, fully featured Git server, there are some several open source solutions out there that you can install instead. As GitLab is one of the more popular ones, we’ll cover installing and using it as an example. This is a bit more complex than the GitWeb option and likely requires more maintenance, but it is a much more fully featured option.</p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>GitLab is a database-backed web application, so its installation is a bit more involved than some other Git servers. Fortunately, this process is very well-documented and supported.</p>
<p>There are a few methods you can pursue to install GitLab. To get something up and running quickly, you can download a virtual machine image or a one-click installer from &lt;<a href="https://bitnami.com/stack/gitlab" target="_blank" rel="noopener">https://bitnami.com/stack/gitlab</a>&gt;, and tweak the configuration to match your particular environment. One nice touch Bitnami has included is the login screen (accessed by typing alt+→); it tells you the IP address and default username and password for the installed GitLab.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchtoogyj20jx0b30sj.jpg" alt="The Bitnami GitLab virtual machine login screen.">  Figure 2. The Bitnami GitLab virtual machine login screen.  For anything else, follow the guidance in the GitLab Community Edition readme, which can be found at &lt;<a href="https://gitlab.com/gitlab-org/gitlab-ce/tree/master" target="_blank" rel="noopener">https://gitlab.com/gitlab-org/gitlab-ce/tree/master</a>&gt;. There you’ll find assistance for installing GitLab using Chef recipes, a virtual machine on Digital Ocean, and RPM and DEB packages (which, as of this writing, are in beta). There’s also “unofficial” guidance on getting GitLab running with non-standard operating systems and databases, a fully-manual installation script, and many other topics.</p>
<h3 id="Administration"><a href="#Administration" class="headerlink" title="Administration"></a>Administration</h3><p>GitLab’s administration interface is accessed over the web. Simply point your browser to the hostname or IP address where GitLab is installed, and log in as an admin user. The default username is <a href="mailto:`admin@local.host" target="_blank" rel="noopener">`admin@local.host</a><code>, and the default password is</code>5iveL!fe` (which you will be prompted to change as soon as you enter it). Once logged in, click the “Admin area” icon in the menu at the top right.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci07uj7j20m804wq3g.jpg" alt="The ``Admin area&#39;&#39; item in the GitLab menu.">  Figure 3. The “Admin area” item in the GitLab menu.</p>
<h4 id="Users"><a href="#Users" class="headerlink" title="Users"></a>Users</h4><p>Users in GitLab are accounts that correspond to people. User accounts don’t have a lot of complexity; mainly it’s a collection of personal information attached to login data. Each user account comes with a <strong>namespace</strong>, which is a logical grouping of projects that belong to that user. If the user <code>jane</code> had a project named <code>project</code>, that project’s url would be &lt;<a href="http://server/jane/project" target="_blank" rel="noopener">http://server/jane/project</a>&gt;.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci52368j20m80bxtev.jpg" alt="The GitLab user administration screen.">  Figure 4. The GitLab user administration screen.  Removing a user can be done in two ways. “Blocking” a user prevents them from logging into the GitLab instance, but all of the data under that user’s namespace will be preserved, and commits signed with that user’s email address will still link back to their profile.</p>
<p>“Destroying” a user, on the other hand, completely removes them from the database and filesystem. All projects and data in their namespace is removed, and any groups they own will also be removed. This is obviously a much more permanent and destructive action, and its uses are rare.</p>
<h4 id="Groups"><a href="#Groups" class="headerlink" title="Groups"></a>Groups</h4><p>A GitLab group is an assemblage of projects, along with data about how users can access those projects. Each group has a project namespace (the same way that users do), so if the group <code>training</code> has a project <code>materials</code>, its url would be &lt;<a href="http://server/training/materials" target="_blank" rel="noopener">http://server/training/materials</a>&gt;.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciedkgfj20m80bx7af.jpg" alt="The GitLab group administration screen.">  Figure 5. The GitLab group administration screen.  Each group is associated with a number of users, each of which has a level of permissions for the group’s projects and the group itself. These range from “Guest” (issues and chat only) to “Owner” (full control of the group, its members, and its projects). The types of permissions are too numerous to list here, but GitLab has a helpful link on the administration screen.</p>
<h4 id="Projects"><a href="#Projects" class="headerlink" title="Projects"></a>Projects</h4><p>A GitLab project roughly corresponds to a single Git repository. Every project belongs to a single namespace, either a user or a group. If the project belongs to a user, the owner of the project has direct control over who has access to the project; if the project belongs to a group, the group’s user-level permissions will also take effect.</p>
<p>Every project also has a visibility level, which controls who has read access to that project’s pages and repository. If a project is <em>Private</em>, the project’s owner must explicitly grant access to specific users. An <em>Internal</em> project is visible to any logged-in user, and a <em>Public</em> project is visible to anyone. Note that this controls both <code>git fetch</code> access as well as access to the web UI for that project.</p>
<h4 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h4><p>GitLab includes support for hooks, both at a project or system level. For either of these, the GitLab server will perform an HTTP POST with some descriptive JSON whenever relevant events occur. This is a great way to connect your Git repositories and GitLab instance to the rest of your development automation, such as CI servers, chat rooms, or deployment tools.</p>
<h3 id="Basic-Usage"><a href="#Basic-Usage" class="headerlink" title="Basic Usage"></a>Basic Usage</h3><p>The first thing you’ll want to do with GitLab is create a new project. This is accomplished by clicking the “+” icon on the toolbar. You’ll be asked for the project’s name, which namespace it should belong to, and what its visibility level should be. Most of what you specify here isn’t permanent, and can be re-adjusted later through the settings interface. Click “Create Project”, and you’re done.</p>
<p>Once the project exists, you’ll probably want to connect it with a local Git repository. Each project is accessible over HTTPS or SSH, either of which can be used to configure a Git remote. The URLs are visible at the top of the project’s home page. For an existing local repository, this command will create a remote named <code>gitlab</code> to the hosted location:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add gitlab [https://server/namespace/project.git](https://server/namespace/project.git)</span><br></pre></td></tr></table></figure>
<p>If you don’t have a local copy of the repository, you can simply do this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://server/namespace/project.git](https://server/namespace/project.git)</span><br></pre></td></tr></table></figure>
<p>The web UI provides access to several useful views of the repository itself. Each project’s home page shows recent activity, and links along the top will lead you to views of the project’s files and commit log.</p>
<h3 id="Working-Together"><a href="#Working-Together" class="headerlink" title="Working Together"></a>Working Together</h3><p>The simplest way of working together on a GitLab project is by giving another user direct push access to the Git repository. You can add a user to a project by going to the “Members” section of that project’s settings, and associating the new user with an access level (the different access levels are discussed a bit in 【Groups】). By giving a user an access level of “Developer” or above, that user can push commits and branches directly to the repository with impunity.</p>
<p>Another, more decoupled way of collaboration is by using merge requests. This feature enables any user that can see a project to contribute to it in a controlled way. Users with direct access can simply create a branch, push commits to it, and open a merge request from their branch back into <code>master</code> or any other branch. Users who don’t have push permissions for a repository can “fork” it (create their own copy), push commits to <em>that</em> copy, and open a merge request from their fork back to the main project. This model allows the owner to be in full control of what goes into the repository and when, while allowing contributions from untrusted users.</p>
<p>Merge requests and issues are the main units of long-lived discussion in GitLab. Each merge request allows a line-by-line discussion of the proposed change (which supports a lightweight kind of code review), as well as a general overall discussion thread. Both can be assigned to users, or organized into milestones.</p>
<p>This section is focused mainly on the Git-related features of GitLab, but as a mature project, it provides many other features to help your team work together, such as project wikis and system maintenance tools. One benefit to GitLab is that, once the server is set up and running, you’ll rarely need to tweak a configuration file or access the server via SSH; most administration and general usage can be accomplished through the in-browser interface.</p>
<h2 id="Third-Party-Hosted-Options"><a href="#Third-Party-Hosted-Options" class="headerlink" title="Third Party Hosted Options"></a>Third Party Hosted Options</h2><p>If you don’t want to go through all of the work involved in setting up your own Git server, you have several options for hosting your Git projects on an external dedicated hosting site. Doing so offers a number of advantages: a hosting site is generally quick to set up and easy to start projects on, and no server maintenance or monitoring is involved. Even if you set up and run your own server internally, you may still want to use a public hosting site for your open source code – it’s generally easier for the open source community to find and help you with.</p>
<p>These days, you have a huge number of hosting options to choose from, each with different advantages and disadvantages. To see an up-to-date list, check out the GitHosting page on the main Git wiki at &lt;<a href="https://git.wiki.kernel.org/index.php/GitHosting" target="_blank" rel="noopener">https://git.wiki.kernel.org/index.php/GitHosting</a>&gt;</p>
<p>We’ll cover using GitHub in detail in 【GitHub】, as it is the largest Git host out there and you may need to interact with projects hosted on it in any case, but there are dozens more to choose from should you not want to set up your own Git server.</p>
<h2 id="Summary-3"><a href="#Summary-3" class="headerlink" title="Summary"></a>Summary</h2><p>You have several options to get a remote Git repository up and running so that you can collaborate with others or share your work.</p>
<p>Running your own server gives you a lot of control and allows you to run the server within your own firewall, but such a server generally requires a fair amount of your time to set up and maintain. If you place your data on a hosted server, it’s easy to set up and maintain; however, you have to be able to keep your code on someone else’s servers, and some organizations don’t allow that.</p>
<p>It should be fairly straightforward to determine which solution or combination of solutions is appropriate for you and your organization.</p>
<h1 id="Distributed-Git"><a href="#Distributed-Git" class="headerlink" title="Distributed Git"></a><strong>Distributed</strong> <strong>Git</strong></h1><p>Now that you have a remote Git repository set up as a focal point for all the developers to share their code, and you’re familiar with basic Git commands in a local workflow, you’ll look at how to utilize some of the distributed workflows that Git affords you.</p>
<p>In this chapter, you’ll see how to work with Git in a distributed environment as a contributor and an integrator. That is, you’ll learn how to contribute code successfully to a project and make it as easy on you and the project maintainer as possible, and also how to maintain a project successfully with a number of developers contributing.</p>
<h2 id="Distributed-Workflows"><a href="#Distributed-Workflows" class="headerlink" title="Distributed Workflows"></a>Distributed Workflows</h2><p>Unlike Centralized Version Control Systems (CVCSs), the distributed nature of Git allows you to be far more flexible in how developers collaborate on projects. In centralized systems, every developer is a node working more or less equally on a central hub. In Git, however, every developer is potentially both a node and a hub — that is, every developer can both contribute code to other repositories and maintain a public repository on which others can base their work and which they can contribute to. This opens a vast range of workflow possibilities for your project and/or your team, so we’ll cover a few common paradigms that take advantage of this flexibility. We’ll go over the strengths and possible weaknesses of each design; you can choose a single one to use, or you can mix and match features from each.</p>
<h3 id="Centralized-Workflow"><a href="#Centralized-Workflow" class="headerlink" title="Centralized Workflow"></a>Centralized Workflow</h3><p>In centralized systems, there is generally a single collaboration model — the centralized workflow. One central hub, or <em>repository</em>, can accept code, and everyone synchronizes their work to it. A number of developers are nodes — consumers of that hub — and synchronize to that one place.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcimlzd5j20m809l3ym.jpg" alt="Centralized workflow.">  Figure 1. Centralized workflow.  This means that if two developers clone from the hub and both make changes, the first developer to push their changes back up can do so with no problems. The second developer must merge in the first one’s work before pushing changes up, so as not to overwrite the first developer’s changes. This concept is as true in Git as it is in Subversion (or any CVCS), and this model works perfectly well in Git.</p>
<p>If you are already comfortable with a centralized workflow in your company or team, you can easily continue using that workflow with Git. Simply set up a single repository, and give everyone on your team push access; Git won’t let users overwrite each other. Say John and Jessica both start working at the same time. John finishes his change and pushes it to the server. Then Jessica tries to push her changes, but the server rejects them. She is told that she’s trying to push non-fast-forward changes and that she won’t be able to do so until she fetches and merges. This workflow is attractive to a lot of people because it’s a paradigm that many are familiar and comfortable with.</p>
<p>This is also not limited to small teams. With Git’s branching model, it’s possible for hundreds of developers to successfully work on a single project through dozens of branches simultaneously.</p>
<h3 id="Integration-Manager-Workflow"><a href="#Integration-Manager-Workflow" class="headerlink" title="Integration-Manager Workflow"></a>Integration-Manager Workflow</h3><p>Because Git allows you to have multiple remote repositories, it’s possible to have a workflow where each developer has write access to their own public repository and read access to everyone else’s. This scenario often includes a canonical repository that represents the “official” project. To contribute to that project, you create your own public clone of the project and push your changes to it. Then, you can send a request to the maintainer of the main project to pull in your changes. The maintainer can then add your repository as a remote, test your changes locally, merge them into their branch, and push back to their repository. The process works as follows (see 【Integration-manager workflow.】):</p>
<ol start="2">
<li>The project maintainer pushes to their public repository.</li>
<li>A contributor clones that repository and makes changes.</li>
<li>The contributor pushes to their own public copy.</li>
<li>The contributor sends the maintainer an email asking them to pull changes.</li>
<li>The maintainer adds the contributor’s repository as a remote and merges locally.</li>
<li>The maintainer pushes merged changes to the main repository.<br><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcik2zwhj20m807fmxf.jpg" alt="Integration-manager workflow.">  Figure 2. Integration-manager workflow.   This is a very common workflow with hub-based tools like GitHub or GitLab, where it’s easy to fork a project and push your changes into your fork for everyone to see. One of the main advantages of this approach is that you can continue to work, and the maintainer of the main repository can pull in your changes at any time. Contributors don’t have to wait for the project to incorporate their changes — each party can work at their own pace.</li>
</ol>
<h3 id="Dictator-and-Lieutenants-Workflow"><a href="#Dictator-and-Lieutenants-Workflow" class="headerlink" title="Dictator and Lieutenants Workflow"></a>Dictator and Lieutenants Workflow</h3><p>This is a variant of a multiple-repository workflow. It’s generally used by huge projects with hundreds of collaborators; one famous example is the Linux kernel. Various integration managers are in charge of certain parts of the repository; they’re called <em>lieutenants</em>. All the lieutenants have one integration manager known as the benevolent dictator. The benevolent dictator pushes from his directory to a reference repository from which all the collaborators need to pull. The process works like this (see 【Benevolent dictator workflow.】):</p>
<ol start="2">
<li>Regular developers work on their topic branch and rebase their work on top of <code>master</code>. The <code>master</code> branch is that of the reference repository to which the dictator pushes.</li>
<li>Lieutenants merge the developers’ topic branches into their <code>master</code> branch.</li>
<li>The dictator merges the lieutenants’ <code>master</code> branches into the dictator’s <code>master</code> branch.</li>
<li>Finally, the dictator pushes that <code>master</code> branch to the reference repository so the other developers can rebase on it.<br><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcino0ehj20m80bgjrp.jpg" alt="Benevolent dictator workflow.">  Figure 3. Benevolent dictator workflow.  This kind of workflow isn’t common, but can be useful in very big projects, or in highly hierarchical environments. It allows the project leader (the dictator) to delegate much of the work and collect large subsets of code at multiple points before integrating them.</li>
</ol>
<h3 id="Workflows-Summary"><a href="#Workflows-Summary" class="headerlink" title="Workflows Summary"></a>Workflows Summary</h3><p>These are some commonly used workflows that are possible with a distributed system like Git, but you can see that many variations are possible to suit your particular real-world workflow. Now that you can (hopefully) determine which workflow combination may work for you, we’ll cover some more specific examples of how to accomplish the main roles that make up the different flows. In the next section, you’ll learn about a few common patterns for contributing to a project.</p>
<h2 id="Contributing-to-a-Project"><a href="#Contributing-to-a-Project" class="headerlink" title="Contributing to a Project"></a>Contributing to a Project</h2><p>The main difficulty with describing how to contribute to a project are the numerous variations on how to do that. Because Git is very flexible, people can and do work together in many ways, and it’s problematic to describe how you should contribute — every project is a bit different. Some of the variables involved are active contributor count, chosen workflow, your commit access, and possibly the external contribution method.</p>
<p>The first variable is active contributor count — how many users are actively contributing code to this project, and how often? In many instances, you’ll have two or three developers with a few commits a day, or possibly less for somewhat dormant projects. For larger companies or projects, the number of developers could be in the thousands, with hundreds or thousands of commits coming in each day. This is important because with more and more developers, you run into more issues with making sure your code applies cleanly or can be easily merged. Changes you submit may be rendered obsolete or severely broken by work that is merged in while you were working or while your changes were waiting to be approved or applied. How can you keep your code consistently up to date and your commits valid?</p>
<p>The next variable is the workflow in use for the project. Is it centralized, with each developer having equal write access to the main codeline? Does the project have a maintainer or integration manager who checks all the patches? Are all the patches peer-reviewed and approved? Are you involved in that process? Is a lieutenant system in place, and do you have to submit your work to them first?</p>
<p>The next variable is your commit access. The workflow required in order to contribute to a project is much different if you have write access to the project than if you don’t. If you don’t have write access, how does the project prefer to accept contributed work? Does it even have a policy? How much work are you contributing at a time? How often do you contribute?</p>
<p>All these questions can affect how you contribute effectively to a project and what workflows are preferred or available to you. We’ll cover aspects of each of these in a series of use cases, moving from simple to more complex; you should be able to construct the specific workflows you need in practice from these examples.</p>
<h3 id="Commit-Guidelines"><a href="#Commit-Guidelines" class="headerlink" title="Commit Guidelines"></a>Commit Guidelines</h3><p>Before we start looking at the specific use cases, here’s a quick note about commit messages. Having a good guideline for creating commits and sticking to it makes working with Git and collaborating with others a lot easier. The Git project provides a document that lays out a number of good tips for creating commits from which to submit patches — you can read it in the Git source code in the <code>Documentation/SubmittingPatches</code> file.</p>
<p>First, your submissions should not contain any whitespace errors. Git provides an easy way to check for this — before you commit, run <code>git diff --check</code>, which identifies possible whitespace errors and lists them for you.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcirbdk9j20m80b83yr.jpg" alt="Output of `git diff --check`.">  Figure 4. Output of <code>git diff --check</code>.  If you run that command before committing, you can tell if you’re about to commit whitespace issues that may annoy other developers.</p>
<p>Next, try to make each commit a logically separate changeset. If you can, try to make your changes digestible — don’t code for a whole weekend on five different issues and then submit them all as one massive commit on Monday. Even if you don’t commit during the weekend, use the staging area on Monday to split your work into at least one commit per issue, with a useful message per commit. If some of the changes modify the same file, try to use <code>git add --patch</code> to partially stage files (covered in detail in 【Interactive Staging】). The project snapshot at the tip of the branch is identical whether you do one commit or five, as long as all the changes are added at some point, so try to make things easier on your fellow developers when they have to review your changes.</p>
<p>This approach also makes it easier to pull out or revert one of the changesets if you need to later. 【Rewriting History】 describes a number of useful Git tricks for rewriting history and interactively staging files — use these tools to help craft a clean and understandable history before sending the work to someone else.</p>
<p>The last thing to keep in mind is the commit message. Getting in the habit of creating quality commit messages makes using and collaborating with Git a lot easier. As a general rule, your messages should start with a single line that’s no more than about 50 characters and that describes the changeset concisely, followed by a blank line, followed by a more detailed explanation. The Git project requires that the more detailed explanation include your motivation for the change and contrast its implementation with previous behavior — this is a good guideline to follow. It’s also a good idea to use the imperative present tense in these messages. In other words, use commands. Instead of “I added tests for” or “Adding tests for,” use “Add tests for.” Here is a <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html" target="_blank" rel="noopener">template originally written by Tim Pope</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Short (50 chars or less) summary of changes</span><br><span class="line"></span><br><span class="line">More detailed explanatory text, <span class="keyword">if</span> necessary.  Wrap it to</span><br><span class="line">about 72 characters or so.  In some contexts, the first</span><br><span class="line">line is treated as the subject of an email and the rest of</span><br><span class="line">the text as the body.  The blank line separating the</span><br><span class="line">summary from the body is critical (unless you omit the body</span><br><span class="line">entirely); tools like rebase can get confused <span class="keyword">if</span> you run</span><br><span class="line">the two together.</span><br><span class="line"></span><br><span class="line">Further paragraphs come after blank lines.</span><br><span class="line"></span><br><span class="line">  - Bullet points are okay, too</span><br><span class="line"></span><br><span class="line">  - Typically a hyphen or asterisk is used <span class="keyword">for</span> the bullet,</span><br><span class="line">    preceded by a single space, with blank lines <span class="keyword">in</span></span><br><span class="line">    between, but conventions vary here</span><br></pre></td></tr></table></figure>
<p>If all your commit messages follow this model, things will be much easier for you and the developers with whom you collaborate. The Git project has well-formatted commit messages — try running <code>git log --no-merges</code> there to see what a nicely-formatted project-commit history looks like.</p>
<h2 id="Do-as-we-say-not-as-we-do"><a href="#Do-as-we-say-not-as-we-do" class="headerlink" title="Do as we say, not as we do."></a>Do as we say, not as we do.</h2><p>For the sake of brevity, many of the examples in this book don’t have nicely-formatted commit messages like this; instead, we simply use the <code>-m</code> option to <code>git commit</code>.</p>
<p>In short, do as we say, not as we do.</p>
<h3 id="Private-Small-Team"><a href="#Private-Small-Team" class="headerlink" title="Private Small Team"></a>Private Small Team</h3><p>The simplest setup you’re likely to encounter is a private project with one or two other developers. “Private,” in this context, means closed-source — not accessible to the outside world. You and the other developers all have push access to the repository.</p>
<p>In this environment, you can follow a workflow similar to what you might do when using Subversion or another centralized system. You still get the advantages of things like offline committing and vastly simpler branching and merging, but the workflow can be very similar; the main difference is that merges happen client-side rather than on the server at commit time. Let’s see what it might look like when two developers start to work together with a shared repository. The first developer, John, clones the repository, makes a change, and commits locally. (The protocol messages have been replaced with <code>...</code> in these examples to shorten them somewhat.)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># John's Machine</span></span><br><span class="line">$ git <span class="built_in">clone</span> john@githost:simplegit.git</span><br><span class="line">Cloning into <span class="string">'simplegit'</span>...</span><br><span class="line">...</span><br><span class="line">$ <span class="built_in">cd</span> simplegit/</span><br><span class="line">$ vim lib/simplegit.rb</span><br><span class="line">$ git commit -am <span class="string">'remove invalid default value'</span></span><br><span class="line">[master 738ee87] remove invalid default value</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>The second developer, Jessica, does the same thing — clones the repository and commits a change:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jessica's Machine</span></span><br><span class="line">$ git <span class="built_in">clone</span> jessica@githost:simplegit.git</span><br><span class="line">Cloning into <span class="string">'simplegit'</span>...</span><br><span class="line">...</span><br><span class="line">$ <span class="built_in">cd</span> simplegit/</span><br><span class="line">$ vim TODO</span><br><span class="line">$ git commit -am <span class="string">'add reset task'</span></span><br><span class="line">[master fbff5bc] add reset task</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>Now, Jessica pushes her work to the server, which works just fine:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jessica's Machine</span></span><br><span class="line">$ git push origin master</span><br><span class="line">...</span><br><span class="line">To jessica@githost:simplegit.git</span><br><span class="line">   1edee6b..fbff5bc  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>The last line of the output above shows a useful return message from the push operation. The basic format is <code>&lt;oldref&gt;..&lt;newref&gt; fromref -&gt; toref</code>, where <code>oldref</code> means the old reference, <code>newref</code> means the new reference, <code>fromref</code> is the name of the local reference being pushed, and <code>toref</code> is the name of the remote reference being updated. You’ll see similar output like this below in the discussions, so having a basic idea of the meaning will help in understanding the various states of the repositories. More details are available in the documentation for <a href="https://git-scm.com/docs/git-push" target="_blank" rel="noopener">git-push</a>.</p>
<p>Continuing with this example, shortly afterwards, John makes some changes, commits them to his local repository, and tries to push them to the same server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># John's Machine</span></span><br><span class="line">$ git push origin master</span><br><span class="line">To john@githost:simplegit.git</span><br><span class="line"> ! [rejected]        master -&gt; master (non-fast forward)</span><br><span class="line">error: failed to push some refs to <span class="string">'john@githost:simplegit.git'</span></span><br></pre></td></tr></table></figure>
<p>In this case, John’s push fails because of Jessica’s earlier push of <em>her</em> changes. This is especially important to understand if you’re used to Subversion, because you’ll notice that the two developers didn’t edit the same file. Although Subversion automatically does such a merge on the server if different files are edited, with Git, you must <em>first</em> merge the commits locally. In other words, John must first fetch Jessica’s upstream changes and merge them into his local repository before he will be allowed to push.</p>
<p>As a first step, John fetches Jessica’s work (this only <em>fetches</em> Jessica’s upstream work, it does not yet merge it into John’s work):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">...</span><br><span class="line">From john@githost:simplegit</span><br><span class="line"> + 049d078...fbff5bc master     -&gt; origin/master</span><br></pre></td></tr></table></figure>
<p>At this point, John’s local repository looks something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciw17g8j20m80dg0su.jpg" alt="John&#39;s divergent history.">  Figure 5. John’s divergent history.  Now John can merge Jessica’s work that he fetched into his own local work:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git merge origin/master</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> TODO |    1 +</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>As long as that local merge goes smoothly, John’s updated history will now look like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcix53pfj20m809ymx6.jpg" alt="John&#39;s repository after merging `origin/master`.">  Figure 6. John’s repository after merging <code>origin/master</code>.  At this point, John might want to test this new code to make sure none of Jessica’s work affects any of his and, as long as everything seems fine, he can finally push the new merged work up to the server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br><span class="line">...</span><br><span class="line">To john@githost:simplegit.git</span><br><span class="line">   fbff5bc..72bbc59  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>In the end, John’s commit history will look like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj3tl2rj20m807yjre.jpg" alt="John&#39;s history after pushing to the `origin` server.">  Figure 7. John’s history after pushing to the <code>origin</code> server.  In the meantime, Jessica has created a new topic branch called <code>issue54</code>, and made three commits to that branch. She hasn’t fetched John’s changes yet, so her commit history looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj8ir2dj20m8059t8o.jpg" alt="Jessica&#39;s topic branch.">  Figure 8. Jessica’s topic branch.  Suddenly, Jessica learns that John has pushed some new work to the server and she wants to take a look at it, so she can fetch all new content from the server that she does not yet have with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jessica's Machine</span></span><br><span class="line">$ git fetch origin</span><br><span class="line">...</span><br><span class="line">From jessica@githost:simplegit</span><br><span class="line">   fbff5bc..72bbc59  master     -&gt; origin/master</span><br></pre></td></tr></table></figure>
<p>That pulls down the work John has pushed up in the meantime. Jessica’s history now looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjc7559j20m806z74a.jpg" alt="Jessica&#39;s history after fetching John&#39;s changes.">  Figure 9. Jessica’s history after fetching John’s changes.  Jessica thinks her topic branch is ready, but she wants to know what part of John’s fetched work she has to merge into her work so that she can push. She runs <code>git log</code> to find out:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --no-merges issue54..origin/master</span><br><span class="line">commit 738ee872852dfaa9d6634e0dea7a324040193016</span><br><span class="line">Author: John Smith &lt;jsmith@example.com&gt;</span><br><span class="line">Date:   Fri May 29 16:01:27 2009 -0700</span><br><span class="line"></span><br><span class="line">   remove invalid default value</span><br></pre></td></tr></table></figure>
<p>The <code>issue54..origin/master</code> syntax is a log filter that asks Git to display only those commits that are on the latter branch (in this case <code>origin/master</code>) that are not on the first branch (in this case <code>issue54</code>). We’ll go over this syntax in detail in 【Commit Ranges】.</p>
<p>From the above output, we can see that there is a single commit that John has made that Jessica has not merged into her local work. If she merges <code>origin/master</code>, that is the single commit that will modify her local work.</p>
<p>Now, Jessica can merge her topic work into her master branch, merge John’s work (<code>origin/master</code>) into her <code>master</code> branch, and then push back to the server again.</p>
<p>First (having committed all of the work on her <code>issue54</code> topic branch), Jessica switches back to her master branch in preparation for integrating all this work:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line">Your branch is behind <span class="string">'origin/master'</span> by 2 commits, and can be fast-forwarded.</span><br></pre></td></tr></table></figure>
<p>Jessica can merge either <code>origin/master</code> or <code>issue54</code> first — they’re both upstream, so the order doesn’t matter. The end snapshot should be identical no matter which order she chooses; only the history will be different. She chooses to merge the <code>issue54</code> branch first:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git merge issue54</span><br><span class="line">Updating fbff5bc..4af4298</span><br><span class="line">Fast forward</span><br><span class="line"> README           |    1 +</span><br><span class="line"> lib/simplegit.rb |    6 +++++-</span><br><span class="line"> 2 files changed, 6 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>No problems occur; as you can see it was a simple fast-forward merge. Jessica now completes the local merging process by merging John’s earlier fetched work that is sitting in the <code>origin/master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge origin/master</span><br><span class="line">Auto-merging lib/simplegit.rb</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> lib/simplegit.rb |    2 +-</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>Everything merges cleanly, and Jessica’s history now looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjfzrwsj20m805zq2x.jpg" alt="Jessica&#39;s history after merging John&#39;s changes.">  Figure 10. Jessica’s history after merging John’s changes.  Now <code>origin/master</code> is reachable from Jessica’s <code>master</code> branch, so she should be able to successfully push (assuming John hasn’t pushed even more changes in the meantime):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br><span class="line">...</span><br><span class="line">To jessica@githost:simplegit.git</span><br><span class="line">   72bbc59..8059c15  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>Each developer has committed a few times and merged each other’s work successfully.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjjikl2j20m805zq2x.jpg" alt="Jessica&#39;s history after pushing all changes back to the server.">  Figure 11. Jessica’s history after pushing all changes back to the server.  That is one of the simplest workflows. You work for a while (generally in a topic branch), and merge that work into your <code>master</code> branch when it’s ready to be integrated. When you want to share that work, you fetch and merge your <code>master</code> from <code>origin/master</code> if it has changed, and finally push to the <code>master</code> branch on the server. The general sequence is something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm0ywmcj20hf0m8t8y.jpg" alt="General sequence of events for a simple multiple-developer Git workflow.">  Figure 12. General sequence of events for a simple multiple-developer Git workflow.</p>
<h3 id="Private-Managed-Team"><a href="#Private-Managed-Team" class="headerlink" title="Private Managed Team"></a>Private Managed Team</h3><p>In this next scenario, you’ll look at contributor roles in a larger private group. You’ll learn how to work in an environment where small groups collaborate on features, after which those team-based contributions are integrated by another party.</p>
<p>Let’s say that John and Jessica are working together on one feature (call this “featureA”), while Jessica and a third developer, Josie, are working on a second (say, “featureB”). In this case, the company is using a type of integration-manager workflow where the work of the individual groups is integrated only by certain engineers, and the <code>master</code> branch of the main repo can be updated only by those engineers. In this scenario, all work is done in team-based branches and pulled together by the integrators later.</p>
<p>Let’s follow Jessica’s workflow as she works on her two features, collaborating in parallel with two different developers in this environment. Assuming she already has her repository cloned, she decides to work on <code>featureA</code> first. She creates a new branch for the feature and does some work on it there:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jessica's Machine</span></span><br><span class="line">$ git checkout -b featureA</span><br><span class="line">Switched to a new branch <span class="string">'featureA'</span></span><br><span class="line">$ vim lib/simplegit.rb</span><br><span class="line">$ git commit -am <span class="string">'add limit to log function'</span></span><br><span class="line">[featureA 3300904] add <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>At this point, she needs to share her work with John, so she pushes her <code>featureA</code> branch commits up to the server. Jessica doesn’t have push access to the <code>master</code> branch — only the integrators do — so she has to push to another branch in order to collaborate with John:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin featureA</span><br><span class="line">...</span><br><span class="line">To jessica@githost:simplegit.git</span><br><span class="line"> * [new branch]      featureA -&gt; featureA</span><br></pre></td></tr></table></figure>
<p>Jessica emails John to tell him that she’s pushed some work into a branch named <code>featureA</code> and he can look at it now. While she waits for feedback from John, Jessica decides to start working on <code>featureB</code> with Josie. To begin, she starts a new feature branch, basing it off the server’s <code>master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jessica's Machine</span></span><br><span class="line">$ git fetch origin</span><br><span class="line">$ git checkout -b featureB origin/master</span><br><span class="line">Switched to a new branch <span class="string">'featureB'</span></span><br></pre></td></tr></table></figure>
<p>Now, Jessica makes a couple of commits on the <code>featureB</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ vim lib/simplegit.rb</span><br><span class="line">$ git commit -am <span class="string">'made the ls-tree function recursive'</span></span><br><span class="line">[featureB e5b0fdc] made the ls-tree <span class="keyword">function</span> recursive</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br><span class="line">$ vim lib/simplegit.rb</span><br><span class="line">$ git commit -am <span class="string">'add ls-files'</span></span><br><span class="line">[featureB 8512791] add ls-files</span><br><span class="line"> 1 files changed, 5 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>Jessica’s repository now looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclrz7sjj20m809wdfw.jpg" alt="Jessica&#39;s initial commit history.">  Figure 13. Jessica’s initial commit history.  She’s ready to push her work, but gets an email from Josie that a branch with some initial “featureB” work on it was already pushed to the server as the <code>featureBee</code> branch. Jessica needs to merge those changes with her own before she can push her work to the server. Jessica first fetches Josie’s changes with <code>git fetch</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">...</span><br><span class="line">From jessica@githost:simplegit</span><br><span class="line"> * [new branch]      featureBee -&gt; origin/featureBee</span><br></pre></td></tr></table></figure>
<p>Assuming Jessica is still on her checked-out <code>featureB</code> branch, she can now merge Josie’s work into that branch with <code>git merge</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge origin/featureBee</span><br><span class="line">Auto-merging lib/simplegit.rb</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> lib/simplegit.rb |    4 ++++</span><br><span class="line"> 1 files changed, 4 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>At this point, Jessica wants to push all of this merged “featureB” work back to the server, but she doesn’t want to simply push her own <code>featureB</code> branch. Rather, since Josie has already started an upstream <code>featureBee</code> branch, Jessica wants to push to <em>that</em> branch, which she does with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin featureB:featureBee</span><br><span class="line">...</span><br><span class="line">To jessica@githost:simplegit.git</span><br><span class="line">   fba9af8..cd685d1  featureB -&gt; featureBee</span><br></pre></td></tr></table></figure>
<p>This is called a <em>refspec</em>. See 【The Refspec】 for a more detailed discussion of Git refspecs and different things you can do with them. Also notice the <code>-u</code> flag; this is short for <code>--set-upstream</code>, which configures the branches for easier pushing and pulling later.</p>
<p>Suddenly, Jessica gets email from John, who tells her he’s pushed some changes to the <code>featureA</code> branch on which they are collaborating, and he asks Jessica to take a look at them. Again, Jessica runs a simple <code>git fetch</code> to fetch <em>all</em> new content from the server, including (of course) John’s latest work:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">...</span><br><span class="line">From jessica@githost:simplegit</span><br><span class="line">   3300904..aad881d  featureA   -&gt; origin/featureA</span><br></pre></td></tr></table></figure>
<p>Jessica can display the log of John’s new work by comparing the content of the newly-fetched <code>featureA</code> branch with her local copy of the same branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> featureA..origin/featureA</span><br><span class="line">commit aad881d154acdaeb2b6b18ea0e827ed8a6d671e6</span><br><span class="line">Author: John Smith &lt;jsmith@example.com&gt;</span><br><span class="line">Date:   Fri May 29 19:57:33 2009 -0700</span><br><span class="line"></span><br><span class="line">    changed <span class="built_in">log</span> output to 30 from 25</span><br></pre></td></tr></table></figure>
<p>If Jessica likes what she sees, she can merge John’s new work into her local <code>featureA</code> branch with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout featureA</span><br><span class="line">Switched to branch <span class="string">'featureA'</span></span><br><span class="line">$ git merge origin/featureA</span><br><span class="line">Updating 3300904..aad881d</span><br><span class="line">Fast forward</span><br><span class="line"> lib/simplegit.rb |   10 +++++++++-</span><br><span class="line">1 files changed, 9 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>Finally, Jessica might want to make a couple minor changes to all that merged content, so she is free to make those changes, commit them to her local <code>featureA</code> branch, and push the end result back to the server.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">'small tweak'</span></span><br><span class="line">[featureA 774b3ed] small tweak</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br><span class="line">$ git push</span><br><span class="line">...</span><br><span class="line">To jessica@githost:simplegit.git</span><br><span class="line">   3300904..774b3ed  featureA -&gt; featureA</span><br></pre></td></tr></table></figure>
<p>Jessica’s commit history now looks something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjy4wo2j20m80cjaa9.jpg" alt="Jessica&#39;s history after committing on a feature branch.">  Figure 14. Jessica’s history after committing on a feature branch.  At some point, Jessica, Josie, and John inform the integrators that the <code>featureA</code> and <code>featureBee</code> branches on the server are ready for integration into the mainline. After the integrators merge these branches into the mainline, a fetch will bring down the new merge commit, making the history look like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck2d4kzj20m80agaa8.jpg" alt="Jessica&#39;s history after merging both her topic branches.">  Figure 15. Jessica’s history after merging both her topic branches.  Many groups switch to Git because of this ability to have multiple teams working in parallel, merging the different lines of work late in the process. The ability of smaller subgroups of a team to collaborate via remote branches without necessarily having to involve or impede the entire team is a huge benefit of Git. The sequence for the workflow you saw here is something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn9didzj20jy0m83z1.jpg" alt="Basic sequence of this managed-team workflow.">  Figure 16. Basic sequence of this managed-team workflow.</p>
<h3 id="Forked-Public-Project"><a href="#Forked-Public-Project" class="headerlink" title="Forked Public Project"></a>Forked Public Project</h3><p>Contributing to public projects is a bit different. Because you don’t have the permissions to directly update branches on the project, you have to get the work to the maintainers some other way. This first example describes contributing via forking on Git hosts that support easy forking. Many hosting sites support this (including GitHub, BitBucket, repo.or.cz, and others), and many project maintainers expect this style of contribution. The next section deals with projects that prefer to accept contributed patches via email.</p>
<p>First, you’ll probably want to clone the main repository, create a topic branch for the patch or patch series you’re planning to contribute, and do your work there. The sequence looks basically like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> &lt;url&gt;</span><br><span class="line">$ <span class="built_in">cd</span> project</span><br><span class="line">$ git checkout -b featureA</span><br><span class="line">  ... work ...</span><br><span class="line">$ git commit</span><br><span class="line">  ... work ...</span><br><span class="line">$ git commit</span><br></pre></td></tr></table></figure>
<p>You may want to use <code>rebase -i</code> to squash your work down to a single commit, or rearrange the work in the commits to make the patch easier for the maintainer to review — see 【Rewriting History】 for more information about interactive rebasing.</p>
<p>When your branch work is finished and you’re ready to contribute it back to the maintainers, go to the original project page and click the “Fork” button, creating your own writable fork of the project. You then need to add this repository URL as a new remote of your local repository; in this example, let’s call it <code>myfork</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add myfork &lt;url&gt;</span><br></pre></td></tr></table></figure>
<p>You then need to push your new work to this repository. It’s easiest to push the topic branch you’re working on to your forked repository, rather than merging that work into your master branch and pushing that. The reason is that if your work isn’t accepted or is cherry-picked, you don’t have to rewind your master branch (the Git <code>cherry-pick</code> operation is covered in more detail in 【Rebasing and Cherry-Picking Workflows】). If the maintainers <code>merge</code>, <code>rebase</code>, or <code>cherry-pick</code> your work, you’ll eventually get it back via pulling from their repository anyhow.</p>
<p>In any event, you can push your work with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u myfork featureA</span><br></pre></td></tr></table></figure>
<p>Once your work has been pushed to your fork of the repository, you need to notify the maintainers of the original project that you have work you’d like them to merge. This is often called a <em>pull request</em>, and you typically generate such a request either via the website — GitHub has its own “Pull Request” mechanism that we’ll go over in 【GitHub】 — or you can run the <code>git request-pull</code> command and email the subsequent output to the project maintainer manually.</p>
<p>The <code>git request-pull</code> command takes the base branch into which you want your topic branch pulled and the Git repository URL you want them to pull from, and produces a summary of all the changes you’re asking to be pulled. For instance, if Jessica wants to send John a pull request, and she’s done two commits on the topic branch she just pushed, she can run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git request-pull origin/master myfork</span><br><span class="line">The following changes since commit 1edee6b1d61823a2de3b09c160d7080b8d1b3a40:</span><br><span class="line">Jessica Smith (1):</span><br><span class="line">        added a new <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">are available <span class="keyword">in</span> the git repository at:</span><br><span class="line"></span><br><span class="line">  git://githost/simplegit.git featureA</span><br><span class="line"></span><br><span class="line">Jessica Smith (2):</span><br><span class="line">      add <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br><span class="line">      change <span class="built_in">log</span> output to 30 from 25</span><br><span class="line"></span><br><span class="line"> lib/simplegit.rb |   10 +++++++++-</span><br><span class="line"> 1 files changed, 9 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>
<p>This output can be sent to the maintainer — it tells them where the work was branched from, summarizes the commits, and identifies from where the new work is to be pulled.</p>
<p>On a project for which you’re not the maintainer, it’s generally easier to have a branch like <code>master</code> always track <code>origin/master</code> and to do your work in topic branches that you can easily discard if they’re rejected. Having work themes isolated into topic branches also makes it easier for you to rebase your work if the tip of the main repository has moved in the meantime and your commits no longer apply cleanly. For example, if you want to submit a second topic of work to the project, don’t continue working on the topic branch you just pushed up — start over from the main repository’s <code>master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b featureB origin/master</span><br><span class="line">  ... work ...</span><br><span class="line">$ git commit</span><br><span class="line">$ git push myfork featureB</span><br><span class="line">$ git request-pull origin/master myfork</span><br><span class="line">  ... email generated request pull to maintainer ...</span><br><span class="line">$ git fetch origin</span><br></pre></td></tr></table></figure>
<p>Now, each of your topics is contained within a silo — similar to a patch queue — that you can rewrite, rebase, and modify without the topics interfering or interdepending on each other, like so:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj5gjgqj20m808274d.jpg" alt="Initial commit history with `featureB` work.">  Figure 17. Initial commit history with <code>featureB</code> work.  Let’s say the project maintainer has pulled in a bunch of other patches and tried your first branch, but it no longer cleanly merges. In this case, you can try to rebase that branch on top of <code>origin/master</code>, resolve the conflicts for the maintainer, and then resubmit your changes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout featureA</span><br><span class="line">$ git rebase origin/master</span><br><span class="line">$ git push -f myfork featureA</span><br></pre></td></tr></table></figure>
<p>This rewrites your history to now look like 【Commit history after <code>featureA</code> work.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcohsq57j20m806pq2y.jpg" alt="Commit history after `featureA` work.">  Figure 18. Commit history after <code>featureA</code> work.  Because you rebased the branch, you have to specify the <code>-f</code> to your push command in order to be able to replace the <code>featureA</code> branch on the server with a commit that isn’t a descendant of it. An alternative would be to push this new work to a different branch on the server (perhaps called <code>featureAv2</code>).</p>
<p>Let’s look at one more possible scenario: the maintainer has looked at work in your second branch and likes the concept but would like you to change an implementation detail. You’ll also take this opportunity to move the work to be based off the project’s current <code>master</code> branch. You start a new branch based off the current <code>origin/master</code> branch, squash the <code>featureB</code> changes there, resolve any conflicts, make the implementation change, and then push that as a new branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b featureBv2 origin/master</span><br><span class="line">$ git merge --squash featureB</span><br><span class="line">  ... change implementation ...</span><br><span class="line">$ git commit</span><br><span class="line">$ git push myfork featureBv2</span><br></pre></td></tr></table></figure>
<p>The <code>--squash</code> option takes all the work on the merged branch and squashes it into one changeset producing the repository state as if a real merge happened, without actually making a merge commit. This means your future commit will have one parent only and allows you to introduce all the changes from another branch and then make more changes before recording the new commit. Also the <code>--no-commit</code> option can be useful to delay the merge commit in case of the default merge process.</p>
<p>At this point, you can notify the maintainer that you’ve made the requested changes, and that they can find those changes in your <code>featureBv2</code> branch.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchxit2yj20m806pglo.jpg" alt="Commit history after `featureBv2` work.">  Figure 19. Commit history after <code>featureBv2</code> work.</p>
<h3 id="Public-Project-over-Email"><a href="#Public-Project-over-Email" class="headerlink" title="Public Project over Email"></a>Public Project over Email</h3><p>Many projects have established procedures for accepting patches — you’ll need to check the specific rules for each project, because they will differ. Since there are several older, larger projects which accept patches via a developer mailing list, we’ll go over an example of that now.</p>
<p>The workflow is similar to the previous use case — you create topic branches for each patch series you work on. The difference is how you submit them to the project. Instead of forking the project and pushing to your own writable version, you generate email versions of each commit series and email them to the developer mailing list:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b topicA</span><br><span class="line">  ... work ...</span><br><span class="line">$ git commit</span><br><span class="line">  ... work ...</span><br><span class="line">$ git commit</span><br></pre></td></tr></table></figure>
<p>Now you have two commits that you want to send to the mailing list. You use <code>git format-patch</code> to generate the mbox-formatted files that you can email to the list — it turns each commit into an email message with the first line of the commit message as the subject and the rest of the message plus the patch that the commit introduces as the body. The nice thing about this is that applying a patch from an email generated with <code>format-patch</code> preserves all the commit information properly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git format-patch -M origin/master</span><br><span class="line">0001-add-limit-to-log-function.patch</span><br><span class="line">0002-changed-log-output-to-30-from-25.patch</span><br></pre></td></tr></table></figure>
<p>The <code>format-patch</code> command prints out the names of the patch files it creates. The <code>-M</code> switch tells Git to look for renames. The files end up looking like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ cat 0001-add-limit-to-log-function.patch</span><br><span class="line">From 330090432754092d704da8e76ca5c05c198e71a8 Mon Sep 17 00:00:00 2001</span><br><span class="line">From: Jessica Smith &lt;jessica@example.com&gt;</span><br><span class="line">Date: Sun, 6 Apr 2008 10:17:23 -0700</span><br><span class="line">Subject: [PATCH 1/2] add <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">Limit <span class="built_in">log</span> functionality to the first 20</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"> lib/simplegit.rb |    2 +-</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br><span class="line"></span><br><span class="line">diff --git a/lib/simplegit.rb b/lib/simplegit.rb</span><br><span class="line">index 76f47bc..f9815f1 100644</span><br><span class="line">--- a/lib/simplegit.rb</span><br><span class="line">+++ b/lib/simplegit.rb</span><br><span class="line">@@ -14,7 +14,7 @@ class SimpleGit</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   def <span class="built_in">log</span>(treeish = <span class="string">'master'</span>)</span><br><span class="line">-    <span class="built_in">command</span>(<span class="string">"git log #&#123;treeish&#125;"</span>)</span><br><span class="line">+    <span class="built_in">command</span>(<span class="string">"git log -n 20 #&#123;treeish&#125;"</span>)</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   def ls_tree(treeish = <span class="string">'master'</span>)</span><br><span class="line">--</span><br><span class="line">2.1.0</span><br></pre></td></tr></table></figure>
<p>You can also edit these patch files to add more information for the email list that you don’t want to show up in the commit message. If you add text between the <code>---</code> line and the beginning of the patch (the <code>diff --git</code> line), the developers can read it, but that content is ignored by the patching process.</p>
<p>To email this to a mailing list, you can either paste the file into your email program or send it via a command-line program. Pasting the text often causes formatting issues, especially with “smarter” clients that don’t preserve newlines and other whitespace appropriately. Luckily, Git provides a tool to help you send properly formatted patches via IMAP, which may be easier for you. We’ll demonstrate how to send a patch via Gmail, which happens to be the email agent we know best; you can read detailed instructions for a number of mail programs at the end of the aforementioned <code>Documentation/SubmittingPatches</code> file in the Git source code.</p>
<p>First, you need to set up the imap section in your <code>~/.gitconfig</code> file. You can set each value separately with a series of <code>git config</code> commands, or you can add them manually, but in the end your config file should look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[imap]</span><br><span class="line">  folder = <span class="string">"[Gmail]/Drafts"</span></span><br><span class="line">  host = imaps://imap.gmail.com</span><br><span class="line">  user = user@gmail.com</span><br><span class="line">  pass = YX]8g76G_2^sFbd</span><br><span class="line">  port = 993</span><br><span class="line">  sslverify = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>If your IMAP server doesn’t use SSL, the last two lines probably aren’t necessary, and the host value will be <code>imap://</code> instead of <code>imaps://</code>. When that is set up, you can use <code>git imap-send</code> to place the patch series in the Drafts folder of the specified IMAP server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat *.patch |git imap-send</span><br><span class="line">Resolving imap.gmail.com... ok</span><br><span class="line">Connecting to [74.125.142.109]:993... ok</span><br><span class="line">Logging <span class="keyword">in</span>...</span><br><span class="line">sending 2 messages</span><br><span class="line">100% (2/2) <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>At this point, you should be able to go to your Drafts folder, change the To field to the mailing list you’re sending the patch to, possibly CC the maintainer or person responsible for that section, and send it off.</p>
<p>You can also send the patches through an SMTP server. As before, you can set each value separately with a series of <code>git config</code> commands, or you can add them manually in the sendemail section in your <code>~/.gitconfig</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[sendemail]</span><br><span class="line">  smtpencryption = tls</span><br><span class="line">  smtpserver = smtp.gmail.com</span><br><span class="line">  smtpuser = user@gmail.com</span><br><span class="line">  smtpserverport = 587</span><br></pre></td></tr></table></figure>
<p>After this is done, you can use <code>git send-email</code> to send your patches:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git send-email *.patch</span><br><span class="line">0001-added-limit-to-log-function.patch</span><br><span class="line">0002-changed-log-output-to-30-from-25.patch</span><br><span class="line">Who should the emails appear to be from? [Jessica Smith &lt;jessica@example.com&gt;]</span><br><span class="line">Emails will be sent from: Jessica Smith &lt;jessica@example.com&gt;</span><br><span class="line">Who should the emails be sent to? jessica@example.com</span><br><span class="line">Message-ID to be used as In-Reply-To <span class="keyword">for</span> the first email? y</span><br></pre></td></tr></table></figure>
<p>Then, Git spits out a bunch of log information looking something like this for each patch you’re sending:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(mbox) Adding cc: Jessica Smith &lt;jessica@example.com&gt; from</span><br><span class="line">  \line <span class="string">'From: Jessica Smith &lt;jessica@example.com&gt;'</span></span><br><span class="line">OK. Log says:</span><br><span class="line">Sendmail: /usr/sbin/sendmail -i jessica@example.com</span><br><span class="line">From: Jessica Smith &lt;jessica@example.com&gt;</span><br><span class="line">To: jessica@example.com</span><br><span class="line">Subject: [PATCH 1/2] added <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br><span class="line">Date: Sat, 30 May 2009 13:29:15 -0700</span><br><span class="line">Message-Id: &lt;1243715356-61726-1-git-send-email-jessica@example.com&gt;</span><br><span class="line">X-Mailer: git-send-email 1.6.2.rc1.20.g8c5b.dirty</span><br><span class="line">In-Reply-To: &lt;y&gt;</span><br><span class="line">References: &lt;y&gt;</span><br><span class="line"></span><br><span class="line">Result: OK</span><br></pre></td></tr></table></figure>
<h3 id="Summary-4"><a href="#Summary-4" class="headerlink" title="Summary"></a>Summary</h3><p>This section has covered a number of common workflows for dealing with several very different types of Git projects you’re likely to encounter, and introduced a couple of new tools to help you manage this process. Next, you’ll see how to work the other side of the coin: maintaining a Git project. You’ll learn how to be a benevolent dictator or integration manager.</p>
<h2 id="Maintaining-a-Project"><a href="#Maintaining-a-Project" class="headerlink" title="Maintaining a Project"></a>Maintaining a Project</h2><p>In addition to knowing how to effectively contribute to a project, you’ll likely need to know how to maintain one. This can consist of accepting and applying patches generated via <code>format-patch</code> and emailed to you, or integrating changes in remote branches for repositories you’ve added as remotes to your project. Whether you maintain a canonical repository or want to help by verifying or approving patches, you need to know how to accept work in a way that is clearest for other contributors and sustainable by you over the long run.</p>
<h3 id="Working-in-Topic-Branches"><a href="#Working-in-Topic-Branches" class="headerlink" title="Working in Topic Branches"></a>Working in Topic Branches</h3><p>When you’re thinking of integrating new work, it’s generally a good idea to try it out in a <em>topic branch</em> — a temporary branch specifically made to try out that new work. This way, it’s easy to tweak a patch individually and leave it if it’s not working until you have time to come back to it. If you create a simple branch name based on the theme of the work you’re going to try, such as <code>ruby_client</code> or something similarly descriptive, you can easily remember it if you have to abandon it for a while and come back later. The maintainer of the Git project tends to namespace these branches as well — such as <code>sc/ruby_client</code>, where <code>sc</code> is short for the person who contributed the work. As you’ll remember, you can create the branch based off your <code>master</code> branch like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch sc/ruby_client master</span><br></pre></td></tr></table></figure>
<p>Or, if you want to also switch to it immediately, you can use the <code>checkout -b</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b sc/ruby_client master</span><br></pre></td></tr></table></figure>
<p>Now you’re ready to add the contributed work that you received into this topic branch and determine if you want to merge it into your longer-term branches.</p>
<h3 id="Applying-Patches-from-Email"><a href="#Applying-Patches-from-Email" class="headerlink" title="Applying Patches from Email"></a>Applying Patches from Email</h3><p>If you receive a patch over email that you need to integrate into your project, you need to apply the patch in your topic branch to evaluate it. There are two ways to apply an emailed patch: with <code>git apply</code> or with <code>git am</code>.</p>
<h4 id="Applying-a-Patch-with-apply"><a href="#Applying-a-Patch-with-apply" class="headerlink" title="Applying a Patch with apply"></a>Applying a Patch with apply</h4><p>If you received the patch from someone who generated it with <code>git diff</code> or some variation of the Unix <code>diff</code> command (which is not recommended; see the next section), you can apply it with the <code>git apply</code> command. Assuming you saved the patch at <code>/tmp/patch-ruby-client.patch</code>, you can apply the patch like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git apply /tmp/patch-ruby-client.patch</span><br></pre></td></tr></table></figure>
<p>This modifies the files in your working directory. It’s almost identical to running a <code>patch -p1</code> command to apply the patch, although it’s more paranoid and accepts fewer fuzzy matches than patch. It also handles file adds, deletes, and renames if they’re described in the <code>git diff</code> format, which <code>patch</code> won’t do. Finally, <code>git apply</code> is an “apply all or abort all” model where either everything is applied or nothing is, whereas <code>patch</code> can partially apply patchfiles, leaving your working directory in a weird state. <code>git apply</code> is overall much more conservative than <code>patch</code>. It won’t create a commit for you — after running it, you must stage and commit the changes introduced manually.</p>
<p>You can also use <code>git apply</code> to see if a patch applies cleanly before you try actually applying it — you can run <code>git apply --check</code> with the patch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git apply --check 0001-seeing-if-this-helps-the-gem.patch</span><br><span class="line">error: patch failed: ticgit.gemspec:1</span><br><span class="line">error: ticgit.gemspec: patch does not apply</span><br></pre></td></tr></table></figure>
<p>If there is no output, then the patch should apply cleanly. This command also exits with a non-zero status if the check fails, so you can use it in scripts if you want.</p>
<h4 id="Applying-a-Patch-with-am"><a href="#Applying-a-Patch-with-am" class="headerlink" title="Applying a Patch with am"></a>Applying a Patch with <code>am</code></h4><p>If the contributor is a Git user and was good enough to use the <code>format-patch</code> command to generate their patch, then your job is easier because the patch contains author information and a commit message for you. If you can, encourage your contributors to use <code>format-patch</code> instead of <code>diff</code> to generate patches for you. You should only have to use <code>git apply</code> for legacy patches and things like that.</p>
<p>To apply a patch generated by <code>format-patch</code>, you use <code>git am</code> (the command is named <code>am</code> as it is used to “apply a series of patches from a mailbox”). Technically, <code>git am</code> is built to read an mbox file, which is a simple, plain-text format for storing one or more email messages in one text file. It looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">From 330090432754092d704da8e76ca5c05c198e71a8 Mon Sep 17 00:00:00 2001</span><br><span class="line">From: Jessica Smith &lt;jessica@example.com&gt;</span><br><span class="line">Date: Sun, 6 Apr 2008 10:17:23 -0700</span><br><span class="line">Subject: [PATCH 1/2] add <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">Limit <span class="built_in">log</span> functionality to the first 20</span><br></pre></td></tr></table></figure>
<p>This is the beginning of the output of the <code>git format-patch</code> command that you saw in the previous section; it also represents a valid mbox email format. If someone has emailed you the patch properly using <code>git send-email</code>, and you download that into an mbox format, then you can point <code>git am</code> to that mbox file, and it will start applying all the patches it sees. If you run a mail client that can save several emails out in mbox format, you can save entire patch series into a file and then use <code>git am</code> to apply them one at a time.</p>
<p>However, if someone uploaded a patch file generated via <code>git format-patch</code> to a ticketing system or something similar, you can save the file locally and then pass that file saved on your disk to <code>git am</code> to apply it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git am 0001-limit-log-function.patch</span><br><span class="line">Applying: add <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br></pre></td></tr></table></figure>
<p>You can see that it applied cleanly and automatically created the new commit for you. The author information is taken from the email’s <code>From</code> and <code>Date</code> headers, and the message of the commit is taken from the <code>Subject</code> and body (before the patch) of the email. For example, if this patch was applied from the mbox example above, the commit generated would look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=fuller -1</span><br><span class="line">commit 6c5e70b984a60b3cecd395edd5b48a7575bf58e0</span><br><span class="line">Author:     Jessica Smith &lt;jessica@example.com&gt;</span><br><span class="line">AuthorDate: Sun Apr 6 10:17:23 2008 -0700</span><br><span class="line">Commit:     Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">CommitDate: Thu Apr 9 09:19:06 2009 -0700</span><br><span class="line"></span><br><span class="line">   add <span class="built_in">limit</span> to <span class="built_in">log</span> <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line">   Limit <span class="built_in">log</span> functionality to the first 20</span><br></pre></td></tr></table></figure>
<p>The <code>Commit</code> information indicates the person who applied the patch and the time it was applied. The <code>Author</code> information is the individual who originally created the patch and when it was originally created.</p>
<p>But it’s possible that the patch won’t apply cleanly. Perhaps your main branch has diverged too far from the branch the patch was built from, or the patch depends on another patch you haven’t applied yet. In that case, the <code>git am</code> process will fail and ask you what you want to do:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git am 0001-seeing-if-this-helps-the-gem.patch</span><br><span class="line">Applying: seeing <span class="keyword">if</span> this helps the gem</span><br><span class="line">error: patch failed: ticgit.gemspec:1</span><br><span class="line">error: ticgit.gemspec: patch does not apply</span><br><span class="line">Patch failed at 0001.</span><br><span class="line">When you have resolved this problem run <span class="string">"git am --resolved"</span>.</span><br><span class="line">If you would prefer to skip this patch, instead run <span class="string">"git am --skip"</span>.</span><br><span class="line">To restore the original branch and stop patching run <span class="string">"git am --abort"</span>.</span><br></pre></td></tr></table></figure>
<p>This command puts conflict markers in any files it has issues with, much like a conflicted merge or rebase operation. You solve this issue much the same way — edit the file to resolve the conflict, stage the new file, and then run <code>git am --resolved</code> to continue to the next patch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ (fix the file)</span><br><span class="line">$ git add ticgit.gemspec</span><br><span class="line">$ git am --resolved</span><br><span class="line">Applying: seeing <span class="keyword">if</span> this helps the gem</span><br></pre></td></tr></table></figure>
<p>If you want Git to try a bit more intelligently to resolve the conflict, you can pass a <code>-3</code> option to it, which makes Git attempt a three-way merge. This option isn’t on by default because it doesn’t work if the commit the patch says it was based on isn’t in your repository. If you do have that commit — if the patch was based on a public commit — then the <code>-3</code> option is generally much smarter about applying a conflicting patch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git am -3 0001-seeing-if-this-helps-the-gem.patch</span><br><span class="line">Applying: seeing <span class="keyword">if</span> this helps the gem</span><br><span class="line">error: patch failed: ticgit.gemspec:1</span><br><span class="line">error: ticgit.gemspec: patch does not apply</span><br><span class="line">Using index info to reconstruct a base tree...</span><br><span class="line">Falling back to patching base and 3-way merge...</span><br><span class="line">No changes -- Patch already applied.</span><br></pre></td></tr></table></figure>
<p>In this case, without the <code>-3</code> option the patch would have been considered as a conflict. Since the <code>-3</code> option was used the patch applied cleanly.</p>
<p>If you’re applying a number of patches from an mbox, you can also run the <code>am</code> command in interactive mode, which stops at each patch it finds and asks if you want to apply it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git am -3 -i mbox</span><br><span class="line">Commit Body is:</span><br><span class="line">--------------------------</span><br><span class="line">seeing <span class="keyword">if</span> this helps the gem</span><br><span class="line">--------------------------</span><br><span class="line">Apply? [y]es/[n]o/[e]dit/[v]iew patch/[a]ccept all</span><br></pre></td></tr></table></figure>
<p>This is nice if you have a number of patches saved, because you can view the patch first if you don’t remember what it is, or not apply the patch if you’ve already done so.</p>
<p>When all the patches for your topic are applied and committed into your branch, you can choose whether and how to integrate them into a longer-running branch.</p>
<h3 id="Checking-Out-Remote-Branches"><a href="#Checking-Out-Remote-Branches" class="headerlink" title="Checking Out Remote Branches"></a>Checking Out Remote Branches</h3><p>If your contribution came from a Git user who set up their own repository, pushed a number of changes into it, and then sent you the URL to the repository and the name of the remote branch the changes are in, you can add them as a remote and do merges locally.</p>
<p>For instance, if Jessica sends you an email saying that she has a great new feature in the <code>ruby-client</code> branch of her repository, you can test it by adding the remote and checking out that branch locally:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add jessica git://github.com/jessica/myproject.git</span><br><span class="line">$ git fetch jessica</span><br><span class="line">$ git checkout -b rubyclient jessica/ruby-client</span><br></pre></td></tr></table></figure>
<p>If she emails you again later with another branch containing another great feature, you could directly <code>fetch</code> and <code>checkout</code> because you already have the remote setup.</p>
<p>This is most useful if you’re working with a person consistently. If someone only has a single patch to contribute once in a while, then accepting it over email may be less time consuming than requiring everyone to run their own server and having to continually add and remove remotes to get a few patches. You’re also unlikely to want to have hundreds of remotes, each for someone who contributes only a patch or two. However, scripts and hosted services may make this easier — it depends largely on how you develop and how your contributors develop.</p>
<p>The other advantage of this approach is that you get the history of the commits as well. Although you may have legitimate merge issues, you know where in your history their work is based; a proper three-way merge is the default rather than having to supply a <code>-3</code> and hope the patch was generated off a public commit to which you have access.</p>
<p>If you aren’t working with a person consistently but still want to pull from them in this way, you can provide the URL of the remote repository to the <code>git pull</code> command. This does a one-time pull and doesn’t save the URL as a remote reference:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git pull [https://github.com/onetimeguy/project](https://github.com/onetimeguy/project)</span><br><span class="line">From [https://github.com/onetimeguy/project](https://github.com/onetimeguy/project)</span><br><span class="line"> * branch            HEAD       -&gt; FETCH_HEAD</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br></pre></td></tr></table></figure>
<h3 id="Determining-What-Is-Introduced"><a href="#Determining-What-Is-Introduced" class="headerlink" title="Determining What Is Introduced"></a>Determining What Is Introduced</h3><p>Now you have a topic branch that contains contributed work. At this point, you can determine what you’d like to do with it. This section revisits a couple of commands so you can see how you can use them to review exactly what you’ll be introducing if you merge this into your main branch.</p>
<p>It’s often helpful to get a review of all the commits that are in this branch but that aren’t in your master branch. You can exclude commits in the master branch by adding the <code>--not</code> option before the branch name. This does the same thing as the <code>master..contrib</code> format that we used earlier. For example, if your contributor sends you two patches and you create a branch called <code>contrib</code> and applied those patches there, you can run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> contrib --not master</span><br><span class="line">commit 5b6235bd297351589efc4d73316f0a68d484f118</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri Oct 24 09:53:59 2008 -0700</span><br><span class="line"></span><br><span class="line">    seeing <span class="keyword">if</span> this helps the gem</span><br><span class="line"></span><br><span class="line">commit 7482e0d16d04bea79d0dba8988cc78df655f16a0</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Mon Oct 22 19:38:36 2008 -0700</span><br><span class="line"></span><br><span class="line">    updated the gemspec to hopefully work better</span><br></pre></td></tr></table></figure>
<p>To see what changes each commit introduces, remember that you can pass the <code>-p</code> option to <code>git log</code> and it will append the diff introduced to each commit.</p>
<p>To see a full diff of what would happen if you were to merge this topic branch with another branch, you may have to use a weird trick to get the correct results. You may think to run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff master</span><br></pre></td></tr></table></figure>
<p>This command gives you a diff, but it may be misleading. If your <code>master</code> branch has moved forward since you created the topic branch from it, then you’ll get seemingly strange results. This happens because Git directly compares the snapshots of the last commit of the topic branch you’re on and the snapshot of the last commit on the <code>master</code> branch. For example, if you’ve added a line in a file on the <code>master</code> branch, a direct comparison of the snapshots will look like the topic branch is going to remove that line.</p>
<p>If <code>master</code> is a direct ancestor of your topic branch, this isn’t a problem; but if the two histories have diverged, the diff will look like you’re adding all the new stuff in your topic branch and removing everything unique to the <code>master</code> branch.</p>
<p>What you really want to see are the changes added to the topic branch — the work you’ll introduce if you merge this branch with master. You do that by having Git compare the last commit on your topic branch with the first common ancestor it has with the master branch.</p>
<p>Technically, you can do that by explicitly figuring out the common ancestor and then running your diff on it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git merge-base contrib master</span><br><span class="line">36c7dba2c95e6bbb78dfa822519ecfec6e1ca649</span><br><span class="line">$ git diff 36c7db</span><br></pre></td></tr></table></figure>
<p>or, more concisely:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff $(git merge-base contrib master)</span><br></pre></td></tr></table></figure>
<p>However, neither of those is particularly convenient, so Git provides another shorthand for doing the same thing: the triple-dot syntax. In the context of the <code>git diff</code> command, you can put three periods after another branch to do a <code>diff</code> between the last commit of the branch you’re on and its common ancestor with another branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff master...contrib</span><br></pre></td></tr></table></figure>
<p>This command shows you only the work your current topic branch has introduced since its common ancestor with master. That is a very useful syntax to remember.</p>
<h3 id="Integrating-Contributed-Work"><a href="#Integrating-Contributed-Work" class="headerlink" title="Integrating Contributed Work"></a>Integrating Contributed Work</h3><p>When all the work in your topic branch is ready to be integrated into a more mainline branch, the question is how to do it. Furthermore, what overall workflow do you want to use to maintain your project? You have a number of choices, so we’ll cover a few of them.</p>
<h4 id="Merging-Workflows"><a href="#Merging-Workflows" class="headerlink" title="Merging Workflows"></a>Merging Workflows</h4><p>One basic workflow is to simply merge all that work directly into your <code>master</code> branch. In this scenario, you have a <code>master</code> branch that contains basically stable code. When you have work in a topic branch that you think you’ve completed, or work that someone else has contributed and you’ve verified, you merge it into your master branch, delete that just-merged topic branch, and repeat.</p>
<p>For instance, if we have a repository with work in two branches named <code>ruby_client</code> and <code>php_client</code> that looks like 【History with several topic branches.】, and we merge <code>ruby_client</code> followed by <code>php_client</code>, your history will end up looking like 【After a topic branch merge.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckobjnej20m808gjre.jpg" alt="History with several topic branches.">  Figure 20. History with several topic branches.    <img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjhuas1j20m808laa3.jpg" alt="After a topic branch merge.">  Figure 21. After a topic branch merge.  That is probably the simplest workflow, but it can possibly be problematic if you’re dealing with larger or more stable projects where you want to be really careful about what you introduce.</p>
<p>If you have a more important project, you might want to use a two-phase merge cycle. In this scenario, you have two long-running branches, <code>master</code> and <code>develop</code>, in which you determine that <code>master</code> is updated only when a very stable release is cut and all new code is integrated into the <code>develop</code> branch. You regularly push both of these branches to the public repository. Each time you have a new topic branch to merge in (【Before a topic branch merge.】), you merge it into <code>develop</code> (【After a topic branch merge.】); then, when you tag a release, you fast-forward <code>master</code> to wherever the now-stable <code>develop</code> branch is (【After a project release.】).</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnlv0lrj20m80ajmx6.jpg" alt="Before a topic branch merge.">  Figure 22. Before a topic branch merge.    <img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnon8zvj20m808gdft.jpg" alt="After a topic branch merge.">  Figure 23. After a topic branch merge.    <img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciivn02j20m807tq2w.jpg" alt="After a topic branch release.">  Figure 24. After a project release.  This way, when people clone your project’s repository, they can either check out <code>master</code> to build the latest stable version and keep up to date on that easily, or they can check out <code>develop</code>, which is the more cutting-edge content. You can also extend this concept by having an <code>integrate</code> branch where all the work is merged together. Then, when the codebase on that branch is stable and passes tests, you merge it into a <code>develop</code> branch; and when that has proven itself stable for a while, you fast-forward your <code>master</code> branch.</p>
<h4 id="Large-Merging-Workflows"><a href="#Large-Merging-Workflows" class="headerlink" title="Large-Merging Workflows"></a>Large-Merging Workflows</h4><p>The Git project has four long-running branches: <code>master</code>, <code>next</code>, and <code>pu</code> (proposed updates) for new work, and <code>maint</code> for maintenance backports. When new work is introduced by contributors, it’s collected into topic branches in the maintainer’s repository in a manner similar to what we’ve described (see 【Managing a complex series of parallel contributed topic branches.】). At this point, the topics are evaluated to determine whether they’re safe and ready for consumption or whether they need more work. If they’re safe, they’re merged into <code>next</code>, and that branch is pushed up so everyone can try the topics integrated together.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjtymauj20m80d2t91.jpg" alt="Managing a complex series of parallel contributed topic branches.">  Figure 25. Managing a complex series of parallel contributed topic branches.  If the topics still need work, they’re merged into <code>pu</code> instead. When it’s determined that they’re totally stable, the topics are re-merged into <code>master</code>. The <code>next</code> and <code>pu</code> branches are then rebuilt from the <code>master</code>. This means <code>master</code> almost always moves forward, <code>next</code> is rebased occasionally, and <code>pu</code> is rebased even more often:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcleb8btj20m80ctq3c.jpg" alt="Merging contributed topic branches into long-term integration branches.">  Figure 26. Merging contributed topic branches into long-term integration branches.  When a topic branch has finally been merged into <code>master</code>, it’s removed from the repository. The Git project also has a <code>maint</code> branch that is forked off from the last release to provide backported patches in case a maintenance release is required. Thus, when you clone the Git repository, you have four branches that you can check out to evaluate the project in different stages of development, depending on how cutting edge you want to be or how you want to contribute; and the maintainer has a structured workflow to help them vet new contributions. The Git project’s workflow is specialized. To clearly understand this you could check out the <a href="https://github.com/git/git/blob/master/Documentation/howto/maintain-git.txt" target="_blank" rel="noopener">Git Maintainer’s guide</a>.</p>
<h4 id="Rebasing-and-Cherry-Picking-Workflows"><a href="#Rebasing-and-Cherry-Picking-Workflows" class="headerlink" title="Rebasing and Cherry-Picking Workflows"></a>Rebasing and Cherry-Picking Workflows</h4><p>Other maintainers prefer to rebase or cherry-pick contributed work on top of their master branch, rather than merging it in, to keep a mostly linear history. When you have work in a topic branch and have determined that you want to integrate it, you move to that branch and run the rebase command to rebuild the changes on top of your current master (or <code>develop</code>, and so on) branch. If that works well, you can fast-forward your <code>master</code> branch, and you’ll end up with a linear project history.</p>
<p>The other way to move introduced work from one branch to another is to cherry-pick it. A cherry-pick in Git is like a rebase for a single commit. It takes the patch that was introduced in a commit and tries to reapply it on the branch you’re currently on. This is useful if you have a number of commits on a topic branch and you want to integrate only one of them, or if you only have one commit on a topic branch and you’d prefer to cherry-pick it rather than run rebase. For example, suppose you have a project that looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclnfrgdj20m80ajq2z.jpg" alt="Example history before a cherry-pick.">  Figure 27. Example history before a cherry-pick.  If you want to pull commit <code>e43a6</code> into your master branch, you can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cherry-pick e43a6</span><br><span class="line">Finished one cherry-pick.</span><br><span class="line">[master]: created a0a41a9: <span class="string">"More friendly message when locking the index fails."</span></span><br><span class="line"> 3 files changed, 17 insertions(+), 3 deletions(-)</span><br></pre></td></tr></table></figure>
<p>This pulls the same change introduced in <code>e43a6</code>, but you get a new commit SHA-1 value, because the date applied is different. Now your history looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco155qwj20m80ajaa4.jpg" alt="History after cherry-picking a commit on a topic branch.">  Figure 28. History after cherry-picking a commit on a topic branch.  Now you can remove your topic branch and drop the commits you didn’t want to pull in.</p>
<h4 id="Rerere"><a href="#Rerere" class="headerlink" title="Rerere"></a>Rerere</h4><p>If you’re doing lots of merging and rebasing, or you’re maintaining a long-lived topic branch, Git has a feature called “rerere” that can help.</p>
<p>Rerere stands for “reuse recorded resolution” — it’s a way of shortcutting manual conflict resolution. When rerere is enabled, Git will keep a set of pre- and post-images from successful merges, and if it notices that there’s a conflict that looks exactly like one you’ve already fixed, it’ll just use the fix from last time, without bothering you with it.</p>
<p>This feature comes in two parts: a configuration setting and a command. The configuration setting is <code>rerere.enabled</code>, and it’s handy enough to put in your global config:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global rerere.enabled <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Now, whenever you do a merge that resolves conflicts, the resolution will be recorded in the cache in case you need it in the future.</p>
<p>If you need to, you can interact with the rerere cache using the <code>git rerere</code> command. When it’s invoked alone, Git checks its database of resolutions and tries to find a match with any current merge conflicts and resolve them (although this is done automatically if <code>rerere.enabled</code> is set to <code>true</code>). There are also subcommands to see what will be recorded, to erase specific resolution from the cache, and to clear the entire cache. We will cover rerere in more detail in 【Rerere】.</p>
<h3 id="Tagging-Your-Releases"><a href="#Tagging-Your-Releases" class="headerlink" title="Tagging Your Releases"></a>Tagging Your Releases</h3><p>When you’ve decided to cut a release, you’ll probably want to assign a tag so you can re-create that release at any point going forward. You can create a new tag as discussed in 【Git Basics】. If you decide to sign the tag as the maintainer, the tagging may look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -s v1.5 -m <span class="string">'my signed 1.5 tag'</span></span><br><span class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></span><br><span class="line">user: <span class="string">"Scott Chacon &lt;schacon@gmail.com&gt;"</span></span><br><span class="line">1024-bit DSA key, ID F721C45A, created 2009-02-09</span><br></pre></td></tr></table></figure>
<p>If you do sign your tags, you may have the problem of distributing the public PGP key used to sign your tags. The maintainer of the Git project has solved this issue by including their public key as a blob in the repository and then adding a tag that points directly to that content. To do this, you can figure out which key you want by running <code>gpg --list-keys</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --list-keys</span><br><span class="line">/Users/schacon/.gnupg/pubring.gpg</span><br><span class="line">---------------------------------</span><br><span class="line">pub   1024D/F721C45A 2009-02-09 [expires: 2010-02-09]</span><br><span class="line">uid                  Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">sub   2048g/45D02282 2009-02-09 [expires: 2010-02-09]</span><br></pre></td></tr></table></figure>
<p>Then, you can directly import the key into the Git database by exporting it and piping that through <code>git hash-object</code>, which writes a new blob with those contents into Git and gives you back the SHA-1 of the blob:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gpg -a --<span class="built_in">export</span> F721C45A | git <span class="built_in">hash</span>-object -w --stdin</span><br><span class="line">659ef797d181633c87ec71ac3f9ba29fe5775b92</span><br></pre></td></tr></table></figure>
<p>Now that you have the contents of your key in Git, you can create a tag that points directly to it by specifying the new SHA-1 value that the <code>hash-object</code> command gave you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a maintainer-pgp-pub 659ef797d181633c87ec71ac3f9ba29fe5775b92</span><br></pre></td></tr></table></figure>
<p>If you run <code>git push --tags</code>, the <code>maintainer-pgp-pub</code> tag will be shared with everyone. If anyone wants to verify a tag, they can directly import your PGP key by pulling the blob directly out of the database and importing it into GPG:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git show maintainer-pgp-pub | gpg --import</span><br></pre></td></tr></table></figure>
<p>They can use that key to verify all your signed tags. Also, if you include instructions in the tag message, running <code>git show &lt;tag&gt;</code> will let you give the end user more specific instructions about tag verification.</p>
<h3 id="Generating-a-Build-Number"><a href="#Generating-a-Build-Number" class="headerlink" title="Generating a Build Number"></a>Generating a Build Number</h3><p>Because Git doesn’t have monotonically increasing numbers like <em>v123</em> or the equivalent to go with each commit, if you want to have a human-readable name to go with a commit, you can run <code>git describe</code> on that commit. Git gives you the name of the nearest tag with the number of commits on top of that tag and a partial SHA-1 value of the commit you’re describing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git describe master</span><br><span class="line">v1.6.2-rc1-20-g8c5b85c</span><br></pre></td></tr></table></figure>
<p>This way, you can export a snapshot or build and name it something understandable to people. In fact, if you build Git from source code cloned from the Git repository, <code>git --version</code> gives you something that looks like this. If you’re describing a commit that you have directly tagged, it gives you the tag name.</p>
<p>The <code>git describe</code> command favors annotated tags (tags created with the <code>-a</code> or <code>-s</code> flag), so release tags should be created this way if you’re using <code>git describe</code>, to ensure the commit is named properly when described. You can also use this string as the target of a checkout or show command, although it relies on the abbreviated SHA-1 value at the end, so it may not be valid forever. For instance, the Linux kernel recently jumped from 8 to 10 characters to ensure SHA-1 object uniqueness, so older <code>git describe</code> output names were invalidated.</p>
<h3 id="Preparing-a-Release"><a href="#Preparing-a-Release" class="headerlink" title="Preparing a Release"></a>Preparing a Release</h3><p>Now you want to release a build. One of the things you’ll want to do is create an archive of the latest snapshot of your code for those poor souls who don’t use Git. The command to do this is <code>git archive</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git archive master --prefix=<span class="string">'project/'</span> | gzip &gt; `git describe master`.tar.gz</span><br><span class="line">$ ls *.tar.gz</span><br><span class="line">v1.6.2-rc1-20-g8c5b85c.tar.gz</span><br></pre></td></tr></table></figure>
<p>If someone opens that tarball, they get the latest snapshot of your project under a project directory. You can also create a zip archive in much the same way, but by passing the <code>--format=zip</code> option to <code>git archive</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git archive master --prefix=<span class="string">'project/'</span> --format=zip &gt; `git describe master`.zip</span><br></pre></td></tr></table></figure>
<p>You now have a nice tarball and a zip archive of your project release that you can upload to your website or email to people.</p>
<h3 id="The-Shortlog"><a href="#The-Shortlog" class="headerlink" title="The Shortlog"></a>The Shortlog</h3><p>It’s time to email your mailing list of people who want to know what’s happening in your project. A nice way of quickly getting a sort of changelog of what has been added to your project since your last release or email is to use the <code>git shortlog</code> command. It summarizes all the commits in the range you give it; for example, the following gives you a summary of all the commits since your last release, if your last release was named v1.0.1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git shortlog --no-merges master --not v1.0.1</span><br><span class="line">Chris Wanstrath (8):</span><br><span class="line">      Add support <span class="keyword">for</span> annotated tags to Grit::Tag</span><br><span class="line">      Add packed-refs annotated tag support.</span><br><span class="line">      Add Grit::Commit<span class="comment">#to_patch</span></span><br><span class="line">      Update version and History.txt</span><br><span class="line">      Remove stray `puts`</span><br><span class="line">      Make ls_tree ignore nils</span><br><span class="line"></span><br><span class="line">Tom Preston-Werner (4):</span><br><span class="line">      fix dates <span class="keyword">in</span> <span class="built_in">history</span></span><br><span class="line">      dynamic version method</span><br><span class="line">      Version bump to 1.0.2</span><br><span class="line">      Regenerated gemspec <span class="keyword">for</span> version 1.0.2</span><br></pre></td></tr></table></figure>
<p>You get a clean summary of all the commits since v1.0.1, grouped by author, that you can email to your list.</p>
<h2 id="Summary-5"><a href="#Summary-5" class="headerlink" title="Summary"></a>Summary</h2><p>You should feel fairly comfortable contributing to a project in Git as well as maintaining your own project or integrating other users’ contributions. Congratulations on being an effective Git developer! In the next chapter, you’ll learn about how to use the largest and most popular Git hosting service, GitHub.</p>
<h1 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a><strong>GitHub</strong></h1><p>GitHub is the single largest host for Git repositories, and is the central point of collaboration for millions of developers and projects. A large percentage of all Git repositories are hosted on GitHub, and many open-source projects use it for Git hosting, issue tracking, code review, and other things. So while it’s not a direct part of the Git open source project, there’s a good chance that you’ll want or need to interact with GitHub at some point while using Git professionally.</p>
<p>This chapter is about using GitHub effectively. We’ll cover signing up for and managing an account, creating and using Git repositories, common workflows to contribute to projects and to accept contributions to yours, GitHub’s programmatic interface and lots of little tips to make your life easier in general.</p>
<p>If you are not interested in using GitHub to host your own projects or to collaborate with other projects that are hosted on GitHub, you can safely skip to 【Git Tools】.</p>
<h2 id="Interfaces-Change"><a href="#Interfaces-Change" class="headerlink" title="Interfaces Change"></a>Interfaces Change</h2><p>It’s important to note that like many active websites, the UI elements in these screenshots are bound to change over time. Hopefully the general idea of what we’re trying to accomplish here will still be there, but if you want more up to date versions of these screens, the online versions of this book may have newer screenshots.</p>
<h2 id="Account-Setup-and-Configuration"><a href="#Account-Setup-and-Configuration" class="headerlink" title="Account Setup and Configuration"></a>Account Setup and Configuration</h2><p>The first thing you need to do is set up a free user account. Simply visit &lt;<a href="https://github.com" target="_blank" rel="noopener">https://github.com</a>&gt;, choose a user name that isn’t already taken, provide an email address and a password, and click the big green “Sign up for GitHub” button.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcia1xquj20lo0fuaak.jpg" alt="The GitHub sign-up form.">  Figure 1. The GitHub sign-up form.  The next thing you’ll see is the pricing page for upgraded plans, but it’s safe to ignore this for now. GitHub will send you an email to verify the address you provided. Go ahead and do this; it’s pretty important (as we’ll see later).</p>
<p>GitHub provides all of its functionality with free accounts, with the limitation that all of your projects are fully public (everyone has read access). GitHub’s paid plans also include the option of creating private projects, but we won’t be covering those in this book.</p>
<p>Clicking the Octocat logo at the top-left of the screen will take you to your dashboard page. You’re now ready to use GitHub.</p>
<h3 id="SSH-Access-1"><a href="#SSH-Access-1" class="headerlink" title="SSH Access"></a>SSH Access</h3><p>As of right now, you’re fully able to connect with Git repositories using the <code>https://</code> protocol, authenticating with the username and password you just set up. However, to simply clone public projects, you don’t even need to sign up - the account we just created comes into play when we fork projects and push to our forks a bit later.</p>
<p>If you’d like to use SSH remotes, you’ll need to configure a public key. (If you don’t already have one, see 【Generating Your SSH Public Key】.) Open up your account settings using the link at the top-right of the window:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnxteimj20m805i3yi.jpg" alt="The ``Account settings&#39;&#39; link.">  Figure 2. The “Account settings” link.  Then select the “SSH keys” section along the left-hand side.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmxifjqj20m80daq34.jpg" alt="The ``SSH keys&#39;&#39; link.">  Figure 3. The “SSH keys” link.  From there, click the “<code>Add an SSH key</code>“ button, give your key a name, paste the contents of your <code>~/.ssh/id_rsa.pub</code> (or whatever you named it) public-key file into the text area, and click “Add key”.</p>
<p>Be sure to name your SSH key something you can remember. You can name each of your keys (e.g. “My Laptop” or “Work Account”) so that if you need to revoke a key later, you can easily tell which one you’re looking for.</p>
<h3 id="Your-Avatar"><a href="#Your-Avatar" class="headerlink" title="Your Avatar"></a>Your Avatar</h3><p>Next, if you wish, you can replace the avatar that is generated for you with an image of your choosing. First go to the “Profile” tab (above the SSH Keys tab) and click “Upload new picture”.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcllaspbj20m80daq33.jpg" alt="The ``Profile&#39;&#39; link.">  Figure 4. The “Profile” link.  We’ll choose a copy of the Git logo that is on our hard drive and then we get a chance to crop it.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnyy9w8j20m80d9jrl.jpg" alt="Crop your uploaded avatar.">  Figure 5. Crop your avatar  Now anywhere you interact on the site, people will see your avatar next to your username.</p>
<p>If you happen to have uploaded an avatar to the popular Gravatar service (often used for Wordpress accounts), that avatar will be used by default and you don’t need to do this step.</p>
<h3 id="Your-Email-Addresses"><a href="#Your-Email-Addresses" class="headerlink" title="Your Email Addresses"></a>Your Email Addresses</h3><p>The way that GitHub maps your Git commits to your user is by email address. If you use multiple email addresses in your commits and you want GitHub to link them up properly, you need to add all the email addresses you have used to the Emails section of the admin section.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclpolngj20m809amxn.jpg" alt="Add all your email addresses.">  Figure 6. Add email addresses  In 【Add email addresses】 we can see some of the different states that are possible. The top address is verified and set as the primary address, meaning that is where you’ll get any notifications and receipts. The second address is verified and so can be set as the primary if you wish to switch them. The final address is unverified, meaning that you can’t make it your primary address. If GitHub sees any of these in commit messages in any repository on the site, it will be linked to your user now.</p>
<h3 id="Two-Factor-Authentication"><a href="#Two-Factor-Authentication" class="headerlink" title="Two Factor Authentication"></a>Two Factor Authentication</h3><p>Finally, for extra security, you should definitely set up Two-factor Authentication or “2FA”. Two-factor Authentication is an authentication mechanism that is becoming more and more popular recently to mitigate the risk of your account being compromised if your password is stolen somehow. Turning it on will make GitHub ask you for two different methods of authentication, so that if one of them is compromised, an attacker will not be able to access your account.</p>
<p>You can find the Two-factor Authentication setup under the Security tab of your Account settings.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclu6sl8j20m80byq3c.jpg" alt="2FA in the Security Tab">  Figure 7. 2FA in the Security Tab  If you click on the “Set up two-factor authentication” button, it will take you to a configuration page where you can choose to use a phone app to generate your secondary code (a “time based one-time password”), or you can have GitHub send you a code via SMS each time you need to log in.</p>
<p>After you choose which method you prefer and follow the instructions for setting up 2FA, your account will then be a little more secure and you will have to provide a code in addition to your password whenever you log into GitHub.</p>
<h2 id="Contributing-to-a-Project-1"><a href="#Contributing-to-a-Project-1" class="headerlink" title="Contributing to a Project"></a>Contributing to a Project</h2><p>Now that our account is set up, let’s walk through some details that could be useful in helping you contribute to an existing project.</p>
<h3 id="Forking-Projects"><a href="#Forking-Projects" class="headerlink" title="Forking Projects"></a>Forking Projects</h3><p>If you want to contribute to an existing project to which you don’t have push access, you can “fork” the project. When you “fork” a project, GitHub will make a copy of the project that is entirely yours; it lives in your namespace, and you can push to it.</p>
<p>Historically, the term “fork” has been somewhat negative in context, meaning that someone took an open source project in a different direction, sometimes creating a competing project and splitting the contributors. In GitHub, a “fork” is simply the same project in your own namespace, allowing you to make changes to a project publicly as a way to contribute in a more open manner.</p>
<p>This way, projects don’t have to worry about adding users as collaborators to give them push access. People can fork a project, push to it, and contribute their changes back to the original repository by creating what’s called a Pull Request, which we’ll cover next. This opens up a discussion thread with code review, and the owner and the contributor can then communicate about the change until the owner is happy with it, at which point the owner can merge it in.</p>
<p>To fork a project, visit the project page and click the “Fork” button at the top-right of the page.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclswszyj203s01g0si.jpg" alt="The ``Fork&#39;&#39; button.">  Figure 8. The “Fork” button.  After a few seconds, you’ll be taken to your new project page, with your own writeable copy of the code.</p>
<h3 id="The-GitHub-Flow"><a href="#The-GitHub-Flow" class="headerlink" title="The GitHub Flow"></a>The GitHub Flow</h3><p>GitHub is designed around a particular collaboration workflow, centered on Pull Requests. This flow works whether you’re collaborating with a tightly-knit team in a single shared repository, or a globally-distributed company or network of strangers contributing to a project through dozens of forks. It is centered on the 【Topic Branches】 workflow covered in 【Git Branching】.</p>
<p>Here’s how it generally works:</p>
<ol start="2">
<li>Fork the project</li>
<li>Create a topic branch from <code>master</code>.</li>
<li>Make some commits to improve the project.</li>
<li>Push this branch to your GitHub project.</li>
<li>Open a Pull Request on GitHub.</li>
<li>Discuss, and optionally continue committing.</li>
<li>The project owner merges or closes the Pull Request.<br>This is basically the Integration Manager workflow covered in 【Integration-Manager Workflow】, but instead of using email to communicate and review changes, teams use GitHub’s web based tools.</li>
</ol>
<p>Let’s walk through an example of proposing a change to an open source project hosted on GitHub using this flow.</p>
<h4 id="Creating-a-Pull-Request"><a href="#Creating-a-Pull-Request" class="headerlink" title="Creating a Pull Request"></a>Creating a Pull Request</h4><p>Tony is looking for code to run on his Arduino programmable microcontroller and has found a great program file on GitHub at &lt;<a href="https://github.com/schacon/blink" target="_blank" rel="noopener">https://github.com/schacon/blink</a>&gt;.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckeifhwj20m80fgjs3.jpg" alt="The project we want to contribute to.">  Figure 9. The project we want to contribute to.  The only problem is that the blinking rate is too fast. We think it’s much nicer to wait 3 seconds instead of 1 in between each state change. So let’s improve the program and submit it back to the project as a proposed change.</p>
<p>First, we click the <em>Fork</em> button as mentioned earlier to get our own copy of the project. Our user name here is “tonychacon” so our copy of this project is at <code>[https://github.com/tonychacon/blink](https://github.com/tonychacon/blink)</code> and that’s where we can edit it. We will clone it locally, create a topic branch, make the code change and finally push that change back up to GitHub.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/tonychacon/blink](https://github.com/tonychacon/blink) ①</span><br><span class="line">Cloning into <span class="string">'blink'</span>...</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> blink</span><br><span class="line">$ git checkout -b slow-blink ②</span><br><span class="line">Switched to a new branch <span class="string">'slow-blink'</span></span><br><span class="line"></span><br><span class="line">$ sed -i <span class="string">''</span> <span class="string">'s/1000/3000/'</span> blink.ino (macOS) ③</span><br><span class="line"><span class="comment"># If you're on a Linux system, do this instead:</span></span><br><span class="line"><span class="comment"># $ sed -i 's/1000/3000/' blink.ino ③</span></span><br><span class="line"></span><br><span class="line">$ git diff --word-diff ④</span><br><span class="line">diff --git a/blink.ino b/blink.ino</span><br><span class="line">index 15b9911..a6cc5a5 100644</span><br><span class="line">--- a/blink.ino</span><br><span class="line">+++ b/blink.ino</span><br><span class="line">@@ -18,7 +18,7 @@ void <span class="function"><span class="title">setup</span></span>() &#123;</span><br><span class="line">// the loop routine runs over and over again forever:</span><br><span class="line">void <span class="function"><span class="title">loop</span></span>() &#123;</span><br><span class="line">  digitalWrite(led, HIGH);   // turn the LED on (HIGH is the voltage level)</span><br><span class="line">  [-delay(1000);-]&#123;+delay(3000);+&#125;               // <span class="built_in">wait</span> <span class="keyword">for</span> a second</span><br><span class="line">  digitalWrite(led, LOW);    // turn the LED off by making the voltage LOW</span><br><span class="line">  [-delay(1000);-]&#123;+delay(3000);+&#125;               // <span class="built_in">wait</span> <span class="keyword">for</span> a second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ git commit -a -m <span class="string">'three seconds is better'</span> ⑤</span><br><span class="line">[slow-blink 5ca509d] three seconds is better</span><br><span class="line"> 1 file changed, 2 insertions(+), 2 deletions(-)</span><br><span class="line"></span><br><span class="line">$ git push origin slow-blink ⑥</span><br><span class="line">Username <span class="keyword">for</span> <span class="string">'[https://github.com](https://github.com)'</span>: tonychacon</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'[https://tonychacon@github.com](https://tonychacon@github.com)'</span>:</span><br><span class="line">Counting objects: 5, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 340 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 1), reused 0 (delta 0)</span><br><span class="line">To [https://github.com/tonychacon/blink](https://github.com/tonychacon/blink)</span><br><span class="line"> * [new branch]      slow-blink -&gt; slow-blink</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> Clone our fork of the project locally</li>
<li><em>②</em> Create a descriptive topic branch</li>
<li><em>③</em> Make our change to the code</li>
<li><em>④</em> Check that the change is good</li>
<li><em>⑤</em> Commit our change to the topic branch</li>
<li><em>⑥</em> Push our new topic branch back up to our GitHub fork<br>Now if we go back to our fork on GitHub, we can see that GitHub noticed that we pushed a new topic branch up and presents us with a big green button to check out our changes and open a Pull Request to the original project.</li>
</ol>
<p>You can alternatively go to the “Branches” page at <code>[https://github.com/](https://github.com/)&lt;user&gt;/&lt;project&gt;/branches</code> to locate your branch and open a new Pull Request from there.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl8uj4hj20m80evaas.jpg" alt="Pull Request button">  Figure 10. Pull Request button   If we click that green button, we’ll see a screen that asks us to give our Pull Request a title and description. It is almost always worthwhile to put some effort into this, since a good description helps the owner of the original project determine what you were trying to do, whether your proposed changes are correct, and whether accepting the changes would improve the original project.</p>
<p>We also see a list of the commits in our topic branch that are “ahead” of the <code>master</code> branch (in this case, just the one) and a unified diff of all the changes that will be made should this branch get merged by the project owner.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm2jqi9j20m80keq3y.jpg" alt="Pull Request creation">  Figure 11. Pull Request creation page  When you hit the <em>Create pull request</em> button on this screen, the owner of the project you forked will get a notification that someone is suggesting a change and will link to a page that has all of this information on it.</p>
<p>Though Pull Requests are used commonly for public projects like this when the contributor has a complete change ready to be made, it’s also often used in internal projects <em>at the beginning</em> of the development cycle. Since you can keep pushing to the topic branch even <strong>after</strong> the Pull Request is opened, it’s often opened early and used as a way to iterate on work as a team within a context, rather than opened at the very end of the process.</p>
<h4 id="Iterating-on-a-Pull-Request"><a href="#Iterating-on-a-Pull-Request" class="headerlink" title="Iterating on a Pull Request"></a>Iterating on a Pull Request</h4><p>At this point, the project owner can look at the suggested change and merge it, reject it or comment on it. Let’s say that he likes the idea, but would prefer a slightly longer time for the light to be off than on.</p>
<p>Where this conversation may take place over email in the workflows presented in 【Distributed Git】, on GitHub this happens online. The project owner can review the unified diff and leave a comment by clicking on any of the lines.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclvb5l6j20m80dbgmi.jpg" alt="PR line comment">  Figure 12. Comment on a specific line of code in a Pull Request  Once the maintainer makes this comment, the person who opened the Pull Request (and indeed, anyone else watching the repository) will get a notification. We’ll go over customizing this later, but if he had email notifications turned on, Tony would get an email like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm59tegj20m807hmxg.jpg" alt="Email notification">  Figure 13. Comments sent as email notifications  Anyone can also leave general comments on the Pull Request. In 【Pull Request discussion page】 we can see an example of the project owner both commenting on a line of code and then leaving a general comment in the discussion section. You can see that the code comments are brought into the conversation as well.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm9nkj9j20m80hv0tp.jpg" alt="PR discussion page">  Figure 14. Pull Request discussion page  Now the contributor can see what they need to do in order to get their change accepted. Luckily this is very straightforward. Where over email you may have to re-roll your series and resubmit it to the mailing list, with GitHub you simply commit to the topic branch again and push, which will automatically update the Pull Request. In 【Pull Request final】 you can also see that the old code comment has been collapsed in the updated Pull Request, since it was made on a line that has since been changed.</p>
<p>Adding commits to an existing Pull Request doesn’t trigger a notification, so once Tony has pushed his corrections he decides to leave a comment to inform the project owner that he made the requested change.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn09mowj20l90m83zn.jpg" alt="PR final">  Figure 15. Pull Request final  An interesting thing to notice is that if you click on the “Files Changed” tab on this Pull Request, you’ll get the “unified” diff — that is, the total aggregate difference that would be introduced to your main branch if this topic branch was merged in. In <code>git diff</code> terms, it basically automatically shows you <code>git diff master...&lt;branch&gt;</code> for the branch this Pull Request is based on. See 【Determining What Is Introduced】 for more about this type of diff.</p>
<p>The other thing you’ll notice is that GitHub checks to see if the Pull Request merges cleanly and provides a button to do the merge for you on the server. This button only shows up if you have write access to the repository and a trivial merge is possible. If you click it GitHub will perform a “non-fast-forward” merge, meaning that even if the merge <strong>could</strong> be a fast-forward, it will still create a merge commit.</p>
<p>If you would prefer, you can simply pull the branch down and merge it locally. If you merge this branch into the <code>master</code> branch and push it to GitHub, the Pull Request will automatically be closed.</p>
<p>This is the basic workflow that most GitHub projects use. Topic branches are created, Pull Requests are opened on them, a discussion ensues, possibly more work is done on the branch and eventually the request is either closed or merged.</p>
<h2 id="Not-Only-Forks"><a href="#Not-Only-Forks" class="headerlink" title="Not Only Forks"></a>Not Only Forks</h2><p>It’s important to note that you can also open a Pull Request between two branches in the same repository. If you’re working on a feature with someone and you both have write access to the project, you can push a topic branch to the repository and open a Pull Request on it to the <code>master</code> branch of that same project to initiate the code review and discussion process. No forking necessary.</p>
<h3 id="Advanced-Pull-Requests"><a href="#Advanced-Pull-Requests" class="headerlink" title="Advanced Pull Requests"></a>Advanced Pull Requests</h3><p>Now that we’ve covered the basics of contributing to a project on GitHub, let’s cover a few interesting tips and tricks about Pull Requests so you can be more effective in using them.</p>
<h4 id="Pull-Requests-as-Patches"><a href="#Pull-Requests-as-Patches" class="headerlink" title="Pull Requests as Patches"></a>Pull Requests as Patches</h4><p>It’s important to understand that many projects don’t really think of Pull Requests as queues of perfect patches that should apply cleanly in order, as most mailing list-based projects think of patch series contributions. Most GitHub projects think about Pull Request branches as iterative conversations around a proposed change, culminating in a unified diff that is applied by merging.</p>
<p>This is an important distinction, because generally the change is suggested before the code is thought to be perfect, which is far more rare with mailing list based patch series contributions. This enables an earlier conversation with the maintainers so that arriving at the proper solution is more of a community effort. When code is proposed with a Pull Request and the maintainers or community suggest a change, the patch series is generally not re-rolled, but instead the difference is pushed as a new commit to the branch, moving the conversation forward with the context of the previous work intact.</p>
<p>For instance, if you go back and look again at 【Pull Request final】, you’ll notice that the contributor did not rebase his commit and send another Pull Request. Instead they added new commits and pushed them to the existing branch. This way if you go back and look at this Pull Request in the future, you can easily find all of the context of why decisions were made. Pushing the “Merge” button on the site purposefully creates a merge commit that references the Pull Request so that it’s easy to go back and research the original conversation if necessary.</p>
<h4 id="Keeping-up-with-Upstream"><a href="#Keeping-up-with-Upstream" class="headerlink" title="Keeping up with Upstream"></a>Keeping up with Upstream</h4><p>If your Pull Request becomes out of date or otherwise doesn’t merge cleanly, you will want to fix it so the maintainer can easily merge it. GitHub will test this for you and let you know at the bottom of every Pull Request if the merge is trivial or not.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmdopjoj20m802kt8p.jpg" alt="PR merge failure">  Figure 16. Pull Request does not merge cleanly  If you see something like 【Pull Request does not merge cleanly】, you’ll want to fix your branch so that it turns green and the maintainer doesn’t have to do extra work.</p>
<p>You have two main options in order to do this. You can either rebase your branch on top of whatever the target branch is (normally the <code>master</code> branch of the repository you forked), or you can merge the target branch into your branch.</p>
<p>Most developers on GitHub will choose to do the latter, for the same reasons we just went over in the previous section. What matters is the history and the final merge, so rebasing isn’t getting you much other than a slightly cleaner history and in return is <strong>far</strong> more difficult and error prone.</p>
<p>If you want to merge in the target branch to make your Pull Request mergeable, you would add the original repository as a new remote, fetch from it, merge the main branch of that repository into your topic branch, fix any issues and finally push it back up to the same branch you opened the Pull Request on.</p>
<p>For example, let’s say that in the “tonychacon” example we were using before, the original author made a change that would create a conflict in the Pull Request. Let’s go through those steps.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add upstream [https://github.com/schacon/blink](https://github.com/schacon/blink) ①</span><br><span class="line"></span><br><span class="line">$ git fetch upstream ②</span><br><span class="line">remote: Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Unpacking objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">From [https://github.com/schacon/blink](https://github.com/schacon/blink)</span><br><span class="line"> * [new branch]      master     -&gt; upstream/master</span><br><span class="line"></span><br><span class="line">$ git merge upstream/master ③</span><br><span class="line">Auto-merging blink.ino</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> blink.ino</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br><span class="line"></span><br><span class="line">$ vim blink.ino ④</span><br><span class="line">$ git add blink.ino</span><br><span class="line">$ git commit</span><br><span class="line">[slow-blink 3c8d735] Merge remote-tracking branch <span class="string">'upstream/master'</span> \</span><br><span class="line">    into slower-blink</span><br><span class="line"></span><br><span class="line">$ git push origin slow-blink ⑤</span><br><span class="line">Counting objects: 6, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (6/6), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (6/6), 682 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 6 (delta 2), reused 0 (delta 0)</span><br><span class="line">To [https://github.com/tonychacon/blink](https://github.com/tonychacon/blink)</span><br><span class="line">   ef4725c..3c8d735  slower-blink -&gt; slow-blink</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> Add the original repository as a remote named “upstream”</li>
<li><em>②</em> Fetch the newest work from that remote</li>
<li><em>③</em> Merge the main branch of that repository into your topic branch</li>
<li><em>④</em> Fix the conflict that occurred</li>
<li><em>⑤</em> Push back up to the same topic branch<br>Once you do that, the Pull Request will be automatically updated and re-checked to see if it merges cleanly.</li>
</ol>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmgxq2bj20m808m74p.jpg" alt="PR fixed">  Figure 17. Pull Request now merges cleanly  One of the great things about Git is that you can do that continuously. If you have a very long-running project, you can easily merge from the target branch over and over again and only have to deal with conflicts that have arisen since the last time that you merged, making the process very manageable.</p>
<p>If you absolutely wish to rebase the branch to clean it up, you can certainly do so, but it is highly encouraged to not force push over the branch that the Pull Request is already opened on. If other people have pulled it down and done more work on it, you run into all of the issues outlined in 【The Perils of Rebasing】. Instead, push the rebased branch to a new branch on GitHub and open a brand new Pull Request referencing the old one, then close the original.</p>
<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><p>Your next question may be “How do I reference the old Pull Request?”. It turns out there are many, many ways to reference other things almost anywhere you can write in GitHub.</p>
<p>Let’s start with how to cross-reference another Pull Request or an Issue. All Pull Requests and Issues are assigned numbers and they are unique within the project. For example, you can’t have Pull Request #3 <em>and</em> Issue #3. If you want to reference any Pull Request or Issue from any other one, you can simply put <code>#&lt;num&gt;</code> in any comment or description. You can also be more specific if the Issue or Pull request lives somewhere else; write <code>username#&lt;num&gt;</code> if you’re referring to an Issue or Pull Request in a fork of the repository you’re in, or <code>username/repo#&lt;num&gt;</code> to reference something in another repository.</p>
<p>Let’s look at an example. Say we rebased the branch in the previous example, created a new pull request for it, and now we want to reference the old pull request from the new one. We also want to reference an issue in the fork of the repository and an issue in a completely different project. We can fill out the description just like 【Cross references in a Pull Request.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmka1buj20m809qgly.jpg" alt="PR references">  Figure 18. Cross references in a Pull Request.  When we submit this pull request, we’ll see all of that rendered like 【Cross references rendered in a Pull Request.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmn3p42j20m80cpmxr.jpg" alt="PR references rendered">  Figure 19. Cross references rendered in a Pull Request.  Notice that the full GitHub URL we put in there was shortened to just the information needed.</p>
<p>Now if Tony goes back and closes out the original Pull Request, we can see that by mentioning it in the new one, GitHub has automatically created a trackback event in the Pull Request timeline. This means that anyone who visits this Pull Request and sees that it is closed can easily link back to the one that superseded it. The link will look something like 【Link back to the new Pull Request in the closed Pull Request timeline.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcms18raj20m808fmxg.jpg" alt="PR closed">  Figure 20. Link back to the new Pull Request in the closed Pull Request timeline.  In addition to issue numbers, you can also reference a specific commit by SHA-1. You have to specify a full 40 character SHA-1, but if GitHub sees that in a comment, it will link directly to the commit. Again, you can reference commits in forks or other repositories in the same way you did with issues.</p>
<h3 id="GitHub-Flavored-Markdown"><a href="#GitHub-Flavored-Markdown" class="headerlink" title="GitHub Flavored Markdown"></a>GitHub Flavored Markdown</h3><p>Linking to other Issues is just the beginning of interesting things you can do with almost any text box on GitHub. In Issue and Pull Request descriptions, comments, code comments and more, you can use what is called “GitHub Flavored Markdown”. Markdown is like writing in plain text but which is rendered richly.</p>
<p>See 【An example of GitHub Flavored Markdown as written and as rendered.】 for an example of how comments or text can be written and then rendered using Markdown.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmuuk4yj20m8095mxm.jpg" alt="Example Markdown">  Figure 21. An example of GitHub Flavored Markdown as written and as rendered.  The GitHub flavor of Markdown adds more things you can do beyond the basic Markdown syntax. These can all be really useful when creating useful Pull Request or Issue comments or descriptions.</p>
<h4 id="Task-Lists"><a href="#Task-Lists" class="headerlink" title="Task Lists"></a>Task Lists</h4><p>The first really useful GitHub specific Markdown feature, especially for use in Pull Requests, is the Task List. A task list is a list of checkboxes of things you want to get done. Putting them into an Issue or Pull Request normally indicates things that you want to get done before you consider the item complete.</p>
<p>You can create a task list like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- [X] Write the code</span><br><span class="line">- [ ] Write all the tests</span><br><span class="line">- [ ] Document the code</span><br></pre></td></tr></table></figure>
<p>If we include this in the description of our Pull Request or Issue, we’ll see it rendered like 【Task lists rendered in a Markdown comment.】</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck9nfawj20m8061aa2.jpg" alt="Example Task List">  Figure 22. Task lists rendered in a Markdown comment.  This is often used in Pull Requests to indicate what all you would like to get done on the branch before the Pull Request will be ready to merge. The really cool part is that you can simply click the checkboxes to update the comment — you don’t have to edit the Markdown directly to check tasks off.</p>
<p>What’s more, GitHub will look for task lists in your Issues and Pull Requests and show them as metadata on the pages that list them out. For example, if you have a Pull Request with tasks and you look at the overview page of all Pull Requests, you can see how far done it is. This helps people break down Pull Requests into subtasks and helps other people track the progress of the branch. You can see an example of this in 【Task list summary in the Pull Request list.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckn3f1lj20m804emx6.jpg" alt="Example Task List">  Figure 23. Task list summary in the Pull Request list.  These are incredibly useful when you open a Pull Request early and use it to track your progress through the implementation of the feature.</p>
<h4 id="Code-Snippets"><a href="#Code-Snippets" class="headerlink" title="Code Snippets"></a>Code Snippets</h4><p>You can also add code snippets to comments. This is especially useful if you want to present something that you <em>could</em> try to do before actually implementing it as a commit on your branch. This is also often used to add example code of what is not working or what this Pull Request could implement.</p>
<p>To add a snippet of code you have to “fence” it in backticks.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line"><span class="keyword">for</span>(int i=0 ; i &lt; 5 ; i++)</span><br><span class="line">&#123;</span><br><span class="line">   System.out.println(<span class="string">"i is : "</span> + i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">If you add a language name like we did there with *java*, GitHub will also try to syntax highlight the snippet. In the case of the above example, it would end up rendering like 【Rendered fenced code example.】.</span><br><span class="line"></span><br><span class="line">![Rendered fenced code](https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckx46b6j20m806jjrd.jpg)  Figure 24. Rendered fenced code example.</span><br><span class="line"></span><br><span class="line">#### Quoting</span><br><span class="line"></span><br><span class="line">If you’re responding to a small part of a long comment, you can selectively quote out of the other comment by preceding the lines with the `&gt;` character. In fact, this is so common and so useful that there is a keyboard shortcut for it. If you highlight text in a comment that you want to directly reply to and hit the `r` key, it will quote that text in the comment box for you.</span><br><span class="line"></span><br><span class="line">The quotes look something like this:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">&gt; Whether &apos;tis Nobler in the mind to suffer</span><br><span class="line">&gt; The Slings and Arrows of outrageous Fortune,</span><br><span class="line"></span><br><span class="line">How big are these slings and in particular, these arrows?</span><br></pre></td></tr></table></figure>
<p>Once rendered, the comment will look like 【Rendered quoting example.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjmth5ij20m80cet9b.jpg" alt="Rendered quoting">  Figure 25. Rendered quoting example.</p>
<h4 id="Emoji"><a href="#Emoji" class="headerlink" title="Emoji"></a>Emoji</h4><p>Finally, you can also use emoji in your comments. This is actually used quite extensively in comments you see on many GitHub Issues and Pull Requests. There is even an emoji helper in GitHub. If you are typing a comment and you start with a <code>:</code> character, an autocompleter will help you find what you’re looking for.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckd2mwpj20m8085wen.jpg" alt="Emoji autocompleter">  Figure 26. Emoji autocompleter in action.  Emojis take the form of <code>:&lt;name&gt;:</code> anywhere in the comment. For instance, you could write something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">I :eyes: that :bug: and I :cold_sweat:.</span><br><span class="line"></span><br><span class="line">:trophy: <span class="keyword">for</span> :microscope: it.</span><br><span class="line"></span><br><span class="line">:+1: and :sparkles: on this :ship:, it<span class="string">'s :fire::poop:!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:clap::tada::panda_face:</span></span><br></pre></td></tr></table></figure>
<p>When rendered, it would look something like 【Heavy emoji commenting.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn1g57bj20m806tweh.jpg" alt="Emoji">  Figure 27. Heavy emoji commenting.  Not that this is incredibly useful, but it does add an element of fun and emotion to a medium that is otherwise hard to convey emotion in.</p>
<p>There are actually quite a number of web services that make use of emoji characters these days. A great cheat sheet to reference to find emoji that expresses what you want to say can be found at:</p>
<p>&lt;<a href="http://www.emoji-cheat-sheet.com" target="_blank" rel="noopener">http://www.emoji-cheat-sheet.com</a>&gt;</p>
<h4 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h4><p>This isn’t technically GitHub Flavored Markdown, but it is incredibly useful. In addition to adding Markdown image links to comments, which can be difficult to find and embed URLs for, GitHub allows you to drag and drop images into text areas to embed them.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci6d3woj20m80f7wf1.jpg" alt="Drag and drop images">  Figure 28. Drag and drop images to upload them and auto-embed them.  If you look at 【Drag and drop images to upload them and auto-embed them.】, you can see a small “Parsed as Markdown” hint above the text area. Clicking on that will give you a full cheat sheet of everything you can do with Markdown on GitHub.</p>
<h2 id="Maintaining-a-Project-1"><a href="#Maintaining-a-Project-1" class="headerlink" title="Maintaining a Project"></a>Maintaining a Project</h2><p>Now that we’re comfortable contributing to a project, let’s look at the other side: creating, maintaining and administering your own project.</p>
<h3 id="Creating-a-New-Repository"><a href="#Creating-a-New-Repository" class="headerlink" title="Creating a New Repository"></a>Creating a New Repository</h3><p>Let’s create a new repository to share our project code with. Start by clicking the “New repository” button on the right-hand side of the dashboard, or from the <code>+</code> button in the top toolbar next to your username as seen in 【The “New repository” dropdown.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciv3d9uj20jc076q2x.jpg" alt="The ``Your repositories&#39;&#39; area.">  Figure 29. The “Your repositories” area.    <img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmocf0hj20m80cf3z5.jpg" alt="The ``new repository&#39;&#39; dropdown.">  Figure 30. The “New repository” dropdown.  This takes you to the “new repository” form:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnglnkkj20m80cqmxr.jpg" alt="The ``new repository&#39;&#39; form.">  Figure 31. The “new repository” form.  All you really have to do here is provide a project name; the rest of the fields are completely optional. For now, just click the “Create Repository” button, and boom – you have a new repository on GitHub, named <code>&lt;user&gt;/&lt;project_name&gt;</code>.</p>
<p>Since you have no code there yet, GitHub will show you instructions for how to create a brand-new Git repository, or connect an existing Git project. We won’t belabor this here; if you need a refresher, check out 【Git Basics】.</p>
<p>Now that your project is hosted on GitHub, you can give the URL to anyone you want to share your project with. Every project on GitHub is accessible over HTTPS as <code>[https://github.com/](https://github.com/)&lt;user&gt;/&lt;project_name&gt;</code>, and over SSH as <a href="mailto:`git@github.com" target="_blank" rel="noopener">`git@github.com</a>:<user>/&lt;project_name&gt;`. Git can fetch from and push to both of these URLs, but they are access-controlled based on the credentials of the user connecting to them.</user></p>
<p>It is often preferable to share the HTTPS based URL for a public project, since the user does not have to have a GitHub account to access it for cloning. Users will have to have an account and an uploaded SSH key to access your project if you give them the SSH URL. The HTTPS one is also exactly the same URL they would paste into a browser to view the project there.</p>
<h3 id="Adding-Collaborators"><a href="#Adding-Collaborators" class="headerlink" title="Adding Collaborators"></a>Adding Collaborators</h3><p>If you’re working with other people who you want to give commit access to, you need to add them as “collaborators”. If Ben, Jeff, and Louise all sign up for accounts on GitHub, and you want to give them push access to your repository, you can add them to your project. Doing so will give them “push” access, which means they have both read and write access to the project and Git repository.</p>
<p>Click the “Settings” link at the bottom of the right-hand sidebar.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchmvywkj20m80duglp.jpg" alt="The repository settings link.">  Figure 32. The repository settings link.  Then select “Collaborators” from the menu on the left-hand side. Then, just type a username into the box, and click “Add collaborator.” You can repeat this as many times as you like to grant access to everyone you like. If you need to revoke access, just click the “X” on the right-hand side of their row.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmjairjj20m806pglo.jpg" alt="The repository collaborators box.">  Figure 33. Repository collaborators.</p>
<h3 id="Managing-Pull-Requests"><a href="#Managing-Pull-Requests" class="headerlink" title="Managing Pull Requests"></a>Managing Pull Requests</h3><p>Now that you have a project with some code in it and maybe even a few collaborators who also have push access, let’s go over what to do when you get a Pull Request yourself.</p>
<p>Pull Requests can either come from a branch in a fork of your repository or they can come from another branch in the same repository. The only difference is that the ones in a fork are often from people where you can’t push to their branch and they can’t push to yours, whereas with internal Pull Requests generally both parties can access the branch.</p>
<p>For these examples, let’s assume you are “tonychacon” and you’ve created a new Arduino code project named “fade”.</p>
<h4 id="Email-Notifications"><a href="#Email-Notifications" class="headerlink" title="Email Notifications"></a>Email Notifications</h4><p>Someone comes along and makes a change to your code and sends you a Pull Request. You should get an email notifying you about the new Pull Request and it should look something like 【Email notification of a new Pull Request.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmw8fx1j20m80ez0tg.jpg" alt="Pull Request email notification">  Figure 34. Email notification of a new Pull Request.  There are a few things to notice about this email. It will give you a small diffstat — a list of files that have changed in the Pull Request and by how much. It gives you a link to the Pull Request on GitHub. It also gives you a few URLs that you can use from the command line.</p>
<p>If you notice the line that says <code>git pull &lt;url&gt; patch-1</code>, this is a simple way to merge in a remote branch without having to add a remote. We went over this quickly in 【Checking Out Remote Branches】. If you wish, you can create and switch to a topic branch and then run this command to merge in the Pull Request changes.</p>
<p>The other interesting URLs are the <code>.diff</code> and <code>.patch</code> URLs, which as you may guess, provide unified diff and patch versions of the Pull Request. You could technically merge in the Pull Request work with something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl [http://github.com/tonychacon/fade/pull/1.patch](http://github.com/tonychacon/fade/pull/1.patch) | git am</span><br></pre></td></tr></table></figure>
<h4 id="Collaborating-on-the-Pull-Request"><a href="#Collaborating-on-the-Pull-Request" class="headerlink" title="Collaborating on the Pull Request"></a>Collaborating on the Pull Request</h4><p>As we covered in 【The GitHub Flow】, you can now have a conversation with the person who opened the Pull Request. You can comment on specific lines of code, comment on whole commits or comment on the entire Pull Request itself, using GitHub Flavored Markdown everywhere.</p>
<p>Every time someone else comments on the Pull Request you will continue to get email notifications so you know there is activity happening. They will each have a link to the Pull Request where the activity is happening and you can also directly respond to the email to comment on the Pull Request thread.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj2v56xj20m806xglp.jpg" alt="Email response">  Figure 35. Responses to emails are included in the thread.  Once the code is in a place you like and want to merge it in, you can either pull the code down and merge it locally, either with the <code>git pull &lt;url&gt; &lt;branch&gt;</code> syntax we saw earlier, or by adding the fork as a remote and fetching and merging.</p>
<p>If the merge is trivial, you can also just hit the “Merge” button on the GitHub site. This will do a “non-fast-forward” merge, creating a merge commit even if a fast-forward merge was possible. This means that no matter what, every time you hit the merge button, a merge commit is created. As you can see in 【Merge button and instructions for merging a Pull Request manually.】, GitHub gives you all of this information if you click the hint link.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjpohw4j20m80bn3z9.jpg" alt="Merge button">  Figure 36. Merge button and instructions for merging a Pull Request manually.  If you decide you don’t want to merge it, you can also just close the Pull Request and the person who opened it will be notified.</p>
<h4 id="Pull-Request-Refs"><a href="#Pull-Request-Refs" class="headerlink" title="Pull Request Refs"></a>Pull Request Refs</h4><p>If you’re dealing with a <strong>lot</strong> of Pull Requests and don’t want to add a bunch of remotes or do one time pulls every time, there is a neat trick that GitHub allows you to do. This is a bit of an advanced trick and we’ll go over the details of this a bit more in 【The Refspec】, but it can be pretty useful.</p>
<p>GitHub actually advertises the Pull Request branches for a repository as sort of pseudo-branches on the server. By default you don’t get them when you clone, but they are there in an obscured way and you can access them pretty easily.</p>
<p>To demonstrate this, we’re going to use a low-level command (often referred to as a “plumbing” command, which we’ll read about more in 【Plumbing and Porcelain】) called <code>ls-remote</code>. This command is generally not used in day-to-day Git operations but it’s useful to show us what references are present on the server.</p>
<p>If we run this command against the “blink” repository we were using earlier, we will get a list of all the branches and tags and other references in the repository.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-remote [https://github.com/schacon/blink](https://github.com/schacon/blink)</span><br><span class="line">10d539600d86723087810ec636870a504f4fee4d	HEAD</span><br><span class="line">10d539600d86723087810ec636870a504f4fee4d	refs/heads/master</span><br><span class="line">6a83107c62950be9453aac297bb0193fd743cd6e	refs/pull/1/head</span><br><span class="line">afe83c2d1a70674c9505cc1d8b7d380d5e076ed3	refs/pull/1/merge</span><br><span class="line">3c8d735ee16296c242be7a9742ebfbc2665adec1	refs/pull/2/head</span><br><span class="line">15c9f4f80973a2758462ab2066b6ad9fe8dcf03d	refs/pull/2/merge</span><br><span class="line">a5a7751a33b7e86c5e9bb07b26001bb17d775d1a	refs/pull/4/head</span><br><span class="line">31a45fc257e8433c8d8804e3e848cf61c9d3166c	refs/pull/4/merge</span><br></pre></td></tr></table></figure>
<p>Of course, if you’re in your repository and you run <code>git ls-remote origin</code> or whatever remote you want to check, it will show you something similar to this.</p>
<p>If the repository is on GitHub and you have any Pull Requests that have been opened, you’ll get these references that are prefixed with <code>refs/pull/</code>. These are basically branches, but since they’re not under <code>refs/heads/</code> you don’t get them normally when you clone or fetch from the server — the process of fetching ignores them normally.</p>
<p>There are two references per Pull Request - the one that ends in <code>/head</code> points to exactly the same commit as the last commit in the Pull Request branch. So if someone opens a Pull Request in our repository and their branch is named <code>bug-fix</code> and it points to commit <code>a5a775</code>, then in <strong>our</strong> repository we will not have a <code>bug-fix</code> branch (since that’s in their fork), but we <em>will</em> have <code>pull/&lt;pr#&gt;/head</code> that points to <code>a5a775</code>. This means that we can pretty easily pull down every Pull Request branch in one go without having to add a bunch of remotes.</p>
<p>Now, you could do something like fetching the reference directly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin refs/pull/958/head</span><br><span class="line">From [https://github.com/libgit2/libgit2](https://github.com/libgit2/libgit2)</span><br><span class="line"> * branch            refs/pull/958/head -&gt; FETCH_HEAD</span><br></pre></td></tr></table></figure>
<p>This tells Git, “Connect to the <code>origin</code> remote, and download the ref named <code>refs/pull/958/head</code>.” Git happily obeys, and downloads everything you need to construct that ref, and puts a pointer to the commit you want under <code>.git/FETCH_HEAD</code>. You can follow that up with <code>git merge FETCH_HEAD</code> into a branch you want to test it in, but that merge commit message looks a bit weird. Also, if you’re reviewing a <strong>lot</strong> of pull requests, this gets tedious.</p>
<p>There’s also a way to fetch <em>all</em> of the pull requests, and keep them up to date whenever you connect to the remote. Open up <code>.git/config</code> in your favorite editor, and look for the <code>origin</code> remote. It should look a bit like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">    url = [https://github.com/libgit2/libgit2](https://github.com/libgit2/libgit2)</span><br><span class="line">    fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure>
<p>That line that begins with <code>fetch =</code> is a “refspec.” It’s a way of mapping names on the remote with names in your local <code>.git</code> directory. This particular one tells Git, “the things on the remote that are under <code>refs/heads</code> should go in my local repository under <code>refs/remotes/origin</code>.” You can modify this section to add another refspec:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">    url = [https://github.com/libgit2/libgit2.git](https://github.com/libgit2/libgit2.git)</span><br><span class="line">    fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">    fetch = +refs/pull/*/head:refs/remotes/origin/pr/*</span><br></pre></td></tr></table></figure>
<p>That last line tells Git, “All the refs that look like <code>refs/pull/123/head</code> should be stored locally like <code>refs/remotes/origin/pr/123</code>.” Now, if you save that file, and do a <code>git fetch</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch</span><br><span class="line"><span class="comment"># …</span></span><br><span class="line"> * [new ref]         refs/pull/1/head -&gt; origin/pr/1</span><br><span class="line"> * [new ref]         refs/pull/2/head -&gt; origin/pr/2</span><br><span class="line"> * [new ref]         refs/pull/4/head -&gt; origin/pr/4</span><br><span class="line"><span class="comment"># …</span></span><br></pre></td></tr></table></figure>
<p>Now all of the remote pull requests are represented locally with refs that act much like tracking branches; they’re read-only, and they update when you do a fetch. This makes it super easy to try the code from a pull request locally:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout pr/2</span><br><span class="line">Checking out files: 100% (3769/3769), <span class="keyword">done</span>.</span><br><span class="line">Branch pr/2 <span class="built_in">set</span> up to track remote branch pr/2 from origin.</span><br><span class="line">Switched to a new branch <span class="string">'pr/2'</span></span><br></pre></td></tr></table></figure>
<p>The eagle-eyed among you would note the <code>head</code> on the end of the remote portion of the refspec. There’s also a <code>refs/pull/#/merge</code> ref on the GitHub side, which represents the commit that would result if you push the “merge” button on the site. This can allow you to test the merge before even hitting the button.</p>
<h4 id="Pull-Requests-on-Pull-Requests"><a href="#Pull-Requests-on-Pull-Requests" class="headerlink" title="Pull Requests on Pull Requests"></a>Pull Requests on Pull Requests</h4><p>Not only can you open Pull Requests that target the main or <code>master</code> branch, you can actually open a Pull Request targeting any branch in the network. In fact, you can even target another Pull Request.</p>
<p>If you see a Pull Request that is moving in the right direction and you have an idea for a change that depends on it or you’re not sure is a good idea, or you just don’t have push access to the target branch, you can open a Pull Request directly to it.</p>
<p>When you go to open a Pull Request, there is a box at the top of the page that specifies which branch you’re requesting to pull to and which you’re requesting to pull from. If you hit the “Edit” button at the right of that box you can change not only the branches but also which fork.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckhkgmmj20m80awgm0.jpg" alt="PR targets">  Figure 37. Manually change the Pull Request target fork and branch.  Here you can fairly easily specify to merge your new branch into another Pull Request or another fork of the project.</p>
<h3 id="Mentions-and-Notifications"><a href="#Mentions-and-Notifications" class="headerlink" title="Mentions and Notifications"></a>Mentions and Notifications</h3><p>GitHub also has a pretty nice notifications system built in that can come in handy when you have questions or need feedback from specific individuals or teams.</p>
<p>In any comment you can start typing a <code>@</code> character and it will begin to autocomplete with the names and usernames of people who are collaborators or contributors in the project.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnrd4cuj20m807ddfz.jpg" alt="Mentions">  Figure 38. Start typing @ to mention someone.  You can also mention a user who is not in that dropdown, but often the autocompleter can make it faster.</p>
<p>Once you post a comment with a user mention, that user will be notified. This means that this can be a really effective way of pulling people into conversations rather than making them poll. Very often in Pull Requests on GitHub people will pull in other people on their teams or in their company to review an Issue or Pull Request.</p>
<p>If someone gets mentioned on a Pull Request or Issue, they will be “subscribed” to it and will continue getting notifications any time some activity occurs on it. You will also be subscribed to something if you opened it, if you’re watching the repository or if you comment on something. If you no longer wish to receive notifications, there is an “Unsubscribe” button on the page you can click to stop receiving updates on it.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclijb4oj20i40c8aah.jpg" alt="Unsubscribe">  Figure 39. Unsubscribe from an Issue or Pull Request.</p>
<h4 id="The-Notifications-Page"><a href="#The-Notifications-Page" class="headerlink" title="The Notifications Page"></a>The Notifications Page</h4><p>When we mention “notifications” here with respect to GitHub, we mean a specific way that GitHub tries to get in touch with you when events happen and there are a few different ways you can configure them. If you go to the “Notification center” tab from the settings page, you can see some of the options you have.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn6g3muj20m80ayt93.jpg" alt="Notification center">  Figure 40. Notification center options.  The two choices are to get notifications over “Email” and over “Web” and you can choose either, neither or both for when you actively participate in things and for activity on repositories you are watching.</p>
<h5 id="Web-Notifications"><a href="#Web-Notifications" class="headerlink" title="Web Notifications"></a>Web Notifications</h5><p>Web notifications only exist on GitHub and you can only check them on GitHub. If you have this option selected in your preferences and a notification is triggered for you, you will see a small blue dot over your notifications icon at the top of your screen as seen in 【Notification center.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnt0pc9j20m80azaad.jpg" alt="Notification center">  Figure 41. Notification center.  If you click on that, you will see a list of all the items you have been notified about, grouped by project. You can filter to the notifications of a specific project by clicking on its name in the left hand sidebar. You can also acknowledge the notification by clicking the checkmark icon next to any notification, or acknowledge <em>all</em> of the notifications in a project by clicking the checkmark at the top of the group. There is also a mute button next to each checkmark that you can click to not receive any further notifications on that item.</p>
<p>All of these tools are very useful for handling large numbers of notifications. Many GitHub power users will simply turn off email notifications entirely and manage all of their notifications through this screen.</p>
<h5 id="Email-Notifications-1"><a href="#Email-Notifications-1" class="headerlink" title="Email Notifications"></a>Email Notifications</h5><p>Email notifications are the other way you can handle notifications through GitHub. If you have this turned on you will get emails for each notification. We saw examples of this in 【Comments sent as email notifications】 and 【Email notification of a new Pull Request.】. The emails will also be threaded properly, which is nice if you’re using a threading email client.</p>
<p>There is also a fair amount of metadata embedded in the headers of the emails that GitHub sends you, which can be really helpful for setting up custom filters and rules.</p>
<p>For instance, if we look at the actual email headers sent to Tony in the email shown in 【Email notification of a new Pull Request.】, we will see the following among the information sent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">To: tonychacon/fade &lt;fade@noreply.github.com&gt;</span><br><span class="line">Message-ID: &lt;tonychacon/fade/pull/1@github.com&gt;</span><br><span class="line">Subject: [fade] Wait longer to see the dimming effect better (<span class="comment">#1)</span></span><br><span class="line">X-GitHub-Recipient: tonychacon</span><br><span class="line">List-ID: tonychacon/fade &lt;fade.tonychacon.github.com&gt;</span><br><span class="line">List-Archive: [https://github.com/tonychacon/fade](https://github.com/tonychacon/fade)</span><br><span class="line">List-Post: &lt;mailto:reply+i-4XXX@reply.github.com&gt;</span><br><span class="line">List-Unsubscribe: &lt;mailto:unsub+i-XXX@reply.github.com&gt;,...</span><br><span class="line">X-GitHub-Recipient-Address: tchacon@example.com</span><br></pre></td></tr></table></figure>
<p>There are a couple of interesting things here. If you want to highlight or re-route emails to this particular project or even Pull Request, the information in <code>Message-ID</code> gives you all the data in <code>&lt;user&gt;/&lt;project&gt;/&lt;type&gt;/&lt;id&gt;</code> format. If this were an issue, for example, the <code>&lt;type&gt;</code> field would have been “issues” rather than “pull”.</p>
<p>The <code>List-Post</code> and <code>List-Unsubscribe</code> fields mean that if you have a mail client that understands those, you can easily post to the list or “Unsubscribe” from the thread. That would be essentially the same as clicking the “mute” button on the web version of the notification or “Unsubscribe” on the Issue or Pull Request page itself.</p>
<p>It’s also worth noting that if you have both email and web notifications enabled and you read the email version of the notification, the web version will be marked as read as well if you have images allowed in your mail client.</p>
<h3 id="Special-Files"><a href="#Special-Files" class="headerlink" title="Special Files"></a>Special Files</h3><p>There are a couple of special files that GitHub will notice if they are present in your repository.</p>
<h3 id="README"><a href="#README" class="headerlink" title="README"></a>README</h3><p>The first is the <code>README</code> file, which can be of nearly any format that GitHub recognizes as prose. For example, it could be <code>README</code>, <code>README.md</code>, <code>README.asciidoc</code>, etc. If GitHub sees a README file in your source, it will render it on the landing page of the project.</p>
<p>Many teams use this file to hold all the relevant project information for someone who might be new to the repository or project. This generally includes things like:</p>
<ul>
<li>What the project is for</li>
<li>How to configure and install it</li>
<li>An example of how to use it or get it running</li>
<li>The license that the project is offered under</li>
<li>How to contribute to it<br>Since GitHub will render this file, you can embed images or links in it for added ease of understanding.</li>
</ul>
<h3 id="CONTRIBUTING"><a href="#CONTRIBUTING" class="headerlink" title="CONTRIBUTING"></a>CONTRIBUTING</h3><p>The other special file that GitHub recognizes is the <code>CONTRIBUTING</code> file. If you have a file named <code>CONTRIBUTING</code> with any file extension, GitHub will show 【Opening a Pull Request when a CONTRIBUTING file exists.】 when anyone starts opening a Pull Request.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck89tlnj20m809yaa8.jpg" alt="Contributing notice">  Figure 42. Opening a Pull Request when a CONTRIBUTING file exists.  The idea here is that you can specify specific things you want or don’t want in a Pull Request sent to your project. This way people may actually read the guidelines before opening the Pull Request.</p>
<h3 id="Project-Administration"><a href="#Project-Administration" class="headerlink" title="Project Administration"></a>Project Administration</h3><p>Generally there are not a lot of administrative things you can do with a single project, but there are a couple of items that might be of interest.</p>
<h4 id="Changing-the-Default-Branch"><a href="#Changing-the-Default-Branch" class="headerlink" title="Changing the Default Branch"></a>Changing the Default Branch</h4><p>If you are using a branch other than “master” as your default branch that you want people to open Pull Requests on or see by default, you can change that in your repository’s settings page under the “Options” tab.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco552xej20m8054t8o.jpg" alt="Default branch">  Figure 43. Change the default branch for a project.  Simply change the default branch in the dropdown and that will be the default for all major operations from then on, including which branch is checked out by default when someone clones the repository.</p>
<h4 id="Transferring-a-Project"><a href="#Transferring-a-Project" class="headerlink" title="Transferring a Project"></a>Transferring a Project</h4><p>If you would like to transfer a project to another user or an organization in GitHub, there is a “Transfer ownership” option at the bottom of the same “Options” tab of your repository settings page that allows you to do this.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcobhke7j20m8092dg4.jpg" alt="Transfer">  Figure 44. Transfer a project to another GitHub user or Organization.  This is helpful if you are abandoning a project and someone wants to take it over, or if your project is getting bigger and want to move it into an organization.</p>
<p>Not only does this move the repository along with all its watchers and stars to another place, it also sets up a redirect from your URL to the new place. It will also redirect clones and fetches from Git, not just web requests.</p>
<h2 id="Managing-an-organization"><a href="#Managing-an-organization" class="headerlink" title="Managing an organization"></a>Managing an organization</h2><p>In addition to single-user accounts, GitHub has what are called Organizations. Like personal accounts, Organizational accounts have a namespace where all their projects exist, but many other things are different. These accounts represent a group of people with shared ownership of projects, and there are many tools to manage subgroups of those people. Normally these accounts are used for Open Source groups (such as “perl” or “rails”) or companies (such as “google” or “twitter”).</p>
<h3 id="Organization-Basics"><a href="#Organization-Basics" class="headerlink" title="Organization Basics"></a>Organization Basics</h3><p>An organization is pretty easy to create; just click on the “+” icon at the top-right of any GitHub page, and select “New organization” from the menu.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcksfcfsj20ap06ewef.jpg" alt="The ``New organization&#39;&#39; menu item.">  Figure 45. The “New organization” menu item.  First you’ll need to name your organization and provide an email address for a main point of contact for the group. Then you can invite other users to be co-owners of the account if you want to.</p>
<p>Follow these steps and you’ll soon be the owner of a brand-new organization. Like personal accounts, organizations are free if everything you plan to store there will be open source.</p>
<p>As an owner in an organization, when you fork a repository, you’ll have the choice of forking it to your organization’s namespace. When you create new repositories you can create them either under your personal account or under any of the organizations that you are an owner in. You also automatically “watch” any new repository created under these organizations.</p>
<p>Just like in 【Your Avatar】, you can upload an avatar for your organization to personalize it a bit. Also just like personal accounts, you have a landing page for the organization that lists all of your repositories and can be viewed by other people.</p>
<p>Now let’s cover some of the things that are a bit different with an organizational account.</p>
<h3 id="Teams"><a href="#Teams" class="headerlink" title="Teams"></a>Teams</h3><p>Organizations are associated with individual people by way of teams, which are simply a grouping of individual user accounts and repositories within the organization and what kind of access those people have in those repositories.</p>
<p>For example, say your company has three repositories: <code>frontend</code>, <code>backend</code>, and <code>deployscripts</code>. You’d want your HTML/CSS/JavaScript developers to have access to <code>frontend</code> and maybe <code>backend</code>, and your Operations people to have access to <code>backend</code> and <code>deployscripts</code>. Teams make this easy, without having to manage the collaborators for every individual repository.</p>
<p>The Organization page shows you a simple dashboard of all the repositories, users and teams that are under this organization.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl6csf5j20m80ftwew.jpg" alt="orgs 01 page">  Figure 46. The Organization page.  To manage your Teams, you can click on the Teams sidebar on the right hand side of the page in 【The Organization page.】. This will bring you to a page you can use to add members to the team, add repositories to the team or manage the settings and access control levels for the team. Each team can have read only, read/write or administrative access to the repositories. You can change that level by clicking the “Settings” button in 【The Team page.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjdfdnej20m808mweq.jpg" alt="orgs 02 teams">  Figure 47. The Team page.  When you invite someone to a team, they will get an email letting them know they’ve been invited.</p>
<p>Additionally, team <code>@mentions</code> (such as <code>@acmecorp/frontend</code>) work much the same as they do with individual users, except that <strong>all</strong> members of the team are then subscribed to the thread. This is useful if you want the attention from someone on a team, but you don’t know exactly who to ask.</p>
<p>A user can belong to any number of teams, so don’t limit yourself to only access-control teams. Special-interest teams like <code>ux</code>, <code>css</code>, or <code>refactoring</code> are useful for certain kinds of questions, and others like <code>legal</code> and <code>colorblind</code> for an entirely different kind.</p>
<h3 id="Audit-Log"><a href="#Audit-Log" class="headerlink" title="Audit Log"></a>Audit Log</h3><p>Organizations also give owners access to all the information about what went on under the organization. You can go to the <em>Audit Log</em> tab and see what events have happened at an organization level, who did them and where in the world they were done.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcodbr2zj20m80m576t.jpg" alt="orgs 03 audit">  Figure 48. The Audit log.  You can also filter down to specific types of events, specific places or specific people.</p>
<h2 id="Scripting-GitHub"><a href="#Scripting-GitHub" class="headerlink" title="Scripting GitHub"></a>Scripting GitHub</h2><p>So now we’ve covered all of the major features and workflows of GitHub, but any large group or project will have customizations they may want to make or external services they may want to integrate.</p>
<p>Luckily for us, GitHub is really quite hackable in many ways. In this section we’ll cover how to use the GitHub hooks system and its API to make GitHub work how we want it to.</p>
<h3 id="Services-and-Hooks"><a href="#Services-and-Hooks" class="headerlink" title="Services and Hooks"></a>Services and Hooks</h3><p>The Hooks and Services section of GitHub repository administration is the easiest way to have GitHub interact with external systems.</p>
<h4 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h4><p>First we’ll take a look at Services. Both the Hooks and Services integrations can be found in the Settings section of your repository, where we previously looked at adding Collaborators and changing the default branch of your project. Under the “Webhooks and Services” tab you will see something like 【Services and Hooks configuration section.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclai6brj20m807tt91.jpg" alt="Services and hooks">  Figure 49. Services and Hooks configuration section.  There are dozens of services you can choose from, most of them integrations into other commercial and open source systems. Most of them are for Continuous Integration services, bug and issue trackers, chat room systems and documentation systems. We’ll walk through setting up a very simple one, the Email hook. If you choose “email” from the “Add Service” dropdown, you’ll get a configuration screen like 【Email service configuration.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcickn33j20m80cwq3a.jpg" alt="Email service">  Figure 50. Email service configuration.  In this case, if we hit the “Add service” button, the email address we specified will get an email every time someone pushes to the repository. Services can listen for lots of different types of events, but most only listen for push events and then do something with that data.</p>
<p>If there is a system you are using that you would like to integrate with GitHub, you should check here to see if there is an existing service integration available. For example, if you’re using Jenkins to run tests on your codebase, you can enable the Jenkins builtin service integration to kick off a test run every time someone pushes to your repository.</p>
<h4 id="Hooks-1"><a href="#Hooks-1" class="headerlink" title="Hooks"></a>Hooks</h4><p>If you need something more specific or you want to integrate with a service or site that is not included in this list, you can instead use the more generic hooks system. GitHub repository hooks are pretty simple. You specify a URL and GitHub will post an HTTP payload to that URL on any event you want.</p>
<p>Generally the way this works is you can setup a small web service to listen for a GitHub hook payload and then do something with the data when it is received.</p>
<p>To enable a hook, you click the “Add webhook” button in 【Services and Hooks configuration section.】. This will bring you to a page that looks like 【Web hook configuration.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcion5jwj20m80epaaj.jpg" alt="Web hook">  Figure 51. Web hook configuration.  The configuration for a web hook is pretty simple. In most cases you simply enter a URL and a secret key and hit “Add webhook”. There are a few options for which events you want GitHub to send you a payload for — the default is to only get a payload for the <code>push</code> event, when someone pushes new code to any branch of your repository.</p>
<p>Let’s see a small example of a web service you may set up to handle a web hook. We’ll use the Ruby web framework Sinatra since it’s fairly concise and you should be able to easily see what we’re doing.</p>
<p>Let’s say we want to get an email if a specific person pushes to a specific branch of our project modifying a specific file. We could fairly easily do that with code like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">require <span class="string">'sinatra'</span></span><br><span class="line">require <span class="string">'json'</span></span><br><span class="line">require <span class="string">'mail'</span></span><br><span class="line"></span><br><span class="line">post <span class="string">'/payload'</span> <span class="keyword">do</span></span><br><span class="line">  push = JSON.parse(request.body.read) <span class="comment"># parse the JSON</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># gather the data we're looking for</span></span><br><span class="line">  pusher = push[<span class="string">"pusher"</span>][<span class="string">"name"</span>]</span><br><span class="line">  branch = push[<span class="string">"ref"</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># get a list of all the files touched</span></span><br><span class="line">  files = push[<span class="string">"commits"</span>].map <span class="keyword">do</span> |commit|</span><br><span class="line">    commit[<span class="string">'added'</span>] + commit[<span class="string">'modified'</span>] + commit[<span class="string">'removed'</span>]</span><br><span class="line">  end</span><br><span class="line">  files = files.flatten.uniq</span><br><span class="line"></span><br><span class="line">  <span class="comment"># check for our criteria</span></span><br><span class="line">  <span class="keyword">if</span> pusher == <span class="string">'schacon'</span> &amp;&amp;</span><br><span class="line">     branch == <span class="string">'ref/heads/special-branch'</span> &amp;&amp;</span><br><span class="line">     files.include?(<span class="string">'special-file.txt'</span>)</span><br><span class="line"></span><br><span class="line">    Mail.deliver <span class="keyword">do</span></span><br><span class="line">      from     <span class="string">'tchacon@example.com'</span></span><br><span class="line">      to       <span class="string">'tchacon@example.com'</span></span><br><span class="line">      subject  <span class="string">'Scott Changed the File'</span></span><br><span class="line">      body     <span class="string">"ALARM"</span></span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Here we’re taking the JSON payload that GitHub delivers us and looking up who pushed it, what branch they pushed to and what files were touched in all the commits that were pushed. Then we check that against our criteria and send an email if it matches.</p>
<p>In order to develop and test something like this, you have a nice developer console in the same screen where you set the hook up. You can see the last few deliveries that GitHub has tried to make for that webhook. For each hook you can dig down into when it was delivered, if it was successful and the body and headers for both the request and the response. This makes it incredibly easy to test and debug your hooks.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj1j9guj20kz0m8jss.jpg" alt="Webhook debug">  Figure 52. Web hook debugging information.  The other great feature of this is that you can redeliver any of the payloads to test your service easily.</p>
<p>For more information on how to write webhooks and all the different event types you can listen for, go to the GitHub Developer documentation at &lt;<a href="https://developer.github.com/webhooks/" target="_blank" rel="noopener">https://developer.github.com/webhooks/</a>&gt;</p>
<h3 id="The-GitHub-API"><a href="#The-GitHub-API" class="headerlink" title="The GitHub API"></a>The GitHub API</h3><p>Services and hooks give you a way to receive push notifications about events that happen on your repositories, but what if you need more information about these events? What if you need to automate something like adding collaborators or labeling issues?</p>
<p>This is where the GitHub API comes in handy. GitHub has tons of API endpoints for doing nearly anything you can do on the website in an automated fashion. In this section we’ll learn how to authenticate and connect to the API, how to comment on an issue and how to change the status of a Pull Request through the API.</p>
<h3 id="Basic-Usage-1"><a href="#Basic-Usage-1" class="headerlink" title="Basic Usage"></a>Basic Usage</h3><p>The most basic thing you can do is a simple GET request on an endpoint that doesn’t require authentication. This could be a user or read-only information on an open source project. For example, if we want to know more about a user named “schacon”, we can run something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ curl [https://api.github.com/users/schacon](https://api.github.com/users/schacon)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"login"</span>: <span class="string">"schacon"</span>,</span><br><span class="line">  <span class="string">"id"</span>: 70,</span><br><span class="line">  <span class="string">"avatar_url"</span>: <span class="string">"[https://avatars.githubusercontent.com/u/70](https://avatars.githubusercontent.com/u/70)"</span>,</span><br><span class="line"><span class="comment"># …</span></span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"Scott Chacon"</span>,</span><br><span class="line">  <span class="string">"company"</span>: <span class="string">"GitHub"</span>,</span><br><span class="line">  <span class="string">"following"</span>: 19,</span><br><span class="line">  <span class="string">"created_at"</span>: <span class="string">"2008-01-27T17:19:28Z"</span>,</span><br><span class="line">  <span class="string">"updated_at"</span>: <span class="string">"2014-06-10T02:37:23Z"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There are tons of endpoints like this to get information about organizations, projects, issues, commits — just about anything you can publicly see on GitHub. You can even use the API to render arbitrary Markdown or find a <code>.gitignore</code> template.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ curl [https://api.github.com/gitignore/templates/Java](https://api.github.com/gitignore/templates/Java)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"Java"</span>,</span><br><span class="line">  <span class="string">"source"</span>: <span class="string">"*.class</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Mobile Tools for Java (J2ME)</span></span><br><span class="line"><span class="string">.mtj.tmp/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Package Files </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">*.jar</span></span><br><span class="line"><span class="string">*.war</span></span><br><span class="line"><span class="string">*.ear</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># virtual machine crash logs, see [http://www.java.com/en/download/help/error_hotspot.xml](http://www.java.com/en/download/help/error_hotspot.xml)</span></span><br><span class="line"><span class="string">hs_err_pid*</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Commenting-on-an-Issue"><a href="#Commenting-on-an-Issue" class="headerlink" title="Commenting on an Issue"></a>Commenting on an Issue</h3><p>However, if you want to do an action on the website such as comment on an Issue or Pull Request or if you want to view or interact with private content, you’ll need to authenticate.</p>
<p>There are several ways to authenticate. You can use basic authentication with just your username and password, but generally it’s a better idea to use a personal access token. You can generate this from the “Applications” tab of your settings page.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchp0951j20m80cbgmc.jpg" alt="Access Token">  Figure 53. Generate your access token from the “Applications” tab of your settings page.  It will ask you which scopes you want for this token and a description. Make sure to use a good description so you feel comfortable removing the token when your script or application is no longer used.</p>
<p>GitHub will only show you the token once, so be sure to copy it. You can now use this to authenticate in your script instead of using a username and password. This is nice because you can limit the scope of what you want to do and the token is revocable.</p>
<p>This also has the added advantage of increasing your rate limit. Without authenticating, you will be limited to 60 requests per hour. If you authenticate you can make up to 5,000 requests per hour.</p>
<p>So let’s use it to make a comment on one of our issues. Let’s say we want to leave a comment on a specific issue, Issue #6. To do so we have to do an HTTP POST request to <code>repos/&lt;user&gt;/&lt;repo&gt;/issues/&lt;num&gt;/comments</code> with the token we just generated as an Authorization header.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Content-Type: application/json"</span> \</span><br><span class="line">       -H <span class="string">"Authorization: token TOKEN"</span> \</span><br><span class="line">       --data <span class="string">'&#123;"body":"A new comment, :+1:"&#125;'</span> \</span><br><span class="line">       [https://api.github.com/repos/schacon/blink/issues/6/comments](https://api.github.com/repos/schacon/blink/issues/6/comments)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"id"</span>: 58322100,</span><br><span class="line">  <span class="string">"html_url"</span>: <span class="string">"[https://github.com/schacon/blink/issues/6#issuecomment-58322100](https://github.com/schacon/blink/issues/6#issuecomment-58322100)"</span>,</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"user"</span>: &#123;</span><br><span class="line">    <span class="string">"login"</span>: <span class="string">"tonychacon"</span>,</span><br><span class="line">    <span class="string">"id"</span>: 7874698,</span><br><span class="line">    <span class="string">"avatar_url"</span>: <span class="string">"[https://avatars.githubusercontent.com/u/7874698?v=2](https://avatars.githubusercontent.com/u/7874698?v=2)"</span>,</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"User"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"created_at"</span>: <span class="string">"2014-10-08T07:48:19Z"</span>,</span><br><span class="line">  <span class="string">"updated_at"</span>: <span class="string">"2014-10-08T07:48:19Z"</span>,</span><br><span class="line">  <span class="string">"body"</span>: <span class="string">"A new comment, :+1:"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now if you go to that issue, you can see the comment that we just successfully posted as in 【A comment posted from the GitHub API.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclohcm3j20m8035a9x.jpg" alt="API Comment">  Figure 54. A comment posted from the GitHub API.  You can use the API to do just about anything you can do on the website — creating and setting milestones, assigning people to Issues and Pull Requests, creating and changing labels, accessing commit data, creating new commits and branches, opening, closing or merging Pull Requests, creating and editing teams, commenting on lines of code in a Pull Request, searching the site and on and on.</p>
<h3 id="Changing-the-Status-of-a-Pull-Request"><a href="#Changing-the-Status-of-a-Pull-Request" class="headerlink" title="Changing the Status of a Pull Request"></a>Changing the Status of a Pull Request</h3><p>There is one final example we’ll look at since it’s really useful if you’re working with Pull Requests. Each commit can have one or more statuses associated with it and there is an API to add and query that status.</p>
<p>Most of the Continuous Integration and testing services make use of this API to react to pushes by testing the code that was pushed, and then report back if that commit has passed all the tests. You could also use this to check if the commit message is properly formatted, if the submitter followed all your contribution guidelines, if the commit was validly signed — any number of things.</p>
<p>Let’s say you set up a webhook on your repository that hits a small web service that checks for a <code>Signed-off-by</code> string in the commit message.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">require <span class="string">'httparty'</span></span><br><span class="line">require <span class="string">'sinatra'</span></span><br><span class="line">require <span class="string">'json'</span></span><br><span class="line"></span><br><span class="line">post <span class="string">'/payload'</span> <span class="keyword">do</span></span><br><span class="line">  push = JSON.parse(request.body.read) <span class="comment"># parse the JSON</span></span><br><span class="line">  repo_name = push[<span class="string">'repository'</span>][<span class="string">'full_name'</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># look through each commit message</span></span><br><span class="line">  push[<span class="string">"commits"</span>].each <span class="keyword">do</span> |commit|</span><br><span class="line"></span><br><span class="line">    <span class="comment"># look for a Signed-off-by string</span></span><br><span class="line">    <span class="keyword">if</span> /Signed-off-by/.match commit[<span class="string">'message'</span>]</span><br><span class="line">      state = <span class="string">'success'</span></span><br><span class="line">      description = <span class="string">'Successfully signed off!'</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      state = <span class="string">'failure'</span></span><br><span class="line">      description = <span class="string">'No signoff found.'</span></span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    <span class="comment"># post status to GitHub</span></span><br><span class="line">    sha = commit[<span class="string">"id"</span>]</span><br><span class="line">    status_url = <span class="string">"[https://api.github.com/repos/#](https://api.github.com/repos/#)&#123;repo_name&#125;/statuses/#&#123;sha&#125;"</span></span><br><span class="line"></span><br><span class="line">    status = &#123;</span><br><span class="line">      <span class="string">"state"</span>       =&gt; state,</span><br><span class="line">      <span class="string">"description"</span> =&gt; description,</span><br><span class="line">      <span class="string">"target_url"</span>  =&gt; <span class="string">"[http://example.com/how-to-signoff](http://example.com/how-to-signoff)"</span>,</span><br><span class="line">      <span class="string">"context"</span>     =&gt; <span class="string">"validate/signoff"</span></span><br><span class="line">    &#125;</span><br><span class="line">    HTTParty.post(status_url,</span><br><span class="line">      :body =&gt; status.to_json,</span><br><span class="line">      :headers =&gt; &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>  =&gt; <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>    =&gt; <span class="string">'tonychacon/signoff'</span>,</span><br><span class="line">        <span class="string">'Authorization'</span> =&gt; <span class="string">"token #&#123;ENV['TOKEN']&#125;"</span> &#125;</span><br><span class="line">    )</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Hopefully this is fairly simple to follow. In this web hook handler we look through each commit that was just pushed, we look for the string <em>Signed-off-by</em> in the commit message and finally we POST via HTTP to the <code>/repos/&lt;user&gt;/&lt;repo&gt;/statuses/&lt;commit_sha&gt;</code> API endpoint with the status.</p>
<p>In this case you can send a state (<em>success</em>, <em>failure</em>, <em>error</em>), a description of what happened, a target URL the user can go to for more information and a “context” in case there are multiple statuses for a single commit. For example, a testing service may provide a status and a validation service like this may also provide a status — the “context” field is how they’re differentiated.</p>
<p>If someone opens a new Pull Request on GitHub and this hook is set up, you may see something like 【Commit status via the API.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmqg0o2j20m80b9q3d.jpg" alt="Commit status">  Figure 55. Commit status via the API.  You can now see a little green check mark next to the commit that has a “Signed-off-by” string in the message and a red cross through the one where the author forgot to sign off. You can also see that the Pull Request takes the status of the last commit on the branch and warns you if it is a failure. This is really useful if you’re using this API for test results so you don’t accidentally merge something where the last commit is failing tests.</p>
<h3 id="Octokit"><a href="#Octokit" class="headerlink" title="Octokit"></a>Octokit</h3><p>Though we’ve been doing nearly everything through <code>curl</code> and simple HTTP requests in these examples, several open-source libraries exist that make this API available in a more idiomatic way. At the time of this writing, the supported languages include Go, Objective-C, Ruby, and .NET. Check out &lt;<a href="http://github.com/octokit" target="_blank" rel="noopener">http://github.com/octokit</a>&gt; for more information on these, as they handle much of the HTTP for you.</p>
<p>Hopefully these tools can help you customize and modify GitHub to work better for your specific workflows. For complete documentation on the entire API as well as guides for common tasks, check out &lt;<a href="https://developer.github.com" target="_blank" rel="noopener">https://developer.github.com</a>&gt;.</p>
<h2 id="Summary-6"><a href="#Summary-6" class="headerlink" title="Summary"></a>Summary</h2><p>Now you’re a GitHub user. You know how to create an account, manage an organization, create and push to repositories, contribute to other people’s projects and accept contributions from others. In the next chapter, you’ll learn more powerful tools and tips for dealing with complex situations, which will truly make you a Git master.</p>
<h1 id="Git-Tools"><a href="#Git-Tools" class="headerlink" title="Git Tools"></a><strong>Git</strong> <strong>Tools</strong></h1><p>By now, you’ve learned most of the day-to-day commands and workflows that you need to manage or maintain a Git repository for your source code control. You’ve accomplished the basic tasks of tracking and committing files, and you’ve harnessed the power of the staging area and lightweight topic branching and merging.</p>
<p>Now you’ll explore a number of very powerful things that Git can do that you may not necessarily use on a day-to-day basis but that you may need at some point.</p>
<h2 id="Revision-Selection"><a href="#Revision-Selection" class="headerlink" title="Revision Selection"></a>Revision Selection</h2><p>Git allows you to refer to a set of commits or a range of commits in several ways. They aren’t necessarily obvious but are helpful to know.</p>
<h3 id="Single-Revisions"><a href="#Single-Revisions" class="headerlink" title="Single Revisions"></a>Single Revisions</h3><p>You can obviously refer to any single commit by its full, 40-character SHA-1 hash, but there are more human-friendly ways to refer to commits as well. This section outlines the various ways you can refer to any commit.</p>
<h3 id="Short-SHA-1"><a href="#Short-SHA-1" class="headerlink" title="Short SHA-1"></a>Short SHA-1</h3><p>Git is smart enough to figure out what commit you’re referring to if you provide the first few characters of the SHA-1 hash, as long as that partial hash is at least four characters long and unambiguous; that is, no other object in the object database can have a hash that begins with the same prefix.</p>
<p>For example, to examine a specific commit where you know you added certain functionality, you might first run the <code>git log</code> command to locate the commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit 734713bc047d87bf7eac9674765ae793478c50d3</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri Jan 2 18:32:33 2009 -0800</span><br><span class="line"></span><br><span class="line">    fixed refs handling, added gc auto, updated tests</span><br><span class="line"></span><br><span class="line">commit d921970aadf03b3cf0e71becdaab3147ba71cdef</span><br><span class="line">Merge: 1c002dd... 35cfb2b...</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Thu Dec 11 15:08:43 2008 -0800</span><br><span class="line"></span><br><span class="line">    Merge commit <span class="string">'phedders/rdocs'</span></span><br><span class="line"></span><br><span class="line">commit 1c002dd4b536e7479fe34593e72e6c6c1819e53b</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Thu Dec 11 14:58:32 2008 -0800</span><br><span class="line"></span><br><span class="line">    added some blame and merge stuff</span><br></pre></td></tr></table></figure>
<p>In this case, say you’re interested in the commit whose hash begins with <code>1c002dd...</code>. You can inspect that commit with any of the following variations of <code>git show</code> (assuming the shorter versions are unambiguous):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git show 1c002dd4b536e7479fe34593e72e6c6c1819e53b</span><br><span class="line">$ git show 1c002dd4b536e7479f</span><br><span class="line">$ git show 1c002d</span><br></pre></td></tr></table></figure>
<p>Git can figure out a short, unique abbreviation for your SHA-1 values. If you pass <code>--abbrev-commit</code> to the <code>git log</code> command, the output will use shorter values but keep them unique; it defaults to using seven characters but makes them longer if necessary to keep the SHA-1 unambiguous:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --abbrev-commit --pretty=oneline</span><br><span class="line">ca82a6d changed the version number</span><br><span class="line">085bb3b removed unnecessary <span class="built_in">test</span> code</span><br><span class="line">a11bef0 first commit</span><br></pre></td></tr></table></figure>
<p>Generally, eight to ten characters are more than enough to be unique within a project. For example, as of June 2018, the Linux kernel (which is a fairly sizable project) has over 700,000 commits and almost six and a half million objects in its object database, with no two objects whose SHA-1s are identical in the first 11 characters.</p>
<h2 id="A-SHORT-NOTE-ABOUT-SHA-1"><a href="#A-SHORT-NOTE-ABOUT-SHA-1" class="headerlink" title="A SHORT NOTE ABOUT SHA-1"></a>A SHORT NOTE ABOUT SHA-1</h2><p>A lot of people become concerned at some point that they will, by random happenstance, have two distinct objects in their repository that hash to the same SHA-1 value. What then?</p>
<p>If you do happen to commit an object that hashes to the same SHA-1 value as a previous <em>different</em> object in your repository, Git will see the previous object already in your Git database, assume it was already written and simply reuse it. If you try to check out that object again at some point, you’ll always get the data of the first object.</p>
<p>However, you should be aware of how ridiculously unlikely this scenario is. The SHA-1 digest is 20 bytes or 160 bits. The number of randomly hashed objects needed to ensure a 50% probability of a single collision is about 280 (the formula for determining collision probability is <code>p = (n(n-1)/2) * (1/2^160))</code>. 280 is 1.2 x 1024 or 1 million billion billion. That’s 1,200 times the number of grains of sand on the earth.</p>
<p>Here’s an example to give you an idea of what it would take to get a SHA-1 collision. If all 6.5 billion humans on Earth were programming, and every second, each one was producing code that was the equivalent of the entire Linux kernel history (6.5 million Git objects) and pushing it into one enormous Git repository, it would take roughly 2 years until that repository contained enough objects to have a 50% probability of a single SHA-1 object collision. Thus, a SHA-1 collision is less likely than every member of your programming team being attacked and killed by wolves in unrelated incidents on the same night.</p>
<h3 id="Branch-References"><a href="#Branch-References" class="headerlink" title="Branch References"></a>Branch References</h3><p>One straightforward way to refer to a particular commit is if it’s the commit at the tip of a branch; in that case, you can simply use the branch name in any Git command that expects a reference to a commit. For instance, if you want to examine the last commit object on a branch, the following commands are equivalent, assuming that the <code>topic1</code> branch points to commit <code>ca82a6d...</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git show ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">$ git show topic1</span><br></pre></td></tr></table></figure>
<p>If you want to see which specific SHA-1 a branch points to, or if you want to see what any of these examples boils down to in terms of SHA-1s, you can use a Git plumbing tool called <code>rev-parse</code>. You can see 【Git Internals】 for more information about plumbing tools; basically, <code>rev-parse</code> exists for lower-level operations and isn’t designed to be used in day-to-day operations. However, it can be helpful sometimes when you need to see what’s really going on. Here you can run <code>rev-parse</code> on your branch.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git rev-parse topic1</span><br><span class="line">ca82a6dff817ec66f44342007202690a93763949</span><br></pre></td></tr></table></figure>
<h3 id="RefLog-Shortnames"><a href="#RefLog-Shortnames" class="headerlink" title="RefLog Shortnames"></a>RefLog Shortnames</h3><p>One of the things Git does in the background while you’re working away is keep a “reflog” — a log of where your HEAD and branch references have been for the last few months.</p>
<p>You can see your reflog by using <code>git reflog</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br><span class="line">734713b HEAD@&#123;0&#125;: commit: fixed refs handling, added gc auto, updated</span><br><span class="line">d921970 HEAD@&#123;1&#125;: merge phedders/rdocs: Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line">1c002dd HEAD@&#123;2&#125;: commit: added some blame and merge stuff</span><br><span class="line">1c36188 HEAD@&#123;3&#125;: rebase -i (squash): updating HEAD</span><br><span class="line">95df984 HEAD@&#123;4&#125;: commit: <span class="comment"># This is a combination of two commits.</span></span><br><span class="line">1c36188 HEAD@&#123;5&#125;: rebase -i (squash): updating HEAD</span><br><span class="line">7e05da5 HEAD@&#123;6&#125;: rebase -i (pick): updating HEAD</span><br></pre></td></tr></table></figure>
<p>Every time your branch tip is updated for any reason, Git stores that information for you in this temporary history. You can use your reflog data to refer to older commits as well. For example, if you want to see the fifth prior value of the HEAD of your repository, you can use the <code>@{5}</code> reference that you see in the reflog output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git show HEAD@&#123;5&#125;</span><br></pre></td></tr></table></figure>
<p>You can also use this syntax to see where a branch was some specific amount of time ago. For instance, to see where your <code>master</code> branch was yesterday, you can type</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git show master@&#123;yesterday&#125;</span><br></pre></td></tr></table></figure>
<p>That would show you where tip of your <code>master</code> branch was yesterday. This technique only works for data that’s still in your reflog, so you can’t use it to look for commits older than a few months.</p>
<p>To see reflog information formatted like the <code>git log</code> output, you can run <code>git log -g</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -g master</span><br><span class="line">commit 734713bc047d87bf7eac9674765ae793478c50d3</span><br><span class="line">Reflog: master@&#123;0&#125; (Scott Chacon &lt;schacon@gmail.com&gt;)</span><br><span class="line">Reflog message: commit: fixed refs handling, added gc auto, updated</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri Jan 2 18:32:33 2009 -0800</span><br><span class="line"></span><br><span class="line">    fixed refs handling, added gc auto, updated tests</span><br><span class="line"></span><br><span class="line">commit d921970aadf03b3cf0e71becdaab3147ba71cdef</span><br><span class="line">Reflog: master@&#123;1&#125; (Scott Chacon &lt;schacon@gmail.com&gt;)</span><br><span class="line">Reflog message: merge phedders/rdocs: Merge made by recursive.</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Thu Dec 11 15:08:43 2008 -0800</span><br><span class="line"></span><br><span class="line">    Merge commit <span class="string">'phedders/rdocs'</span></span><br></pre></td></tr></table></figure>
<p>It’s important to note that reflog information is strictly local — it’s a log only of what <em>you’ve</em> done in <em>your</em> repository. The references won’t be the same on someone else’s copy of the repository; also, right after you initially clone a repository, you’ll have an empty reflog, as no activity has occurred yet in your repository. Running <code>git show HEAD@{2.months.ago}</code> will show you the matching commit only if you cloned the project at least two months ago — if you cloned it any more recently than that, you’ll see only your first local commit.</p>
<h2 id="Think-of-the-reflog-as-Git’s-version-of-shell-history"><a href="#Think-of-the-reflog-as-Git’s-version-of-shell-history" class="headerlink" title="Think of the reflog as Git’s version of shell history"></a>Think of the reflog as Git’s version of shell history</h2><p>If you have a UNIX or Linux background, you can think of the reflog as Git’s version of shell history, which emphasizes that what’s there is clearly relevant only for you and your “session”, and has nothing to do with anyone else who might be working on the same machine.</p>
<h3 id="Ancestry-References"><a href="#Ancestry-References" class="headerlink" title="Ancestry References"></a>Ancestry References</h3><p>The other main way to specify a commit is via its ancestry. If you place a <code>^</code> (caret) at the end of a reference, Git resolves it to mean the parent of that commit. Suppose you look at the history of your project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=format:<span class="string">'%h %s'</span> --graph</span><br><span class="line">* 734713b fixed refs handling, added gc auto, updated tests</span><br><span class="line">*   d921970 Merge commit <span class="string">'phedders/rdocs'</span></span><br><span class="line">|\</span><br><span class="line">| * 35cfb2b Some rdoc changes</span><br><span class="line">* | 1c002dd added some blame and merge stuff</span><br><span class="line">|/</span><br><span class="line">* 1c36188 ignore *.gem</span><br><span class="line">* 9b29157 add open3_detach to gemspec file list</span><br></pre></td></tr></table></figure>
<p>Then, you can see the previous commit by specifying <code>HEAD^</code>, which means “the parent of HEAD”:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git show HEAD^</span><br><span class="line">commit d921970aadf03b3cf0e71becdaab3147ba71cdef</span><br><span class="line">Merge: 1c002dd... 35cfb2b...</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Thu Dec 11 15:08:43 2008 -0800</span><br><span class="line"></span><br><span class="line">    Merge commit <span class="string">'phedders/rdocs'</span></span><br></pre></td></tr></table></figure>
<h2 id="Escaping-the-caret-on-Windows"><a href="#Escaping-the-caret-on-Windows" class="headerlink" title="Escaping the caret on Windows"></a>Escaping the caret on Windows</h2><p>On Windows in <code>cmd.exe</code>, <code>^</code> is a special character and needs to be treated differently. You can either double it or put the commit reference in quotes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git show HEAD^     <span class="comment"># will NOT work on Windows</span></span><br><span class="line">$ git show HEAD^^    <span class="comment"># OK</span></span><br><span class="line">$ git show <span class="string">"HEAD^"</span>   <span class="comment"># OK</span></span><br></pre></td></tr></table></figure>
<p>You can also specify a number after the <code>^</code> – for example, <code>d921970^2</code> means “the second parent of d921970.” This syntax is useful only for merge commits, which have more than one parent. The first parent is the branch you were on when you merged, and the second is the commit on the branch that you merged in:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git show d921970^</span><br><span class="line">commit 1c002dd4b536e7479fe34593e72e6c6c1819e53b</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Thu Dec 11 14:58:32 2008 -0800</span><br><span class="line"></span><br><span class="line">    added some blame and merge stuff</span><br><span class="line"></span><br><span class="line">$ git show d921970^2</span><br><span class="line">commit 35cfb2b795a55793d7cc56a6cc2060b4bb732548</span><br><span class="line">Author: Paul Hedderly &lt;paul+git@mjr.org&gt;</span><br><span class="line">Date:   Wed Dec 10 22:22:03 2008 +0000</span><br><span class="line"></span><br><span class="line">    Some rdoc changes</span><br></pre></td></tr></table></figure>
<p>The other main ancestry specification is the <code>~</code> (tilde). This also refers to the first parent, so <code>HEAD~</code> and <code>HEAD^</code> are equivalent. The difference becomes apparent when you specify a number. <code>HEAD~2</code> means “the first parent of the first parent,” or “the grandparent” — it traverses the first parents the number of times you specify. For example, in the history listed earlier, <code>HEAD~3</code> would be</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git show HEAD~3</span><br><span class="line">commit 1c3618887afb5fbcbea25b7c013f4e2114448b8d</span><br><span class="line">Author: Tom Preston-Werner &lt;tom@mojombo.com&gt;</span><br><span class="line">Date:   Fri Nov 7 13:47:59 2008 -0500</span><br><span class="line"></span><br><span class="line">    ignore *.gem</span><br></pre></td></tr></table></figure>
<p>This can also be written <code>HEAD^^^</code>, which again is the first parent of the first parent of the first parent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git show HEAD^^^</span><br><span class="line">commit 1c3618887afb5fbcbea25b7c013f4e2114448b8d</span><br><span class="line">Author: Tom Preston-Werner &lt;tom@mojombo.com&gt;</span><br><span class="line">Date:   Fri Nov 7 13:47:59 2008 -0500</span><br><span class="line"></span><br><span class="line">    ignore *.gem</span><br></pre></td></tr></table></figure>
<p>You can also combine these syntaxes — you can get the second parent of the previous reference (assuming it was a merge commit) by using <code>HEAD~3^2</code>, and so on.</p>
<h3 id="Commit-Ranges"><a href="#Commit-Ranges" class="headerlink" title="Commit Ranges"></a>Commit Ranges</h3><p>Now that you can specify individual commits, let’s see how to specify ranges of commits. This is particularly useful for managing your branches — if you have a lot of branches, you can use range specifications to answer questions such as, “What work is on this branch that I haven’t yet merged into my main branch?”</p>
<h4 id="Double-Dot"><a href="#Double-Dot" class="headerlink" title="Double Dot"></a>Double Dot</h4><p>The most common range specification is the double-dot syntax. This basically asks Git to resolve a range of commits that are reachable from one commit but aren’t reachable from another. For example, say you have a commit history that looks like 【Example history for range selection.】.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchv4ycaj20m8044jra.jpg" alt="Example history for range selection.">  Figure 1. Example history for range selection.  Say you want to see what is in your <code>experiment</code> branch that hasn’t yet been merged into your <code>master</code> branch. You can ask Git to show you a log of just those commits with <code>master..experiment</code> — that means “all commits reachable from experiment that aren’t reachable from master.” For the sake of brevity and clarity in these examples, the letters of the commit objects from the diagram are used in place of the actual log output in the order that they would display:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> master..experiment</span><br><span class="line">D</span><br><span class="line">C</span><br></pre></td></tr></table></figure>
<p>If, on the other hand, you want to see the opposite — all commits in <code>master</code> that aren’t in <code>experiment</code> — you can reverse the branch names. <code>experiment..master</code> shows you everything in <code>master</code> not reachable from <code>experiment</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> experiment..master</span><br><span class="line">F</span><br><span class="line">E</span><br></pre></td></tr></table></figure>
<p>This is useful if you want to keep the <code>experiment</code> branch up to date and preview what you’re about to merge. Another frequent use of this syntax is to see what you’re about to push to a remote:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> origin/master..HEAD</span><br></pre></td></tr></table></figure>
<p>This command shows you any commits in your current branch that aren’t in the <code>master</code> branch on your <code>origin</code> remote. If you run a <code>git push</code> and your current branch is tracking <code>origin/master</code>, the commits listed by <code>git log origin/master..HEAD</code> are the commits that will be transferred to the server. You can also leave off one side of the syntax to have Git assume <code>HEAD</code>. For example, you can get the same results as in the previous example by typing <code>git log origin/master..</code> — Git substitutes <code>HEAD</code> if one side is missing.</p>
<h4 id="Multiple-Points"><a href="#Multiple-Points" class="headerlink" title="Multiple Points"></a>Multiple Points</h4><p>The double-dot syntax is useful as a shorthand, but perhaps you want to specify more than two branches to indicate your revision, such as seeing what commits are in any of several branches that aren’t in the branch you’re currently on. Git allows you to do this by using either the <code>^</code> character or <code>--not</code> before any reference from which you don’t want to see reachable commits. Thus, the following three commands are equivalent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> refA..refB</span><br><span class="line">$ git <span class="built_in">log</span> ^refA refB</span><br><span class="line">$ git <span class="built_in">log</span> refB --not refA</span><br></pre></td></tr></table></figure>
<p>This is nice because with this syntax you can specify more than two references in your query, which you cannot do with the double-dot syntax. For instance, if you want to see all commits that are reachable from <code>refA</code> or <code>refB</code> but not from <code>refC</code>, you can use either of:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> refA refB ^refC</span><br><span class="line">$ git <span class="built_in">log</span> refA refB --not refC</span><br></pre></td></tr></table></figure>
<p>This makes for a very powerful revision query system that should help you figure out what is in your branches.</p>
<h4 id="Triple-Dot"><a href="#Triple-Dot" class="headerlink" title="Triple Dot"></a>Triple Dot</h4><p>The last major range-selection syntax is the triple-dot syntax, which specifies all the commits that are reachable by <em>either</em> of two references but not by both of them. Look back at the example commit history in 【Example history for range selection.】. If you want to see what is in <code>master</code> or <code>experiment</code> but not any common references, you can run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> master...experiment</span><br><span class="line">F</span><br><span class="line">E</span><br><span class="line">D</span><br><span class="line">C</span><br></pre></td></tr></table></figure>
<p>Again, this gives you normal <code>log</code> output but shows you only the commit information for those four commits, appearing in the traditional commit date ordering.</p>
<p>A common switch to use with the <code>log</code> command in this case is <code>--left-right</code>, which shows you which side of the range each commit is in. This helps make the output more useful:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --left-right master...experiment</span><br><span class="line">&lt; F</span><br><span class="line">&lt; E</span><br><span class="line">&gt; D</span><br><span class="line">&gt; C</span><br></pre></td></tr></table></figure>
<p>With these tools, you can much more easily let Git know what commit or commits you want to inspect.</p>
<h2 id="Interactive-Staging"><a href="#Interactive-Staging" class="headerlink" title="Interactive Staging"></a>Interactive Staging</h2><p>In this section, you’ll look at a few interactive Git commands that can help you easily craft your commits to include only certain combinations and parts of files. These tools are helpful if you modify a number of files and then decide that you want those changes to be in several focused commits rather than one big messy commit. This way, you can make sure your commits are logically separate changesets and can be easily reviewed by the developers working with you.</p>
<p>If you run <code>git add</code> with the <code>-i</code> or <code>--interactive</code> option, Git enters an interactive shell mode, displaying something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git add -i</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:    unchanged        +0/-1 TODO</span><br><span class="line">  2:    unchanged        +1/-1 index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br><span class="line"></span><br><span class="line">*** Commands ***</span><br><span class="line">  1: status     2: update      3: revert     4: add untracked</span><br><span class="line">  5: patch      6: diff        7: quit       8: <span class="built_in">help</span></span><br><span class="line">What now&gt;</span><br></pre></td></tr></table></figure>
<p>You can see that this command shows you a much different view of your staging area than you’re probably used to — basically, the same information you get with <code>git status</code> but a bit more succinct and informative. It lists the changes you’ve staged on the left and unstaged changes on the right.</p>
<p>After this comes a “Commands” section, which allows you to do a number of things like staging and unstaging files, staging parts of files, adding untracked files, and displaying diffs of what has been staged.</p>
<h3 id="Staging-and-Unstaging-Files"><a href="#Staging-and-Unstaging-Files" class="headerlink" title="Staging and Unstaging Files"></a>Staging and Unstaging Files</h3><p>If you type <code>2</code> or <code>u</code> at the <code>What now&gt;</code> prompt, you’re prompted for which files you want to stage:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">What now&gt; 2</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:    unchanged        +0/-1 TODO</span><br><span class="line">  2:    unchanged        +1/-1 index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br><span class="line">Update&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>To stage the <code>TODO</code> and <code>index.html</code> files, you can type the numbers:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Update&gt;&gt; 1,2</span><br><span class="line">           staged     unstaged path</span><br><span class="line">* 1:    unchanged        +0/-1 TODO</span><br><span class="line">* 2:    unchanged        +1/-1 index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br><span class="line">Update&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>The <code>*</code> next to each file means the file is selected to be staged. If you press Enter after typing nothing at the <code>Update&gt;&gt;</code> prompt, Git takes anything selected and stages it for you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Update&gt;&gt;</span><br><span class="line">updated 2 paths</span><br><span class="line"></span><br><span class="line">*** Commands ***</span><br><span class="line">  1: status     2: update      3: revert     4: add untracked</span><br><span class="line">  5: patch      6: diff        7: quit       8: <span class="built_in">help</span></span><br><span class="line">What now&gt; 1</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:        +0/-1      nothing TODO</span><br><span class="line">  2:        +1/-1      nothing index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br></pre></td></tr></table></figure>
<p>Now you can see that the <code>TODO</code> and <code>index.html</code> files are staged and the <code>simplegit.rb</code> file is still unstaged. If you want to unstage the <code>TODO</code> file at this point, you use the <code>3</code> or <code>r</code> (for revert) option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*** Commands ***</span><br><span class="line">  1: status     2: update      3: revert     4: add untracked</span><br><span class="line">  5: patch      6: diff        7: quit       8: <span class="built_in">help</span></span><br><span class="line">What now&gt; 3</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:        +0/-1      nothing TODO</span><br><span class="line">  2:        +1/-1      nothing index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br><span class="line">Revert&gt;&gt; 1</span><br><span class="line">           staged     unstaged path</span><br><span class="line">* 1:        +0/-1      nothing TODO</span><br><span class="line">  2:        +1/-1      nothing index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br><span class="line">Revert&gt;&gt; [enter]</span><br><span class="line">reverted one path</span><br></pre></td></tr></table></figure>
<p>Looking at your Git status again, you can see that you’ve unstaged the <code>TODO</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*** Commands ***</span><br><span class="line">  1: status     2: update      3: revert     4: add untracked</span><br><span class="line">  5: patch      6: diff        7: quit       8: <span class="built_in">help</span></span><br><span class="line">What now&gt; 1</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:    unchanged        +0/-1 TODO</span><br><span class="line">  2:        +1/-1      nothing index.html</span><br><span class="line">  3:    unchanged        +5/-1 lib/simplegit.rb</span><br></pre></td></tr></table></figure>
<p>To see the diff of what you’ve staged, you can use the <code>6</code> or <code>d</code> (for diff) command. It shows you a list of your staged files, and you can select the ones for which you would like to see the staged diff. This is much like specifying <code>git diff --cached</code> on the command line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">*** Commands ***</span><br><span class="line">  1: status     2: update      3: revert     4: add untracked</span><br><span class="line">  5: patch      6: diff        7: quit       8: <span class="built_in">help</span></span><br><span class="line">What now&gt; 6</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:        +1/-1      nothing index.html</span><br><span class="line">Review diff&gt;&gt; 1</span><br><span class="line">diff --git a/index.html b/index.html</span><br><span class="line">index 4d07108..4335f49 100644</span><br><span class="line">--- a/index.html</span><br><span class="line">+++ b/index.html</span><br><span class="line">@@ -16,7 +16,7 @@ Date Finder</span><br><span class="line"></span><br><span class="line"> &lt;p id=<span class="string">"out"</span>&gt;...&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">-&lt;div id=<span class="string">"footer"</span>&gt;contact : support@github.com&lt;/div&gt;</span><br><span class="line">+&lt;div id=<span class="string">"footer"</span>&gt;contact : email.support@github.com&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"> &lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>With these basic commands, you can use the interactive add mode to deal with your staging area a little more easily.</p>
<h3 id="Staging-Patches"><a href="#Staging-Patches" class="headerlink" title="Staging Patches"></a>Staging Patches</h3><p>It’s also possible for Git to stage certain <em>parts</em> of files and not the rest. For example, if you make two changes to your <code>simplegit.rb</code> file and want to stage one of them and not the other, doing so is very easy in Git. From the same interactive prompt explained in the previous section, type <code>5</code> or <code>p</code> (for patch). Git will ask you which files you would like to partially stage; then, for each section of the selected files, it will display hunks of the file diff and ask if you would like to stage them, one by one:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/lib/simplegit.rb b/lib/simplegit.rb</span><br><span class="line">index dd5ecc4..57399e0 100644</span><br><span class="line">--- a/lib/simplegit.rb</span><br><span class="line">+++ b/lib/simplegit.rb</span><br><span class="line">@@ -22,7 +22,7 @@ class SimpleGit</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   def <span class="built_in">log</span>(treeish = <span class="string">'master'</span>)</span><br><span class="line">-    <span class="built_in">command</span>(<span class="string">"git log -n 25 #&#123;treeish&#125;"</span>)</span><br><span class="line">+    <span class="built_in">command</span>(<span class="string">"git log -n 30 #&#123;treeish&#125;"</span>)</span><br><span class="line">   end</span><br><span class="line"></span><br><span class="line">   def blame(path)</span><br><span class="line">Stage this hunk [y,n,a,d,/,j,J,g,e,?]?</span><br></pre></td></tr></table></figure>
<p>You have a lot of options at this point. Typing <code>?</code> shows a list of what you can do:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Stage this hunk [y,n,a,d,/,j,J,g,e,?]? ?</span><br><span class="line">y - stage this hunk</span><br><span class="line">n - <span class="keyword">do</span> not stage this hunk</span><br><span class="line">a - stage this and all the remaining hunks <span class="keyword">in</span> the file</span><br><span class="line">d - <span class="keyword">do</span> not stage this hunk nor any of the remaining hunks <span class="keyword">in</span> the file</span><br><span class="line">g - select a hunk to go to</span><br><span class="line">/ - search <span class="keyword">for</span> a hunk matching the given regex</span><br><span class="line">j - leave this hunk undecided, see next undecided hunk</span><br><span class="line">J - leave this hunk undecided, see next hunk</span><br><span class="line">k - leave this hunk undecided, see previous undecided hunk</span><br><span class="line">K - leave this hunk undecided, see previous hunk</span><br><span class="line">s - split the current hunk into smaller hunks</span><br><span class="line">e - manually edit the current hunk</span><br><span class="line">? - <span class="built_in">print</span> <span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<p>Generally, you’ll type <code>y</code> or <code>n</code> if you want to stage each hunk, but staging all of them in certain files or skipping a hunk decision until later can be helpful too. If you stage one part of the file and leave another part unstaged, your status output will look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">What now&gt; 1</span><br><span class="line">           staged     unstaged path</span><br><span class="line">  1:    unchanged        +0/-1 TODO</span><br><span class="line">  2:        +1/-1      nothing index.html</span><br><span class="line">  3:        +1/-1        +4/-0 lib/simplegit.rb</span><br></pre></td></tr></table></figure>
<p>The status of the <code>simplegit.rb</code> file is interesting. It shows you that a couple of lines are staged and a couple are unstaged. You’ve partially staged this file. At this point, you can exit the interactive adding script and run <code>git commit</code> to commit the partially staged files.</p>
<p>You also don’t need to be in interactive add mode to do the partial-file staging — you can start the same script by using <code>git add -p</code> or <code>git add --patch</code> on the command line.</p>
<p>Furthermore, you can use patch mode for partially resetting files with the <code>git reset --patch</code> command, for checking out parts of files with the <code>git checkout --patch</code> command and for stashing parts of files with the <code>git stash save --patch</code> command. We’ll go into more details on each of these as we get to more advanced usages of these commands.</p>
<h2 id="Stashing-and-Cleaning"><a href="#Stashing-and-Cleaning" class="headerlink" title="Stashing and Cleaning"></a>Stashing and Cleaning</h2><p>Often, when you’ve been working on part of your project, things are in a messy state and you want to switch branches for a bit to work on something else. The problem is, you don’t want to do a commit of half-done work just so you can get back to this point later. The answer to this issue is the <code>git stash</code> command.</p>
<p>Stashing takes the dirty state of your working directory — that is, your modified tracked files and staged changes — and saves it on a stack of unfinished changes that you can reapply at any time (even on a different branch).</p>
<h2 id="Migrating-to-git-stash-push"><a href="#Migrating-to-git-stash-push" class="headerlink" title="Migrating to git stash push"></a>Migrating to <code>git stash push</code></h2><p>As of late October 2017, there has been extensive discussion on the Git mailing list, wherein the command <code>git stash save</code> is being deprecated in favour of the existing alternative <code>git stash push</code>. The main reason for this is that <code>git stash push</code> introduces the option of stashing selected <em>pathspecs</em>, something <code>git stash save</code> does not support.</p>
<p><code>git stash save</code> is not going away any time soon, so don’t worry about it suddenly disappearing. But you might want to start migrating over to the <code>push</code> alternative for the new functionality.</p>
<h3 id="Stashing-Your-Work"><a href="#Stashing-Your-Work" class="headerlink" title="Stashing Your Work"></a>Stashing Your Work</h3><p>To demonstrate stashing, you’ll go into your project and start working on a couple of files and possibly stage one of the changes. If you run <code>git status</code>, you can see your dirty state:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	modified:   index.html</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">	modified:   lib/simplegit.rb</span><br></pre></td></tr></table></figure>
<p>Now you want to switch branches, but you don’t want to commit what you’ve been working on yet; so you’ll stash the changes. To push a new stash onto your stack, run <code>git stash</code> or <code>git stash save</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git stash</span><br><span class="line">Saved working directory and index state \</span><br><span class="line">  <span class="string">"WIP on master: 049d078 added the index file"</span></span><br><span class="line">HEAD is now at 049d078 added the index file</span><br><span class="line">(To restore them <span class="built_in">type</span> <span class="string">"git stash apply"</span>)</span><br></pre></td></tr></table></figure>
<p>You can now see that your working directory is clean:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>
<p>At this point, you can switch branches and do work elsewhere; your changes are stored on your stack. To see which stashes you’ve stored, you can use <code>git stash list</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list</span><br><span class="line">stash@&#123;0&#125;: WIP on master: 049d078 added the index file</span><br><span class="line">stash@&#123;1&#125;: WIP on master: c264051 Revert <span class="string">"added file_size"</span></span><br><span class="line">stash@&#123;2&#125;: WIP on master: 21d80a5 added number to <span class="built_in">log</span></span><br></pre></td></tr></table></figure>
<p>In this case, two stashes were done previously, so you have access to three different stashed works. You can reapply the one you just stashed by using the command shown in the help output of the original stash command: <code>git stash apply</code>. If you want to apply one of the older stashes, you can specify it by naming it, like this: <code>git stash apply stash@{2}</code>. If you don’t specify a stash, Git assumes the most recent stash and tries to apply it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git stash apply</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">	modified:   index.html</span><br><span class="line">	modified:   lib/simplegit.rb</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br></pre></td></tr></table></figure>
<p>You can see that Git re-modifies the files you reverted when you saved the stash. In this case, you had a clean working directory when you tried to apply the stash, and you tried to apply it on the same branch you saved it from. Having a clean working directory and applying it on the same branch aren’t necessary to successfully apply a stash. You can save a stash on one branch, switch to another branch later, and try to reapply the changes. You can also have modified and uncommitted files in your working directory when you apply a stash — Git gives you merge conflicts if anything no longer applies cleanly.</p>
<p>The changes to your files were reapplied, but the file you staged before wasn’t restaged. To do that, you must run the <code>git stash apply</code> command with a <code>--index</code> option to tell the command to try to reapply the staged changes. If you had run that instead, you’d have gotten back to your original position:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git stash apply --index</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	modified:   index.html</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">	modified:   lib/simplegit.rb</span><br></pre></td></tr></table></figure>
<p>The apply option only tries to apply the stashed work — you continue to have it on your stack. To remove it, you can run <code>git stash drop</code> with the name of the stash to remove:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list</span><br><span class="line">stash@&#123;0&#125;: WIP on master: 049d078 added the index file</span><br><span class="line">stash@&#123;1&#125;: WIP on master: c264051 Revert <span class="string">"added file_size"</span></span><br><span class="line">stash@&#123;2&#125;: WIP on master: 21d80a5 added number to <span class="built_in">log</span></span><br><span class="line">$ git stash drop stash@&#123;0&#125;</span><br><span class="line">Dropped stash@&#123;0&#125; (364e91f3f268f0900bc3ee613f9f733e82aaed43)</span><br></pre></td></tr></table></figure>
<p>You can also run <code>git stash pop</code> to apply the stash and then immediately drop it from your stack.</p>
<h3 id="Creative-Stashing"><a href="#Creative-Stashing" class="headerlink" title="Creative Stashing"></a>Creative Stashing</h3><p>There are a few stash variants that may also be helpful. The first option that is quite popular is the <code>--keep-index</code> option to the <code>stash save</code> command. This tells Git to not only include all staged content in the stash being created, but simultaneously leave it in the index.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s</span><br><span class="line">M  index.html</span><br><span class="line"> M lib/simplegit.rb</span><br><span class="line"></span><br><span class="line">$ git stash --keep-index</span><br><span class="line">Saved working directory and index state WIP on master: 1b65b17 added the index file</span><br><span class="line">HEAD is now at 1b65b17 added the index file</span><br><span class="line"></span><br><span class="line">$ git status -s</span><br><span class="line">M  index.html</span><br></pre></td></tr></table></figure>
<p>Another common thing you may want to do with stash is to stash the untracked files as well as the tracked ones. By default, <code>git stash</code> will stash only modified and staged <em>tracked</em> files. If you specify <code>--include-untracked</code> or <code>-u</code>, Git will include untracked files in the stash being created.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s</span><br><span class="line">M  index.html</span><br><span class="line"> M lib/simplegit.rb</span><br><span class="line">?? new-file.txt</span><br><span class="line"></span><br><span class="line">$ git stash -u</span><br><span class="line">Saved working directory and index state WIP on master: 1b65b17 added the index file</span><br><span class="line">HEAD is now at 1b65b17 added the index file</span><br><span class="line"></span><br><span class="line">$ git status -s</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>Finally, if you specify the <code>--patch</code> flag, Git will not stash everything that is modified but will instead prompt you interactively which of the changes you would like to stash and which you would like to keep in your working directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git stash --patch</span><br><span class="line">diff --git a/lib/simplegit.rb b/lib/simplegit.rb</span><br><span class="line">index 66d332e..8bb5674 100644</span><br><span class="line">--- a/lib/simplegit.rb</span><br><span class="line">+++ b/lib/simplegit.rb</span><br><span class="line">@@ -16,6 +16,10 @@ class SimpleGit</span><br><span class="line">         <span class="built_in">return</span> `<span class="comment">#&#123;git_cmd&#125; 2&gt;&amp;1`.chomp</span></span><br><span class="line">       end</span><br><span class="line">     end</span><br><span class="line">+</span><br><span class="line">+    def show(treeish = <span class="string">'master'</span>)</span><br><span class="line">+      <span class="built_in">command</span>(<span class="string">"git show #&#123;treeish&#125;"</span>)</span><br><span class="line">+    end</span><br><span class="line"></span><br><span class="line"> end</span><br><span class="line"> <span class="built_in">test</span></span><br><span class="line">Stash this hunk [y,n,q,a,d,/,e,?]? y</span><br><span class="line"></span><br><span class="line">Saved working directory and index state WIP on master: 1b65b17 added the index file</span><br></pre></td></tr></table></figure>
<h3 id="Creating-a-Branch-from-a-Stash"><a href="#Creating-a-Branch-from-a-Stash" class="headerlink" title="Creating a Branch from a Stash"></a>Creating a Branch from a Stash</h3><p>If you stash some work, leave it there for a while, and continue on the branch from which you stashed the work, you may have a problem reapplying the work. If the apply tries to modify a file that you’ve since modified, you’ll get a merge conflict and will have to try to resolve it. If you want an easier way to test the stashed changes again, you can run <code>git stash branch &lt;branch&gt;</code>, which creates a new branch for you with your selected branch name, checks out the commit you were on when you stashed your work, reapplies your work there, and then drops the stash if it applies successfully:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git stash branch testchanges</span><br><span class="line">M	index.html</span><br><span class="line">M	lib/simplegit.rb</span><br><span class="line">Switched to a new branch <span class="string">'testchanges'</span></span><br><span class="line">On branch testchanges</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	modified:   index.html</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">	modified:   lib/simplegit.rb</span><br><span class="line"></span><br><span class="line">Dropped refs/stash@&#123;0&#125; (29d385a81d163dfd45a452a2ce816487a6b8b014)</span><br></pre></td></tr></table></figure>
<p>This is a nice shortcut to recover stashed work easily and work on it in a new branch.</p>
<h3 id="Cleaning-your-Working-Directory"><a href="#Cleaning-your-Working-Directory" class="headerlink" title="Cleaning your Working Directory"></a>Cleaning your Working Directory</h3><p>Finally, you may not want to stash some work or files in your working directory, but simply get rid of them. The <code>git clean</code> command will do this for you.</p>
<p>Some common reasons for this might be to remove cruft that has been generated by merges or external tools or to remove build artifacts in order to run a clean build.</p>
<p>You’ll want to be pretty careful with this command, since it’s designed to remove files from your working directory that are not tracked. If you change your mind, there is often no retrieving the content of those files. A safer option is to run <code>git stash --all</code> to remove everything but save it in a stash.</p>
<p>Assuming you do want to remove cruft files or clean your working directory, you can do so with <code>git clean</code>. To remove all the untracked files in your working directory, you can run <code>git clean -f -d</code>, which removes any files and also any subdirectories that become empty as a result. The <code>-f</code> means <em>force</em> or “really do this”.</p>
<p>If you ever want to see what it would do, you can run the command with the <code>-n</code> option, which means “do a dry run and tell me what you <em>would</em> have removed”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clean -d -n</span><br><span class="line">Would remove test.o</span><br><span class="line">Would remove tmp/</span><br></pre></td></tr></table></figure>
<p>By default, the <code>git clean</code> command will only remove untracked files that are not ignored. Any file that matches a pattern in your <code>.gitignore</code> or other ignore files will not be removed. If you want to remove those files too, such as to remove all <code>.o</code> files generated from a build so you can do a fully clean build, you can add a <code>-x</code> to the clean command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s</span><br><span class="line"> M lib/simplegit.rb</span><br><span class="line">?? build.TMP</span><br><span class="line">?? tmp/</span><br><span class="line"></span><br><span class="line">$ git clean -n -d</span><br><span class="line">Would remove build.TMP</span><br><span class="line">Would remove tmp/</span><br><span class="line"></span><br><span class="line">$ git clean -n -d -x</span><br><span class="line">Would remove build.TMP</span><br><span class="line">Would remove test.o</span><br><span class="line">Would remove tmp/</span><br></pre></td></tr></table></figure>
<p>If you don’t know what the <code>git clean</code> command is going to do, always run it with a <code>-n</code> first to double check before changing the <code>-n</code> to a <code>-f</code> and doing it for real. The other way you can be careful about the process is to run it with the <code>-i</code> or “interactive” flag.</p>
<p>This will run the clean command in an interactive mode.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git clean -x -i</span><br><span class="line">Would remove the following items:</span><br><span class="line">  build.TMP  test.o</span><br><span class="line">*** Commands ***</span><br><span class="line">    1: clean                2: filter by pattern    3: select by numbers    4: ask each             5: quit</span><br><span class="line">    6: <span class="built_in">help</span></span><br><span class="line">What now&gt;</span><br></pre></td></tr></table></figure>
<p>This way you can step through each file individually or specify patterns for deletion interactively.</p>
<p>There is a quirky situation where you might need to be extra forceful in asking Git to clean your working directory. If you happen to be in a working directory under which you’ve copied or cloned other Git repositories (perhaps as submodules), even <code>git clean -fd</code> will refuse to delete those directories. In cases like that, you need to add a second <code>-f</code> option for emphasis.</p>
<h2 id="Signing-Your-Work"><a href="#Signing-Your-Work" class="headerlink" title="Signing Your Work"></a>Signing Your Work</h2><p>Git is cryptographically secure, but it’s not foolproof. If you’re taking work from others on the internet and want to verify that commits are actually from a trusted source, Git has a few ways to sign and verify work using GPG.</p>
<h3 id="GPG-Introduction"><a href="#GPG-Introduction" class="headerlink" title="GPG Introduction"></a>GPG Introduction</h3><p>First of all, if you want to sign anything you need to get GPG configured and your personal key installed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --list-keys</span><br><span class="line">/Users/schacon/.gnupg/pubring.gpg</span><br><span class="line">---------------------------------</span><br><span class="line">pub   2048R/0A46826A 2014-06-04</span><br><span class="line">uid                  Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;</span><br><span class="line">sub   2048R/874529A9 2014-06-04</span><br></pre></td></tr></table></figure>
<p>If you don’t have a key installed, you can generate one with <code>gpg --gen-key</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --gen-key</span><br></pre></td></tr></table></figure>
<p>Once you have a private key to sign with, you can configure Git to use it for signing things by setting the <code>user.signingkey</code> config setting.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.signingkey 0A46826A</span><br></pre></td></tr></table></figure>
<p>Now Git will use your key by default to sign tags and commits if you want.</p>
<h3 id="Signing-Tags"><a href="#Signing-Tags" class="headerlink" title="Signing Tags"></a>Signing Tags</h3><p>If you have a GPG private key setup, you can now use it to sign new tags. All you have to do is use <code>-s</code> instead of <code>-a</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -s v1.5 -m <span class="string">'my signed 1.5 tag'</span></span><br><span class="line"></span><br><span class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></span><br><span class="line">user: <span class="string">"Ben Straub &lt;ben@straub.cc&gt;"</span></span><br><span class="line">2048-bit RSA key, ID 800430EB, created 2014-05-04</span><br></pre></td></tr></table></figure>
<p>If you run <code>git show</code> on that tag, you can see your GPG signature attached to it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ git show v1.5</span><br><span class="line">tag v1.5</span><br><span class="line">Tagger: Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">Date:   Sat May 3 20:29:41 2014 -0700</span><br><span class="line"></span><br><span class="line">my signed 1.5 tag</span><br><span class="line">-----BEGIN PGP SIGNATURE-----</span><br><span class="line">Version: GnuPG v1</span><br><span class="line"></span><br><span class="line">iQEcBAABAgAGBQJTZbQlAAoJEF0+sviABDDrZbQH/09PfE51KPVPlanr6q1v4/Ut</span><br><span class="line">LQxfojUWiLQdg2ESJItkcuweYg+kc3HCyFejeDIBw9dpXt00rY26p05qrpnG+85b</span><br><span class="line">hM1/PswpPLuBSr+oCIDj5GMC2r2iEKsfv2fJbNW8iWAXVLoWZRF8B0MfqX/YTMbm</span><br><span class="line">ecorc4iXzQu7tupRihslbNkfvfciMnSDeSvzCpWAHl7h8Wj6hhqePmLm9lAYqnKp</span><br><span class="line">8S5B/1SSQuEAjRZgI4IexpZoeKGVDptPHxLLS38fozsyi0QyDyzEgJxcJQVMXxVi</span><br><span class="line">RUysgqjcpT8+iQM1PblGfHR4XAhuOqN5Fx06PSaFZhqvWFezJ28/CLyX5q+oIVk=</span><br><span class="line">=EFTF</span><br><span class="line">-----END PGP SIGNATURE-----</span><br><span class="line"></span><br><span class="line">commit ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">Author: Scott Chacon &lt;schacon@gee-mail.com&gt;</span><br><span class="line">Date:   Mon Mar 17 21:52:11 2008 -0700</span><br><span class="line"></span><br><span class="line">    changed the version number</span><br></pre></td></tr></table></figure>
<h3 id="Verifying-Tags"><a href="#Verifying-Tags" class="headerlink" title="Verifying Tags"></a>Verifying Tags</h3><p>To verify a signed tag, you use <code>git tag -v &lt;tag-name&gt;</code>. This command uses GPG to verify the signature. You need the signer’s public key in your keyring for this to work properly:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -v v1.4.2.1</span><br><span class="line">object 883653babd8ee7ea23e6a5c392bb739348b1eb61</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v1.4.2.1</span><br><span class="line">tagger Junio C Hamano &lt;junkio@cox.net&gt; 1158138501 -0700</span><br><span class="line"></span><br><span class="line">GIT 1.4.2.1</span><br><span class="line"></span><br><span class="line">Minor fixes since 1.4.2, including git-mv and git-http with alternates.</span><br><span class="line">gpg: Signature made Wed Sep 13 02:08:25 2006 PDT using DSA key ID F3119B9A</span><br><span class="line">gpg: Good signature from <span class="string">"Junio C Hamano &lt;junkio@cox.net&gt;"</span></span><br><span class="line">gpg:                 aka <span class="string">"[jpeg image of size 1513]"</span></span><br><span class="line">Primary key fingerprint: 3565 2A26 2040 E066 C9A7  4A7D C0C6 D9A4 F311 9B9A</span><br></pre></td></tr></table></figure>
<p>If you don’t have the signer’s public key, you get something like this instead:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpg: Signature made Wed Sep 13 02:08:25 2006 PDT using DSA key ID F3119B9A</span><br><span class="line">gpg: Can<span class="string">'t check signature: public key not found</span></span><br><span class="line"><span class="string">error: could not verify the tag '</span>v1.4.2.1<span class="string">'</span></span><br></pre></td></tr></table></figure>
<h3 id="Signing-Commits"><a href="#Signing-Commits" class="headerlink" title="Signing Commits"></a>Signing Commits</h3><p>In more recent versions of Git (v1.7.9 and above), you can now also sign individual commits. If you’re interested in signing commits directly instead of just the tags, all you need to do is add a <code>-S</code> to your <code>git commit</code> command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -a -S -m <span class="string">'signed commit'</span></span><br><span class="line"></span><br><span class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></span><br><span class="line">user: <span class="string">"Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;"</span></span><br><span class="line">2048-bit RSA key, ID 0A46826A, created 2014-06-04</span><br><span class="line"></span><br><span class="line">[master 5c3386c] signed commit</span><br><span class="line"> 4 files changed, 4 insertions(+), 24 deletions(-)</span><br><span class="line"> rewrite Rakefile (100%)</span><br><span class="line"> create mode 100644 lib/git.rb</span><br></pre></td></tr></table></figure>
<p>To see and verify these signatures, there is also a <code>--show-signature</code> option to <code>git log</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --show-signature -1</span><br><span class="line">commit 5c3386cf54bba0a33a32da706aa52bc0155503c2</span><br><span class="line">gpg: Signature made Wed Jun  4 19:49:17 2014 PDT using RSA key ID 0A46826A</span><br><span class="line">gpg: Good signature from <span class="string">"Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;"</span></span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Wed Jun 4 19:49:17 2014 -0700</span><br><span class="line"></span><br><span class="line">    signed commit</span><br></pre></td></tr></table></figure>
<p>Additionally, you can configure <code>git log</code> to check any signatures it finds and list them in its output with the <code>%G?</code> format.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=<span class="string">"format:%h %G? %aN  %s"</span></span><br><span class="line"></span><br><span class="line">5c3386c G Scott Chacon  signed commit</span><br><span class="line">ca82a6d N Scott Chacon  changed the version number</span><br><span class="line">085bb3b N Scott Chacon  removed unnecessary <span class="built_in">test</span> code</span><br><span class="line">a11bef0 N Scott Chacon  first commit</span><br></pre></td></tr></table></figure>
<p>Here we can see that only the latest commit is signed and valid and the previous commits are not.</p>
<p>In Git 1.8.3 and later, <code>git merge</code> and <code>git pull</code> can be told to inspect and reject when merging a commit that does not carry a trusted GPG signature with the <code>--verify-signatures</code> command.</p>
<p>If you use this option when merging a branch and it contains commits that are not signed and valid, the merge will not work.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --verify-signatures non-verify</span><br><span class="line">fatal: Commit ab06180 does not have a GPG signature.</span><br></pre></td></tr></table></figure>
<p>If the merge contains only valid signed commits, the merge command will show you all the signatures it has checked and then move forward with the merge.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --verify-signatures signed-branch</span><br><span class="line">Commit 13ad65e has a good GPG signature by Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;</span><br><span class="line">Updating 5c3386c..13ad65e</span><br><span class="line">Fast-forward</span><br><span class="line"> README | 2 ++</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br></pre></td></tr></table></figure>
<p>You can also use the <code>-S</code> option with the <code>git merge</code> command to sign the resulting merge commit itself. The following example both verifies that every commit in the branch to be merged is signed and furthermore signs the resulting merge commit.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --verify-signatures -S  signed-branch</span><br><span class="line">Commit 13ad65e has a good GPG signature by Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;</span><br><span class="line"></span><br><span class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></span><br><span class="line">user: <span class="string">"Scott Chacon (Git signing key) &lt;schacon@gmail.com&gt;"</span></span><br><span class="line">2048-bit RSA key, ID 0A46826A, created 2014-06-04</span><br><span class="line"></span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> README | 2 ++</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br></pre></td></tr></table></figure>
<h3 id="Everyone-Must-Sign"><a href="#Everyone-Must-Sign" class="headerlink" title="Everyone Must Sign"></a>Everyone Must Sign</h3><p>Signing tags and commits is great, but if you decide to use this in your normal workflow, you’ll have to make sure that everyone on your team understands how to do so. If you don’t, you’ll end up spending a lot of time helping people figure out how to rewrite their commits with signed versions. Make sure you understand GPG and the benefits of signing things before adopting this as part of your standard workflow.</p>
<h2 id="Searching"><a href="#Searching" class="headerlink" title="Searching"></a>Searching</h2><p>With just about any size codebase, you’ll often need to find where a function is called or defined, or display the history of a method. Git provides a couple of useful tools for looking through the code and commits stored in its database quickly and easily. We’ll go through a few of them.</p>
<h3 id="Git-Grep"><a href="#Git-Grep" class="headerlink" title="Git Grep"></a>Git Grep</h3><p>Git ships with a command called <code>grep</code> that allows you to easily search through any committed tree, the working directory, or even the index for a string or regular expression. For the examples that follow, we’ll search through the source code for Git itself.</p>
<p>By default, <code>git grep</code> will look through the files in your working directory. As a first variation, you can use either of the <code>-n</code> or <code>--line-number</code> options to print out the line numbers where Git has found matches:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git grep -n gmtime_r</span><br><span class="line">compat/gmtime.c:3:<span class="comment">#undef gmtime_r</span></span><br><span class="line">compat/gmtime.c:8:      <span class="built_in">return</span> git_gmtime_r(timep, &amp;result);</span><br><span class="line">compat/gmtime.c:11:struct tm *git_gmtime_r(const time_t *timep, struct tm *result)</span><br><span class="line">compat/gmtime.c:16:     ret = gmtime_r(timep, result);</span><br><span class="line">compat/mingw.c:826:struct tm *gmtime_r(const time_t *timep, struct tm *result)</span><br><span class="line">compat/mingw.h:206:struct tm *gmtime_r(const time_t *timep, struct tm *result);</span><br><span class="line">date.c:482:             <span class="keyword">if</span> (gmtime_r(&amp;now, &amp;now_tm))</span><br><span class="line">date.c:545:             <span class="keyword">if</span> (gmtime_r(&amp;time, tm)) &#123;</span><br><span class="line">date.c:758:             /* gmtime_r() <span class="keyword">in</span> match_digit() may have clobbered it */</span><br><span class="line">git-compat-util.h:1138:struct tm *git_gmtime_r(const time_t *, struct tm *);</span><br><span class="line">git-compat-util.h:1140:<span class="comment">#define gmtime_r git_gmtime_r</span></span><br></pre></td></tr></table></figure>
<p>In addition to the basic search shown above, <code>git grep</code> supports a plethora of other interesting options.</p>
<p>For instance, instead of printing all of the matches, you can ask <code>git grep</code> to summarize the output by showing you only which files contained the search string and how many matches there were in each file with the <code>-c</code> or <code>--count</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git grep --count gmtime_r</span><br><span class="line">compat/gmtime.c:4</span><br><span class="line">compat/mingw.c:1</span><br><span class="line">compat/mingw.h:1</span><br><span class="line">date.c:3</span><br><span class="line">git-compat-util.h:2</span><br></pre></td></tr></table></figure>
<p>If you’re interested in the <em>context</em> of a search string, you can display the enclosing method or function for each matching string with either of the <code>-p</code> or <code>--show-function</code> options:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git grep -p gmtime_r *.c</span><br><span class="line">date.c=static int match_multi_number(timestamp_t num, char c, const char *date,</span><br><span class="line">date.c:         <span class="keyword">if</span> (gmtime_r(&amp;now, &amp;now_tm))</span><br><span class="line">date.c=static int match_digit(const char *date, struct tm *tm, int *offset, int *tm_gmt)</span><br><span class="line">date.c:         <span class="keyword">if</span> (gmtime_r(&amp;time, tm)) &#123;</span><br><span class="line">date.c=int parse_date_basic(const char *date, timestamp_t *timestamp, int *offset)</span><br><span class="line">date.c:         /* gmtime_r() <span class="keyword">in</span> match_digit() may have clobbered it */</span><br></pre></td></tr></table></figure>
<p>As you can see, the <code>gmtime_r</code> routine is called from both the <code>match_multi_number</code> and <code>match_digit</code> functions in the <code>date.c</code> file (the third match displayed represents just the string appearing in a comment).</p>
<p>You can also search for complex combinations of strings with the <code>--and</code> flag, which ensures that multiple matches must occur in the same line of text. For instance, let’s look for any lines that define a constant whose name contains <em>either</em> of the substrings “LINK” or “BUF_MAX”, specifically in an older version of the Git codebase represented by the tag <code>v1.8.0</code> (we’ll throw in the <code>--break</code> and <code>--heading</code> options which help split up the output into a more readable format):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ git grep --<span class="built_in">break</span> --heading \</span><br><span class="line">    -n -e <span class="string">'#define'</span> --and \( -e LINK -e BUF_MAX \) v1.8.0</span><br><span class="line">v1.8.0:<span class="built_in">builtin</span>/index-pack.c</span><br><span class="line">62:<span class="comment">#define FLAG_LINK (1u&lt;&lt;20)</span></span><br><span class="line"></span><br><span class="line">v1.8.0:cache.h</span><br><span class="line">73:<span class="comment">#define S_IFGITLINK  0160000</span></span><br><span class="line">74:<span class="comment">#define S_ISGITLINK(m)       (((m) &amp; S_IFMT) == S_IFGITLINK)</span></span><br><span class="line"></span><br><span class="line">v1.8.0:environment.c</span><br><span class="line">54:<span class="comment">#define OBJECT_CREATION_MODE OBJECT_CREATION_USES_HARDLINKS</span></span><br><span class="line"></span><br><span class="line">v1.8.0:strbuf.c</span><br><span class="line">326:<span class="comment">#define STRBUF_MAXLINK (2*PATH_MAX)</span></span><br><span class="line"></span><br><span class="line">v1.8.0:symlinks.c</span><br><span class="line">53:<span class="comment">#define FL_SYMLINK  (1 &lt;&lt; 2)</span></span><br><span class="line"></span><br><span class="line">v1.8.0:zlib.c</span><br><span class="line">30:/* <span class="comment">#define ZLIB_BUF_MAX ((uInt)-1) */</span></span><br><span class="line">31:<span class="comment">#define ZLIB_BUF_MAX ((uInt) 1024 * 1024 * 1024) /* 1GB */</span></span><br></pre></td></tr></table></figure>
<p>The <code>git grep</code> command has a few advantages over normal searching commands like <code>grep</code> and <code>ack</code>. The first is that it’s really fast, the second is that you can search through any tree in Git, not just the working directory. As we saw in the above example, we looked for terms in an older version of the Git source code, not the version that was currently checked out.</p>
<h3 id="Git-Log-Searching"><a href="#Git-Log-Searching" class="headerlink" title="Git Log Searching"></a>Git Log Searching</h3><p>Perhaps you’re looking not for <em>where</em> a term exists, but <em>when</em> it existed or was introduced. The <code>git log</code> command has a number of powerful tools for finding specific commits by the content of their messages or even the content of the diff they introduce.</p>
<p>If, for example, we want to find out when the <code>ZLIB_BUF_MAX</code> constant was originally introduced, we can use the <code>-S</code> option (colloquially referred to as the Git “pickaxe” option) to tell Git to show us only those commits that changed the number of occurrences of that string.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -S ZLIB_BUF_MAX --oneline</span><br><span class="line">e01503b zlib: allow feeding more than 4GB <span class="keyword">in</span> one go</span><br><span class="line">ef49a7a zlib: zlib can only process 4GB at a time</span><br></pre></td></tr></table></figure>
<p>If we look at the diff of those commits, we can see that in <code>ef49a7a</code> the constant was introduced and in <code>e01503b</code> it was modified.</p>
<p>If you need to be more specific, you can provide a regular expression to search for with the <code>-G</code> option.</p>
<h4 id="Line-Log-Search"><a href="#Line-Log-Search" class="headerlink" title="Line Log Search"></a>Line Log Search</h4><p>Another fairly advanced log search that is insanely useful is the line history search. Simply run <code>git log</code> with the <code>-L</code> option, and it will show you the history of a function or line of code in your codebase.</p>
<p>For example, if we wanted to see every change made to the function <code>git_deflate_bound</code> in the <code>zlib.c</code> file, we could run <code>git log -L :git_deflate_bound:zlib.c</code>. This will try to figure out what the bounds of that function are and then look through the history and show us every change that was made to the function as a series of patches back to when the function was first created.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -L :git_deflate_bound:zlib.c</span><br><span class="line">commit ef49a7a0126d64359c974b4b3b71d7ad42ee3bca</span><br><span class="line">Author: Junio C Hamano &lt;gitster@pobox.com&gt;</span><br><span class="line">Date:   Fri Jun 10 11:52:15 2011 -0700</span><br><span class="line"></span><br><span class="line">    zlib: zlib can only process 4GB at a time</span><br><span class="line"></span><br><span class="line">diff --git a/zlib.c b/zlib.c</span><br><span class="line">--- a/zlib.c</span><br><span class="line">+++ b/zlib.c</span><br><span class="line">@@ -85,5 +130,5 @@</span><br><span class="line">-unsigned long git_deflate_bound(z_streamp strm, unsigned long size)</span><br><span class="line">+unsigned long git_deflate_bound(git_zstream *strm, unsigned long size)</span><br><span class="line"> &#123;</span><br><span class="line">-       <span class="built_in">return</span> deflateBound(strm, size);</span><br><span class="line">+       <span class="built_in">return</span> deflateBound(&amp;strm-&gt;z, size);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">commit 225a6f1068f71723a910e8565db4e252b3ca21fa</span><br><span class="line">Author: Junio C Hamano &lt;gitster@pobox.com&gt;</span><br><span class="line">Date:   Fri Jun 10 11:18:17 2011 -0700</span><br><span class="line"></span><br><span class="line">    zlib: wrap deflateBound() too</span><br><span class="line"></span><br><span class="line">diff --git a/zlib.c b/zlib.c</span><br><span class="line">--- a/zlib.c</span><br><span class="line">+++ b/zlib.c</span><br><span class="line">@@ -81,0 +85,5 @@</span><br><span class="line">+unsigned long git_deflate_bound(z_streamp strm, unsigned long size)</span><br><span class="line">+&#123;</span><br><span class="line">+       <span class="built_in">return</span> deflateBound(strm, size);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br></pre></td></tr></table></figure>
<p>If Git can’t figure out how to match a function or method in your programming language, you can also provide it with a regular expression (or <em>regex</em>). For example, this would have done the same thing as the example above: <code>git log -L &#39;/unsigned long git_deflate_bound/&#39;,/^}/:zlib.c</code>. You could also give it a range of lines or a single line number and you’ll get the same sort of output.</p>
<h2 id="Rewriting-History"><a href="#Rewriting-History" class="headerlink" title="Rewriting History"></a>Rewriting History</h2><p>Many times, when working with Git, you may want to revise your local commit history. One of the great things about Git is that it allows you to make decisions at the last possible moment. You can decide what files go into which commits right before you commit with the staging area, you can decide that you didn’t mean to be working on something yet with <code>git stash</code>, and you can rewrite commits that already happened so they look like they happened in a different way. This can involve changing the order of the commits, changing messages or modifying files in a commit, squashing together or splitting apart commits, or removing commits entirely — all before you share your work with others.</p>
<p>In this section, you’ll see how to accomplish these tasks so that you can make your commit history look the way you want before you share it with others.</p>
<p>One of the cardinal rules of Git is that, since so much work is local within your clone, you have a great deal of freedom to rewrite your history <em>locally</em>. However, once you push your work, it is a different story entirely, and you should consider pushed work as final unless you have good reason to change it. In short, you should avoid pushing your work until you’re happy with it and ready to share it with the rest of the world.</p>
<h3 id="Changing-the-Last-Commit"><a href="#Changing-the-Last-Commit" class="headerlink" title="Changing the Last Commit"></a>Changing the Last Commit</h3><p>Changing your most recent commit is probably the most common rewriting of history that you’ll do. You’ll often want to do two basic things to your last commit: simply change the commit message, or change the actual content of the commit by adding, removing and modifying files.</p>
<p>If you simply want to modify your last commit message, that’s easy:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<p>The command above loads the previous commit message into an editor session, where you can make changes to the message, save those changes and exit. When you save and close the editor, the editor writes a new commit containing that updated commit message and makes it your new last commit.</p>
<p>If, on the other hand, you want to change the actual <em>content</em> of your last commit, the process works basically the same way — first make the changes you think you forgot, stage those changes, and the subsequent <code>git commit --amend</code> <em>replaces</em> that last commit with your new, improved commit.</p>
<p>You need to be careful with this technique because amending changes the SHA-1 of the commit. It’s like a very small rebase — don’t amend your last commit if you’ve already pushed it.</p>
<h2 id="An-amended-commit-may-or-may-not-need-an-amended-commit-message"><a href="#An-amended-commit-may-or-may-not-need-an-amended-commit-message" class="headerlink" title="An amended commit may (or may not) need an amended commit message"></a>An amended commit may (or may not) need an amended commit message</h2><p>When you amend a commit, you have the opportunity to change both the commit message and the content of the commit. If you amend the content of the commit substantially, you should almost certainly update the commit message to reflect that amended content.</p>
<p>On the other hand, if your amendments are suitably trivial (fixing a silly typo or adding a file you forgot to stage) such that the earlier commit message is just fine, you can simply make the changes, stage them, and avoid the unnecessary editor session entirely with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit --amend --no-edit</span><br></pre></td></tr></table></figure>
<h3 id="Changing-Multiple-Commit-Messages"><a href="#Changing-Multiple-Commit-Messages" class="headerlink" title="Changing Multiple Commit Messages"></a>Changing Multiple Commit Messages</h3><p>To modify a commit that is farther back in your history, you must move to more complex tools. Git doesn’t have a modify-history tool, but you can use the rebase tool to rebase a series of commits onto the HEAD they were originally based on instead of moving them to another one. With the interactive rebase tool, you can then stop after each commit you want to modify and change the message, add files, or do whatever you wish. You can run rebase interactively by adding the <code>-i</code> option to <code>git rebase</code>. You must indicate how far back you want to rewrite commits by telling the command which commit to rebase onto.</p>
<p>For example, if you want to change the last three commit messages, or any of the commit messages in that group, you supply as an argument to <code>git rebase -i</code> the parent of the last commit you want to edit, which is <code>HEAD~2^</code> or <code>HEAD~3</code>. It may be easier to remember the <code>~3</code> because you’re trying to edit the last three commits, but keep in mind that you’re actually designating four commits ago, the parent of the last commit you want to edit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase -i HEAD~3</span><br></pre></td></tr></table></figure>
<p>Remember again that this is a rebasing command – every commit included in the range <code>HEAD~3..HEAD</code> will be rewritten, whether you change the message or not. Don’t include any commit you’ve already pushed to a central server – doing so will confuse other developers by providing an alternate version of the same change.</p>
<p>Running this command gives you a list of commits in your text editor that looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pick f7f3f6d changed my name a bit</span><br><span class="line">pick 310154e updated README formatting and added blame</span><br><span class="line">pick a5f4a0d added cat-file</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rebase 710f0f8..a5f4a0d onto 710f0f8</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment">#  p, pick = use commit</span></span><br><span class="line"><span class="comment">#  r, reword = use commit, but edit the commit message</span></span><br><span class="line"><span class="comment">#  e, edit = use commit, but stop for amending</span></span><br><span class="line"><span class="comment">#  s, squash = use commit, but meld into previous commit</span></span><br><span class="line"><span class="comment">#  f, fixup = like "squash", but discard this commit's log message</span></span><br><span class="line"><span class="comment">#  x, exec = run command (the rest of the line) using shell</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># These lines can be re-ordered; they are executed from top to bottom.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However, if you remove everything, the rebase will be aborted.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that empty commits are commented out</span></span><br></pre></td></tr></table></figure>
<p>It’s important to note that these commits are listed in the opposite order than you normally see them using the <code>log</code> command. If you run a <code>log</code>, you see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=format:<span class="string">"%h %s"</span> HEAD~3..HEAD</span><br><span class="line">a5f4a0d added cat-file</span><br><span class="line">310154e updated README formatting and added blame</span><br><span class="line">f7f3f6d changed my name a bit</span><br></pre></td></tr></table></figure>
<p>Notice the reverse order. The interactive rebase gives you a script that it’s going to run. It will start at the commit you specify on the command line (<code>HEAD~3</code>) and replay the changes introduced in each of these commits from top to bottom. It lists the oldest at the top, rather than the newest, because that’s the first one it will replay.</p>
<p>You need to edit the script so that it stops at the commit you want to edit. To do so, change the word ‘pick’ to the word ‘edit’ for each of the commits you want the script to stop after. For example, to modify only the third commit message, you change the file to look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">edit f7f3f6d changed my name a bit</span><br><span class="line">pick 310154e updated README formatting and added blame</span><br><span class="line">pick a5f4a0d added cat-file</span><br></pre></td></tr></table></figure>
<p>When you save and exit the editor, Git rewinds you back to the last commit in that list and drops you on the command line with the following message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase -i HEAD~3</span><br><span class="line">Stopped at f7f3f6d... changed my name a bit</span><br><span class="line">You can amend the commit now, with</span><br><span class="line"></span><br><span class="line">       git commit --amend</span><br><span class="line"></span><br><span class="line">Once you’re satisfied with your changes, run</span><br><span class="line"></span><br><span class="line">       git rebase --<span class="built_in">continue</span></span><br></pre></td></tr></table></figure>
<p>These instructions tell you exactly what to do. Type</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit --amend</span><br></pre></td></tr></table></figure>
<p>Change the commit message, and exit the editor. Then, run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase --<span class="built_in">continue</span></span><br></pre></td></tr></table></figure>
<p>This command will apply the other two commits automatically, and then you’re done. If you change pick to edit on more lines, you can repeat these steps for each commit you change to edit. Each time, Git will stop, let you amend the commit, and continue when you’re finished.</p>
<h3 id="Reordering-Commits"><a href="#Reordering-Commits" class="headerlink" title="Reordering Commits"></a>Reordering Commits</h3><p>You can also use interactive rebases to reorder or remove commits entirely. If you want to remove the “added cat-file” commit and change the order in which the other two commits are introduced, you can change the rebase script from this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick f7f3f6d changed my name a bit</span><br><span class="line">pick 310154e updated README formatting and added blame</span><br><span class="line">pick a5f4a0d added cat-file</span><br></pre></td></tr></table></figure>
<p>to this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pick 310154e updated README formatting and added blame</span><br><span class="line">pick f7f3f6d changed my name a bit</span><br></pre></td></tr></table></figure>
<p>When you save and exit the editor, Git rewinds your branch to the parent of these commits, applies <code>310154e</code> and then <code>f7f3f6d</code>, and then stops. You effectively change the order of those commits and remove the “added cat-file” commit completely.</p>
<h3 id="Squashing-Commits"><a href="#Squashing-Commits" class="headerlink" title="Squashing Commits"></a>Squashing Commits</h3><p>It’s also possible to take a series of commits and squash them down into a single commit with the interactive rebasing tool. The script puts helpful instructions in the rebase message:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Commands:</span></span><br><span class="line"><span class="comment">#  p, pick = use commit</span></span><br><span class="line"><span class="comment">#  r, reword = use commit, but edit the commit message</span></span><br><span class="line"><span class="comment">#  e, edit = use commit, but stop for amending</span></span><br><span class="line"><span class="comment">#  s, squash = use commit, but meld into previous commit</span></span><br><span class="line"><span class="comment">#  f, fixup = like "squash", but discard this commit's log message</span></span><br><span class="line"><span class="comment">#  x, exec = run command (the rest of the line) using shell</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># These lines can be re-ordered; they are executed from top to bottom.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However, if you remove everything, the rebase will be aborted.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that empty commits are commented out</span></span><br></pre></td></tr></table></figure>
<p>If, instead of “pick” or “edit”, you specify “squash”, Git applies both that change and the change directly before it and makes you merge the commit messages together. So, if you want to make a single commit from these three commits, you make the script look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick f7f3f6d changed my name a bit</span><br><span class="line">squash 310154e updated README formatting and added blame</span><br><span class="line">squash a5f4a0d added cat-file</span><br></pre></td></tr></table></figure>
<p>When you save and exit the editor, Git applies all three changes and then puts you back into the editor to merge the three commit messages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is a combination of 3 commits.</span></span><br><span class="line"><span class="comment"># The first commit's message is:</span></span><br><span class="line">changed my name a bit</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the 2nd commit message:</span></span><br><span class="line"></span><br><span class="line">updated README formatting and added blame</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is the 3rd commit message:</span></span><br><span class="line"></span><br><span class="line">added cat-file</span><br></pre></td></tr></table></figure>
<p>When you save that, you have a single commit that introduces the changes of all three previous commits.</p>
<h3 id="Splitting-a-Commit"><a href="#Splitting-a-Commit" class="headerlink" title="Splitting a Commit"></a>Splitting a Commit</h3><p>Splitting a commit undoes a commit and then partially stages and commits as many times as commits you want to end up with. For example, suppose you want to split the middle commit of your three commits. Instead of “updated README formatting and added blame”, you want to split it into two commits: “updated README formatting” for the first, and “added blame” for the second. You can do that in the <code>rebase -i</code> script by changing the instruction on the commit you want to split to “edit”:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pick f7f3f6d changed my name a bit</span><br><span class="line">edit 310154e updated README formatting and added blame</span><br><span class="line">pick a5f4a0d added cat-file</span><br></pre></td></tr></table></figure>
<p>Then, when the script drops you to the command line, you reset that commit, take the changes that have been reset, and create multiple commits out of them. When you save and exit the editor, Git rewinds to the parent of the first commit in your list, applies the first commit (<code>f7f3f6d</code>), applies the second (<code>310154e</code>), and drops you to the console. There, you can do a mixed reset of that commit with <code>git reset HEAD^</code>, which effectively undoes that commit and leaves the modified files unstaged. Now you can stage and commit files until you have several commits, and run <code>git rebase --continue</code> when you’re done:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git reset HEAD^</span><br><span class="line">$ git add README</span><br><span class="line">$ git commit -m <span class="string">'updated README formatting'</span></span><br><span class="line">$ git add lib/simplegit.rb</span><br><span class="line">$ git commit -m <span class="string">'added blame'</span></span><br><span class="line">$ git rebase --<span class="built_in">continue</span></span><br></pre></td></tr></table></figure>
<p>Git applies the last commit (<code>a5f4a0d</code>) in the script, and your history looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -4 --pretty=format:<span class="string">"%h %s"</span></span><br><span class="line">1c002dd added cat-file</span><br><span class="line">9b29157 added blame</span><br><span class="line">35cfb2b updated README formatting</span><br><span class="line">f3cc40e changed my name a bit</span><br></pre></td></tr></table></figure>
<p>Once again, this changes the SHA-1s of all the commits in your list, so make sure no commit shows up in that list that you’ve already pushed to a shared repository.</p>
<h3 id="The-Nuclear-Option-filter-branch"><a href="#The-Nuclear-Option-filter-branch" class="headerlink" title="The Nuclear Option: filter-branch"></a>The Nuclear Option: filter-branch</h3><p>There is another history-rewriting option that you can use if you need to rewrite a larger number of commits in some scriptable way – for instance, changing your email address globally or removing a file from every commit. The command is <code>filter-branch</code>, and it can rewrite huge swaths of your history, so you probably shouldn’t use it unless your project isn’t yet public and other people haven’t based work off the commits you’re about to rewrite. However, it can be very useful. You’ll learn a few of the common uses so you can get an idea of some of the things it’s capable of.</p>
<h4 id="Removing-a-File-from-Every-Commit"><a href="#Removing-a-File-from-Every-Commit" class="headerlink" title="Removing a File from Every Commit"></a>Removing a File from Every Commit</h4><p>This occurs fairly commonly. Someone accidentally commits a huge binary file with a thoughtless <code>git add .</code>, and you want to remove it everywhere. Perhaps you accidentally committed a file that contained a password, and you want to make your project open source. <code>filter-branch</code> is the tool you probably want to use to scrub your entire history. To remove a file named <code>passwords.txt</code> from your entire history, you can use the <code>--tree-filter</code> option to <code>filter-branch</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git filter-branch --tree-filter <span class="string">'rm -f passwords.txt'</span> HEAD</span><br><span class="line">Rewrite 6b9b3cf04e7c5686a9cb838c3f36a8cb6a0fc2bd (21/21)</span><br><span class="line">Ref <span class="string">'refs/heads/master'</span> was rewritten</span><br></pre></td></tr></table></figure>
<p>The <code>--tree-filter</code> option runs the specified command after each checkout of the project and then recommits the results. In this case, you remove a file called <code>passwords.txt</code> from every snapshot, whether it exists or not. If you want to remove all accidentally committed editor backup files, you can run something like <code>git filter-branch --tree-filter &#39;rm -f *~&#39; HEAD</code>.</p>
<p>You’ll be able to watch Git rewriting trees and commits and then move the branch pointer at the end. It’s generally a good idea to do this in a testing branch and then hard-reset your master branch after you’ve determined the outcome is what you really want. To run <code>filter-branch</code> on all your branches, you can pass <code>--all</code> to the command.</p>
<h4 id="Making-a-Subdirectory-the-New-Root"><a href="#Making-a-Subdirectory-the-New-Root" class="headerlink" title="Making a Subdirectory the New Root"></a>Making a Subdirectory the New Root</h4><p>Suppose you’ve done an import from another source control system and have subdirectories that make no sense (<code>trunk</code>, <code>tags</code>, and so on). If you want to make the <code>trunk</code> subdirectory be the new project root for every commit, <code>filter-branch</code> can help you do that, too:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git filter-branch --subdirectory-filter trunk HEAD</span><br><span class="line">Rewrite 856f0bf61e41a27326cdae8f09fe708d679f596f (12/12)</span><br><span class="line">Ref <span class="string">'refs/heads/master'</span> was rewritten</span><br></pre></td></tr></table></figure>
<p>Now your new project root is what was in the <code>trunk</code> subdirectory each time. Git will also automatically remove commits that did not affect the subdirectory.</p>
<h4 id="Changing-Email-Addresses-Globally"><a href="#Changing-Email-Addresses-Globally" class="headerlink" title="Changing Email Addresses Globally"></a>Changing Email Addresses Globally</h4><p>Another common case is that you forgot to run <code>git config</code> to set your name and email address before you started working, or perhaps you want to open-source a project at work and change all your work email addresses to your personal address. In any case, you can change email addresses in multiple commits in a batch with <code>filter-branch</code> as well. You need to be careful to change only the email addresses that are yours, so you use <code>--commit-filter</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git filter-branch --commit-filter <span class="string">'</span></span><br><span class="line"><span class="string">        if [ "$GIT_AUTHOR_EMAIL" = "schacon@localhost" ];</span></span><br><span class="line"><span class="string">        then</span></span><br><span class="line"><span class="string">                GIT_AUTHOR_NAME="Scott Chacon";</span></span><br><span class="line"><span class="string">                GIT_AUTHOR_EMAIL="schacon@example.com";</span></span><br><span class="line"><span class="string">                git commit-tree "$@";</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">                git commit-tree "$@";</span></span><br><span class="line"><span class="string">        fi'</span> HEAD</span><br></pre></td></tr></table></figure>
<p>This goes through and rewrites every commit to have your new address. Because commits contain the SHA-1 values of their parents, this command changes every commit SHA-1 in your history, not just those that have the matching email address.</p>
<h2 id="Reset-Demystified"><a href="#Reset-Demystified" class="headerlink" title="Reset Demystified"></a>Reset Demystified</h2><p>Before moving on to more specialized tools, let’s talk about the Git <code>reset</code> and <code>checkout</code> commands. These commands are two of the most confusing parts of Git when you first encounter them. They do so many things that it seems hopeless to actually understand them and employ them properly. For this, we recommend a simple metaphor.</p>
<h3 id="The-Three-Trees"><a href="#The-Three-Trees" class="headerlink" title="The Three Trees"></a>The Three Trees</h3><p>An easier way to think about <code>reset</code> and <code>checkout</code> is through the mental frame of Git being a content manager of three different trees. By “tree” here, we really mean “collection of files”, not specifically the data structure. (There are a few cases where the index doesn’t exactly act like a tree, but for our purposes it is easier to think about it this way for now.)</p>
<p>Git as a system manages and manipulates three trees in its normal operation:</p>
<p>Tree Role     HEAD</p>
<p>Last commit snapshot, next parent</p>
<p>Index</p>
<p>Proposed next commit snapshot</p>
<p>Working Directory</p>
<p>Sandbox</p>
<h4 id="The-HEAD"><a href="#The-HEAD" class="headerlink" title="The HEAD"></a>The HEAD</h4><p>HEAD is the pointer to the current branch reference, which is in turn a pointer to the last commit made on that branch. That means HEAD will be the parent of the next commit that is created. It’s generally simplest to think of HEAD as the snapshot of <strong>your last commit on that branch</strong>.</p>
<p>In fact, it’s pretty easy to see what that snapshot looks like. Here is an example of getting the actual directory listing and SHA-1 checksums for each file in the HEAD snapshot:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p HEAD</span><br><span class="line">tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">author Scott Chacon  1301511835 -0700</span><br><span class="line">committer Scott Chacon  1301511835 -0700</span><br><span class="line"></span><br><span class="line">initial commit</span><br><span class="line"></span><br><span class="line">$ git ls-tree -r HEAD</span><br><span class="line">100644 blob a906cb2a4a904a152...   README</span><br><span class="line">100644 blob 8f94139338f9404f2...   Rakefile</span><br><span class="line">040000 tree 99f1a6d12cb4b6f19...   lib</span><br></pre></td></tr></table></figure>
<p>The Git <code>cat-file</code> and <code>ls-tree</code> commands are “plumbing” commands that are used for lower level things and not really used in day-to-day work, but they help us see what’s going on here.</p>
<h4 id="The-Index"><a href="#The-Index" class="headerlink" title="The Index"></a>The Index</h4><p>The Index is your <strong>proposed next commit</strong>. We’ve also been referring to this concept as Git’s “Staging Area” as this is what Git looks at when you run <code>git commit</code>.</p>
<p>Git populates this index with a list of all the file contents that were last checked out into your working directory and what they looked like when they were originally checked out. You then replace some of those files with new versions of them, and <code>git commit</code> converts that into the tree for a new commit.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files -s</span><br><span class="line">100644 a906cb2a4a904a152e80877d4088654daad0c859 0	README</span><br><span class="line">100644 8f94139338f9404f26296befa88755fc2598c289 0	Rakefile</span><br><span class="line">100644 47c6340d6459e05787f644c2447d2595f5d3a54b 0	lib/simplegit.rb</span><br></pre></td></tr></table></figure>
<p>Again, here we’re using <code>git ls-files</code>, which is more of a behind the scenes command that shows you what your index currently looks like.</p>
<p>The index is not technically a tree structure — it’s actually implemented as a flattened manifest — but for our purposes it’s close enough.</p>
<h4 id="The-Working-Directory"><a href="#The-Working-Directory" class="headerlink" title="The Working Directory"></a>The Working Directory</h4><p>Finally, you have your working directory. The other two trees store their content in an efficient but inconvenient manner, inside the <code>.git</code> folder. The Working Directory unpacks them into actual files, which makes it much easier for you to edit them. Think of the Working Directory as a <strong>sandbox</strong>, where you can try changes out before committing them to your staging area (index) and then to history.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── README</span><br><span class="line">├── Rakefile</span><br><span class="line">└── lib</span><br><span class="line">    └── simplegit.rb</span><br><span class="line"></span><br><span class="line">1 directory, 3 files</span><br></pre></td></tr></table></figure>
<h3 id="The-Workflow"><a href="#The-Workflow" class="headerlink" title="The Workflow"></a>The Workflow</h3><p>Git’s main purpose is to record snapshots of your project in successively better states, by manipulating these three trees.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci1r21kj20m80c9mx9.jpg" alt="reset workflow">   Let’s visualize this process: say you go into a new directory with a single file in it. We’ll call this <strong>v1</strong> of the file, and we’ll indicate it in blue. Now we run <code>git init</code>, which will create a Git repository with a HEAD reference which points to an unborn branch (<code>master</code> doesn’t exist yet).</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci8cnzmj20m80hvt8r.jpg" alt="reset ex1">   At this point, only the Working Directory tree has any content.</p>
<p>Now we want to commit this file, so we use <code>git add</code> to take content in the Working Directory and copy it to the Index.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcihl1smj20m80j03yn.jpg" alt="reset ex2">   Then we run <code>git commit</code>, which takes the contents of the Index and saves it as a permanent snapshot, creates a commit object which points to that snapshot, and updates <code>master</code> to point to that commit.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoj2ss7j20m80ji74k.jpg" alt="reset ex3">   If we run <code>git status</code>, we’ll see no changes, because all three trees are the same.</p>
<p>Now we want to make a change to that file and commit it. We’ll go through the same process; first we change the file in our working directory. Let’s call this <strong>v2</strong> of the file, and indicate it in red.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcispl9vj20m80ji3ys.jpg" alt="reset ex4">   If we run <code>git status</code> right now, we’ll see the file in red as “Changes not staged for commit,” because that entry differs between the Index and the Working Directory. Next we run <code>git add</code> on it to stage it into our Index.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoom7ctj20m80ji74k.jpg" alt="reset ex5">   At this point, if we run <code>git status</code>, we will see the file in green under “Changes to be committed” because the Index and HEAD differ — that is, our proposed next commit is now different from our last commit. Finally, we run <code>git commit</code> to finalize the commit.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcilbidwj20m80jidg7.jpg" alt="reset ex6">   Now <code>git status</code> will give us no output, because all three trees are the same again.</p>
<p>Switching branches or cloning goes through a similar process. When you checkout a branch, it changes <strong>HEAD</strong> to point to the new branch ref, populates your <strong>Index</strong> with the snapshot of that commit, then copies the contents of the <strong>Index</strong> into your <strong>Working Directory</strong>.</p>
<h3 id="The-Role-of-Reset"><a href="#The-Role-of-Reset" class="headerlink" title="The Role of Reset"></a>The Role of Reset</h3><p>The <code>reset</code> command makes more sense when viewed in this context.</p>
<p>For the purposes of these examples, let’s say that we’ve modified <code>file.txt</code> again and committed it a third time. So now our history looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjwy6qoj20m80ia3yw.jpg" alt="reset start">   Let’s now walk through exactly what <code>reset</code> does when you call it. It directly manipulates these three trees in a simple and predictable way. It does up to three basic operations.</p>
<h4 id="Step-1-Move-HEAD"><a href="#Step-1-Move-HEAD" class="headerlink" title="Step 1: Move HEAD"></a>Step 1: Move HEAD</h4><p>The first thing <code>reset</code> will do is move what HEAD points to. This isn’t the same as changing HEAD itself (which is what <code>checkout</code> does); <code>reset</code> moves the branch that HEAD is pointing to. This means if HEAD is set to the <code>master</code> branch (i.e. you’re currently on the <code>master</code> branch), running <code>git reset 9e5e6a4</code> will start by making <code>master</code> point to <code>9e5e6a4</code>.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchwczxwj20m80jit97.jpg" alt="reset soft">   No matter what form of <code>reset</code> with a commit you invoke, this is the first thing it will always try to do. With <code>reset --soft</code>, it will simply stop there.</p>
<p>Now take a second to look at that diagram and realize what happened: it essentially undid the last <code>git commit</code> command. When you run <code>git commit</code>, Git creates a new commit and moves the branch that HEAD points to up to it. When you <code>reset</code> back to <code>HEAD~</code> (the parent of HEAD), you are moving the branch back to where it was, without changing the Index or Working Directory. You could now update the Index and run <code>git commit</code> again to accomplish what <code>git commit --amend</code> would have done (see 【Changing the Last Commit】).</p>
<h4 id="Step-2-Updating-the-Index-–mixed"><a href="#Step-2-Updating-the-Index-–mixed" class="headerlink" title="Step 2: Updating the Index (–mixed)"></a>Step 2: Updating the Index (–mixed)</h4><p>Note that if you run <code>git status</code> now you’ll see in green the difference between the Index and what the new HEAD is.</p>
<p>The next thing <code>reset</code> will do is to update the Index with the contents of whatever snapshot HEAD now points to.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm3zt05j20m80jiq3g.jpg" alt="reset mixed">   If you specify the <code>--mixed</code> option, <code>reset</code> will stop at this point. This is also the default, so if you specify no option at all (just <code>git reset HEAD~</code> in this case), this is where the command will stop.</p>
<p>Now take another second to look at that diagram and realize what happened: it still undid your last <code>commit</code>, but also <em>unstaged</em> everything. You rolled back to before you ran all your <code>git add</code> and <code>git commit</code> commands.</p>
<h4 id="Step-3-Updating-the-Working-Directory-–hard"><a href="#Step-3-Updating-the-Working-Directory-–hard" class="headerlink" title="Step 3: Updating the Working Directory (–hard)"></a>Step 3: Updating the Working Directory (–hard)</h4><p>The third thing that <code>reset</code> will do is to make the Working Directory look like the Index. If you use the <code>--hard</code> option, it will continue to this stage.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciu3dyij20m80jimxo.jpg" alt="reset hard">   So let’s think about what just happened. You undid your last commit, the <code>git add</code> and <code>git commit</code> commands, <strong>and</strong> all the work you did in your working directory.</p>
<p>It’s important to note that this flag (<code>--hard</code>) is the only way to make the <code>reset</code> command dangerous, and one of the very few cases where Git will actually destroy data. Any other invocation of <code>reset</code> can be pretty easily undone, but the <code>--hard</code> option cannot, since it forcibly overwrites files in the Working Directory. In this particular case, we still have the <strong>v3</strong> version of our file in a commit in our Git DB, and we could get it back by looking at our <code>reflog</code>, but if we had not committed it, Git still would have overwritten the file and it would be unrecoverable.</p>
<h4 id="Recap"><a href="#Recap" class="headerlink" title="Recap"></a>Recap</h4><p>The <code>reset</code> command overwrites these three trees in a specific order, stopping when you tell it to:</p>
<ol start="2">
<li>Move the branch HEAD points to <em>(stop here if <code>--soft</code>)</em></li>
<li>Make the Index look like HEAD <em>(stop here unless <code>--hard</code>)</em></li>
<li>Make the Working Directory look like the Index</li>
</ol>
<h3 id="Reset-With-a-Path"><a href="#Reset-With-a-Path" class="headerlink" title="Reset With a Path"></a>Reset With a Path</h3><p>That covers the behavior of <code>reset</code> in its basic form, but you can also provide it with a path to act upon. If you specify a path, <code>reset</code> will skip step 1, and limit the remainder of its actions to a specific file or set of files. This actually sort of makes sense — HEAD is just a pointer, and you can’t point to part of one commit and part of another. But the Index and Working directory <em>can</em> be partially updated, so reset proceeds with steps 2 and 3.</p>
<p>So, assume we run <code>git reset file.txt</code>. This form (since you did not specify a commit SHA-1 or branch, and you didn’t specify <code>--soft</code> or <code>--hard</code>) is shorthand for <code>git reset --mixed HEAD file.txt</code>, which will:</p>
<ol start="2">
<li>Move the branch HEAD points to <em>(skipped)</em></li>
<li>Make the Index look like HEAD <em>(stop here)</em><br>So it essentially just copies <code>file.txt</code> from HEAD to the Index.</li>
</ol>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn40o1wj20m80jijrp.jpg" alt="reset path1">   This has the practical effect of <em>unstaging</em> the file. If we look at the diagram for that command and think about what <code>git add</code> does, they are exact opposites.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcni77m1j20m80jijrp.jpg" alt="reset path2">   This is why the output of the <code>git status</code> command suggests that you run this to unstage a file. (See 【Unstaging a Staged File】 for more on this.)</p>
<p>We could just as easily not let Git assume we meant “pull the data from HEAD” by specifying a specific commit to pull that file version from. We would just run something like <code>git reset eb43bf file.txt</code>.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcjrajq3j20m80jimxn.jpg" alt="reset path3">   This effectively does the same thing as if we had reverted the content of the file to <strong>v1</strong> in the Working Directory, ran <code>git add</code> on it, then reverted it back to <strong>v3</strong> again (without actually going through all those steps). If we run <code>git commit</code> now, it will record a change that reverts that file back to <strong>v1</strong>, even though we never actually had it in our Working Directory again.</p>
<p>It’s also interesting to note that like <code>git add</code>, the <code>reset</code> command will accept a <code>--patch</code> option to unstage content on a hunk-by-hunk basis. So you can selectively unstage or revert content.</p>
<h3 id="Squashing"><a href="#Squashing" class="headerlink" title="Squashing"></a>Squashing</h3><p>Let’s look at how to do something interesting with this newfound power — squashing commits.</p>
<p>Say you have a series of commits with messages like “oops.”, “WIP” and “forgot this file”. You can use <code>reset</code> to quickly and easily squash them into a single commit that makes you look really smart. (【Squashing Commits】 shows another way to do this, but in this example it’s simpler to use <code>reset</code>.)</p>
<p>Let’s say you have a project where the first commit has one file, the second commit added a new file and changed the first, and the third commit changed the first file again. The second commit was a work in progress and you want to squash it down.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmlcwjfj20m80ip74r.jpg" alt="reset squash r1">   You can run <code>git reset --soft HEAD~2</code> to move the HEAD branch back to an older commit (the most recent commit you want to keep):</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn2mervj20m80ka3z1.jpg" alt="reset squash r2">   And then simply run <code>git commit</code> again:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj6kxdbj20jp0m8aal.jpg" alt="reset squash r3">   Now you can see that your reachable history, the history you would push, now looks like you had one commit with <code>file-a.txt</code> v1, then a second that both modified <code>file-a.txt</code> to v3 and added <code>file-b.txt</code>. The commit with the v2 version of the file is no longer in the history.</p>
<h3 id="Check-It-Out"><a href="#Check-It-Out" class="headerlink" title="Check It Out"></a>Check It Out</h3><p>Finally, you may wonder what the difference between <code>checkout</code> and <code>reset</code> is. Like <code>reset</code>, <code>checkout</code> manipulates the three trees, and it is a bit different depending on whether you give the command a file path or not.</p>
<h4 id="Without-Paths"><a href="#Without-Paths" class="headerlink" title="Without Paths"></a>Without Paths</h4><p>Running <code>git checkout [branch]</code> is pretty similar to running <code>git reset --hard [branch]</code> in that it updates all three trees for you to look like <code>[branch]</code>, but there are two important differences.</p>
<p>First, unlike <code>reset --hard</code>, <code>checkout</code> is working-directory safe; it will check to make sure it’s not blowing away files that have changes to them. Actually, it’s a bit smarter than that — it tries to do a trivial merge in the Working Directory, so all of the files you <em>haven’t</em> changed will be updated. <code>reset --hard</code>, on the other hand, will simply replace everything across the board without checking.</p>
<p>The second important difference is how <code>checkout</code> updates HEAD. Whereas <code>reset</code> will move the branch that HEAD points to, <code>checkout</code> will move HEAD itself to point to another branch.</p>
<p>For instance, say we have <code>master</code> and <code>develop</code> branches which point at different commits, and we’re currently on <code>develop</code> (so HEAD points to it). If we run <code>git reset master</code>, <code>develop</code> itself will now point to the same commit that <code>master</code> does. If we instead run <code>git checkout master</code>, <code>develop</code> does not move, HEAD itself does. HEAD will now point to <code>master</code>.</p>
<p>So, in both cases we’re moving HEAD to point to commit A, but <em>how</em> we do so is very different. <code>reset</code> will move the branch HEAD points to, <code>checkout</code> moves HEAD itself.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnu9uh5j20m80gt3yt.jpg" alt="reset checkout"></p>
<h4 id="With-Paths"><a href="#With-Paths" class="headerlink" title="With Paths"></a>With Paths</h4><p>The other way to run <code>checkout</code> is with a file path, which, like <code>reset</code>, does not move HEAD. It is just like <code>git reset [branch] file</code> in that it updates the index with that file at that commit, but it also overwrites the file in the working directory. It would be exactly like <code>git reset --hard [branch] file</code> (if <code>reset</code> would let you run that) — it’s not working-directory safe, and it does not move HEAD.</p>
<p>Also, like <code>git reset</code> and <code>git add</code>, <code>checkout</code> will accept a <code>--patch</code> option to allow you to selectively revert file contents on a hunk-by-hunk basis.</p>
<h3 id="Summary-7"><a href="#Summary-7" class="headerlink" title="Summary"></a>Summary</h3><p>Hopefully now you understand and feel more comfortable with the <code>reset</code> command, but are probably still a little confused about how exactly it differs from <code>checkout</code> and could not possibly remember all the rules of the different invocations.</p>
<p>Here’s a cheat-sheet for which commands affect which trees. The “HEAD” column reads “REF” if that command moves the reference (branch) that HEAD points to, and “HEAD” if it moves HEAD itself. Pay especial attention to the <em>WD Safe?</em> column — if it says <strong>NO</strong>, take a second to think before running that command.</p>
<p>HEAD Index Workdir WD Safe?     <strong>Commit Level</strong></p>
<p><code>reset --soft [commit]</code></p>
<p>REF</p>
<p>NO</p>
<p>NO</p>
<p>YES</p>
<p><code>reset [commit]</code></p>
<p>REF</p>
<p>YES</p>
<p>NO</p>
<p>YES</p>
<p><code>reset --hard [commit]</code></p>
<p>REF</p>
<p>YES</p>
<p>YES</p>
<p><strong>NO</strong></p>
<p><code>checkout &lt;commit&gt;</code></p>
<p>HEAD</p>
<p>YES</p>
<p>YES</p>
<p>YES</p>
<p><strong>File Level</strong></p>
<p><code>reset [commit] &lt;paths&gt;</code></p>
<p>NO</p>
<p>YES</p>
<p>NO</p>
<p>YES</p>
<p><code>checkout [commit] &lt;paths&gt;</code></p>
<p>NO</p>
<p>YES</p>
<p>YES</p>
<p><strong>NO</strong></p>
<h2 id="Advanced-Merging"><a href="#Advanced-Merging" class="headerlink" title="Advanced Merging"></a>Advanced Merging</h2><p>Merging in Git is typically fairly easy. Since Git makes it easy to merge another branch multiple times, it means that you can have a very long lived branch but you can keep it up to date as you go, solving small conflicts often, rather than be surprised by one enormous conflict at the end of the series.</p>
<p>However, sometimes tricky conflicts do occur. Unlike some other version control systems, Git does not try to be overly clever about merge conflict resolution. Git’s philosophy is to be smart about determining when a merge resolution is unambiguous, but if there is a conflict, it does not try to be clever about automatically resolving it. Therefore, if you wait too long to merge two branches that diverge quickly, you can run into some issues.</p>
<p>In this section, we’ll go over what some of those issues might be and what tools Git gives you to help handle these more tricky situations. We’ll also cover some of the different, non-standard types of merges you can do, as well as see how to back out of merges that you’ve done.</p>
<h3 id="Merge-Conflicts"><a href="#Merge-Conflicts" class="headerlink" title="Merge Conflicts"></a>Merge Conflicts</h3><p>While we covered some basics on resolving merge conflicts in 【Basic Merge Conflicts】, for more complex conflicts, Git provides a few tools to help you figure out what’s going on and how to better deal with the conflict.</p>
<p>First of all, if at all possible, try to make sure your working directory is clean before doing a merge that may have conflicts. If you have work in progress, either commit it to a temporary branch or stash it. This makes it so that you can undo <strong>anything</strong> you try here. If you have unsaved changes in your working directory when you try a merge, some of these tips may help you preserve that work.</p>
<p>Let’s walk through a very simple example. We have a super simple Ruby file that prints <em>hello world</em>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">  puts <span class="string">'hello world'</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">hello()</span><br></pre></td></tr></table></figure>
<p>In our repository, we create a new branch named <code>whitespace</code> and proceed to change all the Unix line endings to DOS line endings, essentially changing every line of the file, but just with whitespace. Then we change the line “hello world” to “hello mundo”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b whitespace</span><br><span class="line">Switched to a new branch <span class="string">'whitespace'</span></span><br><span class="line"></span><br><span class="line">$ unix2dos hello.rb</span><br><span class="line">unix2dos: converting file hello.rb to DOS format ...</span><br><span class="line">$ git commit -am <span class="string">'converted hello.rb to DOS'</span></span><br><span class="line">[whitespace 3270f76] converted hello.rb to DOS</span><br><span class="line"> 1 file changed, 7 insertions(+), 7 deletions(-)</span><br><span class="line"></span><br><span class="line">$ vim hello.rb</span><br><span class="line">$ git diff -b</span><br><span class="line">diff --git a/hello.rb b/hello.rb</span><br><span class="line">index ac51efd..e85207e 100755</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -1,7 +1,7 @@</span><br><span class="line"> <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"> def hello</span><br><span class="line">-  puts <span class="string">'hello world'</span></span><br><span class="line">+  puts <span class="string">'hello mundo'</span>^M</span><br><span class="line"> end</span><br><span class="line"></span><br><span class="line"> hello()</span><br><span class="line"></span><br><span class="line">$ git commit -am <span class="string">'hello mundo change'</span></span><br><span class="line">[whitespace 6d338d2] hello mundo change</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br></pre></td></tr></table></figure>
<p>Now we switch back to our <code>master</code> branch and add some documentation for the function.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line"></span><br><span class="line">$ vim hello.rb</span><br><span class="line">$ git diff</span><br><span class="line">diff --git a/hello.rb b/hello.rb</span><br><span class="line">index ac51efd..36c06c8 100755</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -1,5 +1,6 @@</span><br><span class="line"> <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">+<span class="comment"># prints out a greeting</span></span><br><span class="line"> def hello</span><br><span class="line">   puts <span class="string">'hello world'</span></span><br><span class="line"> end</span><br><span class="line"></span><br><span class="line">$ git commit -am <span class="string">'document the function'</span></span><br><span class="line">[master bec6336] document the <span class="keyword">function</span></span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<p>Now we try to merge in our <code>whitespace</code> branch and we’ll get conflicts because of the whitespace changes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git merge whitespace</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> hello.rb</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<h4 id="Aborting-a-Merge"><a href="#Aborting-a-Merge" class="headerlink" title="Aborting a Merge"></a>Aborting a Merge</h4><p>We now have a few options. First, let’s cover how to get out of this situation. If you perhaps weren’t expecting conflicts and don’t want to quite deal with the situation yet, you can simply back out of the merge with <code>git merge --abort</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git status -sb</span><br><span class="line"><span class="comment">## master</span></span><br><span class="line">UU hello.rb</span><br><span class="line"></span><br><span class="line">$ git merge --abort</span><br><span class="line"></span><br><span class="line">$ git status -sb</span><br><span class="line"><span class="comment">## master</span></span><br></pre></td></tr></table></figure>
<p>The <code>git merge --abort</code> option tries to revert back to your state before you ran the merge. The only cases where it may not be able to do this perfectly would be if you had unstashed, uncommitted changes in your working directory when you ran it, otherwise it should work fine.</p>
<p>If for some reason you just want to start over, you can also run <code>git reset --hard HEAD</code>, and your repository will be back to the last committed state. Remember that any uncommitted work will be lost, so make sure you don’t want any of your changes.</p>
<h4 id="Ignoring-Whitespace"><a href="#Ignoring-Whitespace" class="headerlink" title="Ignoring Whitespace"></a>Ignoring Whitespace</h4><p>In this specific case, the conflicts are whitespace related. We know this because the case is simple, but it’s also pretty easy to tell in real cases when looking at the conflict because every line is removed on one side and added again on the other. By default, Git sees all of these lines as being changed, so it can’t merge the files.</p>
<p>The default merge strategy can take arguments though, and a few of them are about properly ignoring whitespace changes. If you see that you have a lot of whitespace issues in a merge, you can simply abort it and do it again, this time with <code>-Xignore-all-space</code> or <code>-Xignore-space-change</code>. The first option ignores whitespace <strong>completely</strong> when comparing lines, the second treats sequences of one or more whitespace characters as equivalent.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge -Xignore-space-change whitespace</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> hello.rb | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br></pre></td></tr></table></figure>
<p>Since in this case, the actual file changes were not conflicting, once we ignore the whitespace changes, everything merges just fine.</p>
<p>This is a lifesaver if you have someone on your team who likes to occasionally reformat everything from spaces to tabs or vice-versa.</p>
<h4 id="Manual-File-Re-merging"><a href="#Manual-File-Re-merging" class="headerlink" title="Manual File Re-merging"></a>Manual File Re-merging</h4><p>Though Git handles whitespace pre-processing pretty well, there are other types of changes that perhaps Git can’t handle automatically, but are scriptable fixes. As an example, let’s pretend that Git could not handle the whitespace change and we needed to do it by hand.</p>
<p>What we really need to do is run the file we’re trying to merge in through a <code>dos2unix</code> program before trying the actual file merge. So how would we do that?</p>
<p>First, we get into the merge conflict state. Then we want to get copies of my version of the file, their version (from the branch we’re merging in) and the common version (from where both sides branched off). Then we want to fix up either their side or our side and re-try the merge again for just this single file.</p>
<p>Getting the three file versions is actually pretty easy. Git stores all of these versions in the index under “stages” which each have numbers associated with them. Stage 1 is the common ancestor, stage 2 is your version and stage 3 is from the <code>MERGE_HEAD</code>, the version you’re merging in (“theirs”).</p>
<p>You can extract a copy of each of these versions of the conflicted file with the <code>git show</code> command and a special syntax.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git show :1:hello.rb &gt; hello.common.rb</span><br><span class="line">$ git show :2:hello.rb &gt; hello.ours.rb</span><br><span class="line">$ git show :3:hello.rb &gt; hello.theirs.rb</span><br></pre></td></tr></table></figure>
<p>If you want to get a little more hard core, you can also use the <code>ls-files -u</code> plumbing command to get the actual SHA-1s of the Git blobs for each of these files.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files -u</span><br><span class="line">100755 ac51efdc3df4f4fd328d1a02ad05331d8e2c9111 1	hello.rb</span><br><span class="line">100755 36c06c8752c78d2aff89571132f3bf7841a7b5c3 2	hello.rb</span><br><span class="line">100755 e85207e04dfdd5eb0a1e9febbc67fd837c44a1cd 3	hello.rb</span><br></pre></td></tr></table></figure>
<p>The <code>:1:hello.rb</code> is just a shorthand for looking up that blob SHA-1.</p>
<p>Now that we have the content of all three stages in our working directory, we can manually fix up theirs to fix the whitespace issue and re-merge the file with the little-known <code>git merge-file</code> command which does just that.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ dos2unix hello.theirs.rb</span><br><span class="line">dos2unix: converting file hello.theirs.rb to Unix format ...</span><br><span class="line"></span><br><span class="line">$ git merge-file -p \</span><br><span class="line">    hello.ours.rb hello.common.rb hello.theirs.rb &gt; hello.rb</span><br><span class="line"></span><br><span class="line">$ git diff -b</span><br><span class="line">diff --cc hello.rb</span><br><span class="line">index 36c06c8,e85207e..0000000</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@@ -1,8 -1,7 +1,8 @@@</span><br><span class="line">  <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"> +<span class="comment"># prints out a greeting</span></span><br><span class="line">  def hello</span><br><span class="line">-   puts <span class="string">'hello world'</span></span><br><span class="line">+   puts <span class="string">'hello mundo'</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  hello()</span><br></pre></td></tr></table></figure>
<p>At this point we have nicely merged the file. In fact, this actually works better than the <code>ignore-space-change</code> option because this actually fixes the whitespace changes before merge instead of simply ignoring them. In the <code>ignore-space-change</code> merge, we actually ended up with a few lines with DOS line endings, making things mixed.</p>
<p>If you want to get an idea before finalizing this commit about what was actually changed between one side or the other, you can ask <code>git diff</code> to compare what is in your working directory that you’re about to commit as the result of the merge to any of these stages. Let’s go through them all.</p>
<p>To compare your result to what you had in your branch before the merge, in other words, to see what the merge introduced, you can run <code>git diff --ours</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --ours</span><br><span class="line">* Unmerged path hello.rb</span><br><span class="line">diff --git a/hello.rb b/hello.rb</span><br><span class="line">index 36c06c8..44d0a25 100755</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -2,7 +2,7 @@</span><br><span class="line"></span><br><span class="line"> <span class="comment"># prints out a greeting</span></span><br><span class="line"> def hello</span><br><span class="line">-  puts <span class="string">'hello world'</span></span><br><span class="line">+  puts <span class="string">'hello mundo'</span></span><br><span class="line"> end</span><br><span class="line"></span><br><span class="line"> hello()</span><br></pre></td></tr></table></figure>
<p>So here we can easily see that what happened in our branch, what we’re actually introducing to this file with this merge, is changing that single line.</p>
<p>If we want to see how the result of the merge differed from what was on their side, you can run <code>git diff --theirs</code>. In this and the following example, we have to use <code>-b</code> to strip out the whitespace because we’re comparing it to what is in Git, not our cleaned up <code>hello.theirs.rb</code> file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --theirs -b</span><br><span class="line">* Unmerged path hello.rb</span><br><span class="line">diff --git a/hello.rb b/hello.rb</span><br><span class="line">index e85207e..44d0a25 100755</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -1,5 +1,6 @@</span><br><span class="line"> <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">+<span class="comment"># prints out a greeting</span></span><br><span class="line"> def hello</span><br><span class="line">   puts <span class="string">'hello mundo'</span></span><br><span class="line"> end</span><br></pre></td></tr></table></figure>
<p>Finally, you can see how the file has changed from both sides with <code>git diff --base</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --base -b</span><br><span class="line">* Unmerged path hello.rb</span><br><span class="line">diff --git a/hello.rb b/hello.rb</span><br><span class="line">index ac51efd..44d0a25 100755</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -1,7 +1,8 @@</span><br><span class="line"> <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">+<span class="comment"># prints out a greeting</span></span><br><span class="line"> def hello</span><br><span class="line">-  puts <span class="string">'hello world'</span></span><br><span class="line">+  puts <span class="string">'hello mundo'</span></span><br><span class="line"> end</span><br><span class="line"></span><br><span class="line"> hello()</span><br></pre></td></tr></table></figure>
<p>At this point we can use the <code>git clean</code> command to clear out the extra files we created to do the manual merge but no longer need.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git clean -f</span><br><span class="line">Removing hello.common.rb</span><br><span class="line">Removing hello.ours.rb</span><br><span class="line">Removing hello.theirs.rb</span><br></pre></td></tr></table></figure>
<h4 id="Checking-Out-Conflicts"><a href="#Checking-Out-Conflicts" class="headerlink" title="Checking Out Conflicts"></a>Checking Out Conflicts</h4><p>Perhaps we’re not happy with the resolution at this point for some reason, or maybe manually editing one or both sides still didn’t work well and we need more context.</p>
<p>Let’s change up the example a little. For this example, we have two longer lived branches that each have a few commits in them but create a legitimate content conflict when merged.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph --oneline --decorate --all</span><br><span class="line">* f1270f7 (HEAD, master) update README</span><br><span class="line">* 9af9d3b add a README</span><br><span class="line">* 694971d update phrase to hola world</span><br><span class="line">| * e3eb223 (mundo) add more tests</span><br><span class="line">| * 7cff591 add testing script</span><br><span class="line">| * c3ffff1 changed text to hello mundo</span><br><span class="line">|/</span><br><span class="line">* b7dcc89 initial hello world code</span><br></pre></td></tr></table></figure>
<p>We now have three unique commits that live only on the <code>master</code> branch and three others that live on the <code>mundo</code> branch. If we try to merge the <code>mundo</code> branch in, we get a conflict.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git merge mundo</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> hello.rb</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>We would like to see what the merge conflict is. If we open up the file, we’ll see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">  puts <span class="string">'hola world'</span></span><br><span class="line">=======</span><br><span class="line">  puts <span class="string">'hello mundo'</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; mundo</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">hello()</span><br></pre></td></tr></table></figure>
<p>Both sides of the merge added content to this file, but some of the commits modified the file in the same place that caused this conflict.</p>
<p>Let’s explore a couple of tools that you now have at your disposal to determine how this conflict came to be. Perhaps it’s not obvious how exactly you should fix this conflict. You need more context.</p>
<p>One helpful tool is <code>git checkout</code> with the ‘–conflict’ option. This will re-checkout the file again and replace the merge conflict markers. This can be useful if you want to reset the markers and try to resolve them again.</p>
<p>You can pass <code>--conflict</code> either <code>diff3</code> or <code>merge</code> (which is the default). If you pass it <code>diff3</code>, Git will use a slightly different version of conflict markers, not only giving you the “ours” and “theirs” versions, but also the “base” version inline to give you more context.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --conflict=diff3 hello.rb</span><br></pre></td></tr></table></figure>
<p>Once we run that, the file will look like this instead:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; ours</span><br><span class="line">  puts <span class="string">'hola world'</span></span><br><span class="line">||||||| base</span><br><span class="line">  puts <span class="string">'hello world'</span></span><br><span class="line">=======</span><br><span class="line">  puts <span class="string">'hello mundo'</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">hello()</span><br></pre></td></tr></table></figure>
<p>If you like this format, you can set it as the default for future merge conflicts by setting the <code>merge.conflictstyle</code> setting to <code>diff3</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global merge.conflictstyle diff3</span><br></pre></td></tr></table></figure>
<p>The <code>git checkout</code> command can also take <code>--ours</code> and <code>--theirs</code> options, which can be a really fast way of just choosing either one side or the other without merging things at all.</p>
<p>This can be particularly useful for conflicts of binary files where you can simply choose one side, or where you only want to merge certain files in from another branch - you can do the merge and then checkout certain files from one side or the other before committing.</p>
<h4 id="Merge-Log"><a href="#Merge-Log" class="headerlink" title="Merge Log"></a>Merge Log</h4><p>Another useful tool when resolving merge conflicts is <code>git log</code>. This can help you get context on what may have contributed to the conflicts. Reviewing a little bit of history to remember why two lines of development were touching the same area of code can be really helpful sometimes.</p>
<p>To get a full list of all of the unique commits that were included in either branch involved in this merge, we can use the “triple dot” syntax that we learned in 【Triple Dot】.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --left-right HEAD...MERGE_HEAD</span><br><span class="line">&lt; f1270f7 update README</span><br><span class="line">&lt; 9af9d3b add a README</span><br><span class="line">&lt; 694971d update phrase to hola world</span><br><span class="line">&gt; e3eb223 add more tests</span><br><span class="line">&gt; 7cff591 add testing script</span><br><span class="line">&gt; c3ffff1 changed text to hello mundo</span><br></pre></td></tr></table></figure>
<p>That’s a nice list of the six total commits involved, as well as which line of development each commit was on.</p>
<p>We can further simplify this though to give us much more specific context. If we add the <code>--merge</code> option to <code>git log</code>, it will only show the commits in either side of the merge that touch a file that’s currently conflicted.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --left-right --merge</span><br><span class="line">&lt; 694971d update phrase to hola world</span><br><span class="line">&gt; c3ffff1 changed text to hello mundo</span><br></pre></td></tr></table></figure>
<p>If you run that with the <code>-p</code> option instead, you get just the diffs to the file that ended up in conflict. This can be <strong>really</strong> helpful in quickly giving you the context you need to help understand why something conflicts and how to more intelligently resolve it.</p>
<h4 id="Combined-Diff-Format"><a href="#Combined-Diff-Format" class="headerlink" title="Combined Diff Format"></a>Combined Diff Format</h4><p>Since Git stages any merge results that are successful, when you run <code>git diff</code> while in a conflicted merge state, you only get what is currently still in conflict. This can be helpful to see what you still have to resolve.</p>
<p>When you run <code>git diff</code> directly after a merge conflict, it will give you information in a rather unique diff output format.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --cc hello.rb</span><br><span class="line">index 0399cd5,59727f0..0000000</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@@ -1,7 -1,7 +1,11 @@@</span><br><span class="line">  <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">  def hello</span><br><span class="line">++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"> +  puts <span class="string">'hola world'</span></span><br><span class="line">++=======</span><br><span class="line">+   puts <span class="string">'hello mundo'</span></span><br><span class="line">++&gt;&gt;&gt;&gt;&gt;&gt;&gt; mundo</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  hello()</span><br></pre></td></tr></table></figure>
<p>The format is called “Combined Diff” and gives you two columns of data next to each line. The first column shows you if that line is different (added or removed) between the “ours” branch and the file in your working directory and the second column does the same between the “theirs” branch and your working directory copy.</p>
<p>So in that example you can see that the <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code> and <code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code> lines are in the working copy but were not in either side of the merge. This makes sense because the merge tool stuck them in there for our context, but we’re expected to remove them.</p>
<p>If we resolve the conflict and run <code>git diff</code> again, we’ll see the same thing, but it’s a little more useful.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ vim hello.rb</span><br><span class="line">$ git diff</span><br><span class="line">diff --cc hello.rb</span><br><span class="line">index 0399cd5,59727f0..0000000</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@@ -1,7 -1,7 +1,7 @@@</span><br><span class="line">  <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">  def hello</span><br><span class="line">-   puts <span class="string">'hola world'</span></span><br><span class="line"> -  puts <span class="string">'hello mundo'</span></span><br><span class="line">++  puts <span class="string">'hola mundo'</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  hello()</span><br></pre></td></tr></table></figure>
<p>This shows us that “hola world” was in our side but not in the working copy, that “hello mundo” was in their side but not in the working copy and finally that “hola mundo” was not in either side but is now in the working copy. This can be useful to review before committing the resolution.</p>
<p>You can also get this from the <code>git log</code> for any merge to see how something was resolved after the fact. Git will output this format if you run <code>git show</code> on a merge commit, or if you add a <code>--cc</code> option to a <code>git log -p</code> (which by default only shows patches for non-merge commits).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --cc -p -1</span><br><span class="line">commit 14f41939956d80b9e17bb8721354c33f8d5b5a79</span><br><span class="line">Merge: f1270f7 e3eb223</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri Sep 19 18:14:49 2014 +0200</span><br><span class="line"></span><br><span class="line">    Merge branch <span class="string">'mundo'</span></span><br><span class="line"></span><br><span class="line">    Conflicts:</span><br><span class="line">        hello.rb</span><br><span class="line"></span><br><span class="line">diff --cc hello.rb</span><br><span class="line">index 0399cd5,59727f0..e1d0799</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@@ -1,7 -1,7 +1,7 @@@</span><br><span class="line">  <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">  def hello</span><br><span class="line">-   puts <span class="string">'hola world'</span></span><br><span class="line"> -  puts <span class="string">'hello mundo'</span></span><br><span class="line">++  puts <span class="string">'hola mundo'</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  hello()</span><br></pre></td></tr></table></figure>
<h3 id="Undoing-Merges"><a href="#Undoing-Merges" class="headerlink" title="Undoing Merges"></a>Undoing Merges</h3><p>Now that you know how to create a merge commit, you’ll probably make some by mistake. One of the great things about working with Git is that it’s okay to make mistakes, because it’s possible (and in many cases easy) to fix them.</p>
<p>Merge commits are no different. Let’s say you started work on a topic branch, accidentally merged it into <code>master</code>, and now your commit history looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchjdwdej20m80a3wef.jpg" alt="Accidental merge commit.">  Figure 2. Accidental merge commit  There are two ways to approach this problem, depending on what your desired outcome is.</p>
<h4 id="Fix-the-references"><a href="#Fix-the-references" class="headerlink" title="Fix the references"></a>Fix the references</h4><p>If the unwanted merge commit only exists on your local repository, the easiest and best solution is to move the branches so that they point where you want them to. In most cases, if you follow the errant <code>git merge</code> with <code>git reset --hard HEAD~</code>, this will reset the branch pointers so they look like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckk5hrgj20m80a3dfs.jpg" alt="History after `git reset --hard HEAD~`.">  Figure 3. History after <code>git reset --hard HEAD~</code>  We covered <code>reset</code> back in 【Reset Demystified】, so it shouldn’t be too hard to figure out what’s going on here. Here’s a quick refresher: <code>reset --hard</code> usually goes through three steps:</p>
<ol start="2">
<li>Move the branch HEAD points to. In this case, we want to move <code>master</code> to where it was before the merge commit (<code>C6</code>).</li>
<li>Make the index look like HEAD.</li>
<li>Make the working directory look like the index.<br>The downside of this approach is that it’s rewriting history, which can be problematic with a shared repository. Check out 【The Perils of Rebasing】 for more on what can happen; the short version is that if other people have the commits you’re rewriting, you should probably avoid <code>reset</code>. This approach also won’t work if any other commits have been created since the merge; moving the refs would effectively lose those changes.</li>
</ol>
<h4 id="Reverse-the-commit"><a href="#Reverse-the-commit" class="headerlink" title="Reverse the commit"></a>Reverse the commit</h4><p>If moving the branch pointers around isn’t going to work for you, Git gives you the option of making a new commit which undoes all the changes from an existing one. Git calls this operation a “revert”, and in this particular scenario, you’d invoke it like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git revert -m 1 HEAD</span><br><span class="line">[master b1d8379] Revert <span class="string">"Merge branch 'topic'"</span></span><br></pre></td></tr></table></figure>
<p>The <code>-m 1</code> flag indicates which parent is the “mainline” and should be kept. When you invoke a merge into <code>HEAD</code> (<code>git merge topic</code>), the new commit has two parents: the first one is <code>HEAD</code> (<code>C6</code>), and the second is the tip of the branch being merged in (<code>C4</code>). In this case, we want to undo all the changes introduced by merging in parent #2 (<code>C4</code>), while keeping all the content from parent #1 (<code>C6</code>).</p>
<p>The history with the revert commit looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoldx8bj20m808ewef.jpg" alt="History after `git revert -m 1`.">  Figure 4. History after <code>git revert -m 1</code>  The new commit <code>^M</code> has exactly the same contents as <code>C6</code>, so starting from here it’s as if the merge never happened, except that the now-unmerged commits are still in <code>HEAD</code>‘s history. Git will get confused if you try to merge <code>topic</code> into <code>master</code> again:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git merge topic</span><br><span class="line">Already up-to-date.</span><br></pre></td></tr></table></figure>
<p>There’s nothing in <code>topic</code> that isn’t already reachable from <code>master</code>. What’s worse, if you add work to <code>topic</code> and merge again, Git will only bring in the changes <em>since</em> the reverted merge:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckqhtmpj20m8076mx3.jpg" alt="History with a bad merge.">  Figure 5. History with a bad merge  The best way around this is to un-revert the original merge, since now you want to bring in the changes that were reverted out, <strong>then</strong> create a new merge commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git revert ^M</span><br><span class="line">[master 09f0126] Revert <span class="string">"Revert "</span>Merge branch <span class="string">'topic'</span><span class="string">""</span></span><br><span class="line">$ git merge topic</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcoa29pzj20m8069wee.jpg" alt="History after re-merging a reverted merge.">  Figure 6. History after re-merging a reverted merge  In this example, <code>M</code> and <code>^M</code> cancel out. <code>^^M</code> effectively merges in the changes from <code>C3</code> and <code>C4</code>, and <code>C8</code> merges in the changes from <code>C7</code>, so now <code>topic</code> is fully merged.</p>
<h3 id="Other-Types-of-Merges"><a href="#Other-Types-of-Merges" class="headerlink" title="Other Types of Merges"></a>Other Types of Merges</h3><p>So far we’ve covered the normal merge of two branches, normally handled with what is called the “recursive” strategy of merging. There are other ways to merge branches together however. Let’s cover a few of them quickly.</p>
<h4 id="Our-or-Theirs-Preference"><a href="#Our-or-Theirs-Preference" class="headerlink" title="Our or Theirs Preference"></a>Our or Theirs Preference</h4><p>First of all, there is another useful thing we can do with the normal “recursive” mode of merging. We’ve already seen the <code>ignore-all-space</code> and <code>ignore-space-change</code> options which are passed with a <code>-X</code> but we can also tell Git to favor one side or the other when it sees a conflict.</p>
<p>By default, when Git sees a conflict between two branches being merged, it will add merge conflict markers into your code and mark the file as conflicted and let you resolve it. If you would prefer for Git to simply choose a specific side and ignore the other side instead of letting you manually resolve the conflict, you can pass the <code>merge</code> command either a <code>-Xours</code> or <code>-Xtheirs</code>.</p>
<p>If Git sees this, it will not add conflict markers. Any differences that are mergeable, it will merge. Any differences that conflict, it will simply choose the side you specify in whole, including binary files.</p>
<p>If we go back to the “hello world” example we were using before, we can see that merging in our branch causes conflicts.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge mundo</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> hello.rb</span><br><span class="line">Resolved <span class="string">'hello.rb'</span> using previous resolution.</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>However if we run it with <code>-Xours</code> or <code>-Xtheirs</code> it does not.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git merge -Xours mundo</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> hello.rb | 2 +-</span><br><span class="line"> test.sh  | 2 ++</span><br><span class="line"> 2 files changed, 3 insertions(+), 1 deletion(-)</span><br><span class="line"> create mode 100644 test.sh</span><br></pre></td></tr></table></figure>
<p>In that case, instead of getting conflict markers in the file with “hello mundo” on one side and “hola world” on the other, it will simply pick “hola world”. However, all the other non-conflicting changes on that branch are merged successfully in.</p>
<p>This option can also be passed to the <code>git merge-file</code> command we saw earlier by running something like <code>git merge-file --ours</code> for individual file merges.</p>
<p>If you want to do something like this but not have Git even try to merge changes from the other side in, there is a more draconian option, which is the “ours” merge <em>strategy</em>. This is different from the “ours” recursive merge <em>option</em>.</p>
<p>This will basically do a fake merge. It will record a new merge commit with both branches as parents, but it will not even look at the branch you’re merging in. It will simply record as the result of the merge the exact code in your current branch.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git merge -s ours mundo</span><br><span class="line">Merge made by the <span class="string">'ours'</span> strategy.</span><br><span class="line">$ git diff HEAD HEAD~</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>You can see that there is no difference between the branch we were on and the result of the merge.</p>
<p>This can often be useful to basically trick Git into thinking that a branch is already merged when doing a merge later on. For example, say you branched off a <code>release</code> branch and have done some work on it that you will want to merge back into your <code>master</code> branch at some point. In the meantime some bugfix on <code>master</code> needs to be backported into your <code>release</code> branch. You can merge the bugfix branch into the <code>release</code> branch and also <code>merge -s ours</code> the same branch into your <code>master</code> branch (even though the fix is already there) so when you later merge the <code>release</code> branch again, there are no conflicts from the bugfix.</p>
<h4 id="Subtree-Merging"><a href="#Subtree-Merging" class="headerlink" title="Subtree Merging"></a>Subtree Merging</h4><p>The idea of the subtree merge is that you have two projects, and one of the projects maps to a subdirectory of the other one. When you specify a subtree merge, Git is often smart enough to figure out that one is a subtree of the other and merge appropriately.</p>
<p>We’ll go through an example of adding a separate project into an existing project and then merging the code of the second into a subdirectory of the first.</p>
<p>First, we’ll add the Rack application to our project. We’ll add the Rack project as a remote reference in our own project and then check it out into its own branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add rack_remote [https://github.com/rack/rack](https://github.com/rack/rack)</span><br><span class="line">$ git fetch rack_remote --no-tags</span><br><span class="line">warning: no common commits</span><br><span class="line">remote: Counting objects: 3184, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (1465/1465), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3184 (delta 1952), reused 2770 (delta 1675)</span><br><span class="line">Receiving objects: 100% (3184/3184), 677.42 KiB | 4 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (1952/1952), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/rack/rack](https://github.com/rack/rack)</span><br><span class="line"> * [new branch]      build      -&gt; rack_remote/build</span><br><span class="line"> * [new branch]      master     -&gt; rack_remote/master</span><br><span class="line"> * [new branch]      rack-0.4   -&gt; rack_remote/rack-0.4</span><br><span class="line"> * [new branch]      rack-0.9   -&gt; rack_remote/rack-0.9</span><br><span class="line">$ git checkout -b rack_branch rack_remote/master</span><br><span class="line">Branch rack_branch <span class="built_in">set</span> up to track remote branch refs/remotes/rack_remote/master.</span><br><span class="line">Switched to a new branch <span class="string">"rack_branch"</span></span><br></pre></td></tr></table></figure>
<p>Now we have the root of the Rack project in our <code>rack_branch</code> branch and our own project in the <code>master</code> branch. If you check out one and then the other, you can see that they have different project roots:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">AUTHORS         KNOWN-ISSUES   Rakefile      contrib         lib</span><br><span class="line">COPYING         README         bin           example         <span class="built_in">test</span></span><br><span class="line">$ git checkout master</span><br><span class="line">Switched to branch <span class="string">"master"</span></span><br><span class="line">$ ls</span><br><span class="line">README</span><br></pre></td></tr></table></figure>
<p>This is sort of a strange concept. Not all the branches in your repository actually have to be branches of the same project. It’s not common, because it’s rarely helpful, but it’s fairly easy to have branches contain completely different histories.</p>
<p>In this case, we want to pull the Rack project into our <code>master</code> project as a subdirectory. We can do that in Git with <code>git read-tree</code>. You’ll learn more about <code>read-tree</code> and its friends in 【Git Internals】, but for now know that it reads the root tree of one branch into your current staging area and working directory. We just switched back to your <code>master</code> branch, and we pull the <code>rack_branch</code> branch into the <code>rack</code> subdirectory of our <code>master</code> branch of our main project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">read</span>-tree --prefix=rack/ -u rack_branch</span><br></pre></td></tr></table></figure>
<p>When we commit, it looks like we have all the Rack files under that subdirectory – as though we copied them in from a tarball. What gets interesting is that we can fairly easily merge changes from one of the branches to the other. So, if the Rack project updates, we can pull in upstream changes by switching to that branch and pulling:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout rack_branch</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure>
<p>Then, we can merge those changes back into our <code>master</code> branch. To pull in the changes and prepopulate the commit message, use the <code>--squash</code> option, as well as the recursive merge strategy’s <code>-Xsubtree</code> option. (The recursive strategy is the default here, but we include it for clarity.)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge --squash -s recursive -Xsubtree=rack rack_branch</span><br><span class="line">Squash commit -- not updating HEAD</span><br><span class="line">Automatic merge went well; stopped before committing as requested</span><br></pre></td></tr></table></figure>
<p>All the changes from the Rack project are merged in and ready to be committed locally. You can also do the opposite – make changes in the <code>rack</code> subdirectory of your master branch and then merge them into your <code>rack_branch</code> branch later to submit them to the maintainers or push them upstream.</p>
<p>This gives us a way to have a workflow somewhat similar to the submodule workflow without using submodules (which we will cover in 【Submodules】). We can keep branches with other related projects in our repository and subtree merge them into our project occasionally. It is nice in some ways, for example all the code is committed to a single place. However, it has other drawbacks in that it’s a bit more complex and easier to make mistakes in reintegrating changes or accidentally pushing a branch into an unrelated repository.</p>
<p>Another slightly weird thing is that to get a diff between what you have in your <code>rack</code> subdirectory and the code in your <code>rack_branch</code> branch – to see if you need to merge them – you can’t use the normal <code>diff</code> command. Instead, you must run <code>git diff-tree</code> with the branch you want to compare to:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff-tree -p rack_branch</span><br></pre></td></tr></table></figure>
<p>Or, to compare what is in your <code>rack</code> subdirectory with what the <code>master</code> branch on the server was the last time you fetched, you can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff-tree -p rack_remote/master</span><br></pre></td></tr></table></figure>
<h2 id="Rerere-1"><a href="#Rerere-1" class="headerlink" title="Rerere"></a>Rerere</h2><p>The <code>git rerere</code> functionality is a bit of a hidden feature. The name stands for “reuse recorded resolution” and, as the name implies, it allows you to ask Git to remember how you’ve resolved a hunk conflict so that the next time it sees the same conflict, Git can resolve it for you automatically.</p>
<p>There are a number of scenarios in which this functionality might be really handy. One of the examples that is mentioned in the documentation is when you want to make sure a long-lived topic branch will ultimately merge cleanly, but you don’t want to have a bunch of intermediate merge commits cluttering up your commit history. With <code>rerere</code> enabled, you can attempt the occasional merge, resolve the conflicts, then back out of the merge. If you do this continuously, then the final merge should be easy because <code>rerere</code> can just do everything for you automatically.</p>
<p>This same tactic can be used if you want to keep a branch rebased so you don’t have to deal with the same rebasing conflicts each time you do it. Or if you want to take a branch that you merged and fixed a bunch of conflicts and then decide to rebase it instead — you likely won’t have to do all the same conflicts again.</p>
<p>Another application of <code>rerere</code> is where you merge a bunch of evolving topic branches together into a testable head occasionally, as the Git project itself often does. If the tests fail, you can rewind the merges and re-do them without the topic branch that made the tests fail without having to re-resolve the conflicts again.</p>
<p>To enable <code>rerere</code> functionality, you simply have to run this config setting:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global rerere.enabled <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>You can also turn it on by creating the <code>.git/rr-cache</code> directory in a specific repository, but the config setting is clearer and enables that feature globally for you.</p>
<p>Now let’s see a simple example, similar to our previous one. Let’s say we have a file named <code>hello.rb</code> that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">  puts <span class="string">'hello world'</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>In one branch we change the word “hello” to “hola”, then in another branch we change the “world” to “mundo”, just like before.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl0mbz2j20m80bc748.jpg" alt="rerere1">   When we merge the two branches together, we’ll get a merge conflict:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge i18n-world</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> hello.rb</span><br><span class="line">Recorded preimage <span class="keyword">for</span> <span class="string">'hello.rb'</span></span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>You should notice the new line <code>Recorded preimage for FILE</code> in there. Otherwise it should look exactly like a normal merge conflict. At this point, <code>rerere</code> can tell us a few things. Normally, you might run <code>git status</code> at this point to see what all conflicted:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line"><span class="comment"># Unmerged paths:</span></span><br><span class="line"><span class="comment">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span></span><br><span class="line"><span class="comment">#   (use "git add &lt;file&gt;..." to mark resolution)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	both modified:      hello.rb</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>However, <code>git rerere</code> will also tell you what it has recorded the pre-merge state for with <code>git rerere status</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git rerere status</span><br><span class="line">hello.rb</span><br></pre></td></tr></table></figure>
<p>And <code>git rerere diff</code> will show the current state of the resolution — what you started with to resolve and what you’ve resolved it to.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git rerere diff</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -1,11 +1,11 @@</span><br><span class="line"> <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"> def hello</span><br><span class="line">-&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">-  puts <span class="string">'hello mundo'</span></span><br><span class="line">-=======</span><br><span class="line">+&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">   puts <span class="string">'hola world'</span></span><br><span class="line">-&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">+=======</span><br><span class="line">+  puts <span class="string">'hello mundo'</span></span><br><span class="line">+&gt;&gt;&gt;&gt;&gt;&gt;&gt; i18n-world</span><br><span class="line"> end</span><br></pre></td></tr></table></figure>
<p>Also (and this isn’t really related to <code>rerere</code>), you can use <code>git ls-files -u</code> to see the conflicted files and the before, left and right versions:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-files -u</span><br><span class="line">100644 39804c942a9c1f2c03dc7c5ebcd7f3e3a6b97519 1	hello.rb</span><br><span class="line">100644 a440db6e8d1fd76ad438a49025a9ad9ce746f581 2	hello.rb</span><br><span class="line">100644 54336ba847c3758ab604876419607e9443848474 3	hello.rb</span><br></pre></td></tr></table></figure>
<p>Now you can resolve it to just be <code>puts &#39;hola mundo&#39;</code> and you can run <code>git rerere diff</code> again to see what rerere will remember:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git rerere diff</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@ -1,11 +1,7 @@</span><br><span class="line"> <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"> def hello</span><br><span class="line">-&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">-  puts <span class="string">'hello mundo'</span></span><br><span class="line">-=======</span><br><span class="line">-  puts <span class="string">'hola world'</span></span><br><span class="line">-&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">+  puts <span class="string">'hola mundo'</span></span><br><span class="line"> end</span><br></pre></td></tr></table></figure>
<p>So that basically says, when Git sees a hunk conflict in a <code>hello.rb</code> file that has “hello mundo” on one side and “hola world” on the other, it will resolve it to “hola mundo”.</p>
<p>Now we can mark it as resolved and commit it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git add hello.rb</span><br><span class="line">$ git commit</span><br><span class="line">Recorded resolution <span class="keyword">for</span> <span class="string">'hello.rb'</span>.</span><br><span class="line">[master 68e16e5] Merge branch <span class="string">'i18n'</span></span><br></pre></td></tr></table></figure>
<p>You can see that it “Recorded resolution for FILE”.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcm6kjyej20m80cf3yl.jpg" alt="rerere2">   Now, let’s undo that merge and then rebase it on top of our master branch instead. We can move our branch back by using <code>git reset</code> as we saw in 【Reset Demystified】.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard HEAD^</span><br><span class="line">HEAD is now at ad63f15 i18n the hello</span><br></pre></td></tr></table></figure>
<p>Our merge is undone. Now let’s rebase the topic branch.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout i18n-world</span><br><span class="line">Switched to branch <span class="string">'i18n-world'</span></span><br><span class="line"></span><br><span class="line">$ git rebase master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: i18n one word</span><br><span class="line">Using index info to reconstruct a base tree...</span><br><span class="line">Falling back to patching base and 3-way merge...</span><br><span class="line">Auto-merging hello.rb</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> hello.rb</span><br><span class="line">Resolved <span class="string">'hello.rb'</span> using previous resolution.</span><br><span class="line">Failed to merge <span class="keyword">in</span> the changes.</span><br><span class="line">Patch failed at 0001 i18n one word</span><br></pre></td></tr></table></figure>
<p>Now, we got the same merge conflict like we expected, but take a look at the <code>Resolved FILE using previous resolution</code> line. If we look at the file, we’ll see that it’s already been resolved, there are no merge conflict markers in it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">  puts <span class="string">'hola mundo'</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Also, <code>git diff</code> will show you how it was automatically re-resolved:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --cc hello.rb</span><br><span class="line">index a440db6,54336ba..0000000</span><br><span class="line">--- a/hello.rb</span><br><span class="line">+++ b/hello.rb</span><br><span class="line">@@@ -1,7 -1,7 +1,7 @@@</span><br><span class="line">  <span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">  def hello</span><br><span class="line">-   puts <span class="string">'hola world'</span></span><br><span class="line"> -  puts <span class="string">'hello mundo'</span></span><br><span class="line">++  puts <span class="string">'hola mundo'</span></span><br><span class="line">  end</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl41pbbj20m80cf74d.jpg" alt="rerere3">   You can also recreate the conflicted file state with <code>git checkout</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout --conflict=merge hello.rb</span><br><span class="line">$ cat hello.rb</span><br><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; ours</span><br><span class="line">  puts <span class="string">'hola world'</span></span><br><span class="line">=======</span><br><span class="line">  puts <span class="string">'hello mundo'</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>We saw an example of this in 【Advanced Merging】. For now though, let’s re-resolve it by just running <code>git rerere</code> again:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git rerere</span><br><span class="line">Resolved <span class="string">'hello.rb'</span> using previous resolution.</span><br><span class="line">$ cat hello.rb</span><br><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">def hello</span><br><span class="line">  puts <span class="string">'hola mundo'</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>We have re-resolved the file automatically using the <code>rerere</code> cached resolution. You can now add and continue the rebase to complete it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add hello.rb</span><br><span class="line">$ git rebase --<span class="built_in">continue</span></span><br><span class="line">Applying: i18n one word</span><br></pre></td></tr></table></figure>
<p>So, if you do a lot of re-merges, or want to keep a topic branch up to date with your master branch without a ton of merges, or you rebase often, you can turn on <code>rerere</code> to help your life out a bit.</p>
<h2 id="Debugging-with-Git"><a href="#Debugging-with-Git" class="headerlink" title="Debugging with Git"></a>Debugging with Git</h2><p>In addition to being primarily for version control, Git also provides a couple commands to help you debug your source code projects. Because Git is designed to handle nearly any type of content, these tools are pretty generic, but they can often help you hunt for a bug or culprit when things go wrong.</p>
<h3 id="File-Annotation"><a href="#File-Annotation" class="headerlink" title="File Annotation"></a>File Annotation</h3><p>If you track down a bug in your code and want to know when it was introduced and why, file annotation is often your best tool. It shows you what commit was the last to modify each line of any file. So if you see that a method in your code is buggy, you can annotate the file with <code>git blame</code> to determine which commit was responsible for the introduction of that line.</p>
<p>The following example uses <code>git blame</code> to determine which commit and committer was responsible for lines in the top-level Linux kernel <code>Makefile</code> and, further, uses the <code>-L</code> option to restrict the output of the annotation to lines 69 through 82 of that file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git blame -L 69,82 Makefile</span><br><span class="line">b8b0618cf6fab (Cheng Renquan  2009-05-26 16:03:07 +0800 69) ifeq (<span class="string">"<span class="variable">$(origin V)</span>"</span>, <span class="string">"command line"</span>)</span><br><span class="line">b8b0618cf6fab (Cheng Renquan  2009-05-26 16:03:07 +0800 70)   KBUILD_VERBOSE = $(V)</span><br><span class="line">^1da177e4c3f4 (Linus Torvalds 2005-04-16 15:20:36 -0700 71) endif</span><br><span class="line">^1da177e4c3f4 (Linus Torvalds 2005-04-16 15:20:36 -0700 72) ifndef KBUILD_VERBOSE</span><br><span class="line">^1da177e4c3f4 (Linus Torvalds 2005-04-16 15:20:36 -0700 73)   KBUILD_VERBOSE = 0</span><br><span class="line">^1da177e4c3f4 (Linus Torvalds 2005-04-16 15:20:36 -0700 74) endif</span><br><span class="line">^1da177e4c3f4 (Linus Torvalds 2005-04-16 15:20:36 -0700 75)</span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 76) ifeq ($(KBUILD_VERBOSE),1)</span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 77)   quiet =</span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 78)   Q =</span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 79) <span class="keyword">else</span></span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 80)   quiet=quiet_</span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 81)   Q = @</span><br><span class="line">066b7ed955808 (Michal Marek   2014-07-04 14:29:30 +0200 82) endif</span><br></pre></td></tr></table></figure>
<p>Notice that the first field is the partial SHA-1 of the commit that last modified that line. The next two fields are values extracted from that commit — the author name and the authored date of that commit — so you can easily see who modified that line and when. After that come the line number and the content of the file. Also note the <code>^1da177e4c3f4</code> commit lines, where the <code>^</code> prefix designates lines that were introduced in the repository’s initial commit and have remained unchanged ever since. This is a tad confusing, because now you’ve seen at least three different ways that Git uses the <code>^</code> to modify a commit SHA-1, but that is what it means here.</p>
<p>Another cool thing about Git is that it doesn’t track file renames explicitly. It records the snapshots and then tries to figure out what was renamed implicitly, after the fact. One of the interesting features of this is that you can ask it to figure out all sorts of code movement as well. If you pass <code>-C</code> to <code>git blame</code>, Git analyzes the file you’re annotating and tries to figure out where snippets of code within it originally came from if they were copied from elsewhere. For example, say you are refactoring a file named <code>GITServerHandler.m</code> into multiple files, one of which is <code>GITPackUpload.m</code>. By blaming <code>GITPackUpload.m</code> with the <code>-C</code> option, you can see where sections of the code originally came from:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git blame -C -L 141,153 GITPackUpload.m</span><br><span class="line">f344f58d GITServerHandler.m (Scott 2009-01-04 141)</span><br><span class="line">f344f58d GITServerHandler.m (Scott 2009-01-04 142) - (void) gatherObjectShasFromC</span><br><span class="line">f344f58d GITServerHandler.m (Scott 2009-01-04 143) &#123;</span><br><span class="line">70befddd GITServerHandler.m (Scott 2009-03-22 144)         //NSLog(@<span class="string">"GATHER COMMI</span></span><br><span class="line"><span class="string">ad11ac80 GITPackUpload.m    (Scott 2009-03-24 145)</span></span><br><span class="line"><span class="string">ad11ac80 GITPackUpload.m    (Scott 2009-03-24 146)         NSString *parentSha;</span></span><br><span class="line"><span class="string">ad11ac80 GITPackUpload.m    (Scott 2009-03-24 147)         GITCommit *commit = [g</span></span><br><span class="line"><span class="string">ad11ac80 GITPackUpload.m    (Scott 2009-03-24 148)</span></span><br><span class="line"><span class="string">ad11ac80 GITPackUpload.m    (Scott 2009-03-24 149)         //NSLog(@"</span>GATHER COMMI</span><br><span class="line">ad11ac80 GITPackUpload.m    (Scott 2009-03-24 150)</span><br><span class="line">56ef2caf GITServerHandler.m (Scott 2009-01-05 151)         <span class="keyword">if</span>(commit) &#123;</span><br><span class="line">56ef2caf GITServerHandler.m (Scott 2009-01-05 152)                 [refDict setOb</span><br><span class="line">56ef2caf GITServerHandler.m (Scott 2009-01-05 153)</span><br></pre></td></tr></table></figure>
<p>This is really useful. Normally, you get as the original commit the commit where you copied the code over, because that is the first time you touched those lines in this file. Git tells you the original commit where you wrote those lines, even if it was in another file.</p>
<h3 id="Binary-Search"><a href="#Binary-Search" class="headerlink" title="Binary Search"></a>Binary Search</h3><p>Annotating a file helps if you know where the issue is to begin with. If you don’t know what is breaking, and there have been dozens or hundreds of commits since the last state where you know the code worked, you’ll likely turn to <code>git bisect</code> for help. The <code>bisect</code> command does a binary search through your commit history to help you identify as quickly as possible which commit introduced an issue.</p>
<p>Let’s say you just pushed out a release of your code to a production environment, you’re getting bug reports about something that wasn’t happening in your development environment, and you can’t imagine why the code is doing that. You go back to your code, and it turns out you can reproduce the issue, but you can’t figure out what is going wrong. You can <em>bisect</em> the code to find out. First you run <code>git bisect start</code> to get things going, and then you use <code>git bisect bad</code> to tell the system that the current commit you’re on is broken. Then, you must tell bisect when the last known good state was, using <code>git bisect good &lt;good_commit&gt;</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git bisect start</span><br><span class="line">$ git bisect bad</span><br><span class="line">$ git bisect good v1.0</span><br><span class="line">Bisecting: 6 revisions left to <span class="built_in">test</span> after this</span><br><span class="line">[ecb6e1bc347ccecc5f9350d878ce677feb13d3b2] error handling on repo</span><br></pre></td></tr></table></figure>
<p>Git figured out that about 12 commits came between the commit you marked as the last good commit (v1.0) and the current bad version, and it checked out the middle one for you. At this point, you can run your test to see if the issue exists as of this commit. If it does, then it was introduced sometime before this middle commit; if it doesn’t, then the problem was introduced sometime after the middle commit. It turns out there is no issue here, and you tell Git that by typing <code>git bisect good</code> and continue your journey:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git bisect good</span><br><span class="line">Bisecting: 3 revisions left to <span class="built_in">test</span> after this</span><br><span class="line">[b047b02ea83310a70fd603dc8cd7a6cd13d15c04] secure this thing</span><br></pre></td></tr></table></figure>
<p>Now you’re on another commit, halfway between the one you just tested and your bad commit. You run your test again and find that this commit is broken, so you tell Git that with <code>git bisect bad</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git bisect bad</span><br><span class="line">Bisecting: 1 revisions left to <span class="built_in">test</span> after this</span><br><span class="line">[f71ce38690acf49c1f3c9bea38e09d82a5ce6014] drop exceptions table</span><br></pre></td></tr></table></figure>
<p>This commit is fine, and now Git has all the information it needs to determine where the issue was introduced. It tells you the SHA-1 of the first bad commit and show some of the commit information and which files were modified in that commit so you can figure out what happened that may have introduced this bug:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git bisect good</span><br><span class="line">b047b02ea83310a70fd603dc8cd7a6cd13d15c04 is first bad commit</span><br><span class="line">commit b047b02ea83310a70fd603dc8cd7a6cd13d15c04</span><br><span class="line">Author: PJ Hyett &lt;pjhyett@example.com&gt;</span><br><span class="line">Date:   Tue Jan 27 14:48:32 2009 -0800</span><br><span class="line"></span><br><span class="line">    secure this thing</span><br><span class="line"></span><br><span class="line">:040000 040000 40ee3e7821b895e52c1695092db9bdc4c61d1730</span><br><span class="line">f24d3c6ebcfc639b1a3814550e62d60b8e68a8e4 M  config</span><br></pre></td></tr></table></figure>
<p>When you’re finished, you should run <code>git bisect reset</code> to reset your HEAD to where you were before you started, or you’ll end up in a weird state:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git bisect reset</span><br></pre></td></tr></table></figure>
<p>This is a powerful tool that can help you check hundreds of commits for an introduced bug in minutes. In fact, if you have a script that will exit 0 if the project is good or non-0 if the project is bad, you can fully automate <code>git bisect</code>. First, you again tell it the scope of the bisect by providing the known bad and good commits. You can do this by listing them with the <code>bisect start</code> command if you want, listing the known bad commit first and the known good commit second:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git bisect start HEAD v1.0</span><br><span class="line">$ git bisect run <span class="built_in">test</span>-error.sh</span><br></pre></td></tr></table></figure>
<p>Doing so automatically runs <code>test-error.sh</code> on each checked-out commit until Git finds the first broken commit. You can also run something like <code>make</code> or <code>make tests</code> or whatever you have that runs automated tests for you.</p>
<h2 id="Submodules"><a href="#Submodules" class="headerlink" title="Submodules"></a>Submodules</h2><p>It often happens that while working on one project, you need to use another project from within it. Perhaps it’s a library that a third party developed or that you’re developing separately and using in multiple parent projects. A common issue arises in these scenarios: you want to be able to treat the two projects as separate yet still be able to use one from within the other.</p>
<p>Here’s an example. Suppose you’re developing a website and creating Atom feeds. Instead of writing your own Atom-generating code, you decide to use a library. You’re likely to have to either include this code from a shared library like a CPAN install or Ruby gem, or copy the source code into your own project tree. The issue with including the library is that it’s difficult to customize the library in any way and often more difficult to deploy it, because you need to make sure every client has that library available. The issue with copying the code into your own project is that any custom changes you make are difficult to merge when upstream changes become available.</p>
<p>Git addresses this issue using submodules. Submodules allow you to keep a Git repository as a subdirectory of another Git repository. This lets you clone another repository into your project and keep your commits separate.</p>
<h3 id="Starting-with-Submodules"><a href="#Starting-with-Submodules" class="headerlink" title="Starting with Submodules"></a>Starting with Submodules</h3><p>We’ll walk through developing a simple project that has been split up into a main project and a few sub-projects.</p>
<p>Let’s start by adding an existing Git repository as a submodule of the repository that we’re working on. To add a new submodule you use the <code>git submodule add</code> command with the absolute or relative URL of the project you would like to start tracking. In this example, we’ll add a library called “DbConnector”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule add [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">Cloning into <span class="string">'DbConnector'</span>...</span><br><span class="line">remote: Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (10/10), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 11 (delta 0), reused 11 (delta 0)</span><br><span class="line">Unpacking objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure>
<p>By default, submodules will add the subproject into a directory named the same as the repository, in this case “DbConnector”. You can add a different path at the end of the command if you want it to go elsewhere.</p>
<p>If you run <code>git status</code> at this point, you’ll notice a few things.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   .gitmodules</span><br><span class="line">	new file:   DbConnector</span><br></pre></td></tr></table></figure>
<p>First you should notice the new <code>.gitmodules</code> file. This is a configuration file that stores the mapping between the project’s URL and the local subdirectory you’ve pulled it into:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[submodule <span class="string">"DbConnector"</span>]</span><br><span class="line">	path = DbConnector</span><br><span class="line">	url = [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br></pre></td></tr></table></figure>
<p>If you have multiple submodules, you’ll have multiple entries in this file. It’s important to note that this file is version-controlled with your other files, like your <code>.gitignore</code> file. It’s pushed and pulled with the rest of your project. This is how other people who clone this project know where to get the submodule projects from.</p>
<p>Since the URL in the .gitmodules file is what other people will first try to clone/fetch from, make sure to use a URL that they can access if possible. For example, if you use a different URL to push to than others would to pull from, use the one that others have access to. You can overwrite this value locally with <code>git config submodule.DbConnector.url PRIVATE_URL</code> for your own use. When applicable, a relative URL can be helpful.</p>
<p>The other listing in the <code>git status</code> output is the project folder entry. If you run <code>git diff</code> on that, you see something interesting:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --cached DbConnector</span><br><span class="line">diff --git a/DbConnector b/DbConnector</span><br><span class="line">new file mode 160000</span><br><span class="line">index 0000000..c3f01dc</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/DbConnector</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+Subproject commit c3f01dc8862123d317dd46284b05b6892c7b29bc</span><br></pre></td></tr></table></figure>
<p>Although <code>DbConnector</code> is a subdirectory in your working directory, Git sees it as a submodule and doesn’t track its contents when you’re not in that directory. Instead, Git sees it as a particular commit from that repository.</p>
<p>If you want a little nicer diff output, you can pass the <code>--submodule</code> option to <code>git diff</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git diff --cached --submodule</span><br><span class="line">diff --git a/.gitmodules b/.gitmodules</span><br><span class="line">new file mode 100644</span><br><span class="line">index 0000000..71fc376</span><br><span class="line">--- /dev/null</span><br><span class="line">+++ b/.gitmodules</span><br><span class="line">@@ -0,0 +1,3 @@</span><br><span class="line">+[submodule <span class="string">"DbConnector"</span>]</span><br><span class="line">+       path = DbConnector</span><br><span class="line">+       url = [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">Submodule DbConnector 0000000...c3f01dc (new submodule)</span><br></pre></td></tr></table></figure>
<p>When you commit, you see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">'added DbConnector module'</span></span><br><span class="line">[master fb9093c] added DbConnector module</span><br><span class="line"> 2 files changed, 4 insertions(+)</span><br><span class="line"> create mode 100644 .gitmodules</span><br><span class="line"> create mode 160000 DbConnector</span><br></pre></td></tr></table></figure>
<p>Notice the <code>160000</code> mode for the <code>DbConnector</code> entry. That is a special mode in Git that basically means you’re recording a commit as a directory entry rather than a subdirectory or a file.</p>
<p>Lastly, push these changes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<h3 id="Cloning-a-Project-with-Submodules"><a href="#Cloning-a-Project-with-Submodules" class="headerlink" title="Cloning a Project with Submodules"></a>Cloning a Project with Submodules</h3><p>Here we’ll clone a project with a submodule in it. When you clone such a project, by default you get the directories that contain submodules, but none of the files within them yet:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/chaconinc/MainProject](https://github.com/chaconinc/MainProject)</span><br><span class="line">Cloning into <span class="string">'MainProject'</span>...</span><br><span class="line">remote: Counting objects: 14, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (13/13), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 14 (delta 1), reused 13 (delta 0)</span><br><span class="line">Unpacking objects: 100% (14/14), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line">$ <span class="built_in">cd</span> MainProject</span><br><span class="line">$ ls -la</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x   9 schacon  staff  306 Sep 17 15:21 .</span><br><span class="line">drwxr-xr-x   7 schacon  staff  238 Sep 17 15:21 ..</span><br><span class="line">drwxr-xr-x  13 schacon  staff  442 Sep 17 15:21 .git</span><br><span class="line">-rw-r--r--   1 schacon  staff   92 Sep 17 15:21 .gitmodules</span><br><span class="line">drwxr-xr-x   2 schacon  staff   68 Sep 17 15:21 DbConnector</span><br><span class="line">-rw-r--r--   1 schacon  staff  756 Sep 17 15:21 Makefile</span><br><span class="line">drwxr-xr-x   3 schacon  staff  102 Sep 17 15:21 includes</span><br><span class="line">drwxr-xr-x   4 schacon  staff  136 Sep 17 15:21 scripts</span><br><span class="line">drwxr-xr-x   4 schacon  staff  136 Sep 17 15:21 src</span><br><span class="line">$ <span class="built_in">cd</span> DbConnector/</span><br><span class="line">$ ls</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>The <code>DbConnector</code> directory is there, but empty. You must run two commands: <code>git submodule init</code> to initialize your local configuration file, and <code>git submodule update</code> to fetch all the data from that project and check out the appropriate commit listed in your superproject:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule init</span><br><span class="line">Submodule <span class="string">'DbConnector'</span> (https://github.com/chaconinc/DbConnector) registered <span class="keyword">for</span> path <span class="string">'DbConnector'</span></span><br><span class="line">$ git submodule update</span><br><span class="line">Cloning into <span class="string">'DbConnector'</span>...</span><br><span class="line">remote: Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (10/10), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 11 (delta 0), reused 11 (delta 0)</span><br><span class="line">Unpacking objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: checked out <span class="string">'c3f01dc8862123d317dd46284b05b6892c7b29bc'</span></span><br></pre></td></tr></table></figure>
<p>Now your <code>DbConnector</code> subdirectory is at the exact state it was in when you committed earlier.</p>
<p>There is another way to do this which is a little simpler, however. If you pass <code>--recurse-submodules</code> to the <code>git clone</code> command, it will automatically initialize and update each submodule in the repository.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> --recurse-submodules [https://github.com/chaconinc/MainProject](https://github.com/chaconinc/MainProject)</span><br><span class="line">Cloning into <span class="string">'MainProject'</span>...</span><br><span class="line">remote: Counting objects: 14, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (13/13), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 14 (delta 1), reused 13 (delta 0)</span><br><span class="line">Unpacking objects: 100% (14/14), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line">Submodule <span class="string">'DbConnector'</span> (https://github.com/chaconinc/DbConnector) registered <span class="keyword">for</span> path <span class="string">'DbConnector'</span></span><br><span class="line">Cloning into <span class="string">'DbConnector'</span>...</span><br><span class="line">remote: Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (10/10), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 11 (delta 0), reused 11 (delta 0)</span><br><span class="line">Unpacking objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: checked out <span class="string">'c3f01dc8862123d317dd46284b05b6892c7b29bc'</span></span><br></pre></td></tr></table></figure>
<h3 id="Working-on-a-Project-with-Submodules"><a href="#Working-on-a-Project-with-Submodules" class="headerlink" title="Working on a Project with Submodules"></a>Working on a Project with Submodules</h3><p>Now we have a copy of a project with submodules in it and will collaborate with our teammates on both the main project and the submodule project.</p>
<h4 id="Pulling-in-Upstream-Changes"><a href="#Pulling-in-Upstream-Changes" class="headerlink" title="Pulling in Upstream Changes"></a>Pulling in Upstream Changes</h4><p>The simplest model of using submodules in a project would be if you were simply consuming a subproject and wanted to get updates from it from time to time but were not actually modifying anything in your checkout. Let’s walk through a simple example there.</p>
<p>If you want to check for new work in a submodule, you can go into the directory and run <code>git fetch</code> and <code>git merge</code> the upstream branch to update the local code.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch</span><br><span class="line">From [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">   c3f01dc..d0354fc  master     -&gt; origin/master</span><br><span class="line">$ git merge origin/master</span><br><span class="line">Updating c3f01dc..d0354fc</span><br><span class="line">Fast-forward</span><br><span class="line"> scripts/connect.sh | 1 +</span><br><span class="line"> src/db.c           | 1 +</span><br><span class="line"> 2 files changed, 2 insertions(+)</span><br></pre></td></tr></table></figure>
<p>Now if you go back into the main project and run <code>git diff --submodule</code> you can see that the submodule was updated and get a list of commits that were added to it. If you don’t want to type <code>--submodule</code> every time you run <code>git diff</code>, you can set it as the default format by setting the <code>diff.submodule</code> config value to “log”.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global diff.submodule <span class="built_in">log</span></span><br><span class="line">$ git diff</span><br><span class="line">Submodule DbConnector c3f01dc..d0354fc:</span><br><span class="line">  &gt; more efficient db routine</span><br><span class="line">  &gt; better connection routine</span><br></pre></td></tr></table></figure>
<p>If you commit at this point then you will lock the submodule into having the new code when other people update.</p>
<p>There is an easier way to do this as well, if you prefer to not manually fetch and merge in the subdirectory. If you run <code>git submodule update --remote</code>, Git will go into your submodules and fetch and update for you.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule update --remote DbConnector</span><br><span class="line">remote: Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 2), reused 4 (delta 2)</span><br><span class="line">Unpacking objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">   3f19983..d0354fc  master     -&gt; origin/master</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: checked out <span class="string">'d0354fc054692d3906c85c3af05ddce39a1c0644'</span></span><br></pre></td></tr></table></figure>
<p>This command will by default assume that you want to update the checkout to the <code>master</code> branch of the submodule repository. You can, however, set this to something different if you want. For example, if you want to have the DbConnector submodule track that repository’s “stable” branch, you can set it in either your <code>.gitmodules</code> file (so everyone else also tracks it), or just in your local <code>.git/config</code> file. Let’s set it in the <code>.gitmodules</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git config -f .gitmodules submodule.DbConnector.branch stable</span><br><span class="line"></span><br><span class="line">$ git submodule update --remote</span><br><span class="line">remote: Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 2), reused 4 (delta 2)</span><br><span class="line">Unpacking objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">   27cf5d3..c87d55d  stable -&gt; origin/stable</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: checked out <span class="string">'c87d55d4c6d4b05ee34fbc8cb6f7bf4585ae6687'</span></span><br></pre></td></tr></table></figure>
<p>If you leave off the <code>-f .gitmodules</code> it will only make the change for you, but it probably makes more sense to track that information with the repository so everyone else does as well.</p>
<p>When we run <code>git status</code> at this point, Git will show us that we have “new commits” on the submodule.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">  modified:   .gitmodules</span><br><span class="line">  modified:   DbConnector (new commits)</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br></pre></td></tr></table></figure>
<p>If you set the configuration setting <code>status.submodulesummary</code>, Git will also show you a short summary of changes to your submodules:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ git config status.submodulesummary 1</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line"></span><br><span class="line">	modified:   .gitmodules</span><br><span class="line">	modified:   DbConnector (new commits)</span><br><span class="line"></span><br><span class="line">Submodules changed but not updated:</span><br><span class="line"></span><br><span class="line">* DbConnector c3f01dc...c87d55d (4):</span><br><span class="line">  &gt; catch non-null terminated lines</span><br></pre></td></tr></table></figure>
<p>At this point if you run <code>git diff</code> we can see both that we have modified our <code>.gitmodules</code> file and also that there are a number of commits that we’ve pulled down and are ready to commit to our submodule project.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --git a/.gitmodules b/.gitmodules</span><br><span class="line">index 6fc0b3d..fd1cc29 100644</span><br><span class="line">--- a/.gitmodules</span><br><span class="line">+++ b/.gitmodules</span><br><span class="line">@@ -1,3 +1,4 @@</span><br><span class="line"> [submodule <span class="string">"DbConnector"</span>]</span><br><span class="line">        path = DbConnector</span><br><span class="line">        url = [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">+       branch = stable</span><br><span class="line"> Submodule DbConnector c3f01dc..c87d55d:</span><br><span class="line">  &gt; catch non-null terminated lines</span><br><span class="line">  &gt; more robust error handling</span><br><span class="line">  &gt; more efficient db routine</span><br><span class="line">  &gt; better connection routine</span><br></pre></td></tr></table></figure>
<p>This is pretty cool as we can actually see the log of commits that we’re about to commit to in our submodule. Once committed, you can see this information after the fact as well when you run <code>git log -p</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -p --submodule</span><br><span class="line">commit 0a24cfc121a8a3c118e0105ae4ae4c00281cf7ae</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Wed Sep 17 16:37:02 2014 +0200</span><br><span class="line"></span><br><span class="line">    updating DbConnector <span class="keyword">for</span> bug fixes</span><br><span class="line"></span><br><span class="line">diff --git a/.gitmodules b/.gitmodules</span><br><span class="line">index 6fc0b3d..fd1cc29 100644</span><br><span class="line">--- a/.gitmodules</span><br><span class="line">+++ b/.gitmodules</span><br><span class="line">@@ -1,3 +1,4 @@</span><br><span class="line"> [submodule <span class="string">"DbConnector"</span>]</span><br><span class="line">        path = DbConnector</span><br><span class="line">        url = [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">+       branch = stable</span><br><span class="line">Submodule DbConnector c3f01dc..c87d55d:</span><br><span class="line">  &gt; catch non-null terminated lines</span><br><span class="line">  &gt; more robust error handling</span><br><span class="line">  &gt; more efficient db routine</span><br><span class="line">  &gt; better connection routine</span><br></pre></td></tr></table></figure>
<p>Git will by default try to update <strong>all</strong> of your submodules when you run <code>git submodule update --remote</code> so if you have a lot of them, you may want to pass the name of just the submodule you want to try to update.</p>
<h4 id="Working-on-a-Submodule"><a href="#Working-on-a-Submodule" class="headerlink" title="Working on a Submodule"></a>Working on a Submodule</h4><p>It’s quite likely that if you’re using submodules, you’re doing so because you really want to work on the code in the submodule at the same time as you’re working on the code in the main project (or across several submodules). Otherwise you would probably instead be using a simpler dependency management system (such as Maven or Rubygems).</p>
<p>So now let’s go through an example of making changes to the submodule at the same time as the main project and committing and publishing those changes at the same time.</p>
<p>So far, when we’ve run the <code>git submodule update</code> command to fetch changes from the submodule repositories, Git would get the changes and update the files in the subdirectory but will leave the sub-repository in what’s called a “detached HEAD” state. This means that there is no local working branch (like “master”, for example) tracking changes. With no working branch tracking changes, that means even if you commit changes to the submodule, those changes will quite possibly be lost the next time you run <code>git submodule update</code>. You have to do some extra steps if you want changes in a submodule to be tracked.</p>
<p>In order to set up your submodule to be easier to go in and hack on, you need to do two things. You need to go into each submodule and check out a branch to work on. Then you need to tell Git what to do if you have made changes and then <code>git submodule update --remote</code> pulls in new work from upstream. The options are that you can merge them into your local work, or you can try to rebase your local work on top of the new changes.</p>
<p>First of all, let’s go into our submodule directory and check out a branch.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout stable</span><br><span class="line">Switched to branch <span class="string">'stable'</span></span><br></pre></td></tr></table></figure>
<p>Let’s try it with the “merge” option. To specify it manually, we can just add the <code>--merge</code> option to our <code>update</code> call. Here we’ll see that there was a change on the server for this submodule and it gets merged in.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule update --remote --merge</span><br><span class="line">remote: Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 2), reused 4 (delta 2)</span><br><span class="line">Unpacking objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">   c87d55d..92c7337  stable     -&gt; origin/stable</span><br><span class="line">Updating c87d55d..92c7337</span><br><span class="line">Fast-forward</span><br><span class="line"> src/main.c | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: merged <span class="keyword">in</span> <span class="string">'92c7337b30ef9e0893e758dac2459d07362ab5ea'</span></span><br></pre></td></tr></table></figure>
<p>If we go into the DbConnector directory, we have the new changes already merged into our local <code>stable</code> branch. Now let’s see what happens when we make our own local change to the library and someone else pushes another change upstream at the same time.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> DbConnector/</span><br><span class="line">$ vim src/db.c</span><br><span class="line">$ git commit -am <span class="string">'unicode support'</span></span><br><span class="line">[stable f906e16] unicode support</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<p>Now if we update our submodule we can see what happens when we have made a local change and upstream also has a change we need to incorporate.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule update --remote --rebase</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: unicode support</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: rebased into <span class="string">'5d60ef9bbebf5a0c1c1050f242ceeb54ad58da94'</span></span><br></pre></td></tr></table></figure>
<p>If you forget the <code>--rebase</code> or <code>--merge</code>, Git will just update the submodule to whatever is on the server and reset your project to a detached HEAD state.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule update --remote</span><br><span class="line">Submodule path <span class="string">'DbConnector'</span>: checked out <span class="string">'5d60ef9bbebf5a0c1c1050f242ceeb54ad58da94'</span></span><br></pre></td></tr></table></figure>
<p>If this happens, don’t worry, you can simply go back into the directory and check out your branch again (which will still contain your work) and merge or rebase <code>origin/stable</code> (or whatever remote branch you want) manually.</p>
<p>If you haven’t committed your changes in your submodule and you run a submodule update that would cause issues, Git will fetch the changes but not overwrite unsaved work in your submodule directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule update --remote</span><br><span class="line">remote: Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 0), reused 4 (delta 0)</span><br><span class="line">Unpacking objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">   5d60ef9..c75e92a  stable     -&gt; origin/stable</span><br><span class="line">error: Your <span class="built_in">local</span> changes to the following files would be overwritten by checkout:</span><br><span class="line">	scripts/setup.sh</span><br><span class="line">Please, commit your changes or stash them before you can switch branches.</span><br><span class="line">Aborting</span><br><span class="line">Unable to checkout <span class="string">'c75e92a2b3855c9e5b66f915308390d9db204aca'</span> <span class="keyword">in</span> submodule path <span class="string">'DbConnector'</span></span><br></pre></td></tr></table></figure>
<p>If you made changes that conflict with something changed upstream, Git will let you know when you run the update.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule update --remote --merge</span><br><span class="line">Auto-merging scripts/setup.sh</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> scripts/setup.sh</span><br><span class="line">Recorded preimage <span class="keyword">for</span> <span class="string">'scripts/setup.sh'</span></span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br><span class="line">Unable to merge <span class="string">'c75e92a2b3855c9e5b66f915308390d9db204aca'</span> <span class="keyword">in</span> submodule path <span class="string">'DbConnector'</span></span><br></pre></td></tr></table></figure>
<p>You can go into the submodule directory and fix the conflict just as you normally would.</p>
<h4 id="Publishing-Submodule-Changes"><a href="#Publishing-Submodule-Changes" class="headerlink" title="Publishing Submodule Changes"></a>Publishing Submodule Changes</h4><p>Now we have some changes in our submodule directory. Some of these were brought in from upstream by our updates and others were made locally and aren’t available to anyone else yet as we haven’t pushed them yet.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">Submodule DbConnector c87d55d..82d2ad3:</span><br><span class="line">  &gt; Merge from origin/stable</span><br><span class="line">  &gt; updated setup script</span><br><span class="line">  &gt; unicode support</span><br><span class="line">  &gt; remove unnecessary method</span><br><span class="line">  &gt; add new option <span class="keyword">for</span> conn pooling</span><br></pre></td></tr></table></figure>
<p>If we commit in the main project and push it up without pushing the submodule changes up as well, other people who try to check out our changes are going to be in trouble since they will have no way to get the submodule changes that are depended on. Those changes will only exist on our local copy.</p>
<p>In order to make sure this doesn’t happen, you can ask Git to check that all your submodules have been pushed properly before pushing the main project. The <code>git push</code> command takes the <code>--recurse-submodules</code> argument which can be set to either “check” or “on-demand”. The “check” option will make <code>push</code> simply fail if any of the committed submodule changes haven’t been pushed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git push --recurse-submodules=check</span><br><span class="line">The following submodule paths contain changes that can</span><br><span class="line">not be found on any remote:</span><br><span class="line">  DbConnector</span><br><span class="line"></span><br><span class="line">Please try</span><br><span class="line"></span><br><span class="line">	git push --recurse-submodules=on-demand</span><br><span class="line"></span><br><span class="line">or <span class="built_in">cd</span> to the path and use</span><br><span class="line"></span><br><span class="line">	git push</span><br><span class="line"></span><br><span class="line">to push them to a remote.</span><br></pre></td></tr></table></figure>
<p>As you can see, it also gives us some helpful advice on what we might want to do next. The simple option is to go into each submodule and manually push to the remotes to make sure they’re externally available and then try this push again. If you want the check behavior to happen for all pushes, you can make this behavior the default by doing <code>git config push.recurseSubmodules check</code>.</p>
<p>The other option is to use the “on-demand” value, which will try to do this for you.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git push --recurse-submodules=on-demand</span><br><span class="line">Pushing submodule <span class="string">'DbConnector'</span></span><br><span class="line">Counting objects: 9, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (8/8), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (9/9), 917 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 9 (delta 3), reused 0 (delta 0)</span><br><span class="line">To [https://github.com/chaconinc/DbConnector](https://github.com/chaconinc/DbConnector)</span><br><span class="line">   c75e92a..82d2ad3  stable -&gt; stable</span><br><span class="line">Counting objects: 2, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (2/2), 266 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 2 (delta 1), reused 0 (delta 0)</span><br><span class="line">To [https://github.com/chaconinc/MainProject](https://github.com/chaconinc/MainProject)</span><br><span class="line">   3d6d338..9a377d1  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>As you can see there, Git went into the DbConnector module and pushed it before pushing the main project. If that submodule push fails for some reason, the main project push will also fail. You can make this behavior the default by doing <code>git config push.recurseSubmodules on-demand</code>.</p>
<h4 id="Merging-Submodule-Changes"><a href="#Merging-Submodule-Changes" class="headerlink" title="Merging Submodule Changes"></a>Merging Submodule Changes</h4><p>If you change a submodule reference at the same time as someone else, you may run into some problems. That is, if the submodule histories have diverged and are committed to diverging branches in a superproject, it may take a bit of work for you to fix.</p>
<p>If one of the commits is a direct ancestor of the other (a fast-forward merge), then Git will simply choose the latter for the merge, so that works fine.</p>
<p>Git will not attempt even a trivial merge for you, however. If the submodule commits diverge and need to be merged, you will get something that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git pull</span><br><span class="line">remote: Counting objects: 2, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (1/1), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 2 (delta 1), reused 2 (delta 1)</span><br><span class="line">Unpacking objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">From [https://github.com/chaconinc/MainProject](https://github.com/chaconinc/MainProject)</span><br><span class="line">   9a377d1..eb974f8  master     -&gt; origin/master</span><br><span class="line">Fetching submodule DbConnector</span><br><span class="line">warning: Failed to merge submodule DbConnector (merge following commits not found)</span><br><span class="line">Auto-merging DbConnector</span><br><span class="line">CONFLICT (submodule): Merge conflict <span class="keyword">in</span> DbConnector</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>So basically what has happened here is that Git has figured out that the two branches record points in the submodule’s history that are divergent and need to be merged. It explains it as “merge following commits not found”, which is confusing but we’ll explain why that is in a bit.</p>
<p>To solve the problem, you need to figure out what state the submodule should be in. Strangely, Git doesn’t really give you much information to help out here, not even the SHA-1s of the commits of both sides of the history. Fortunately, it’s simple to figure out. If you run <code>git diff</code> you can get the SHA-1s of the commits recorded in both branches you were trying to merge.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --cc DbConnector</span><br><span class="line">index eb41d76,c771610..0000000</span><br><span class="line">--- a/DbConnector</span><br><span class="line">+++ b/DbConnector</span><br></pre></td></tr></table></figure>
<p>So, in this case, <code>eb41d76</code> is the commit in our submodule that <strong>we</strong> had and <code>c771610</code> is the commit that upstream had. If we go into our submodule directory, it should already be on <code>eb41d76</code> as the merge would not have touched it. If for whatever reason it’s not, you can simply create and checkout a branch pointing to it.</p>
<p>What is important is the SHA-1 of the commit from the other side. This is what you’ll have to merge in and resolve. You can either just try the merge with the SHA-1 directly, or you can create a branch for it and then try to merge that in. We would suggest the latter, even if only to make a nicer merge commit message.</p>
<p>So, we will go into our submodule directory, create a branch based on that second SHA-1 from <code>git diff</code> and manually merge.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> DbConnector</span><br><span class="line"></span><br><span class="line">$ git rev-parse HEAD</span><br><span class="line">eb41d764bccf88be77aced643c13a7fa86714135</span><br><span class="line"></span><br><span class="line">$ git branch try-merge c771610</span><br><span class="line">(DbConnector) $ git merge try-merge</span><br><span class="line">Auto-merging src/main.c</span><br><span class="line">CONFLICT (content): Merge conflict <span class="keyword">in</span> src/main.c</span><br><span class="line">Recorded preimage <span class="keyword">for</span> <span class="string">'src/main.c'</span></span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>We got an actual merge conflict here, so if we resolve that and commit it, then we can simply update the main project with the result.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ vim src/main.c ①</span><br><span class="line">$ git add src/main.c</span><br><span class="line">$ git commit -am <span class="string">'merged our changes'</span></span><br><span class="line">Recorded resolution <span class="keyword">for</span> <span class="string">'src/main.c'</span>.</span><br><span class="line">[master 9fd905e] merged our changes</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> .. ②</span><br><span class="line">$ git diff ③</span><br><span class="line">diff --cc DbConnector</span><br><span class="line">index eb41d76,c771610..0000000</span><br><span class="line">--- a/DbConnector</span><br><span class="line">+++ b/DbConnector</span><br><span class="line">@@@ -1,1 -1,1 +1,1 @@@</span><br><span class="line">- Subproject commit eb41d764bccf88be77aced643c13a7fa86714135</span><br><span class="line"> -Subproject commit c77161012afbbe1f58b5053316ead08f4b7e6d1d</span><br><span class="line">++Subproject commit 9fd905e5d7f45a0d4cbc43d1ee550f16a30e825a</span><br><span class="line">$ git add DbConnector ④</span><br><span class="line"></span><br><span class="line">$ git commit -m <span class="string">"Merge Tom's Changes"</span> ⑤</span><br><span class="line">[master 10d2c60] Merge Tom<span class="string">'s Changes</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> First we resolve the conflict</li>
<li><em>②</em> Then we go back to the main project directory</li>
<li><em>③</em> We can check the SHA-1s again</li>
<li><em>④</em> Resolve the conflicted submodule entry</li>
<li><em>⑤</em> Commit our merge<br>It can be a bit confusing, but it’s really not very hard.</li>
</ol>
<p>Interestingly, there is another case that Git handles. If a merge commit exists in the submodule directory that contains <strong>both</strong> commits in its history, Git will suggest it to you as a possible solution. It sees that at some point in the submodule project, someone merged branches containing these two commits, so maybe you’ll want that one.</p>
<p>This is why the error message from before was “merge following commits not found”, because it could not do <strong>this</strong>. It’s confusing because who would expect it to <strong>try</strong> to do this?</p>
<p>If it does find a single acceptable merge commit, you’ll see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git merge origin/master</span><br><span class="line">warning: Failed to merge submodule DbConnector (not fast-forward)</span><br><span class="line">Found a possible merge resolution <span class="keyword">for</span> the submodule:</span><br><span class="line"> 9fd905e5d7f45a0d4cbc43d1ee550f16a30e825a: &gt; merged our changes</span><br><span class="line">If this is correct simply add it to the index <span class="keyword">for</span> example</span><br><span class="line">by using:</span><br><span class="line"></span><br><span class="line">  git update-index --cacheinfo 160000 9fd905e5d7f45a0d4cbc43d1ee550f16a30e825a <span class="string">"DbConnector"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">which</span> will accept this suggestion.</span><br><span class="line">Auto-merging DbConnector</span><br><span class="line">CONFLICT (submodule): Merge conflict <span class="keyword">in</span> DbConnector</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the result.</span><br></pre></td></tr></table></figure>
<p>What it’s suggesting that you do is to update the index like you had run <code>git add</code>, which clears the conflict, then commit. You probably shouldn’t do this though. You can just as easily go into the submodule directory, see what the difference is, fast-forward to this commit, test it properly, and then commit it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> DbConnector/</span><br><span class="line">$ git merge 9fd905e</span><br><span class="line">Updating eb41d76..9fd905e</span><br><span class="line">Fast-forward</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> ..</span><br><span class="line">$ git add DbConnector</span><br><span class="line">$ git commit -am <span class="string">'Fast forwarded to a common submodule child'</span></span><br></pre></td></tr></table></figure>
<p>This accomplishes the same thing, but at least this way you can verify that it works and you have the code in your submodule directory when you’re done.</p>
<h3 id="Submodule-Tips"><a href="#Submodule-Tips" class="headerlink" title="Submodule Tips"></a>Submodule Tips</h3><p>There are a few things you can do to make working with submodules a little easier.</p>
<h4 id="Submodule-Foreach"><a href="#Submodule-Foreach" class="headerlink" title="Submodule Foreach"></a>Submodule Foreach</h4><p>There is a <code>foreach</code> submodule command to run some arbitrary command in each submodule. This can be really helpful if you have a number of submodules in the same project.</p>
<p>For example, let’s say we want to start a new feature or do a bugfix and we have work going on in several submodules. We can easily stash all the work in all our submodules.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule foreach <span class="string">'git stash'</span></span><br><span class="line">Entering <span class="string">'CryptoLibrary'</span></span><br><span class="line">No <span class="built_in">local</span> changes to save</span><br><span class="line">Entering <span class="string">'DbConnector'</span></span><br><span class="line">Saved working directory and index state WIP on stable: 82d2ad3 Merge from origin/stable</span><br><span class="line">HEAD is now at 82d2ad3 Merge from origin/stable</span><br></pre></td></tr></table></figure>
<p>Then we can create a new branch and switch to it in all our submodules.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule foreach <span class="string">'git checkout -b featureA'</span></span><br><span class="line">Entering <span class="string">'CryptoLibrary'</span></span><br><span class="line">Switched to a new branch <span class="string">'featureA'</span></span><br><span class="line">Entering <span class="string">'DbConnector'</span></span><br><span class="line">Switched to a new branch <span class="string">'featureA'</span></span><br></pre></td></tr></table></figure>
<p>You get the idea. One really useful thing you can do is produce a nice unified diff of what is changed in your main project and all your subprojects as well.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ git diff; git submodule foreach <span class="string">'git diff'</span></span><br><span class="line">Submodule DbConnector contains modified content</span><br><span class="line">diff --git a/src/main.c b/src/main.c</span><br><span class="line">index 210f1ae..1f0acdc 100644</span><br><span class="line">--- a/src/main.c</span><br><span class="line">+++ b/src/main.c</span><br><span class="line">@@ -245,6 +245,8 @@ static int handle_alias(int *argcp, const char ***argv)</span><br><span class="line"></span><br><span class="line">      commit_pager_choice();</span><br><span class="line"></span><br><span class="line">+     url = url_decode(url_orig);</span><br><span class="line">+</span><br><span class="line">      /* build alias_argv */</span><br><span class="line">      alias_argv = xmalloc(sizeof(*alias_argv) * (argc + 1));</span><br><span class="line">      alias_argv[0] = alias_string + 1;</span><br><span class="line">Entering <span class="string">'DbConnector'</span></span><br><span class="line">diff --git a/src/db.c b/src/db.c</span><br><span class="line">index 1aaefb6..5297645 100644</span><br><span class="line">--- a/src/db.c</span><br><span class="line">+++ b/src/db.c</span><br><span class="line">@@ -93,6 +93,11 @@ char *url_decode_mem(const char *url, int len)</span><br><span class="line">        <span class="built_in">return</span> url_decode_internal(&amp;url, len, NULL, &amp;out, 0);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">+char *url_decode(const char *url)</span><br><span class="line">+&#123;</span><br><span class="line">+       <span class="built_in">return</span> url_decode_mem(url, strlen(url));</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line"> char *url_decode_parameter_name(const char **query)</span><br><span class="line"> &#123;</span><br><span class="line">        struct strbuf out = STRBUF_INIT;</span><br></pre></td></tr></table></figure>
<p>Here we can see that we’re defining a function in a submodule and calling it in the main project. This is obviously a simplified example, but hopefully it gives you an idea of how this may be useful.</p>
<h4 id="Useful-Aliases"><a href="#Useful-Aliases" class="headerlink" title="Useful Aliases"></a>Useful Aliases</h4><p>You may want to set up some aliases for some of these commands as they can be quite long and you can’t set configuration options for most of them to make them defaults. We covered setting up Git aliases in 【Git Aliases】, but here is an example of what you may want to set up if you plan on working with submodules in Git a lot.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git config alias.sdiff <span class="string">'!'</span><span class="string">"git diff &amp;&amp; git submodule foreach 'git diff'"</span></span><br><span class="line">$ git config alias.spush <span class="string">'push --recurse-submodules=on-demand'</span></span><br><span class="line">$ git config alias.supdate <span class="string">'submodule update --remote --merge'</span></span><br></pre></td></tr></table></figure>
<p>This way you can simply run <code>git supdate</code> when you want to update your submodules, or <code>git spush</code> to push with submodule dependency checking.</p>
<h3 id="Issues-with-Submodules"><a href="#Issues-with-Submodules" class="headerlink" title="Issues with Submodules"></a>Issues with Submodules</h3><p>Using submodules isn’t without hiccups, however.</p>
<p>For instance switching branches with submodules in them can also be tricky. If you create a new branch, add a submodule there, and then switch back to a branch without that submodule, you still have the submodule directory as an untracked directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b add-crypto</span><br><span class="line">Switched to a new branch <span class="string">'add-crypto'</span></span><br><span class="line"></span><br><span class="line">$ git submodule add [https://github.com/chaconinc/CryptoLibrary](https://github.com/chaconinc/CryptoLibrary)</span><br><span class="line">Cloning into <span class="string">'CryptoLibrary'</span>...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ git commit -am <span class="string">'adding crypto library'</span></span><br><span class="line">[add-crypto 4445836] adding crypto library</span><br><span class="line"> 2 files changed, 4 insertions(+)</span><br><span class="line"> create mode 160000 CryptoLibrary</span><br><span class="line"></span><br><span class="line">$ git checkout master</span><br><span class="line">warning: unable to rmdir CryptoLibrary: Directory not empty</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"></span><br><span class="line">	CryptoLibrary/</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br></pre></td></tr></table></figure>
<p>Removing the directory isn’t difficult, but it can be a bit confusing to have that in there. If you do remove it and then switch back to the branch that has that submodule, you will need to run <code>submodule update --init</code> to repopulate it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git clean -ffdx</span><br><span class="line">Removing CryptoLibrary/</span><br><span class="line"></span><br><span class="line">$ git checkout add-crypto</span><br><span class="line">Switched to branch <span class="string">'add-crypto'</span></span><br><span class="line"></span><br><span class="line">$ ls CryptoLibrary/</span><br><span class="line"></span><br><span class="line">$ git submodule update --init</span><br><span class="line">Submodule path <span class="string">'CryptoLibrary'</span>: checked out <span class="string">'b8dda6aa182ea4464f3f3264b11e0268545172af'</span></span><br><span class="line"></span><br><span class="line">$ ls CryptoLibrary/</span><br><span class="line">Makefile	includes	scripts		src</span><br></pre></td></tr></table></figure>
<p>Again, not really very difficult, but it can be a little confusing.</p>
<p>The other main caveat that many people run into involves switching from subdirectories to submodules. If you’ve been tracking files in your project and you want to move them out into a submodule, you must be careful or Git will get angry at you. Assume that you have files in a subdirectory of your project, and you want to switch it to a submodule. If you delete the subdirectory and then run <code>submodule add</code>, Git yells at you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ rm -Rf CryptoLibrary/</span><br><span class="line">$ git submodule add [https://github.com/chaconinc/CryptoLibrary](https://github.com/chaconinc/CryptoLibrary)</span><br><span class="line"><span class="string">'CryptoLibrary'</span> already exists <span class="keyword">in</span> the index</span><br></pre></td></tr></table></figure>
<p>You have to unstage the <code>CryptoLibrary</code> directory first. Then you can add the submodule:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git rm -r CryptoLibrary</span><br><span class="line">$ git submodule add [https://github.com/chaconinc/CryptoLibrary](https://github.com/chaconinc/CryptoLibrary)</span><br><span class="line">Cloning into <span class="string">'CryptoLibrary'</span>...</span><br><span class="line">remote: Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (10/10), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 11 (delta 0), reused 11 (delta 0)</span><br><span class="line">Unpacking objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure>
<p>Now suppose you did that in a branch. If you try to switch back to a branch where those files are still in the actual tree rather than a submodule – you get this error:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">error: The following untracked working tree files would be overwritten by checkout:</span><br><span class="line">  CryptoLibrary/Makefile</span><br><span class="line">  CryptoLibrary/includes/crypto.h</span><br><span class="line">  ...</span><br><span class="line">Please move or remove them before you can switch branches.</span><br><span class="line">Aborting</span><br></pre></td></tr></table></figure>
<p>You can force it to switch with <code>checkout -f</code>, but be careful that you don’t have unsaved changes in there as they could be overwritten with that command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -f master</span><br><span class="line">warning: unable to rmdir CryptoLibrary: Directory not empty</span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br></pre></td></tr></table></figure>
<p>Then, when you switch back, you get an empty <code>CryptoLibrary</code> directory for some reason and <code>git submodule update</code> may not fix it either. You may need to go into your submodule directory and run a <code>git checkout .</code> to get all your files back. You could run this in a <code>submodule foreach</code> script to run it for multiple submodules.</p>
<p>It’s important to note that submodules these days keep all their Git data in the top project’s <code>.git</code> directory, so unlike much older versions of Git, destroying a submodule directory won’t lose any commits or branches that you had.</p>
<p>With these tools, submodules can be a fairly simple and effective method for developing on several related but still separate projects simultaneously.</p>
<h2 id="Bundling"><a href="#Bundling" class="headerlink" title="Bundling"></a>Bundling</h2><p>Though we’ve covered the common ways to transfer Git data over a network (HTTP, SSH, etc), there is actually one more way to do so that is not commonly used but can actually be quite useful.</p>
<p>Git is capable of “bundling” its data into a single file. This can be useful in various scenarios. Maybe your network is down and you want to send changes to your co-workers. Perhaps you’re working somewhere offsite and don’t have access to the local network for security reasons. Maybe your wireless/ethernet card just broke. Maybe you don’t have access to a shared server for the moment, you want to email someone updates and you don’t want to transfer 40 commits via <code>format-patch</code>.</p>
<p>This is where the <code>git bundle</code> command can be helpful. The <code>bundle</code> command will package up everything that would normally be pushed over the wire with a <code>git push</code> command into a binary file that you can email to someone or put on a flash drive, then unbundle into another repository.</p>
<p>Let’s see a simple example. Let’s say you have a repository with two commits:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit 9a466c572fe88b195efd356c3f2bbeccdb504102</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Wed Mar 10 07:34:10 2010 -0800</span><br><span class="line"></span><br><span class="line">    second commit</span><br><span class="line"></span><br><span class="line">commit b1ec3248f39900d2a406049d762aa68e9641be25</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Wed Mar 10 07:34:01 2010 -0800</span><br><span class="line"></span><br><span class="line">    first commit</span><br></pre></td></tr></table></figure>
<p>If you want to send that repository to someone and you don’t have access to a repository to push to, or simply don’t want to set one up, you can bundle it with <code>git bundle create</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git bundle create repo.bundle HEAD master</span><br><span class="line">Counting objects: 6, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (6/6), 441 bytes, <span class="keyword">done</span>.</span><br><span class="line">Total 6 (delta 0), reused 0 (delta 0)</span><br></pre></td></tr></table></figure>
<p>Now you have a file named <code>repo.bundle</code> that has all the data needed to re-create the repository’s <code>master</code> branch. With the <code>bundle</code> command you need to list out every reference or specific range of commits that you want to be included. If you intend for this to be cloned somewhere else, you should add HEAD as a reference as well as we’ve done here.</p>
<p>You can email this <code>repo.bundle</code> file to someone else, or put it on a USB drive and walk it over.</p>
<p>On the other side, say you are sent this <code>repo.bundle</code> file and want to work on the project. You can clone from the binary file into a directory, much like you would from a URL.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> repo.bundle repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">...</span><br><span class="line">$ <span class="built_in">cd</span> repo</span><br><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">9a466c5 second commit</span><br><span class="line">b1ec324 first commit</span><br></pre></td></tr></table></figure>
<p>If you don’t include HEAD in the references, you have to also specify <code>-b master</code> or whatever branch is included because otherwise it won’t know what branch to check out.</p>
<p>Now let’s say you do three commits on it and want to send the new commits back via a bundle on a USB stick or email.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">71b84da last commit - second repo</span><br><span class="line">c99cf5b fourth commit - second repo</span><br><span class="line">7011d3d third commit - second repo</span><br><span class="line">9a466c5 second commit</span><br><span class="line">b1ec324 first commit</span><br></pre></td></tr></table></figure>
<p>First we need to determine the range of commits we want to include in the bundle. Unlike the network protocols which figure out the minimum set of data to transfer over the network for us, we’ll have to figure this out manually. Now, you could just do the same thing and bundle the entire repository, which will work, but it’s better to just bundle up the difference - just the three commits we just made locally.</p>
<p>In order to do that, you’ll have to calculate the difference. As we described in 【Commit Ranges】, you can specify a range of commits in a number of ways. To get the three commits that we have in our master branch that weren’t in the branch we originally cloned, we can use something like <code>origin/master..master</code> or <code>master ^origin/master</code>. You can test that with the <code>log</code> command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline master ^origin/master</span><br><span class="line">71b84da last commit - second repo</span><br><span class="line">c99cf5b fourth commit - second repo</span><br><span class="line">7011d3d third commit - second repo</span><br></pre></td></tr></table></figure>
<p>So now that we have the list of commits we want to include in the bundle, let’s bundle them up. We do that with the <code>git bundle create</code> command, giving it a filename we want our bundle to be and the range of commits we want to go into it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git bundle create commits.bundle master ^9a466c5</span><br><span class="line">Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (9/9), 775 bytes, <span class="keyword">done</span>.</span><br><span class="line">Total 9 (delta 0), reused 0 (delta 0)</span><br></pre></td></tr></table></figure>
<p>Now we have a <code>commits.bundle</code> file in our directory. If we take that and send it to our partner, she can then import it into the original repository, even if more work has been done there in the meantime.</p>
<p>When she gets the bundle, she can inspect it to see what it contains before she imports it into her repository. The first command is the <code>bundle verify</code> command that will make sure the file is actually a valid Git bundle and that you have all the necessary ancestors to reconstitute it properly.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git bundle verify ../commits.bundle</span><br><span class="line">The bundle contains 1 ref</span><br><span class="line">71b84daaf49abed142a373b6e5c59a22dc6560dc refs/heads/master</span><br><span class="line">The bundle requires these 1 ref</span><br><span class="line">9a466c572fe88b195efd356c3f2bbeccdb504102 second commit</span><br><span class="line">../commits.bundle is okay</span><br></pre></td></tr></table></figure>
<p>If the bundler had created a bundle of just the last two commits they had done, rather than all three, the original repository would not be able to import it, since it is missing requisite history. The <code>verify</code> command would have looked like this instead:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git bundle verify ../commits-bad.bundle</span><br><span class="line">error: Repository lacks these prerequisite commits:</span><br><span class="line">error: 7011d3d8fc200abe0ad561c011c3852a4b7bbe95 third commit - second repo</span><br></pre></td></tr></table></figure>
<p>However, our first bundle is valid, so we can fetch in commits from it. If you want to see what branches are in the bundle that can be imported, there is also a command to just list the heads:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git bundle list-heads ../commits.bundle</span><br><span class="line">71b84daaf49abed142a373b6e5c59a22dc6560dc refs/heads/master</span><br></pre></td></tr></table></figure>
<p>The <code>verify</code> sub-command will tell you the heads as well. The point is to see what can be pulled in, so you can use the <code>fetch</code> or <code>pull</code> commands to import commits from this bundle. Here we’ll fetch the <em>master</em> branch of the bundle to a branch named <em>other-master</em> in our repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch ../commits.bundle master:other-master</span><br><span class="line">From ../commits.bundle</span><br><span class="line"> * [new branch]      master     -&gt; other-master</span><br></pre></td></tr></table></figure>
<p>Now we can see that we have the imported commits on the <em>other-master</em> branch as well as any commits we’ve done in the meantime in our own <em>master</em> branch.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* 8255d41 (HEAD, master) third commit - first repo</span><br><span class="line">| * 71b84da (other-master) last commit - second repo</span><br><span class="line">| * c99cf5b fourth commit - second repo</span><br><span class="line">| * 7011d3d third commit - second repo</span><br><span class="line">|/</span><br><span class="line">* 9a466c5 second commit</span><br><span class="line">* b1ec324 first commit</span><br></pre></td></tr></table></figure>
<p>So, <code>git bundle</code> can be really useful for sharing or doing network-type operations when you don’t have the proper network or shared repository to do so.</p>
<h2 id="Replace"><a href="#Replace" class="headerlink" title="Replace"></a>Replace</h2><p>As we’ve emphasized before, the objects in Git’s object database are unchangeable, but Git does provide an interesting way to <em>pretend</em> to replace objects in its database with other objects.</p>
<p>The <code>replace</code> command lets you specify an object in Git and say “every time you refer to <em>this</em> object, pretend it’s a <em>different</em> object”. This is most commonly useful for replacing one commit in your history with another one without having to rebuild the entire history with, say, <code>git filter-branch</code>.</p>
<p>For example, let’s say you have a huge code history and want to split your repository into one short history for new developers and one much longer and larger history for people interested in data mining. You can graft one history onto the other by “replacing” the earliest commit in the new line with the latest commit on the older one. This is nice because it means that you don’t actually have to rewrite every commit in the new history, as you would normally have to do to join them together (because the parentage affects the SHA-1s).</p>
<p>Let’s try this out. Let’s take an existing repository, split it into two repositories, one recent and one historical, and then we’ll see how we can recombine them without modifying the recent repositories SHA-1 values via <code>replace</code>.</p>
<p>We’ll use a simple repository with five simple commits:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">ef989d8 fifth commit</span><br><span class="line">c6e1e95 fourth commit</span><br><span class="line">9c68fdc third commit</span><br><span class="line">945704c second commit</span><br><span class="line">c1822cf first commit</span><br></pre></td></tr></table></figure>
<p>We want to break this up into two lines of history. One line goes from commit one to commit four - that will be the historical one. The second line will just be commits four and five - that will be the recent history.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnee653j20ln0m80sv.jpg" alt="replace1">   Well, creating the historical history is easy, we can just put a branch in the history and then push that branch to the master branch of a new remote repository.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git branch <span class="built_in">history</span> c6e1e95</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate</span><br><span class="line">ef989d8 (HEAD, master) fifth commit</span><br><span class="line">c6e1e95 (<span class="built_in">history</span>) fourth commit</span><br><span class="line">9c68fdc third commit</span><br><span class="line">945704c second commit</span><br><span class="line">c1822cf first commit</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclctzy4j20ln0m874f.jpg" alt="replace2">   Now we can push the new <code>history</code> branch to the <code>master</code> branch of our new repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add project-history [https://github.com/schacon/project-history](https://github.com/schacon/project-history)</span><br><span class="line">$ git push project-history <span class="built_in">history</span>:master</span><br><span class="line">Counting objects: 12, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (12/12), 907 bytes, <span class="keyword">done</span>.</span><br><span class="line">Total 12 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (12/12), <span class="keyword">done</span>.</span><br><span class="line">To git@github.com:schacon/project-history.git</span><br><span class="line"> * [new branch]      <span class="built_in">history</span> -&gt; master</span><br></pre></td></tr></table></figure>
<p>OK, so our history is published. Now the harder part is truncating our recent history down so it’s smaller. We need an overlap so we can replace a commit in one with an equivalent commit in the other, so we’re going to truncate this to just commits four and five (so commit four overlaps).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --decorate</span><br><span class="line">ef989d8 (HEAD, master) fifth commit</span><br><span class="line">c6e1e95 (<span class="built_in">history</span>) fourth commit</span><br><span class="line">9c68fdc third commit</span><br><span class="line">945704c second commit</span><br><span class="line">c1822cf first commit</span><br></pre></td></tr></table></figure>
<p>It’s useful in this case to create a base commit that has instructions on how to expand the history, so other developers know what to do if they hit the first commit in the truncated history and need more. So, what we’re going to do is create an initial commit object as our base point with instructions, then rebase the remaining commits (four and five) on top of it.</p>
<p>To do that, we need to choose a point to split at, which for us is the third commit, which is <code>9c68fdc</code> in SHA-speak. So, our base commit will be based off of that tree. We can create our base commit using the <code>commit-tree</code> command, which just takes a tree and will give us a brand new, parentless commit object SHA-1 back.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'get history from blah blah blah'</span> | git commit-tree 9c68fdc^&#123;tree&#125;</span><br><span class="line">622e88e9cbfbacfb75b5279245b9fb38dfea10cf</span><br></pre></td></tr></table></figure>
<p>The <code>commit-tree</code> command is one of a set of commands that are commonly referred to as <em>plumbing</em> commands. These are commands that are not generally meant to be used directly, but instead are used by <strong>other</strong> Git commands to do smaller jobs. On occasions when we’re doing weirder things like this, they allow us to do really low-level things but are not meant for daily use. You can read more about plumbing commands in 【Plumbing and Porcelain】</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcj0297pj20ln0m8q35.jpg" alt="replace3">   OK, so now that we have a base commit, we can rebase the rest of our history on top of that with <code>git rebase --onto</code>. The <code>--onto</code> argument will be the SHA-1 we just got back from <code>commit-tree</code> and the rebase point will be the third commit (the parent of the first commit we want to keep, <code>9c68fdc</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase --onto 622e88 9c68fdc</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: fourth commit</span><br><span class="line">Applying: fifth commit</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckvr5fcj20m80ieglu.jpg" alt="replace4">   OK, so now we’ve re-written our recent history on top of a throw away base commit that now has instructions in it on how to reconstitute the entire history if we wanted to. We can push that new history to a new project and now when people clone that repository, they will only see the most recent two commits and then a base commit with instructions.</p>
<p>Let’s now switch roles to someone cloning the project for the first time who wants the entire history. To get the history data after cloning this truncated repository, one would have to add a second remote for the historical repository and fetch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/schacon/project](https://github.com/schacon/project)</span><br><span class="line">$ <span class="built_in">cd</span> project</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">log</span> --oneline master</span><br><span class="line">e146b5f fifth commit</span><br><span class="line">81a708d fourth commit</span><br><span class="line">622e88e get <span class="built_in">history</span> from blah blah blah</span><br><span class="line"></span><br><span class="line">$ git remote add project-history [https://github.com/schacon/project-history](https://github.com/schacon/project-history)</span><br><span class="line">$ git fetch project-history</span><br><span class="line">From [https://github.com/schacon/project-history](https://github.com/schacon/project-history)</span><br><span class="line"> * [new branch]      master     -&gt; project-history/master</span><br></pre></td></tr></table></figure>
<p>Now the collaborator would have their recent commits in the <code>master</code> branch and the historical commits in the <code>project-history/master</code> branch.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline master</span><br><span class="line">e146b5f fifth commit</span><br><span class="line">81a708d fourth commit</span><br><span class="line">622e88e get <span class="built_in">history</span> from blah blah blah</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">log</span> --oneline project-history/master</span><br><span class="line">c6e1e95 fourth commit</span><br><span class="line">9c68fdc third commit</span><br><span class="line">945704c second commit</span><br><span class="line">c1822cf first commit</span><br></pre></td></tr></table></figure>
<p>To combine them, you can simply call <code>git replace</code> with the commit you want to replace and then the commit you want to replace it with. So we want to replace the “fourth” commit in the master branch with the “fourth” commit in the <code>project-history/master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git replace 81a708d c6e1e95</span><br></pre></td></tr></table></figure>
<p>Now, if you look at the history of the <code>master</code> branch, it appears to look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline master</span><br><span class="line">e146b5f fifth commit</span><br><span class="line">81a708d fourth commit</span><br><span class="line">9c68fdc third commit</span><br><span class="line">945704c second commit</span><br><span class="line">c1822cf first commit</span><br></pre></td></tr></table></figure>
<p>Cool, right? Without having to change all the SHA-1s upstream, we were able to replace one commit in our history with an entirely different commit and all the normal tools (<code>bisect</code>, <code>blame</code>, etc) will work how we would expect them to.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchyiz15j20m80ieglr.jpg" alt="replace5">   Interestingly, it still shows <code>81a708d</code> as the SHA-1, even though it’s actually using the <code>c6e1e95</code> commit data that we replaced it with. Even if you run a command like <code>cat-file</code>, it will show you the replaced data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 81a708d</span><br><span class="line">tree 7bc544cf438903b65ca9104a1e30345eee6c083d</span><br><span class="line">parent 9c68fdceee073230f19ebb8b5e7fc71b479c0252</span><br><span class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1268712581 -0700</span><br><span class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1268712581 -0700</span><br><span class="line"></span><br><span class="line">fourth commit</span><br></pre></td></tr></table></figure>
<p>Remember that the actual parent of <code>81a708d</code> was our placeholder commit (<code>622e88e</code>), not <code>9c68fdce</code> as it states here.</p>
<p>Another interesting thing is that this data is kept in our references:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">for</span>-each-ref</span><br><span class="line">e146b5f14e79d4935160c0e83fb9ebe526b8da0d commit	refs/heads/master</span><br><span class="line">c6e1e95051d41771a649f3145423f8809d1a74d4 commit	refs/remotes/<span class="built_in">history</span>/master</span><br><span class="line">e146b5f14e79d4935160c0e83fb9ebe526b8da0d commit	refs/remotes/origin/HEAD</span><br><span class="line">e146b5f14e79d4935160c0e83fb9ebe526b8da0d commit	refs/remotes/origin/master</span><br><span class="line">c6e1e95051d41771a649f3145423f8809d1a74d4 commit	refs/replace/81a708dd0e167a3f691541c7a6463343bc457040</span><br></pre></td></tr></table></figure>
<p>This means that it’s easy to share our replacement with others, because we can push this to our server and other people can easily download it. This is not that helpful in the history grafting scenario we’ve gone over here (since everyone would be downloading both histories anyhow, so why separate them?) but it can be useful in other circumstances.</p>
<h2 id="Credential-Storage"><a href="#Credential-Storage" class="headerlink" title="Credential Storage"></a>Credential Storage</h2><p>If you use the SSH transport for connecting to remotes, it’s possible for you to have a key without a passphrase, which allows you to securely transfer data without typing in your username and password. However, this isn’t possible with the HTTP protocols – every connection needs a username and password. This gets even harder for systems with two-factor authentication, where the token you use for a password is randomly generated and unpronounceable.</p>
<p>Fortunately, Git has a credentials system that can help with this. Git has a few options provided in the box:</p>
<ul>
<li>The default is not to cache at all. Every connection will prompt you for your username and password.</li>
<li>The “cache” mode keeps credentials in memory for a certain period of time. None of the passwords are ever stored on disk, and they are purged from the cache after 15 minutes.</li>
<li>The “store” mode saves the credentials to a plain-text file on disk, and they never expire. This means that until you change your password for the Git host, you won’t ever have to type in your credentials again. The downside of this approach is that your passwords are stored in cleartext in a plain file in your home directory.</li>
<li>If you’re using a Mac, Git comes with an “osxkeychain” mode, which caches credentials in the secure keychain that’s attached to your system account. This method stores the credentials on disk, and they never expire, but they’re encrypted with the same system that stores HTTPS certificates and Safari auto-fills.</li>
<li>If you’re using Windows, you can install a helper called “Git Credential Manager for Windows.” This is similar to the “osxkeychain” helper described above, but uses the Windows Credential Store to control sensitive information. It can be found at &lt;<a href="https://github.com/Microsoft/Git-Credential-Manager-for-Windows" target="_blank" rel="noopener">https://github.com/Microsoft/Git-Credential-Manager-for-Windows</a>&gt;.<br>You can choose one of these methods by setting a Git configuration value:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global credential.helper cache</span><br></pre></td></tr></table></figure>
<p>Some of these helpers have options. The “store” helper can take a <code>--file &lt;path&gt;</code> argument, which customizes where the plain-text file is saved (the default is <code>~/.git-credentials</code>). The “cache” helper accepts the <code>--timeout &lt;seconds&gt;</code> option, which changes the amount of time its daemon is kept running (the default is “900”, or 15 minutes). Here’s an example of how you’d configure the “store” helper with a custom file name:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global credential.helper <span class="string">'store --file ~/.my-credentials'</span></span><br></pre></td></tr></table></figure>
<p>Git even allows you to configure several helpers. When looking for credentials for a particular host, Git will query them in order, and stop after the first answer is provided. When saving credentials, Git will send the username and password to <strong>all</strong> of the helpers in the list, and they can choose what to do with them. Here’s what a <code>.gitconfig</code> would look like if you had a credentials file on a thumb drive, but wanted to use the in-memory cache to save some typing if the drive isn’t plugged in:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[credential]</span><br><span class="line">    helper = store --file /mnt/thumbdrive/.git-credentials</span><br><span class="line">    helper = cache --timeout 30000</span><br></pre></td></tr></table></figure>
<h3 id="Under-the-Hood"><a href="#Under-the-Hood" class="headerlink" title="Under the Hood"></a>Under the Hood</h3><p>How does this all work? Git’s root command for the credential-helper system is <code>git credential</code>, which takes a command as an argument, and then more input through stdin.</p>
<p>This might be easier to understand with an example. Let’s say that a credential helper has been configured, and the helper has stored credentials for <code>mygithost</code>. Here’s a session that uses the “fill” command, which is invoked when Git is trying to find credentials for a host:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git credential fill ①</span><br><span class="line">protocol=https ②</span><br><span class="line">host=mygithost</span><br><span class="line"> ③</span><br><span class="line">protocol=https ④</span><br><span class="line">host=mygithost</span><br><span class="line">username=bob</span><br><span class="line">password=s3cre7</span><br><span class="line">$ git credential fill ⑤</span><br><span class="line">protocol=https</span><br><span class="line">host=unknownhost</span><br><span class="line"></span><br><span class="line">Username <span class="keyword">for</span> <span class="string">'[https://unknownhost](https://unknownhost)'</span>: bob</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'[https://bob@unknownhost](https://bob@unknownhost)'</span>:</span><br><span class="line">protocol=https</span><br><span class="line">host=unknownhost</span><br><span class="line">username=bob</span><br><span class="line">password=s3cre7</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> This is the command line that initiates the interaction.</li>
<li><em>②</em> Git-credential is then waiting for input on stdin. We provide it with the things we know: the protocol and hostname.</li>
<li><em>③</em> A blank line indicates that the input is complete, and the credential system should answer with what it knows.</li>
<li><em>④</em> Git-credential then takes over, and writes to stdout with the bits of information it found.</li>
<li><em>⑤</em> If credentials are not found, Git asks the user for the username and password, and provides them back to the invoking stdout (here they’re attached to the same console).<br>The credential system is actually invoking a program that’s separate from Git itself; which one and how depends on the <code>credential.helper</code> configuration value. There are several forms it can take:</li>
</ol>
<p>Configuration Value Behavior     <code>foo</code></p>
<p>Runs <code>git-credential-foo</code></p>
<p><code>foo -a --opt=bcd</code></p>
<p>Runs <code>git-credential-foo -a --opt=bcd</code></p>
<p><code>/absolute/path/foo -xyz</code></p>
<p>Runs <code>/absolute/path/foo -xyz</code></p>
<p><code>!f() { echo &quot;password=s3cre7&quot;; }; f</code></p>
<p>Code after <code>!</code> evaluated in shell</p>
<p>So the helpers described above are actually named <code>git-credential-cache</code>, <code>git-credential-store</code>, and so on, and we can configure them to take command-line arguments. The general form for this is “git-credential-foo [args] <action>.” The stdin/stdout protocol is the same as git-credential, but they use a slightly different set of actions:</action></p>
<ul>
<li><code>get</code> is a request for a username/password pair.</li>
<li><code>store</code> is a request to save a set of credentials in this helper’s memory.</li>
<li><code>erase</code> purge the credentials for the given properties from this helper’s memory.<br>For the <code>store</code> and <code>erase</code> actions, no response is required (Git ignores it anyway). For the <code>get</code> action, however, Git is very interested in what the helper has to say. If the helper doesn’t know anything useful, it can simply exit with no output, but if it does know, it should augment the provided information with the information it has stored. The output is treated like a series of assignment statements; anything provided will replace what Git already knows.</li>
</ul>
<p>Here’s the same example from above, but skipping git-credential and going straight for git-credential-store:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git credential-store --file ~/git.store store ①</span><br><span class="line">protocol=https</span><br><span class="line">host=mygithost</span><br><span class="line">username=bob</span><br><span class="line">password=s3cre7</span><br><span class="line">$ git credential-store --file ~/git.store get ②</span><br><span class="line">protocol=https</span><br><span class="line">host=mygithost</span><br><span class="line"></span><br><span class="line">username=bob ③</span><br><span class="line">password=s3cre7</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> Here we tell <code>git-credential-store</code> to save some credentials: the username “bob” and the password “s3cre7” are to be used when <code>[https://mygithost](https://mygithost)</code> is accessed.</li>
<li><em>②</em> Now we’ll retrieve those credentials. We provide the parts of the connection we already know (<code>[https://mygithost](https://mygithost)</code>), and an empty line.</li>
<li><em>③</em> <code>git-credential-store</code> replies with the username and password we stored above.<br>Here’s what the <code>~/git.store</code> file looks like:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[https://bob:s3cre7@mygithost](https://bob:s3cre7@mygithost)</span><br></pre></td></tr></table></figure>
<p>It’s just a series of lines, each of which contains a credential-decorated URL. The <code>osxkeychain</code> and <code>wincred</code> helpers use the native format of their backing stores, while <code>cache</code> uses its own in-memory format (which no other process can read).</p>
<h3 id="A-Custom-Credential-Cache"><a href="#A-Custom-Credential-Cache" class="headerlink" title="A Custom Credential Cache"></a>A Custom Credential Cache</h3><p>Given that <code>git-credential-store</code> and friends are separate programs from Git, it’s not much of a leap to realize that <em>any</em> program can be a Git credential helper. The helpers provided by Git cover many common use cases, but not all. For example, let’s say your team has some credentials that are shared with the entire team, perhaps for deployment. These are stored in a shared directory, but you don’t want to copy them to your own credential store, because they change often. None of the existing helpers cover this case; let’s see what it would take to write our own. There are several key features this program needs to have:</p>
<ol start="2">
<li>The only action we need to pay attention to is <code>get</code>; <code>store</code> and <code>erase</code> are write operations, so we’ll just exit cleanly when they’re received.</li>
<li>The file format of the shared-credential file is the same as that used by <code>git-credential-store</code>.</li>
<li>The location of that file is fairly standard, but we should allow the user to pass a custom path just in case.<br>Once again, we’ll write this extension in Ruby, but any language will work so long as Git can execute the finished product. Here’s the full source code of our new credential helper:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">require <span class="string">'optparse'</span></span><br><span class="line"></span><br><span class="line">path = File.expand_path <span class="string">'~/.git-credentials'</span> ①</span><br><span class="line">OptionParser.new <span class="keyword">do</span> |opts|</span><br><span class="line">    opts.banner = <span class="string">'USAGE: git-credential-read-only [options] &lt;action&gt;'</span></span><br><span class="line">    opts.on(<span class="string">'-f'</span>, <span class="string">'--file PATH'</span>, <span class="string">'Specify path for backing store'</span>) <span class="keyword">do</span> |argpath|</span><br><span class="line">        path = File.expand_path argpath</span><br><span class="line">    end</span><br><span class="line">end.parse!</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span>(0) unless ARGV[0].downcase == <span class="string">'get'</span> ②</span><br><span class="line"><span class="built_in">exit</span>(0) unless File.exists? path</span><br><span class="line"></span><br><span class="line">known = &#123;&#125; ③</span><br><span class="line"><span class="keyword">while</span> line = STDIN.gets</span><br><span class="line">    <span class="built_in">break</span> <span class="keyword">if</span> line.strip == <span class="string">''</span></span><br><span class="line">    k,v = line.strip.split <span class="string">'='</span>, 2</span><br><span class="line">    known[k] = v</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">File.readlines(path).each <span class="keyword">do</span> |fileline| ④</span><br><span class="line">    prot,user,pass,host = fileline.scan(/^(.*?):\/\/(.*?):(.*?)@(.*)$/).first</span><br><span class="line">    <span class="keyword">if</span> prot == known[<span class="string">'protocol'</span>] and host == known[<span class="string">'host'</span>] and user == known[<span class="string">'username'</span>] <span class="keyword">then</span></span><br><span class="line">        puts <span class="string">"protocol=#&#123;prot&#125;"</span></span><br><span class="line">        puts <span class="string">"host=#&#123;host&#125;"</span></span><br><span class="line">        puts <span class="string">"username=#&#123;user&#125;"</span></span><br><span class="line">        puts <span class="string">"password=#&#123;pass&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span>(0)</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> Here we parse the command-line options, allowing the user to specify the input file. The default is <code>~/.git-credentials</code>.</li>
<li><em>②</em> This program only responds if the action is <code>get</code> and the backing-store file exists.</li>
<li><em>③</em> This loop reads from stdin until the first blank line is reached. The inputs are stored in the <code>known</code> hash for later reference.</li>
<li><em>④</em> This loop reads the contents of the storage file, looking for matches. If the protocol and host from <code>known</code> match this line, the program prints the results to stdout and exits.<br>We’ll save our helper as <code>git-credential-read-only</code>, put it somewhere in our <code>PATH</code> and mark it executable. Here’s what an interactive session looks like:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git credential-read-only --file=/mnt/shared/creds get</span><br><span class="line">protocol=https</span><br><span class="line">host=mygithost</span><br><span class="line"></span><br><span class="line">protocol=https</span><br><span class="line">host=mygithost</span><br><span class="line">username=bob</span><br><span class="line">password=s3cre7</span><br></pre></td></tr></table></figure>
<p>Since its name starts with “git-”, we can use the simple syntax for the configuration value:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global credential.helper <span class="string">'read-only --file /mnt/shared/creds'</span></span><br></pre></td></tr></table></figure>
<p>As you can see, extending this system is pretty straightforward, and can solve some common problems for you and your team.</p>
<h2 id="Summary-8"><a href="#Summary-8" class="headerlink" title="Summary"></a>Summary</h2><p>You’ve seen a number of advanced tools that allow you to manipulate your commits and staging area more precisely. When you notice issues, you should be able to easily figure out what commit introduced them, when, and by whom. If you want to use subprojects in your project, you’ve learned how to accommodate those needs. At this point, you should be able to do most of the things in Git that you’ll need on the command line day to day and feel comfortable doing so.</p>
<h1 id="Customizing-Git"><a href="#Customizing-Git" class="headerlink" title="Customizing Git"></a><strong>Customizing</strong> <strong>Git</strong></h1><p>So far, we’ve covered the basics of how Git works and how to use it, and we’ve introduced a number of tools that Git provides to help you use it easily and efficiently. In this chapter, we’ll see how you can make Git operate in a more customized fashion, by introducing several important configuration settings and the hooks system. With these tools, it’s easy to get Git to work exactly the way you, your company, or your group needs it to.</p>
<h2 id="Git-Configuration"><a href="#Git-Configuration" class="headerlink" title="Git Configuration"></a>Git Configuration</h2><p>As you read briefly in 【Getting Started】, you can specify Git configuration settings with the <code>git config</code> command. One of the first things you did was set up your name and email address:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">"John Doe"</span></span><br><span class="line">$ git config --global user.email johndoe@example.com</span><br></pre></td></tr></table></figure>
<p>Now you’ll learn a few of the more interesting options that you can set in this manner to customize your Git usage.</p>
<p>First, a quick review: Git uses a series of configuration files to determine non-default behavior that you may want. The first place Git looks for these values is in the system-wide <code>/etc/gitconfig</code> file, which contains settings that are applied to every user on the system and all of their repositories. If you pass the option <code>--system</code> to <code>git config</code>, it reads and writes from this file specifically.</p>
<p>The next place Git looks is the <code>~/.gitconfig</code> (or <code>~/.config/git/config</code>) file, which is specific to each user. You can make Git read and write to this file by passing the <code>--global</code> option.</p>
<p>Finally, Git looks for configuration values in the configuration file in the Git directory (<code>.git/config</code>) of whatever repository you’re currently using. These values are specific to that single repository, and represent passing the <code>--local</code> option to <code>git config</code>. (If you don’t specify which level you want to work with, this is the default.)</p>
<p>Each of these “levels” (system, global, local) overwrites values in the previous level, so values in <code>.git/config</code> trump those in <code>/etc/gitconfig</code>, for instance.</p>
<p>Git’s configuration files are plain-text, so you can also set these values by manually editing the file and inserting the correct syntax. It’s generally easier to run the <code>git config</code> command, though.</p>
<h3 id="Basic-Client-Configuration"><a href="#Basic-Client-Configuration" class="headerlink" title="Basic Client Configuration"></a>Basic Client Configuration</h3><p>The configuration options recognized by Git fall into two categories: client-side and server-side. The majority of the options are client-side — configuring your personal working preferences. Many, <em>many</em> configuration options are supported, but a large fraction of them are useful only in certain edge cases; we’ll cover just the most common and useful options here. If you want to see a list of all the options your version of Git recognizes, you can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man git-config</span><br></pre></td></tr></table></figure>
<p>This command lists all the available options in quite a bit of detail. You can also find this reference material at &lt;<a href="http://git-scm.com/docs/git-config.html" target="_blank" rel="noopener">http://git-scm.com/docs/git-config.html</a>&gt;.</p>
<h4 id="core-editor"><a href="#core-editor" class="headerlink" title="core.editor"></a><code>core.editor</code></h4><p>By default, Git uses whatever you’ve set as your default text editor via one of the shell environment variables <code>VISUAL</code> or <code>EDITOR</code>, or else falls back to the <code>vi</code> editor to create and edit your commit and tag messages. To change that default to something else, you can use the <code>core.editor</code> setting:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.editor emacs</span><br></pre></td></tr></table></figure>
<p>Now, no matter what is set as your default shell editor, Git will fire up Emacs to edit messages.</p>
<h4 id="commit-template"><a href="#commit-template" class="headerlink" title="commit.template"></a><code>commit.template</code></h4><p>If you set this to the path of a file on your system, Git will use that file as the default initial message when you commit. The value in creating a custom commit template is that you can use it to remind yourself (or others) of the proper format and style when creating a commit message.</p>
<p>For instance, consider a template file at <code>~/.gitmessage.txt</code> that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Subject line (try to keep under 50 characters)</span><br><span class="line"></span><br><span class="line">Multi-line description of commit,</span><br><span class="line">feel free to be detailed.</span><br><span class="line"></span><br><span class="line">[Ticket: X]</span><br></pre></td></tr></table></figure>
<p>Note how this commit template reminds the committer to keep the subject line short (for the sake of <code>git log --oneline</code> output), to add further detail under that, and to refer to an issue or bug tracker ticket number if one exists.</p>
<p>To tell Git to use it as the default message that appears in your editor when you run <code>git commit</code>, set the <code>commit.template</code> configuration value:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global commit.template ~/.gitmessage.txt</span><br><span class="line">$ git commit</span><br></pre></td></tr></table></figure>
<p>Then, your editor will open to something like this for your placeholder commit message when you commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Subject line (try to keep under 60 characters)</span><br><span class="line"></span><br><span class="line">Multi-line description of commit,</span><br><span class="line">feel free to be detailed.</span><br><span class="line"></span><br><span class="line">[Ticket: X]</span><br><span class="line"><span class="comment"># Please enter the commit message for your changes. Lines starting</span></span><br><span class="line"><span class="comment"># with '#' will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="comment"># On branch master</span></span><br><span class="line"><span class="comment"># Changes to be committed:</span></span><br><span class="line"><span class="comment">#   (use "git reset HEAD &lt;file&gt;..." to unstage)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># modified:   lib/test.rb</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">~</span><br><span class="line">~</span><br><span class="line"><span class="string">".git/COMMIT_EDITMSG"</span> 14L, 297C</span><br></pre></td></tr></table></figure>
<p>If your team has a commit-message policy, then putting a template for that policy on your system and configuring Git to use it by default can help increase the chance of that policy being followed regularly.</p>
<h4 id="core-pager"><a href="#core-pager" class="headerlink" title="core.pager"></a><code>core.pager</code></h4><p>This setting determines which pager is used when Git pages output such as <code>log</code> and <code>diff</code>. You can set it to <code>more</code> or to your favorite pager (by default, it’s <code>less</code>), or you can turn it off by setting it to a blank string:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.pager <span class="string">''</span></span><br></pre></td></tr></table></figure>
<p>If you run that, Git will page the entire output of all commands, no matter how long they are.</p>
<h4 id="user-signingkey"><a href="#user-signingkey" class="headerlink" title="user.signingkey"></a><code>user.signingkey</code></h4><p>If you’re making signed annotated tags (as discussed in 【Signing Your Work】), setting your GPG signing key as a configuration setting makes things easier. Set your key ID like so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.signingkey &lt;gpg-key-id&gt;</span><br></pre></td></tr></table></figure>
<p>Now, you can sign tags without having to specify your key every time with the <code>git tag</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -s &lt;tag-name&gt;</span><br></pre></td></tr></table></figure>
<h4 id="core-excludesfile"><a href="#core-excludesfile" class="headerlink" title="core.excludesfile"></a><code>core.excludesfile</code></h4><p>You can put patterns in your project’s <code>.gitignore</code> file to have Git not see them as untracked files or try to stage them when you run <code>git add</code> on them, as discussed in 【Ignoring Files】.</p>
<p>But sometimes you want to ignore certain files for all repositories that you work with. If your computer is running macOS, you’re probably familiar with <code>.DS_Store</code> files. If your preferred editor is Emacs or Vim, you know about filenames that end with a <code>~</code> or <code>.swp</code>.</p>
<p>This setting lets you write a kind of global <code>.gitignore</code> file. If you create a <code>~/.gitignore_global</code> file with these contents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*~</span><br><span class="line">.*.swp</span><br><span class="line">.DS_Store</span><br></pre></td></tr></table></figure>
<p>…and you run <code>git config --global core.excludesfile ~/.gitignore_global</code>, Git will never again bother you about those files.</p>
<h4 id="help-autocorrect"><a href="#help-autocorrect" class="headerlink" title="help.autocorrect"></a><code>help.autocorrect</code></h4><p>If you mistype a command, it shows you something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git chekcout master</span><br><span class="line">git: <span class="string">'chekcout'</span> is not a git <span class="built_in">command</span>. See <span class="string">'git --help'</span>.</span><br><span class="line"></span><br><span class="line">Did you mean this?</span><br><span class="line">    checkout</span><br></pre></td></tr></table></figure>
<p>Git helpfully tries to figure out what you meant, but it still refuses to do it. If you set <code>help.autocorrect</code> to 1, Git will actually run this command for you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git chekcout master</span><br><span class="line">WARNING: You called a Git <span class="built_in">command</span> named <span class="string">'chekcout'</span>, <span class="built_in">which</span> does not exist.</span><br><span class="line">Continuing under the assumption that you meant <span class="string">'checkout'</span></span><br><span class="line"><span class="keyword">in</span> 0.1 seconds automatically...</span><br></pre></td></tr></table></figure>
<p>Note that “0.1 seconds” business. <code>help.autocorrect</code> is actually an integer which represents tenths of a second. So if you set it to 50, Git will give you 5 seconds to change your mind before executing the autocorrected command.</p>
<h3 id="Colors-in-Git"><a href="#Colors-in-Git" class="headerlink" title="Colors in Git"></a>Colors in Git</h3><p>Git fully supports colored terminal output, which greatly aids in visually parsing command output quickly and easily. A number of options can help you set the coloring to your preference.</p>
<h4 id="color-ui"><a href="#color-ui" class="headerlink" title="color.ui"></a><code>color.ui</code></h4><p>Git automatically colors most of its output, but there’s a master switch if you don’t like this behavior. To turn off all Git’s colored terminal output, do this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global color.ui <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>The default setting is <code>auto</code>, which colors output when it’s going straight to a terminal, but omits the color-control codes when the output is redirected to a pipe or a file.</p>
<p>You can also set it to <code>always</code> to ignore the difference between terminals and pipes. You’ll rarely want this; in most scenarios, if you want color codes in your redirected output, you can instead pass a <code>--color</code> flag to the Git command to force it to use color codes. The default setting is almost always what you’ll want.</p>
<h4 id="color"><a href="#color" class="headerlink" title="color.*"></a><code>color.*</code></h4><p>If you want to be more specific about which commands are colored and how, Git provides verb-specific coloring settings. Each of these can be set to <code>true</code>, <code>false</code>, or <code>always</code>:</p>
<p>color.branch color.diff color.interactive color.status In addition, each of these has subsettings you can use to set specific colors for parts of the output, if you want to override each color. For example, to set the meta information in your diff output to blue foreground, black background, and bold text, you can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global color.diff.meta <span class="string">"blue black bold"</span></span><br></pre></td></tr></table></figure>
<p>You can set the color to any of the following values: <code>normal</code>, <code>black</code>, <code>red</code>, <code>green</code>, <code>yellow</code>, <code>blue</code>, <code>magenta</code>, <code>cyan</code>, or <code>white</code>. If you want an attribute like bold in the previous example, you can choose from <code>bold</code>, <code>dim</code>, <code>ul</code> (underline), <code>blink</code>, and <code>reverse</code> (swap foreground and background).</p>
<h3 id="External-Merge-and-Diff-Tools"><a href="#External-Merge-and-Diff-Tools" class="headerlink" title="External Merge and Diff Tools"></a>External Merge and Diff Tools</h3><p>Although Git has an internal implementation of diff, which is what we’ve been showing in this book, you can set up an external tool instead. You can also set up a graphical merge-conflict-resolution tool instead of having to resolve conflicts manually. We’ll demonstrate setting up the Perforce Visual Merge Tool (P4Merge) to do your diffs and merge resolutions, because it’s a nice graphical tool and it’s free.</p>
<p>If you want to try this out, P4Merge works on all major platforms, so you should be able to do so. We’ll use path names in the examples that work on Mac and Linux systems; for Windows, you’ll have to change <code>/usr/local/bin</code> to an executable path in your environment.</p>
<p>To begin, <a href="https://www.perforce.com/product/components/perforce-visual-merge-and-diff-tools" target="_blank" rel="noopener">download P4Merge from Perforce</a>. Next, you’ll set up external wrapper scripts to run your commands. We’ll use the Mac path for the executable; in other systems, it will be where your <code>p4merge</code> binary is installed. Set up a merge wrapper script named <code>extMerge</code> that calls your binary with all the arguments provided:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/<span class="built_in">local</span>/bin/extMerge</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">/Applications/p4merge.app/Contents/MacOS/p4merge $*</span><br></pre></td></tr></table></figure>
<p>The diff wrapper checks to make sure seven arguments are provided and passes two of them to your merge script. By default, Git passes the following arguments to the diff program:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path old-file old-hex old-mode new-file new-hex new-mode</span><br></pre></td></tr></table></figure>
<p>Because you only want the <code>old-file</code> and <code>new-file</code> arguments, you use the wrapper script to pass the ones you need.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/<span class="built_in">local</span>/bin/extDiff</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">[ <span class="variable">$#</span> -eq 7 ] &amp;&amp; /usr/<span class="built_in">local</span>/bin/extMerge <span class="string">"<span class="variable">$2</span>"</span> <span class="string">"<span class="variable">$5</span>"</span></span><br></pre></td></tr></table></figure>
<p>You also need to make sure these tools are executable:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod +x /usr/<span class="built_in">local</span>/bin/extMerge</span><br><span class="line">$ sudo chmod +x /usr/<span class="built_in">local</span>/bin/extDiff</span><br></pre></td></tr></table></figure>
<p>Now you can set up your config file to use your custom merge resolution and diff tools. This takes a number of custom settings: <code>merge.tool</code> to tell Git what strategy to use, <code>mergetool.&lt;tool&gt;.cmd</code> to specify how to run the command, <code>mergetool.&lt;tool&gt;.trustExitCode</code> to tell Git if the exit code of that program indicates a successful merge resolution or not, and <code>diff.external</code> to tell Git what command to run for diffs. So, you can either run four config commands</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global merge.tool extMerge</span><br><span class="line">$ git config --global mergetool.extMerge.cmd \</span><br><span class="line">  <span class="string">'extMerge "$BASE" "$LOCAL" "$REMOTE" "$MERGED"'</span></span><br><span class="line">$ git config --global mergetool.extMerge.trustExitCode <span class="literal">false</span></span><br><span class="line">$ git config --global diff.external extDiff</span><br></pre></td></tr></table></figure>
<p>or you can edit your <code>~/.gitconfig</code> file to add these lines:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[merge]</span><br><span class="line">  tool = extMerge</span><br><span class="line">[mergetool <span class="string">"extMerge"</span>]</span><br><span class="line">  cmd = extMerge <span class="string">"<span class="variable">$BASE</span>"</span> <span class="string">"<span class="variable">$LOCAL</span>"</span> <span class="string">"<span class="variable">$REMOTE</span>"</span> <span class="string">"<span class="variable">$MERGED</span>"</span></span><br><span class="line">  trustExitCode = <span class="literal">false</span></span><br><span class="line">[diff]</span><br><span class="line">  external = extDiff</span><br></pre></td></tr></table></figure>
<p>After all this is set, if you run diff commands such as this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff 32d1776b1^ 32d1776b1</span><br></pre></td></tr></table></figure>
<p>Instead of getting the diff output on the command line, Git fires up P4Merge, which looks something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmto7hgj20dw0aat9k.jpg" alt="P4Merge.">  Figure 1. P4Merge.  If you try to merge two branches and subsequently have merge conflicts, you can run the command <code>git mergetool</code>; it starts P4Merge to let you resolve the conflicts through that GUI tool.</p>
<p>The nice thing about this wrapper setup is that you can change your diff and merge tools easily. For example, to change your <code>extDiff</code> and <code>extMerge</code> tools to run the KDiff3 tool instead, all you have to do is edit your <code>extMerge</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/<span class="built_in">local</span>/bin/extMerge</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">/Applications/kdiff3.app/Contents/MacOS/kdiff3 $*</span><br></pre></td></tr></table></figure>
<p>Now, Git will use the KDiff3 tool for diff viewing and merge conflict resolution.</p>
<p>Git comes preset to use a number of other merge-resolution tools without your having to set up the cmd configuration. To see a list of the tools it supports, try this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ git mergetool --tool-help</span><br><span class="line"><span class="string">'git mergetool --tool=&lt;tool&gt;'</span> may be <span class="built_in">set</span> to one of the following:</span><br><span class="line">        emerge</span><br><span class="line">        gvimdiff</span><br><span class="line">        gvimdiff2</span><br><span class="line">        opendiff</span><br><span class="line">        p4merge</span><br><span class="line">        vimdiff</span><br><span class="line">        vimdiff2</span><br><span class="line"></span><br><span class="line">The following tools are valid, but not currently available:</span><br><span class="line">        araxis</span><br><span class="line">        bc3</span><br><span class="line">        codecompare</span><br><span class="line">        deltawalker</span><br><span class="line">        diffmerge</span><br><span class="line">        diffuse</span><br><span class="line">        ecmerge</span><br><span class="line">        kdiff3</span><br><span class="line">        meld</span><br><span class="line">        tkdiff</span><br><span class="line">        tortoisemerge</span><br><span class="line">        xxdiff</span><br><span class="line"></span><br><span class="line">Some of the tools listed above only work <span class="keyword">in</span> a windowed</span><br><span class="line">environment. If run <span class="keyword">in</span> a terminal-only session, they will fail.</span><br></pre></td></tr></table></figure>
<p>If you’re not interested in using KDiff3 for diff but rather want to use it just for merge resolution, and the kdiff3 command is in your path, then you can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global merge.tool kdiff3</span><br></pre></td></tr></table></figure>
<p>If you run this instead of setting up the <code>extMerge</code> and <code>extDiff</code> files, Git will use KDiff3 for merge resolution and the normal Git diff tool for diffs.</p>
<h3 id="Formatting-and-Whitespace"><a href="#Formatting-and-Whitespace" class="headerlink" title="Formatting and Whitespace"></a>Formatting and Whitespace</h3><p>Formatting and whitespace issues are some of the more frustrating and subtle problems that many developers encounter when collaborating, especially cross-platform. It’s very easy for patches or other collaborated work to introduce subtle whitespace changes because editors silently introduce them, and if your files ever touch a Windows system, their line endings might be replaced. Git has a few configuration options to help with these issues.</p>
<h4 id="core-autocrlf"><a href="#core-autocrlf" class="headerlink" title="core.autocrlf"></a><code>core.autocrlf</code></h4><p>If you’re programming on Windows and working with people who are not (or vice-versa), you’ll probably run into line-ending issues at some point. This is because Windows uses both a carriage-return character and a linefeed character for newlines in its files, whereas Mac and Linux systems use only the linefeed character. This is a subtle but incredibly annoying fact of cross-platform work; many editors on Windows silently replace existing LF-style line endings with CRLF, or insert both line-ending characters when the user hits the enter key.</p>
<p>Git can handle this by auto-converting CRLF line endings into LF when you add a file to the index, and vice versa when it checks out code onto your filesystem. You can turn on this functionality with the <code>core.autocrlf</code> setting. If you’re on a Windows machine, set it to <code>true</code> — this converts LF endings into CRLF when you check out code:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>If you’re on a Linux or Mac system that uses LF line endings, then you don’t want Git to automatically convert them when you check out files; however, if a file with CRLF endings accidentally gets introduced, then you may want Git to fix it. You can tell Git to convert CRLF to LF on commit but not the other way around by setting <code>core.autocrlf</code> to input:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf input</span><br></pre></td></tr></table></figure>
<p>This setup should leave you with CRLF endings in Windows checkouts, but LF endings on Mac and Linux systems and in the repository.</p>
<p>If you’re a Windows programmer doing a Windows-only project, then you can turn off this functionality, recording the carriage returns in the repository by setting the config value to <code>false</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h4 id="core-whitespace"><a href="#core-whitespace" class="headerlink" title="core.whitespace"></a><code>core.whitespace</code></h4><p>Git comes preset to detect and fix some whitespace issues. It can look for six primary whitespace issues — three are enabled by default and can be turned off, and three are disabled by default but can be activated.</p>
<p>The three that are turned on by default are <code>blank-at-eol</code>, which looks for spaces at the end of a line; <code>blank-at-eof</code>, which notices blank lines at the end of a file; and <code>space-before-tab</code>, which looks for spaces before tabs at the beginning of a line.</p>
<p>The three that are disabled by default but can be turned on are <code>indent-with-non-tab</code>, which looks for lines that begin with spaces instead of tabs (and is controlled by the <code>tabwidth</code> option); <code>tab-in-indent</code>, which watches for tabs in the indentation portion of a line; and <code>cr-at-eol</code>, which tells Git that carriage returns at the end of lines are OK.</p>
<p>You can tell Git which of these you want enabled by setting <code>core.whitespace</code> to the values you want on or off, separated by commas. You can disable an option by prepending a <code>-</code> in front of its name, or use the default value by leaving it out of the setting string entirely. For example, if you want all but <code>space-before-tab</code> to be set, you can do this (with <code>trailing-space</code> being a short-hand to cover both <code>blank-at-eol</code> and <code>blank-at-eof</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.whitespace \</span><br><span class="line">    trailing-space,-space-before-tab,indent-with-non-tab,tab-in-indent,cr-at-eol</span><br></pre></td></tr></table></figure>
<p>Or you can specify the customizing part only:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.whitespace \</span><br><span class="line">    -space-before-tab,indent-with-non-tab,tab-in-indent,cr-at-eol</span><br></pre></td></tr></table></figure>
<p>Git will detect these issues when you run a <code>git diff</code> command and try to color them so you can possibly fix them before you commit. It will also use these values to help you when you apply patches with <code>git apply</code>. When you’re applying patches, you can ask Git to warn you if it’s applying patches with the specified whitespace issues:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git apply --whitespace=warn &lt;patch&gt;</span><br></pre></td></tr></table></figure>
<p>Or you can have Git try to automatically fix the issue before applying the patch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git apply --whitespace=fix &lt;patch&gt;</span><br></pre></td></tr></table></figure>
<p>These options apply to the <code>git rebase</code> command as well. If you’ve committed whitespace issues but haven’t yet pushed upstream, you can run <code>git rebase --whitespace=fix</code> to have Git automatically fix whitespace issues as it’s rewriting the patches.</p>
<h3 id="Server-Configuration"><a href="#Server-Configuration" class="headerlink" title="Server Configuration"></a>Server Configuration</h3><p>Not nearly as many configuration options are available for the server side of Git, but there are a few interesting ones you may want to take note of.</p>
<h4 id="receive-fsckObjects"><a href="#receive-fsckObjects" class="headerlink" title="receive.fsckObjects"></a><code>receive.fsckObjects</code></h4><p>Git is capable of making sure every object received during a push still matches its SHA-1 checksum and points to valid objects. However, it doesn’t do this by default; it’s a fairly expensive operation, and might slow down the operation, especially on large repositories or pushes. If you want Git to check object consistency on every push, you can force it to do so by setting <code>receive.fsckObjects</code> to true:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --system receive.fsckObjects <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Now, Git will check the integrity of your repository before each push is accepted to make sure faulty (or malicious) clients aren’t introducing corrupt data.</p>
<h4 id="receive-denyNonFastForwards"><a href="#receive-denyNonFastForwards" class="headerlink" title="receive.denyNonFastForwards"></a><code>receive.denyNonFastForwards</code></h4><p>If you rebase commits that you’ve already pushed and then try to push again, or otherwise try to push a commit to a remote branch that doesn’t contain the commit that the remote branch currently points to, you’ll be denied. This is generally good policy; but in the case of the rebase, you may determine that you know what you’re doing and can force-update the remote branch with a <code>-f</code> flag to your push command.</p>
<p>To tell Git to refuse force-pushes, set <code>receive.denyNonFastForwards</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --system receive.denyNonFastForwards <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>The other way you can do this is via server-side receive hooks, which we’ll cover in a bit. That approach lets you do more complex things like deny non-fast-forwards to a certain subset of users.</p>
<h4 id="receive-denyDeletes"><a href="#receive-denyDeletes" class="headerlink" title="receive.denyDeletes"></a><code>receive.denyDeletes</code></h4><p>One of the workarounds to the <code>denyNonFastForwards</code> policy is for the user to delete the branch and then push it back up with the new reference. To avoid this, set <code>receive.denyDeletes</code> to true:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --system receive.denyDeletes <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>This denies any deletion of branches or tags — no user can do it. To remove remote branches, you must remove the ref files from the server manually. There are also more interesting ways to do this on a per-user basis via ACLs, as you’ll learn in 【An Example Git-Enforced Policy】.</p>
<h2 id="Git-Attributes"><a href="#Git-Attributes" class="headerlink" title="Git Attributes"></a>Git Attributes</h2><p>Some of these settings can also be specified for a path, so that Git applies those settings only for a subdirectory or subset of files. These path-specific settings are called Git attributes and are set either in a <code>.gitattributes</code> file in one of your directories (normally the root of your project) or in the <code>.git/info/attributes</code> file if you don’t want the attributes file committed with your project.</p>
<p>Using attributes, you can do things like specify separate merge strategies for individual files or directories in your project, tell Git how to diff non-text files, or have Git filter content before you check it into or out of Git. In this section, you’ll learn about some of the attributes you can set on your paths in your Git project and see a few examples of using this feature in practice.</p>
<h3 id="Binary-Files"><a href="#Binary-Files" class="headerlink" title="Binary Files"></a>Binary Files</h3><p>One cool trick for which you can use Git attributes is telling Git which files are binary (in cases it otherwise may not be able to figure out) and giving Git special instructions about how to handle those files. For instance, some text files may be machine generated and not diffable, whereas some binary files can be diffed. You’ll see how to tell Git which is which.</p>
<h4 id="Identifying-Binary-Files"><a href="#Identifying-Binary-Files" class="headerlink" title="Identifying Binary Files"></a>Identifying Binary Files</h4><p>Some files look like text files but for all intents and purposes are to be treated as binary data. For instance, Xcode projects on the Mac contain a file that ends in <code>.pbxproj</code>, which is basically a JSON (plain-text JavaScript data format) dataset written out to disk by the IDE, which records your build settings and so on. Although it’s technically a text file (because it’s all UTF-8), you don’t want to treat it as such because it’s really a lightweight database – you can’t merge the contents if two people change it, and diffs generally aren’t helpful. The file is meant to be consumed by a machine. In essence, you want to treat it like a binary file.</p>
<p>To tell Git to treat all <code>pbxproj</code> files as binary data, add the following line to your <code>.gitattributes</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.pbxproj binary</span><br></pre></td></tr></table></figure>
<p>Now, Git won’t try to convert or fix CRLF issues; nor will it try to compute or print a diff for changes in this file when you run <code>git show</code> or <code>git diff</code> on your project.</p>
<h4 id="Diffing-Binary-Files"><a href="#Diffing-Binary-Files" class="headerlink" title="Diffing Binary Files"></a>Diffing Binary Files</h4><p>You can also use the Git attributes functionality to effectively diff binary files. You do this by telling Git how to convert your binary data to a text format that can be compared via the normal diff.</p>
<p>First, you’ll use this technique to solve one of the most annoying problems known to humanity: version-controlling Microsoft Word documents. Everyone knows that Word is the most horrific editor around, but oddly, everyone still uses it. If you want to version-control Word documents, you can stick them in a Git repository and commit every once in a while; but what good does that do? If you run <code>git diff</code> normally, you only see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --git a/chapter1.docx b/chapter1.docx</span><br><span class="line">index 88839c4..4afcb7c 100644</span><br><span class="line">Binary files a/chapter1.docx and b/chapter1.docx differ</span><br></pre></td></tr></table></figure>
<p>You can’t directly compare two versions unless you check them out and scan them manually, right? It turns out you can do this fairly well using Git attributes. Put the following line in your <code>.gitattributes</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.docx diff=word</span><br></pre></td></tr></table></figure>
<p>This tells Git that any file that matches this pattern (<code>.docx</code>) should use the “word” filter when you try to view a diff that contains changes. What is the “word” filter? You have to set it up. Here you’ll configure Git to use the <code>docx2txt</code> program to convert Word documents into readable text files, which it will then diff properly.</p>
<p>First, you’ll need to install <code>docx2txt</code>; you can download it from &lt;<a href="http://docx2txt.sourceforge.net" target="_blank" rel="noopener">http://docx2txt.sourceforge.net</a>&gt;. Follow the instructions in the <code>INSTALL</code> file to put it somewhere your shell can find it. Next, you’ll write a wrapper script to convert output to the format Git expects. Create a file that’s somewhere in your path called <code>docx2txt</code>, and add these contents:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">docx2txt.pl <span class="string">"<span class="variable">$1</span>"</span> -</span><br></pre></td></tr></table></figure>
<p>Don’t forget to <code>chmod a+x</code> that file. Finally, you can configure Git to use this script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config diff.word.textconv docx2txt</span><br></pre></td></tr></table></figure>
<p>Now Git knows that if it tries to do a diff between two snapshots, and any of the files end in <code>.docx</code>, it should run those files through the “word” filter, which is defined as the <code>docx2txt</code> program. This effectively makes nice text-based versions of your Word files before attempting to diff them.</p>
<p>Here’s an example: Chapter 1 of this book was converted to Word format and committed in a Git repository. Then a new paragraph was added. Here’s what <code>git diff</code> shows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git diff</span><br><span class="line">diff --git a/chapter1.docx b/chapter1.docx</span><br><span class="line">index 0b013ca..ba25db5 100644</span><br><span class="line">--- a/chapter1.docx</span><br><span class="line">+++ b/chapter1.docx</span><br><span class="line">@@ -2,6 +2,7 @@</span><br><span class="line"> This chapter will be about getting started with Git. We will begin at the beginning by explaining some background on version control tools, <span class="keyword">then</span> move on to how to get Git running on your system and finally how to get it setup to start working with. At the end of this chapter you should understand why Git is around, why you should use it and you should be all setup to <span class="keyword">do</span> so.</span><br><span class="line"> 1.1. About Version Control</span><br><span class="line"> What is <span class="string">"version control"</span>, and why should you care? Version control is a system that records changes to a file or <span class="built_in">set</span> of files over time so that you can recall specific versions later. For the examples <span class="keyword">in</span> this book you will use software <span class="built_in">source</span> code as the files being version controlled, though <span class="keyword">in</span> reality you can <span class="keyword">do</span> this with nearly any <span class="built_in">type</span> of file on a computer.</span><br><span class="line">+Testing: 1, 2, 3.</span><br><span class="line"> If you are a graphic or web designer and want to keep every version of an image or layout (<span class="built_in">which</span> you would most certainly want to), a Version Control System (VCS) is a very wise thing to use. It allows you to revert files back to a previous state, revert the entire project back to a previous state, compare changes over time, see who last modified something that might be causing a problem, who introduced an issue and when, and more. Using a VCS also generally means that <span class="keyword">if</span> you screw things up or lose files, you can easily recover. In addition, you get all this <span class="keyword">for</span> very little overhead.</span><br><span class="line"> 1.1.1. Local Version Control Systems</span><br><span class="line"> Many people<span class="string">'s version-control method of choice is to copy files into another directory (perhaps a time-stamped directory, if they'</span>re clever). This approach is very common because it is so simple, but it is also incredibly error prone. It is easy to forget <span class="built_in">which</span> directory you<span class="string">'re in and accidentally write to the wrong file or copy over files you don'</span>t mean to.</span><br></pre></td></tr></table></figure>
<p>Git successfully and succinctly tells us that we added the string “Testing: 1, 2, 3.”, which is correct. It’s not perfect – formatting changes wouldn’t show up here – but it certainly works.</p>
<p>Another interesting problem you can solve this way involves diffing image files. One way to do this is to run image files through a filter that extracts their EXIF information – metadata that is recorded with most image formats. If you download and install the <code>exiftool</code> program, you can use it to convert your images into text about the metadata, so at least the diff will show you a textual representation of any changes that happened. Put the following line in your <code>.gitattributes</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.png diff=exif</span><br></pre></td></tr></table></figure>
<p>Configure Git to use this tool:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config diff.exif.textconv exiftool</span><br></pre></td></tr></table></figure>
<p>If you replace an image in your project and run <code>git diff</code>, you see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/image.png b/image.png</span><br><span class="line">index 88839c4..4afcb7c 100644</span><br><span class="line">--- a/image.png</span><br><span class="line">+++ b/image.png</span><br><span class="line">@@ -1,12 +1,12 @@</span><br><span class="line"> ExifTool Version Number         : 7.74</span><br><span class="line">-File Size                       : 70 kB</span><br><span class="line">-File Modification Date/Time     : 2009:04:21 07:02:45-07:00</span><br><span class="line">+File Size                       : 94 kB</span><br><span class="line">+File Modification Date/Time     : 2009:04:21 07:02:43-07:00</span><br><span class="line"> File Type                       : PNG</span><br><span class="line"> MIME Type                       : image/png</span><br><span class="line">-Image Width                     : 1058</span><br><span class="line">-Image Height                    : 889</span><br><span class="line">+Image Width                     : 1056</span><br><span class="line">+Image Height                    : 827</span><br><span class="line"> Bit Depth                       : 8</span><br><span class="line"> Color Type                      : RGB with Alpha</span><br></pre></td></tr></table></figure>
<p>You can easily see that the file size and image dimensions have both changed.</p>
<h3 id="Keyword-Expansion"><a href="#Keyword-Expansion" class="headerlink" title="Keyword Expansion"></a>Keyword Expansion</h3><p>SVN- or CVS-style keyword expansion is often requested by developers used to those systems. The main problem with this in Git is that you can’t modify a file with information about the commit after you’ve committed, because Git checksums the file first. However, you can inject text into a file when it’s checked out and remove it again before it’s added to a commit. Git attributes offers you two ways to do this.</p>
<p>First, you can inject the SHA-1 checksum of a blob into an <code>$Id$</code> field in the file automatically. If you set this attribute on a file or set of files, then the next time you check out that branch, Git will replace that field with the SHA-1 of the blob. It’s important to notice that it isn’t the SHA-1 of the commit, but of the blob itself. Put the following line in your <code>.gitattributes</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.txt ident</span><br></pre></td></tr></table></figure>
<p>Add an <code>$Id$</code> reference to a test file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'$Id$'</span> &gt; test.txt</span><br></pre></td></tr></table></figure>
<p>The next time you check out this file, Git injects the SHA-1 of the blob:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ rm test.txt</span><br><span class="line">$ git checkout -- test.txt</span><br><span class="line">$ cat test.txt</span><br><span class="line"><span class="variable">$Id</span>: 42812b7653c7b88933f8a9d6cad0ca16714b9bb3 $</span><br></pre></td></tr></table></figure>
<p>However, that result is of limited use. If you’ve used keyword substitution in CVS or Subversion, you can include a datestamp – the SHA-1 isn’t all that helpful, because it’s fairly random and you can’t tell if one SHA-1 is older or newer than another just by looking at them.</p>
<p>It turns out that you can write your own filters for doing substitutions in files on commit/checkout. These are called “clean” and “smudge” filters. In the <code>.gitattributes</code> file, you can set a filter for particular paths and then set up scripts that will process files just before they’re checked out (“smudge”, see 【The “smudge” filter is run on checkout.】) and just before they’re staged (“clean”, see 【The “clean” filter is run when files are staged.】). These filters can be set to do all sorts of fun things.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclr21fdj20m80apjrl.jpg" alt="The ``smudge&#39;&#39; filter is run on checkout.">  Figure 2. The “smudge” filter is run on checkout.    <img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckix8edj20m80ao0sy.jpg" alt="The ``clean&#39;&#39; filter is run when files are staged.">  Figure 3. The “clean” filter is run when files are staged.  The original commit message for this feature gives a simple example of running all your C source code through the <code>indent</code> program before committing. You can set it up by setting the filter attribute in your <code>.gitattributes</code> file to filter <code>*.c</code> files with the “indent” filter:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.c filter=indent</span><br></pre></td></tr></table></figure>
<p>Then, tell Git what the “indent” filter does on smudge and clean:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global filter.indent.clean indent</span><br><span class="line">$ git config --global filter.indent.smudge cat</span><br></pre></td></tr></table></figure>
<p>In this case, when you commit files that match <code>*.c</code>, Git will run them through the indent program before it stages them and then run them through the <code>cat</code> program before it checks them back out onto disk. The <code>cat</code> program does essentially nothing: it spits out the same data that it comes in. This combination effectively filters all C source code files through <code>indent</code> before committing.</p>
<p>Another interesting example gets <code>$Date$</code> keyword expansion, RCS style. To do this properly, you need a small script that takes a filename, figures out the last commit date for this project, and inserts the date into the file. Here is a small Ruby script that does that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env ruby</span></span><br><span class="line">data = STDIN.read</span><br><span class="line">last_date = `git <span class="built_in">log</span> --pretty=format:<span class="string">"%ad"</span> -1`</span><br><span class="line">puts data.gsub(<span class="string">'$Date$'</span>, <span class="string">'$Date: '</span> + last_date.to_s + <span class="string">'$'</span>)</span><br></pre></td></tr></table></figure>
<p>All the script does is get the latest commit date from the <code>git log</code> command, stick that into any <code>$Date$</code> strings it sees in stdin, and print the results – it should be simple to do in whatever language you’re most comfortable in. You can name this file <code>expand_date</code> and put it in your path. Now, you need to set up a filter in Git (call it <code>dater</code>) and tell it to use your <code>expand_date</code> filter to smudge the files on checkout. You’ll use a Perl expression to clean that up on commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config filter.dater.smudge expand_date</span><br><span class="line">$ git config filter.dater.clean <span class="string">'perl -pe "s/\\\$Date[^\\\$]*\\\$/\\\$Date\\\$/"'</span></span><br></pre></td></tr></table></figure>
<p>This Perl snippet strips out anything it sees in a <code>$Date$</code> string, to get back to where you started. Now that your filter is ready, you can test it by setting up a Git attribute for that file that engages the new filter and creating a file with your <code>$Date$</code> keyword:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date*.txt filter=dater</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'# $Date$'</span> &gt; date_test.txt</span><br></pre></td></tr></table></figure>
<p>If you commit those changes and check out the file again, you see the keyword properly substituted:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git add date_test.txt .gitattributes</span><br><span class="line">$ git commit -m <span class="string">"Testing date expansion in Git"</span></span><br><span class="line">$ rm date_test.txt</span><br><span class="line">$ git checkout date_test.txt</span><br><span class="line">$ cat date_test.txt</span><br><span class="line"><span class="comment"># $Date: Tue Apr 21 07:26:52 2009 -0700$</span></span><br></pre></td></tr></table></figure>
<p>You can see how powerful this technique can be for customized applications. You have to be careful, though, because the <code>.gitattributes</code> file is committed and passed around with the project, but the driver (in this case, <code>dater</code>) isn’t, so it won’t work everywhere. When you design these filters, they should be able to fail gracefully and have the project still work properly.</p>
<h3 id="Exporting-Your-Repository"><a href="#Exporting-Your-Repository" class="headerlink" title="Exporting Your Repository"></a>Exporting Your Repository</h3><p>Git attribute data also allows you to do some interesting things when exporting an archive of your project.</p>
<h4 id="export-ignore"><a href="#export-ignore" class="headerlink" title="export-ignore"></a><code>export-ignore</code></h4><p>You can tell Git not to export certain files or directories when generating an archive. If there is a subdirectory or file that you don’t want to include in your archive file but that you do want checked into your project, you can determine those files via the <code>export-ignore</code> attribute.</p>
<p>For example, say you have some test files in a <code>test/</code> subdirectory, and it doesn’t make sense to include them in the tarball export of your project. You can add the following line to your Git attributes file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>/ <span class="built_in">export</span>-ignore</span><br></pre></td></tr></table></figure>
<p>Now, when you run <code>git archive</code> to create a tarball of your project, that directory won’t be included in the archive.</p>
<h4 id="export-subst"><a href="#export-subst" class="headerlink" title="export-subst"></a><code>export-subst</code></h4><p>When exporting files for deployment you can apply <code>git log</code>‘s formatting and keyword-expansion processing to selected portions of files marked with the <code>export-subst</code> attribute.</p>
<p>For instance, if you want to include a file named <code>LAST_COMMIT</code> in your project, and have metadata about the last commit automatically injected into it when <code>git archive</code> runs, you can for example set up your <code>.gitattributes</code> and <code>LAST_COMMIT</code> files like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LAST_COMMIT <span class="built_in">export</span>-subst</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'Last commit date: $Format:%cd by %aN$'</span> &gt; LAST_COMMIT</span><br><span class="line">$ git add LAST_COMMIT .gitattributes</span><br><span class="line">$ git commit -am <span class="string">'adding LAST_COMMIT file for archives'</span></span><br></pre></td></tr></table></figure>
<p>When you run <code>git archive</code>, the contents of the archived file will look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git archive HEAD | tar xCf ../deployment-testing -</span><br><span class="line">$ cat ../deployment-testing/LAST_COMMIT</span><br><span class="line">Last commit date: Tue Apr 21 08:38:48 2009 -0700 by Scott Chacon</span><br></pre></td></tr></table></figure>
<p>The substitutions can include for example the commit message and any <code>git notes</code>, and <code>git log</code> can do simple word wrapping:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'$Format:Last commit: %h by %aN at %cd%n%+w(76,6,9)%B$'</span> &gt; LAST_COMMIT</span><br><span class="line">$ git commit -am <span class="string">'export-subst uses git log'</span>\<span class="string">''</span>s custom formatter</span><br><span class="line"></span><br><span class="line">git archive uses git <span class="built_in">log</span><span class="string">'\'</span><span class="string">'s `pretty=format:` processor</span></span><br><span class="line"><span class="string">directly, and strips the surrounding `$Format:` and `$`</span></span><br><span class="line"><span class="string">markup from the output.</span></span><br><span class="line"><span class="string">'</span></span><br><span class="line">$ git archive @ | tar xfO - LAST_COMMIT</span><br><span class="line">Last commit: 312ccc8 by Jim Hill at Fri May 8 09:14:04 2015 -0700</span><br><span class="line">       <span class="built_in">export</span>-subst uses git <span class="built_in">log</span><span class="string">'s custom formatter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         git archive uses git log'</span>s `pretty=format:` processor directly, and</span><br><span class="line">         strips the surrounding `<span class="variable">$Format</span>:` and `$` markup from the output.</span><br></pre></td></tr></table></figure>
<p>The resulting archive is suitable for deployment work, but like any exported archive it isn’t suitable for further development work.</p>
<h3 id="Merge-Strategies"><a href="#Merge-Strategies" class="headerlink" title="Merge Strategies"></a>Merge Strategies</h3><p>You can also use Git attributes to tell Git to use different merge strategies for specific files in your project. One very useful option is to tell Git to not try to merge specific files when they have conflicts, but rather to use your side of the merge over someone else’s.</p>
<p>This is helpful if a branch in your project has diverged or is specialized, but you want to be able to merge changes back in from it, and you want to ignore certain files. Say you have a database settings file called <code>database.xml</code> that is different in two branches, and you want to merge in your other branch without messing up the database file. You can set up an attribute like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">database.xml merge=ours</span><br></pre></td></tr></table></figure>
<p>And then define a dummy <code>ours</code> merge strategy with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global merge.ours.driver <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>If you merge in the other branch, instead of having merge conflicts with the <code>database.xml</code> file, you see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git merge topic</span><br><span class="line">Auto-merging database.xml</span><br><span class="line">Merge made by recursive.</span><br></pre></td></tr></table></figure>
<p>In this case, <code>database.xml</code> stays at whatever version you originally had.</p>
<h2 id="Git-Hooks"><a href="#Git-Hooks" class="headerlink" title="Git Hooks"></a>Git Hooks</h2><p>Like many other Version Control Systems, Git has a way to fire off custom scripts when certain important actions occur. There are two groups of these hooks: client-side and server-side. Client-side hooks are triggered by operations such as committing and merging, while server-side hooks run on network operations such as receiving pushed commits. You can use these hooks for all sorts of reasons.</p>
<h3 id="Installing-a-Hook"><a href="#Installing-a-Hook" class="headerlink" title="Installing a Hook"></a>Installing a Hook</h3><p>The hooks are all stored in the <code>hooks</code> subdirectory of the Git directory. In most projects, that’s <code>.git/hooks</code>. When you initialize a new repository with <code>git init</code>, Git populates the hooks directory with a bunch of example scripts, many of which are useful by themselves; but they also document the input values of each script. All the examples are written as shell scripts, with some Perl thrown in, but any properly named executable scripts will work fine – you can write them in Ruby or Python or whatever language you are familiar with. If you want to use the bundled hook scripts, you’ll have to rename them; their file names all end with <code>.sample</code>.</p>
<p>To enable a hook script, put a file in the <code>hooks</code> subdirectory of your .git directory that is named appropriately (without any extension) and is executable. From that point forward, it should be called. We’ll cover most of the major hook filenames here.</p>
<h3 id="Client-Side-Hooks"><a href="#Client-Side-Hooks" class="headerlink" title="Client-Side Hooks"></a>Client-Side Hooks</h3><p>There are a lot of client-side hooks. This section splits them into committing-workflow hooks, email-workflow scripts, and everything else.</p>
<p>It’s important to note that client-side hooks are <strong>not</strong> copied when you clone a repository. If your intent with these scripts is to enforce a policy, you’ll probably want to do that on the server side; see the example in 【An Example Git-Enforced Policy】.</p>
<h4 id="Committing-Workflow-Hooks"><a href="#Committing-Workflow-Hooks" class="headerlink" title="Committing-Workflow Hooks"></a>Committing-Workflow Hooks</h4><p>The first four hooks have to do with the committing process.</p>
<p>The <code>pre-commit</code> hook is run first, before you even type in a commit message. It’s used to inspect the snapshot that’s about to be committed, to see if you’ve forgotten something, to make sure tests run, or to examine whatever you need to inspect in the code. Exiting non-zero from this hook aborts the commit, although you can bypass it with <code>git commit --no-verify</code>. You can do things like check for code style (run <code>lint</code> or something equivalent), check for trailing whitespace (the default hook does exactly this), or check for appropriate documentation on new methods.</p>
<p>The <code>prepare-commit-msg</code> hook is run before the commit message editor is fired up but after the default message is created. It lets you edit the default message before the commit author sees it. This hook takes a few parameters: the path to the file that holds the commit message so far, the type of commit, and the commit SHA-1 if this is an amended commit. This hook generally isn’t useful for normal commits; rather, it’s good for commits where the default message is auto-generated, such as templated commit messages, merge commits, squashed commits, and amended commits. You may use it in conjunction with a commit template to programmatically insert information.</p>
<p>The <code>commit-msg</code> hook takes one parameter, which again is the path to a temporary file that contains the commit message written by the developer. If this script exits non-zero, Git aborts the commit process, so you can use it to validate your project state or commit message before allowing a commit to go through. In the last section of this chapter, We’ll demonstrate using this hook to check that your commit message is conformant to a required pattern.</p>
<p>After the entire commit process is completed, the <code>post-commit</code> hook runs. It doesn’t take any parameters, but you can easily get the last commit by running <code>git log -1 HEAD</code>. Generally, this script is used for notification or something similar.</p>
<h4 id="Email-Workflow-Hooks"><a href="#Email-Workflow-Hooks" class="headerlink" title="Email Workflow Hooks"></a>Email Workflow Hooks</h4><p>You can set up three client-side hooks for an email-based workflow. They’re all invoked by the <code>git am</code> command, so if you aren’t using that command in your workflow, you can safely skip to the next section. If you’re taking patches over email prepared by <code>git format-patch</code>, then some of these may be helpful to you.</p>
<p>The first hook that is run is <code>applypatch-msg</code>. It takes a single argument: the name of the temporary file that contains the proposed commit message. Git aborts the patch if this script exits non-zero. You can use this to make sure a commit message is properly formatted, or to normalize the message by having the script edit it in place.</p>
<p>The next hook to run when applying patches via <code>git am</code> is <code>pre-applypatch</code>. Somewhat confusingly, it is run <em>after</em> the patch is applied but before a commit is made, so you can use it to inspect the snapshot before making the commit. You can run tests or otherwise inspect the working tree with this script. If something is missing or the tests don’t pass, exiting non-zero aborts the <code>git am</code> script without committing the patch.</p>
<p>The last hook to run during a <code>git am</code> operation is <code>post-applypatch</code>, which runs after the commit is made. You can use it to notify a group or the author of the patch you pulled in that you’ve done so. You can’t stop the patching process with this script.</p>
<h4 id="Other-Client-Hooks"><a href="#Other-Client-Hooks" class="headerlink" title="Other Client Hooks"></a>Other Client Hooks</h4><p>The <code>pre-rebase</code> hook runs before you rebase anything and can halt the process by exiting non-zero. You can use this hook to disallow rebasing any commits that have already been pushed. The example <code>pre-rebase</code> hook that Git installs does this, although it makes some assumptions that may not match with your workflow.</p>
<p>The <code>post-rewrite</code> hook is run by commands that replace commits, such as <code>git commit --amend</code> and <code>git rebase</code> (though not by <code>git filter-branch</code>). Its single argument is which command triggered the rewrite, and it receives a list of rewrites on <code>stdin</code>. This hook has many of the same uses as the <code>post-checkout</code> and <code>post-merge</code> hooks.</p>
<p>After you run a successful <code>git checkout</code>, the <code>post-checkout</code> hook runs; you can use it to set up your working directory properly for your project environment. This may mean moving in large binary files that you don’t want source controlled, auto-generating documentation, or something along those lines.</p>
<p>The <code>post-merge</code> hook runs after a successful <code>merge</code> command. You can use it to restore data in the working tree that Git can’t track, such as permissions data. This hook can likewise validate the presence of files external to Git control that you may want copied in when the working tree changes.</p>
<p>The <code>pre-push</code> hook runs during <code>git push</code>, after the remote refs have been updated but before any objects have been transferred. It receives the name and location of the remote as parameters, and a list of to-be-updated refs through <code>stdin</code>. You can use it to validate a set of ref updates before a push occurs (a non-zero exit code will abort the push).</p>
<p>Git occasionally does garbage collection as part of its normal operation, by invoking <code>git gc --auto</code>. The <code>pre-auto-gc</code> hook is invoked just before the garbage collection takes place, and can be used to notify you that this is happening, or to abort the collection if now isn’t a good time.</p>
<h3 id="Server-Side-Hooks"><a href="#Server-Side-Hooks" class="headerlink" title="Server-Side Hooks"></a>Server-Side Hooks</h3><p>In addition to the client-side hooks, you can use a couple of important server-side hooks as a system administrator to enforce nearly any kind of policy for your project. These scripts run before and after pushes to the server. The pre hooks can exit non-zero at any time to reject the push as well as print an error message back to the client; you can set up a push policy that’s as complex as you wish.</p>
<h4 id="pre-receive"><a href="#pre-receive" class="headerlink" title="pre-receive"></a><code>pre-receive</code></h4><p>The first script to run when handling a push from a client is <code>pre-receive</code>. It takes a list of references that are being pushed from stdin; if it exits non-zero, none of them are accepted. You can use this hook to do things like make sure none of the updated references are non-fast-forwards, or to do access control for all the refs and files they’re modifying with the push.</p>
<h4 id="update"><a href="#update" class="headerlink" title="update"></a><code>update</code></h4><p>The <code>update</code> script is very similar to the <code>pre-receive</code> script, except that it’s run once for each branch the pusher is trying to update. If the pusher is trying to push to multiple branches, <code>pre-receive</code> runs only once, whereas update runs once per branch they’re pushing to. Instead of reading from stdin, this script takes three arguments: the name of the reference (branch), the SHA-1 that reference pointed to before the push, and the SHA-1 the user is trying to push. If the update script exits non-zero, only that reference is rejected; other references can still be updated.</p>
<h4 id="post-receive"><a href="#post-receive" class="headerlink" title="post-receive"></a><code>post-receive</code></h4><p>The <code>post-receive</code> hook runs after the entire process is completed and can be used to update other services or notify users. It takes the same stdin data as the <code>pre-receive</code> hook. Examples include emailing a list, notifying a continuous integration server, or updating a ticket-tracking system – you can even parse the commit messages to see if any tickets need to be opened, modified, or closed. This script can’t stop the push process, but the client doesn’t disconnect until it has completed, so be careful if you try to do anything that may take a long time.</p>
<h2 id="An-Example-Git-Enforced-Policy"><a href="#An-Example-Git-Enforced-Policy" class="headerlink" title="An Example Git-Enforced Policy"></a>An Example Git-Enforced Policy</h2><p>In this section, you’ll use what you’ve learned to establish a Git workflow that checks for a custom commit message format, and allows only certain users to modify certain subdirectories in a project. You’ll build client scripts that help the developer know if their push will be rejected and server scripts that actually enforce the policies.</p>
<p>The scripts we’ll show are written in Ruby; partly because of our intellectual inertia, but also because Ruby is easy to read, even if you can’t necessarily write it. However, any language will work – all the sample hook scripts distributed with Git are in either Perl or Bash, so you can also see plenty of examples of hooks in those languages by looking at the samples.</p>
<h3 id="Server-Side-Hook"><a href="#Server-Side-Hook" class="headerlink" title="Server-Side Hook"></a>Server-Side Hook</h3><p>All the server-side work will go into the <code>update</code> file in your <code>hooks</code> directory. The <code>update</code> hook runs once per branch being pushed and takes three arguments:</p>
<ul>
<li>The name of the reference being pushed to</li>
<li>The old revision where that branch was</li>
<li>The new revision being pushed<br>You also have access to the user doing the pushing if the push is being run over SSH. If you’ve allowed everyone to connect with a single user (like “git”) via public-key authentication, you may have to give that user a shell wrapper that determines which user is connecting based on the public key, and set an environment variable accordingly. Here we’ll assume the connecting user is in the <code>$USER</code> environment variable, so your update script begins by gathering all the information you need:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$refname</span> = ARGV[0]</span><br><span class="line"><span class="variable">$oldrev</span>  = ARGV[1]</span><br><span class="line"><span class="variable">$newrev</span>  = ARGV[2]</span><br><span class="line"><span class="variable">$user</span>    = ENV[<span class="string">'USER'</span>]</span><br><span class="line"></span><br><span class="line">puts <span class="string">"Enforcing Policies..."</span></span><br><span class="line">puts <span class="string">"(#&#123;<span class="variable">$refname</span>&#125;) (#&#123;<span class="variable">$oldrev</span>[0,6]&#125;) (#&#123;<span class="variable">$newrev</span>[0,6]&#125;)"</span></span><br></pre></td></tr></table></figure>
<p>Yes, those are global variables. Don’t judge – it’s easier to demonstrate this way.</p>
<h4 id="Enforcing-a-Specific-Commit-Message-Format"><a href="#Enforcing-a-Specific-Commit-Message-Format" class="headerlink" title="Enforcing a Specific Commit-Message Format"></a>Enforcing a Specific Commit-Message Format</h4><p>Your first challenge is to enforce that each commit message adheres to a particular format. Just to have a target, assume that each message has to include a string that looks like “ref: 1234” because you want each commit to link to a work item in your ticketing system. You must look at each commit being pushed up, see if that string is in the commit message, and, if the string is absent from any of the commits, exit non-zero so the push is rejected.</p>
<p>You can get a list of the SHA-1 values of all the commits that are being pushed by taking the <code>$newrev</code> and <code>$oldrev</code> values and passing them to a Git plumbing command called <code>git rev-list</code>. This is basically the <code>git log</code> command, but by default it prints out only the SHA-1 values and no other information. So, to get a list of all the commit SHA-1s introduced between one commit SHA-1 and another, you can run something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git rev-list 538c33..d14fc7</span><br><span class="line">d14fc7c847ab946ec39590d87783c69b031bdfb7</span><br><span class="line">9f585da4401b0a3999e84113824d15245c13f0be</span><br><span class="line">234071a1be950e2a8d078e6141f5cd20c1e61ad3</span><br><span class="line">dfa04c9ef3d5197182f13fb5b9b1fb7717d2222a</span><br><span class="line">17716ec0f1ff5c77eff40b7fe912f9f6cfd0e475</span><br></pre></td></tr></table></figure>
<p>You can take that output, loop through each of those commit SHA-1s, grab the message for it, and test that message against a regular expression that looks for a pattern.</p>
<p>You have to figure out how to get the commit message from each of these commits to test. To get the raw commit data, you can use another plumbing command called <code>git cat-file</code>. We’ll go over all these plumbing commands in detail in 【Git Internals】; but for now, here’s what that command gives you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file commit ca82a6</span><br><span class="line">tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">parent 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1205815931 -0700</span><br><span class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1240030591 -0700</span><br><span class="line"></span><br><span class="line">changed the version number</span><br></pre></td></tr></table></figure>
<p>A simple way to get the commit message from a commit when you have the SHA-1 value is to go to the first blank line and take everything after that. You can do so with the <code>sed</code> command on Unix systems:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file commit ca82a6 | sed <span class="string">'1,/^$/d'</span></span><br><span class="line">changed the version number</span><br></pre></td></tr></table></figure>
<p>You can use that incantation to grab the commit message from each commit that is trying to be pushed and exit if you see anything that doesn’t match. To exit the script and reject the push, exit non-zero. The whole method looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$regex</span> = /\[ref: (\d+)\]/</span><br><span class="line"></span><br><span class="line"><span class="comment"># enforced custom commit message format</span></span><br><span class="line">def check_message_format</span><br><span class="line">  missed_revs = `git rev-list <span class="comment">#&#123;$oldrev&#125;..#&#123;$newrev&#125;`.split("\n")</span></span><br><span class="line">  missed_revs.each <span class="keyword">do</span> |rev|</span><br><span class="line">    message = `git cat-file commit <span class="comment">#&#123;rev&#125; | sed '1,/^$/d'`</span></span><br><span class="line">    <span class="keyword">if</span> !<span class="variable">$regex</span>.match(message)</span><br><span class="line">      puts <span class="string">"[POLICY] Your message is not formatted correctly"</span></span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line">check_message_format</span><br></pre></td></tr></table></figure>
<p>Putting that in your <code>update</code> script will reject updates that contain commits that have messages that don’t adhere to your rule.</p>
<h4 id="Enforcing-a-User-Based-ACL-System"><a href="#Enforcing-a-User-Based-ACL-System" class="headerlink" title="Enforcing a User-Based ACL System"></a>Enforcing a User-Based ACL System</h4><p>Suppose you want to add a mechanism that uses an access control list (ACL) that specifies which users are allowed to push changes to which parts of your projects. Some people have full access, and others can only push changes to certain subdirectories or specific files. To enforce this, you’ll write those rules to a file named <code>acl</code> that lives in your bare Git repository on the server. You’ll have the <code>update</code> hook look at those rules, see what files are being introduced for all the commits being pushed, and determine whether the user doing the push has access to update all those files.</p>
<p>The first thing you’ll do is write your ACL. Here you’ll use a format very much like the CVS ACL mechanism: it uses a series of lines, where the first field is <code>avail</code> or <code>unavail</code>, the next field is a comma-delimited list of the users to which the rule applies, and the last field is the path to which the rule applies (blank meaning open access). All of these fields are delimited by a pipe (<code>|</code>) character.</p>
<p>In this case, you have a couple of administrators, some documentation writers with access to the <code>doc</code> directory, and one developer who only has access to the <code>lib</code> and <code>tests</code> directories, and your ACL file looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">avail|nickh,pjhyett,defunkt,tpw</span><br><span class="line">avail|usinclair,cdickens,ebronte|doc</span><br><span class="line">avail|schacon|lib</span><br><span class="line">avail|schacon|tests</span><br></pre></td></tr></table></figure>
<p>You begin by reading this data into a structure that you can use. In this case, to keep the example simple, you’ll only enforce the <code>avail</code> directives. Here is a method that gives you an associative array where the key is the user name and the value is an array of paths to which the user has write access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def get_acl_access_data(acl_file)</span><br><span class="line">  <span class="comment"># read in ACL data</span></span><br><span class="line">  acl_file = File.read(acl_file).split(<span class="string">"\n"</span>).reject &#123; |line| line == <span class="string">''</span> &#125;</span><br><span class="line">  access = &#123;&#125;</span><br><span class="line">  acl_file.each <span class="keyword">do</span> |line|</span><br><span class="line">    avail, users, path = line.split(<span class="string">'|'</span>)</span><br><span class="line">    next unless avail == <span class="string">'avail'</span></span><br><span class="line">    users.split(<span class="string">','</span>).each <span class="keyword">do</span> |user|</span><br><span class="line">      access[user] ||= []</span><br><span class="line">      access[user] &lt;&lt; path</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  access</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>On the ACL file you looked at earlier, this <code>get_acl_access_data</code> method returns a data structure that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"defunkt"</span>=&gt;[nil],</span><br><span class="line"> <span class="string">"tpw"</span>=&gt;[nil],</span><br><span class="line"> <span class="string">"nickh"</span>=&gt;[nil],</span><br><span class="line"> <span class="string">"pjhyett"</span>=&gt;[nil],</span><br><span class="line"> <span class="string">"schacon"</span>=&gt;[<span class="string">"lib"</span>, <span class="string">"tests"</span>],</span><br><span class="line"> <span class="string">"cdickens"</span>=&gt;[<span class="string">"doc"</span>],</span><br><span class="line"> <span class="string">"usinclair"</span>=&gt;[<span class="string">"doc"</span>],</span><br><span class="line"> <span class="string">"ebronte"</span>=&gt;[<span class="string">"doc"</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>Now that you have the permissions sorted out, you need to determine what paths the commits being pushed have modified, so you can make sure the user who’s pushing has access to all of them.</p>
<p>You can pretty easily see what files have been modified in a single commit with the <code>--name-only</code> option to the <code>git log</code> command (mentioned briefly in 【Git Basics】):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -1 --name-only --pretty=format:<span class="string">''</span> 9f585d</span><br><span class="line"></span><br><span class="line">README</span><br><span class="line">lib/test.rb</span><br></pre></td></tr></table></figure>
<p>If you use the ACL structure returned from the <code>get_acl_access_data</code> method and check it against the listed files in each of the commits, you can determine whether the user has access to push all of their commits:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># only allows certain users to modify certain subdirectories in a project</span></span><br><span class="line">def check_directory_perms</span><br><span class="line">  access = get_acl_access_data(<span class="string">'acl'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># see if anyone is trying to push something they can't</span></span><br><span class="line">  new_commits = `git rev-list <span class="comment">#&#123;$oldrev&#125;..#&#123;$newrev&#125;`.split("\n")</span></span><br><span class="line">  new_commits.each <span class="keyword">do</span> |rev|</span><br><span class="line">    files_modified = `git <span class="built_in">log</span> -1 --name-only --pretty=format:<span class="string">''</span> <span class="comment">#&#123;rev&#125;`.split("\n")</span></span><br><span class="line">    files_modified.each <span class="keyword">do</span> |path|</span><br><span class="line">      next <span class="keyword">if</span> path.size == 0</span><br><span class="line">      has_file_access = <span class="literal">false</span></span><br><span class="line">      access[<span class="variable">$user</span>].each <span class="keyword">do</span> |access_path|</span><br><span class="line">        <span class="keyword">if</span> !access_path  <span class="comment"># user has access to everything</span></span><br><span class="line">           || (path.start_with? access_path) <span class="comment"># access to this path</span></span><br><span class="line">          has_file_access = <span class="literal">true</span></span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      <span class="keyword">if</span> !has_file_access</span><br><span class="line">        puts <span class="string">"[POLICY] You do not have access to push to #&#123;path&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">check_directory_perms</span><br></pre></td></tr></table></figure>
<p>You get a list of new commits being pushed to your server with <code>git rev-list</code>. Then, for each of those commits, you find which files are modified and make sure the user who’s pushing has access to all the paths being modified.</p>
<p>Now your users can’t push any commits with badly formed messages or with modified files outside of their designated paths.</p>
<h4 id="Testing-It-Out"><a href="#Testing-It-Out" class="headerlink" title="Testing It Out"></a>Testing It Out</h4><p>If you run <code>chmod u+x .git/hooks/update</code>, which is the file into which you should have put all this code, and then try to push a commit with a non-compliant message, you get something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git push -f origin master</span><br><span class="line">Counting objects: 5, <span class="keyword">done</span>.</span><br><span class="line">Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 323 bytes, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 1), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">Enforcing Policies...</span><br><span class="line">(refs/heads/master) (8338c5) (c5b616)</span><br><span class="line">[POLICY] Your message is not formatted correctly</span><br><span class="line">error: hooks/update exited with error code 1</span><br><span class="line">error: hook declined to update refs/heads/master</span><br><span class="line">To git@gitserver:project.git</span><br><span class="line"> ! [remote rejected] master -&gt; master (hook declined)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@gitserver:project.git'</span></span><br></pre></td></tr></table></figure>
<p>There are a couple of interesting things here. First, you see this where the hook starts running.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enforcing Policies...</span><br><span class="line">(refs/heads/master) (fb8c72) (c56860)</span><br></pre></td></tr></table></figure>
<p>Remember that you printed that out at the very beginning of your update script. Anything your script echoes to <code>stdout</code> will be transferred to the client.</p>
<p>The next thing you’ll notice is the error message.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[POLICY] Your message is not formatted correctly</span><br><span class="line">error: hooks/update exited with error code 1</span><br><span class="line">error: hook declined to update refs/heads/master</span><br></pre></td></tr></table></figure>
<p>The first line was printed out by you, the other two were Git telling you that the update script exited non-zero and that is what is declining your push. Lastly, you have this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">To git@gitserver:project.git</span><br><span class="line"> ! [remote rejected] master -&gt; master (hook declined)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@gitserver:project.git'</span></span><br></pre></td></tr></table></figure>
<p>You’ll see a remote rejected message for each reference that your hook declined, and it tells you that it was declined specifically because of a hook failure.</p>
<p>Furthermore, if someone tries to edit a file they don’t have access to and push a commit containing it, they will see something similar. For instance, if a documentation author tries to push a commit modifying something in the <code>lib</code> directory, they see</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[POLICY] You <span class="keyword">do</span> not have access to push to lib/test.rb</span><br></pre></td></tr></table></figure>
<p>From now on, as long as that <code>update</code> script is there and executable, your repository will never have a commit message without your pattern in it, and your users will be sandboxed.</p>
<h3 id="Client-Side-Hooks-1"><a href="#Client-Side-Hooks-1" class="headerlink" title="Client-Side Hooks"></a>Client-Side Hooks</h3><p>The downside to this approach is the whining that will inevitably result when your users’ commit pushes are rejected. Having their carefully crafted work rejected at the last minute can be extremely frustrating and confusing; and furthermore, they will have to edit their history to correct it, which isn’t always for the faint of heart.</p>
<p>The answer to this dilemma is to provide some client-side hooks that users can run to notify them when they’re doing something that the server is likely to reject. That way, they can correct any problems before committing and before those issues become more difficult to fix. Because hooks aren’t transferred with a clone of a project, you must distribute these scripts some other way and then have your users copy them to their <code>.git/hooks</code> directory and make them executable. You can distribute these hooks within the project or in a separate project, but Git won’t set them up automatically.</p>
<p>To begin, you should check your commit message just before each commit is recorded, so you know the server won’t reject your changes due to badly formatted commit messages. To do this, you can add the <code>commit-msg</code> hook. If you have it read the message from the file passed as the first argument and compare that to the pattern, you can force Git to abort the commit if there is no match:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line">message_file = ARGV[0]</span><br><span class="line">message = File.read(message_file)</span><br><span class="line"></span><br><span class="line"><span class="variable">$regex</span> = /\[ref: (\d+)\]/</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !<span class="variable">$regex</span>.match(message)</span><br><span class="line">  puts <span class="string">"[POLICY] Your message is not formatted correctly"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>If that script is in place (in <code>.git/hooks/commit-msg</code>) and executable, and you commit with a message that isn’t properly formatted, you see this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">'test'</span></span><br><span class="line">[POLICY] Your message is not formatted correctly</span><br></pre></td></tr></table></figure>
<p>No commit was completed in that instance. However, if your message contains the proper pattern, Git allows you to commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">'test [ref: 132]'</span></span><br><span class="line">[master e05c914] <span class="built_in">test</span> [ref: 132]</span><br><span class="line"> 1 file changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>
<p>Next, you want to make sure you aren’t modifying files that are outside your ACL scope. If your project’s <code>.git</code> directory contains a copy of the ACL file you used previously, then the following <code>pre-commit</code> script will enforce those constraints for you:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>    = ENV[<span class="string">'USER'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># [ insert acl_access_data method from above ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># only allows certain users to modify certain subdirectories in a project</span></span><br><span class="line">def check_directory_perms</span><br><span class="line">  access = get_acl_access_data(<span class="string">'.git/acl'</span>)</span><br><span class="line"></span><br><span class="line">  files_modified = `git diff-index --cached --name-only HEAD`.split(<span class="string">"\n"</span>)</span><br><span class="line">  files_modified.each <span class="keyword">do</span> |path|</span><br><span class="line">    next <span class="keyword">if</span> path.size == 0</span><br><span class="line">    has_file_access = <span class="literal">false</span></span><br><span class="line">    access[<span class="variable">$user</span>].each <span class="keyword">do</span> |access_path|</span><br><span class="line">    <span class="keyword">if</span> !access_path || (path.index(access_path) == 0)</span><br><span class="line">      has_file_access = <span class="literal">true</span></span><br><span class="line">    end</span><br><span class="line">    <span class="keyword">if</span> !has_file_access</span><br><span class="line">      puts <span class="string">"[POLICY] You do not have access to push to #&#123;path&#125;"</span></span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">check_directory_perms</span><br></pre></td></tr></table></figure>
<p>This is roughly the same script as the server-side part, but with two important differences. First, the ACL file is in a different place, because this script runs from your working directory, not from your <code>.git</code> directory. You have to change the path to the ACL file from this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access = get_acl_access_data(<span class="string">'acl'</span>)</span><br></pre></td></tr></table></figure>
<p>to this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access = get_acl_access_data(<span class="string">'.git/acl'</span>)</span><br></pre></td></tr></table></figure>
<p>The other important difference is the way you get a listing of the files that have been changed. Because the server-side method looks at the log of commits, and, at this point, the commit hasn’t been recorded yet, you must get your file listing from the staging area instead. Instead of</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">files_modified = `git <span class="built_in">log</span> -1 --name-only --pretty=format:<span class="string">''</span> <span class="comment">#&#123;ref&#125;`</span></span><br></pre></td></tr></table></figure>
<p>you have to use</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">files_modified = `git diff-index --cached --name-only HEAD`</span><br></pre></td></tr></table></figure>
<p>But those are the only two differences – otherwise, the script works the same way. One caveat is that it expects you to be running locally as the same user you push as to the remote machine. If that is different, you must set the <code>$user</code> variable manually.</p>
<p>One other thing we can do here is make sure the user doesn’t push non-fast-forwarded references. To get a reference that isn’t a fast-forward, you either have to rebase past a commit you’ve already pushed up or try pushing a different local branch up to the same remote branch.</p>
<p>Presumably, the server is already configured with <code>receive.denyDeletes</code> and <code>receive.denyNonFastForwards</code> to enforce this policy, so the only accidental thing you can try to catch is rebasing commits that have already been pushed.</p>
<p>Here is an example pre-rebase script that checks for that. It gets a list of all the commits you’re about to rewrite and checks whether they exist in any of your remote references. If it sees one that is reachable from one of your remote references, it aborts the rebase.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">base_branch = ARGV[0]</span><br><span class="line"><span class="keyword">if</span> ARGV[1]</span><br><span class="line">  topic_branch = ARGV[1]</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  topic_branch = <span class="string">"HEAD"</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">target_shas = `git rev-list <span class="comment">#&#123;base_branch&#125;..#&#123;topic_branch&#125;`.split("\n")</span></span><br><span class="line">remote_refs = `git branch -r`.split(<span class="string">"\n"</span>).map &#123; |r| r.strip &#125;</span><br><span class="line"></span><br><span class="line">target_shas.each <span class="keyword">do</span> |sha|</span><br><span class="line">  remote_refs.each <span class="keyword">do</span> |remote_ref|</span><br><span class="line">    shas_pushed = `git rev-list ^<span class="comment">#&#123;sha&#125;^@ refs/remotes/#&#123;remote_ref&#125;`</span></span><br><span class="line">    <span class="keyword">if</span> shas_pushed.split(<span class="string">"\n"</span>).include?(sha)</span><br><span class="line">      puts <span class="string">"[POLICY] Commit #&#123;sha&#125; has already been pushed to #&#123;remote_ref&#125;"</span></span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>This script uses a syntax that wasn’t covered in 【Revision Selection】. You get a list of commits that have already been pushed up by running this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`git rev-list ^<span class="comment">#&#123;sha&#125;^@ refs/remotes/#&#123;remote_ref&#125;`</span></span><br></pre></td></tr></table></figure>
<p>The <code>SHA^@</code> syntax resolves to all the parents of that commit. You’re looking for any commit that is reachable from the last commit on the remote and that isn’t reachable from any parent of any of the SHA-1s you’re trying to push up – meaning it’s a fast-forward.</p>
<p>The main drawback to this approach is that it can be very slow and is often unnecessary – if you don’t try to force the push with <code>-f</code>, the server will warn you and not accept the push. However, it’s an interesting exercise and can in theory help you avoid a rebase that you might later have to go back and fix.</p>
<h2 id="Summary-9"><a href="#Summary-9" class="headerlink" title="Summary"></a>Summary</h2><p>We’ve covered most of the major ways that you can customize your Git client and server to best fit your workflow and projects. You’ve learned about all sorts of configuration settings, file-based attributes, and event hooks, and you’ve built an example policy-enforcing server. You should now be able to make Git fit nearly any workflow you can dream up.</p>
<h1 id="Git-and-Other-Systems"><a href="#Git-and-Other-Systems" class="headerlink" title="Git and Other Systems"></a><strong>Git</strong> <strong>and</strong> <strong>Other</strong> <strong>Systems</strong></h1><p>The world isn’t perfect. Usually, you can’t immediately switch every project you come in contact with to Git. Sometimes you’re stuck on a project using another VCS, and wish it was Git. We’ll spend the first part of this chapter learning about ways to use Git as a client when the project you’re working on is hosted in a different system.</p>
<p>At some point, you may want to convert your existing project to Git. The second part of this chapter covers how to migrate your project into Git from several specific systems, as well as a method that will work if no pre-built import tool exists.</p>
<h2 id="Git-as-a-Client"><a href="#Git-as-a-Client" class="headerlink" title="Git as a Client"></a>Git as a Client</h2><p>Git provides such a nice experience for developers that many people have figured out how to use it on their workstation, even if the rest of their team is using an entirely different VCS. There are a number of these adapters, called “bridges,” available. Here we’ll cover the ones you’re most likely to run into in the wild.</p>
<h3 id="Git-and-Subversion"><a href="#Git-and-Subversion" class="headerlink" title="Git and Subversion"></a>Git and Subversion</h3><p>A large fraction of open source development projects and a good number of corporate projects use Subversion to manage their source code. It’s been around for more than a decade, and for most of that time was the <em>de facto</em> VCS choice for open-source projects. It’s also very similar in many ways to CVS, which was the big boy of the source-control world before that.</p>
<p>One of Git’s great features is a bidirectional bridge to Subversion called <code>git svn</code>. This tool allows you to use Git as a valid client to a Subversion server, so you can use all the local features of Git and then push to a Subversion server as if you were using Subversion locally. This means you can do local branching and merging, use the staging area, use rebasing and cherry-picking, and so on, while your collaborators continue to work in their dark and ancient ways. It’s a good way to sneak Git into the corporate environment and help your fellow developers become more efficient while you lobby to get the infrastructure changed to support Git fully. The Subversion bridge is the gateway drug to the DVCS world.</p>
<h4 id="git-svn"><a href="#git-svn" class="headerlink" title="git svn"></a><code>git svn</code></h4><p>The base command in Git for all the Subversion bridging commands is <code>git svn</code>. It takes quite a few commands, so we’ll show the most common while going through a few simple workflows.</p>
<p>It’s important to note that when you’re using <code>git svn</code>, you’re interacting with Subversion, which is a system that works very differently from Git. Although you <strong>can</strong> do local branching and merging, it’s generally best to keep your history as linear as possible by rebasing your work, and avoiding doing things like simultaneously interacting with a Git remote repository.</p>
<p>Don’t rewrite your history and try to push again, and don’t push to a parallel Git repository to collaborate with fellow Git developers at the same time. Subversion can have only a single linear history, and confusing it is very easy. If you’re working with a team, and some are using SVN and others are using Git, make sure everyone is using the SVN server to collaborate – doing so will make your life easier.</p>
<h4 id="Setting-Up"><a href="#Setting-Up" class="headerlink" title="Setting Up"></a>Setting Up</h4><p>To demonstrate this functionality, you need a typical SVN repository that you have write access to. If you want to copy these examples, you’ll have to make a writeable copy of an SVN test repository. In order to do that easily, you can use a tool called <code>svnsync</code> that comes with Subversion.</p>
<p>To follow along, you first need to create a new local Subversion repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /tmp/<span class="built_in">test</span>-svn</span><br><span class="line">$ svnadmin create /tmp/<span class="built_in">test</span>-svn</span><br></pre></td></tr></table></figure>
<p>Then, enable all users to change revprops – the easy way is to add a <code>pre-revprop-change</code> script that always exits 0:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tmp/<span class="built_in">test</span>-svn/hooks/pre-revprop-change</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">exit</span> 0;</span><br><span class="line">$ chmod +x /tmp/<span class="built_in">test</span>-svn/hooks/pre-revprop-change</span><br></pre></td></tr></table></figure>
<p>You can now sync this project to your local machine by calling <code>svnsync init</code> with the to and from repositories.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ svnsync init [file:///tmp/<span class="built_in">test</span>-svn](file:///tmp/<span class="built_in">test</span>-svn) \</span><br><span class="line">  [http://your-svn-server.example.org/svn/](http://your-svn-server.example.org/svn/)</span><br></pre></td></tr></table></figure>
<p>This sets up the properties to run the sync. You can then clone the code by running</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ svnsync sync [file:///tmp/<span class="built_in">test</span>-svn](file:///tmp/<span class="built_in">test</span>-svn)</span><br><span class="line">Committed revision 1.</span><br><span class="line">Copied properties <span class="keyword">for</span> revision 1.</span><br><span class="line">Transmitting file data .............................[...]</span><br><span class="line">Committed revision 2.</span><br><span class="line">Copied properties <span class="keyword">for</span> revision 2.</span><br><span class="line">[…]</span><br></pre></td></tr></table></figure>
<p>Although this operation may take only a few minutes, if you try to copy the original repository to another remote repository instead of a local one, the process will take nearly an hour, even though there are fewer than 100 commits. Subversion has to clone one revision at a time and then push it back into another repository – it’s ridiculously inefficient, but it’s the only easy way to do this.</p>
<h4 id="Getting-Started-1"><a href="#Getting-Started-1" class="headerlink" title="Getting Started"></a>Getting Started</h4><p>Now that you have a Subversion repository to which you have write access, you can go through a typical workflow. You’ll start with the <code>git svn clone</code> command, which imports an entire Subversion repository into a local Git repository. Remember that if you’re importing from a real hosted Subversion repository, you should replace the <code>[file:///tmp/test-svn](file:///tmp/test-svn)</code> here with the URL of your Subversion repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git svn <span class="built_in">clone</span> [file:///tmp/<span class="built_in">test</span>-svn](file:///tmp/<span class="built_in">test</span>-svn) -T trunk -b branches -t tags</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /private/tmp/progit/<span class="built_in">test</span>-svn/.git/</span><br><span class="line">r1 = dcbfb5891860124cc2e8cc616cded42624897125 (refs/remotes/origin/trunk)</span><br><span class="line">    A	m4/acx_pthread.m4</span><br><span class="line">    A	m4/stl_hash.m4</span><br><span class="line">    A	java/src/<span class="built_in">test</span>/java/com/google/protobuf/UnknownFieldSetTest.java</span><br><span class="line">    A	java/src/<span class="built_in">test</span>/java/com/google/protobuf/WireFormatTest.java</span><br><span class="line">…</span><br><span class="line">r75 = 556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae (refs/remotes/origin/trunk)</span><br><span class="line">Found possible branch point: [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) =&gt; [file:///tmp/<span class="built_in">test</span>-svn/branches/my-calc-branch](file:///tmp/<span class="built_in">test</span>-svn/branches/my-calc-branch), 75</span><br><span class="line">Found branch parent: (refs/remotes/origin/my-calc-branch) 556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae</span><br><span class="line">Following parent with do_switch</span><br><span class="line">Successfully followed parent</span><br><span class="line">r76 = 0fb585761df569eaecd8146c71e58d70147460a2 (refs/remotes/origin/my-calc-branch)</span><br><span class="line">Checked out HEAD:</span><br><span class="line">  [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) r75</span><br></pre></td></tr></table></figure>
<p>This runs the equivalent of two commands – <code>git svn init</code> followed by <code>git svn fetch</code> – on the URL you provide. This can take a while. If, for example, the test project has only about 75 commits and the codebase isn’t that big, Git nevertheless must check out each version, one at a time, and commit it individually. For a project with hundreds or thousands of commits, this can literally take hours or even days to finish.</p>
<p>The <code>-T trunk -b branches -t tags</code> part tells Git that this Subversion repository follows the basic branching and tagging conventions. If you name your trunk, branches, or tags differently, you can change these options. Because this is so common, you can replace this entire part with <code>-s</code>, which means standard layout and implies all those options. The following command is equivalent:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git svn <span class="built_in">clone</span> [file:///tmp/<span class="built_in">test</span>-svn](file:///tmp/<span class="built_in">test</span>-svn) -s</span><br></pre></td></tr></table></figure>
<p>At this point, you should have a valid Git repository that has imported your branches and tags:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/my-calc-branch</span><br><span class="line">  remotes/origin/tags/2.0.2</span><br><span class="line">  remotes/origin/tags/release-2.0.1</span><br><span class="line">  remotes/origin/tags/release-2.0.2</span><br><span class="line">  remotes/origin/tags/release-2.0.2rc1</span><br><span class="line">  remotes/origin/trunk</span><br></pre></td></tr></table></figure>
<p>Note how this tool manages Subversion tags as remote refs. Let’s take a closer look with the Git plumbing command <code>show-ref</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git show-ref</span><br><span class="line">556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae refs/heads/master</span><br><span class="line">0fb585761df569eaecd8146c71e58d70147460a2 refs/remotes/origin/my-calc-branch</span><br><span class="line">bfd2d79303166789fc73af4046651a4b35c12f0b refs/remotes/origin/tags/2.0.2</span><br><span class="line">285c2b2e36e467dd4d91c8e3c0c0e1750b3fe8ca refs/remotes/origin/tags/release-2.0.1</span><br><span class="line">cbda99cb45d9abcb9793db1d4f70ae562a969f1e refs/remotes/origin/tags/release-2.0.2</span><br><span class="line">a9f074aa89e826d6f9d30808ce5ae3ffe711feda refs/remotes/origin/tags/release-2.0.2rc1</span><br><span class="line">556a3e1e7ad1fde0a32823fc7e4d046bcfd86dae refs/remotes/origin/trunk</span><br></pre></td></tr></table></figure>
<p>Git doesn’t do this when it clones from a Git server; here’s what a repository with tags looks like after a fresh clone:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git show-ref</span><br><span class="line">c3dcbe8488c6240392e8a5d7553bbffcb0f94ef0 refs/remotes/origin/master</span><br><span class="line">32ef1d1c7cc8c603ab78416262cc421b80a8c2df refs/remotes/origin/branch-1</span><br><span class="line">75f703a3580a9b81ead89fe1138e6da858c5ba18 refs/remotes/origin/branch-2</span><br><span class="line">23f8588dde934e8f33c263c6d8359b2ae095f863 refs/tags/v0.1.0</span><br><span class="line">7064938bd5e7ef47bfd79a685a62c1e2649e2ce7 refs/tags/v0.2.0</span><br><span class="line">6dcb09b5b57875f334f61aebed695e2e4193db5e refs/tags/v1.0.0</span><br></pre></td></tr></table></figure>
<p>Git fetches the tags directly into <code>refs/tags</code>, rather than treating them remote branches.</p>
<h4 id="Committing-Back-to-Subversion"><a href="#Committing-Back-to-Subversion" class="headerlink" title="Committing Back to Subversion"></a>Committing Back to Subversion</h4><p>Now that you have a working directory, you can do some work on the project and push your commits back upstream, using Git effectively as an SVN client. If you edit one of the files and commit it, you have a commit that exists in Git locally that doesn’t exist on the Subversion server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">'Adding git-svn instructions to the README'</span></span><br><span class="line">[master 4af61fd] Adding git-svn instructions to the README</span><br><span class="line"> 1 file changed, 5 insertions(+)</span><br></pre></td></tr></table></figure>
<p>Next, you need to push your change upstream. Notice how this changes the way you work with Subversion – you can do several commits offline and then push them all at once to the Subversion server. To push to a Subversion server, you run the <code>git svn dcommit</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git svn dcommit</span><br><span class="line">Committing to [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) ...</span><br><span class="line">    M	README.txt</span><br><span class="line">Committed r77</span><br><span class="line">    M	README.txt</span><br><span class="line">r77 = 95e0222ba6399739834380eb10afcd73e0670bc5 (refs/remotes/origin/trunk)</span><br><span class="line">No changes between 4af61fd05045e07598c553167e0f31c84fd6ffe1 and refs/remotes/origin/trunk</span><br><span class="line">Resetting to the latest refs/remotes/origin/trunk</span><br></pre></td></tr></table></figure>
<p>This takes all the commits you’ve made on top of the Subversion server code, does a Subversion commit for each, and then rewrites your local Git commit to include a unique identifier. This is important because it means that all the SHA-1 checksums for your commits change. Partly for this reason, working with Git-based remote versions of your projects concurrently with a Subversion server isn’t a good idea. If you look at the last commit, you can see the new <code>git-svn-id</code> that was added:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -1</span><br><span class="line">commit 95e0222ba6399739834380eb10afcd73e0670bc5</span><br><span class="line">Author: ben &lt;ben@0b684db3-b064-4277-89d1-21af03df0a68&gt;</span><br><span class="line">Date:   Thu Jul 24 03:08:36 2014 +0000</span><br><span class="line"></span><br><span class="line">    Adding git-svn instructions to the README</span><br><span class="line"></span><br><span class="line">    git-svn-id: [file:///tmp/<span class="built_in">test</span>-svn/trunk@77](file:///tmp/<span class="built_in">test</span>-svn/trunk@77) 0b684db3-b064-4277-89d1-21af03df0a68</span><br></pre></td></tr></table></figure>
<p>Notice that the SHA-1 checksum that originally started with <code>4af61fd</code> when you committed now begins with <code>95e0222</code>. If you want to push to both a Git server and a Subversion server, you have to push (<code>dcommit</code>) to the Subversion server first, because that action changes your commit data.</p>
<h4 id="Pulling-in-New-Changes"><a href="#Pulling-in-New-Changes" class="headerlink" title="Pulling in New Changes"></a>Pulling in New Changes</h4><p>If you’re working with other developers, then at some point one of you will push, and then the other one will try to push a change that conflicts. That change will be rejected until you merge in their work. In <code>git svn</code>, it looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git svn dcommit</span><br><span class="line">Committing to [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) ...</span><br><span class="line"></span><br><span class="line">ERROR from SVN:</span><br><span class="line">Transaction is out of date: File <span class="string">'/trunk/README.txt'</span> is out of date</span><br><span class="line">W: d5837c4b461b7c0e018b49d12398769d2bfc240a and refs/remotes/origin/trunk differ, using rebase:</span><br><span class="line">:100644 100644 f414c433af0fd6734428cf9d2a9fd8ba00ada145 c80b6127dd04f5fcda218730ddf3a2da4eb39138 M	README.txt</span><br><span class="line">Current branch master is up to date.</span><br><span class="line">ERROR: Not all changes have been committed into SVN, however the committed</span><br><span class="line">ones (<span class="keyword">if</span> any) seem to be successfully integrated into the working tree.</span><br><span class="line">Please see the above messages <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>
<p>To resolve this situation, you can run <code>git svn rebase</code>, which pulls down any changes on the server that you don’t have yet and rebases any work you have on top of what is on the server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git svn rebase</span><br><span class="line">Committing to [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) ...</span><br><span class="line"></span><br><span class="line">ERROR from SVN:</span><br><span class="line">Transaction is out of date: File <span class="string">'/trunk/README.txt'</span> is out of date</span><br><span class="line">W: eaa029d99f87c5c822c5c29039d19111ff32ef46 and refs/remotes/origin/trunk differ, using rebase:</span><br><span class="line">:100644 100644 65536c6e30d263495c17d781962cfff12422693a b34372b25ccf4945fe5658fa381b075045e7702a M	README.txt</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: update foo</span><br><span class="line">Using index info to reconstruct a base tree...</span><br><span class="line">M	README.txt</span><br><span class="line">Falling back to patching base and 3-way merge...</span><br><span class="line">Auto-merging README.txt</span><br><span class="line">ERROR: Not all changes have been committed into SVN, however the committed</span><br><span class="line">ones (<span class="keyword">if</span> any) seem to be successfully integrated into the working tree.</span><br><span class="line">Please see the above messages <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>
<p>Now, all your work is on top of what is on the Subversion server, so you can successfully <code>dcommit</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git svn dcommit</span><br><span class="line">Committing to [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) ...</span><br><span class="line">    M	README.txt</span><br><span class="line">Committed r85</span><br><span class="line">    M	README.txt</span><br><span class="line">r85 = 9c29704cc0bbbed7bd58160cfb66cb9191835cd8 (refs/remotes/origin/trunk)</span><br><span class="line">No changes between 5762f56732a958d6cfda681b661d2a239cc53ef5 and refs/remotes/origin/trunk</span><br><span class="line">Resetting to the latest refs/remotes/origin/trunk</span><br></pre></td></tr></table></figure>
<p>Note that unlike Git, which requires you to merge upstream work you don’t yet have locally before you can push, <code>git svn</code> makes you do that only if the changes conflict (much like how Subversion works). If someone else pushes a change to one file and then you push a change to another file, your <code>dcommit</code> will work fine:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git svn dcommit</span><br><span class="line">Committing to [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) ...</span><br><span class="line">    M	configure.ac</span><br><span class="line">Committed r87</span><br><span class="line">    M	autogen.sh</span><br><span class="line">r86 = d8450bab8a77228a644b7dc0e95977ffc61adff7 (refs/remotes/origin/trunk)</span><br><span class="line">    M	configure.ac</span><br><span class="line">r87 = f3653ea40cb4e26b6281cec102e35dcba1fe17c4 (refs/remotes/origin/trunk)</span><br><span class="line">W: a0253d06732169107aa020390d9fefd2b1d92806 and refs/remotes/origin/trunk differ, using rebase:</span><br><span class="line">:100755 100755 efa5a59965fbbb5b2b0a12890f1b351bb5493c18 e757b59a9439312d80d5d43bb65d4a7d0389ed6d M	autogen.sh</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br></pre></td></tr></table></figure>
<p>This is important to remember, because the outcome is a project state that didn’t exist on either of your computers when you pushed. If the changes are incompatible but don’t conflict, you may get issues that are difficult to diagnose. This is different than using a Git server – in Git, you can fully test the state on your client system before publishing it, whereas in SVN, you can’t ever be certain that the states immediately before commit and after commit are identical.</p>
<p>You should also run this command to pull in changes from the Subversion server, even if you’re not ready to commit yourself. You can run <code>git svn fetch</code> to grab the new data, but <code>git svn rebase</code> does the fetch and then updates your local commits.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git svn rebase</span><br><span class="line">    M	autogen.sh</span><br><span class="line">r88 = c9c5f83c64bd755368784b444bc7a0216cc1e17b (refs/remotes/origin/trunk)</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Fast-forwarded master to refs/remotes/origin/trunk.</span><br></pre></td></tr></table></figure>
<p>Running <code>git svn rebase</code> every once in a while makes sure your code is always up to date. You need to be sure your working directory is clean when you run this, though. If you have local changes, you must either stash your work or temporarily commit it before running <code>git svn rebase</code> – otherwise, the command will stop if it sees that the rebase will result in a merge conflict.</p>
<h4 id="Git-Branching-Issues"><a href="#Git-Branching-Issues" class="headerlink" title="Git Branching Issues"></a>Git Branching Issues</h4><p>When you’ve become comfortable with a Git workflow, you’ll likely create topic branches, do work on them, and then merge them in. If you’re pushing to a Subversion server via <code>git svn</code>, you may want to rebase your work onto a single branch each time instead of merging branches together. The reason to prefer rebasing is that Subversion has a linear history and doesn’t deal with merges like Git does, so <code>git svn</code> follows only the first parent when converting the snapshots into Subversion commits.</p>
<p>Suppose your history looks like the following: you created an <code>experiment</code> branch, did two commits, and then merged them back into <code>master</code>. When you <code>dcommit</code>, you see output like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git svn dcommit</span><br><span class="line">Committing to [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) ...</span><br><span class="line">    M	CHANGES.txt</span><br><span class="line">Committed r89</span><br><span class="line">    M	CHANGES.txt</span><br><span class="line">r89 = 89d492c884ea7c834353563d5d913c6adf933981 (refs/remotes/origin/trunk)</span><br><span class="line">    M	COPYING.txt</span><br><span class="line">    M	INSTALL.txt</span><br><span class="line">Committed r90</span><br><span class="line">    M	INSTALL.txt</span><br><span class="line">    M	COPYING.txt</span><br><span class="line">r90 = cb522197870e61467473391799148f6721bcf9a0 (refs/remotes/origin/trunk)</span><br><span class="line">No changes between 71af502c214ba13123992338569f4669877f55fd and refs/remotes/origin/trunk</span><br><span class="line">Resetting to the latest refs/remotes/origin/trunk</span><br></pre></td></tr></table></figure>
<p>Running <code>dcommit</code> on a branch with merged history works fine, except that when you look at your Git project history, it hasn’t rewritten either of the commits you made on the <code>experiment</code> branch – instead, all those changes appear in the SVN version of the single merge commit.</p>
<p>When someone else clones that work, all they see is the merge commit with all the work squashed into it, as though you ran <code>git merge --squash</code>; they don’t see the commit data about where it came from or when it was committed.</p>
<h4 id="Subversion-Branching"><a href="#Subversion-Branching" class="headerlink" title="Subversion Branching"></a>Subversion Branching</h4><p>Branching in Subversion isn’t the same as branching in Git; if you can avoid using it much, that’s probably best. However, you can create and commit to branches in Subversion using <code>git svn</code>.</p>
<h4 id="Creating-a-New-SVN-Branch"><a href="#Creating-a-New-SVN-Branch" class="headerlink" title="Creating a New SVN Branch"></a>Creating a New SVN Branch</h4><p>To create a new branch in Subversion, you run <code>git svn branch [new-branch]</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git svn branch opera</span><br><span class="line">Copying [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) at r90 to [file:///tmp/<span class="built_in">test</span>-svn/branches/opera](file:///tmp/<span class="built_in">test</span>-svn/branches/opera)...</span><br><span class="line">Found possible branch point: [file:///tmp/<span class="built_in">test</span>-svn/trunk](file:///tmp/<span class="built_in">test</span>-svn/trunk) =&gt; [file:///tmp/<span class="built_in">test</span>-svn/branches/opera](file:///tmp/<span class="built_in">test</span>-svn/branches/opera), 90</span><br><span class="line">Found branch parent: (refs/remotes/origin/opera) cb522197870e61467473391799148f6721bcf9a0</span><br><span class="line">Following parent with do_switch</span><br><span class="line">Successfully followed parent</span><br><span class="line">r91 = f1b64a3855d3c8dd84ee0ef10fa89d27f1584302 (refs/remotes/origin/opera)</span><br></pre></td></tr></table></figure>
<p>This does the equivalent of the <code>svn copy trunk branches/opera</code> command in Subversion and operates on the Subversion server. It’s important to note that it doesn’t check you out into that branch; if you commit at this point, that commit will go to <code>trunk</code> on the server, not <code>opera</code>.</p>
<h4 id="Switching-Active-Branches"><a href="#Switching-Active-Branches" class="headerlink" title="Switching Active Branches"></a>Switching Active Branches</h4><p>Git figures out what branch your dcommits go to by looking for the tip of any of your Subversion branches in your history – you should have only one, and it should be the last one with a <code>git-svn-id</code> in your current branch history.</p>
<p>If you want to work on more than one branch simultaneously, you can set up local branches to <code>dcommit</code> to specific Subversion branches by starting them at the imported Subversion commit for that branch. If you want an <code>opera</code> branch that you can work on separately, you can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch opera remotes/origin/opera</span><br></pre></td></tr></table></figure>
<p>Now, if you want to merge your <code>opera</code> branch into <code>trunk</code> (your <code>master</code> branch), you can do so with a normal <code>git merge</code>. But you need to provide a descriptive commit message (via <code>-m</code>), or the merge will say “Merge branch opera” instead of something useful.</p>
<p>Remember that although you’re using <code>git merge</code> to do this operation, and the merge likely will be much easier than it would be in Subversion (because Git will automatically detect the appropriate merge base for you), this isn’t a normal Git merge commit. You have to push this data back to a Subversion server that can’t handle a commit that tracks more than one parent; so, after you push it up, it will look like a single commit that squashed in all the work of another branch under a single commit. After you merge one branch into another, you can’t easily go back and continue working on that branch, as you normally can in Git. The <code>dcommit</code> command that you run erases any information that says what branch was merged in, so subsequent merge-base calculations will be wrong – the <code>dcommit</code> makes your <code>git merge</code> result look like you ran <code>git merge --squash</code>. Unfortunately, there’s no good way to avoid this situation – Subversion can’t store this information, so you’ll always be crippled by its limitations while you’re using it as your server. To avoid issues, you should delete the local branch (in this case, <code>opera</code>) after you merge it into trunk.</p>
<h4 id="Subversion-Commands"><a href="#Subversion-Commands" class="headerlink" title="Subversion Commands"></a>Subversion Commands</h4><p>The <code>git svn</code> toolset provides a number of commands to help ease the transition to Git by providing some functionality that’s similar to what you had in Subversion. Here are a few commands that give you what Subversion used to.</p>
<h5 id="SVN-Style-History"><a href="#SVN-Style-History" class="headerlink" title="SVN Style History"></a>SVN Style History</h5><p>If you’re used to Subversion and want to see your history in SVN output style, you can run <code>git svn log</code> to view your commit history in SVN formatting:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git svn <span class="built_in">log</span></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">r87 | schacon | 2014-05-02 16:07:37 -0700 (Sat, 02 May 2014) | 2 lines</span><br><span class="line"></span><br><span class="line">autogen change</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">r86 | schacon | 2014-05-02 16:00:21 -0700 (Sat, 02 May 2014) | 2 lines</span><br><span class="line"></span><br><span class="line">Merge branch <span class="string">'experiment'</span></span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">r85 | schacon | 2014-05-02 16:00:09 -0700 (Sat, 02 May 2014) | 2 lines</span><br><span class="line"></span><br><span class="line">updated the changelog</span><br></pre></td></tr></table></figure>
<p>You should know two important things about <code>git svn log</code>. First, it works offline, unlike the real <code>svn log</code> command, which asks the Subversion server for the data. Second, it only shows you commits that have been committed up to the Subversion server. Local Git commits that you haven’t dcommited don’t show up; neither do commits that people have made to the Subversion server in the meantime. It’s more like the last known state of the commits on the Subversion server.</p>
<h5 id="SVN-Annotation"><a href="#SVN-Annotation" class="headerlink" title="SVN Annotation"></a>SVN Annotation</h5><p>Much as the <code>git svn log</code> command simulates the <code>svn log</code> command offline, you can get the equivalent of <code>svn annotate</code> by running <code>git svn blame [FILE]</code>. The output looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git svn blame README.txt</span><br><span class="line"> 2   temporal Protocol Buffers - Google<span class="string">'s data interchange format</span></span><br><span class="line"><span class="string"> 2   temporal Copyright 2008 Google Inc.</span></span><br><span class="line"><span class="string"> 2   temporal [http://code.google.com/apis/protocolbuffers/](http://code.google.com/apis/protocolbuffers/)</span></span><br><span class="line"><span class="string"> 2   temporal</span></span><br><span class="line"><span class="string">22   temporal C++ Installation - Unix</span></span><br><span class="line"><span class="string">22   temporal =======================</span></span><br><span class="line"><span class="string"> 2   temporal</span></span><br><span class="line"><span class="string">79    schacon Committing in git-svn.</span></span><br><span class="line"><span class="string">78    schacon</span></span><br><span class="line"><span class="string"> 2   temporal To build and install the C++ Protocol Buffer runtime and the Protocol</span></span><br><span class="line"><span class="string"> 2   temporal Buffer compiler (protoc) execute the following:</span></span><br><span class="line"><span class="string"> 2   temporal</span></span><br></pre></td></tr></table></figure>
<p>Again, it doesn’t show commits that you did locally in Git or that have been pushed to Subversion in the meantime.</p>
<h5 id="SVN-Server-Information"><a href="#SVN-Server-Information" class="headerlink" title="SVN Server Information"></a>SVN Server Information</h5><p>You can also get the same sort of information that <code>svn info</code> gives you by running <code>git svn info</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git svn info</span><br><span class="line">Path: .</span><br><span class="line">URL: [https://schacon-test.googlecode.com/svn/trunk](https://schacon-test.googlecode.com/svn/trunk)</span><br><span class="line">Repository Root: [https://schacon-test.googlecode.com/svn](https://schacon-test.googlecode.com/svn)</span><br><span class="line">Repository UUID: 4c93b258-373f-11de-be05-5f7a86268029</span><br><span class="line">Revision: 87</span><br><span class="line">Node Kind: directory</span><br><span class="line">Schedule: normal</span><br><span class="line">Last Changed Author: schacon</span><br><span class="line">Last Changed Rev: 87</span><br><span class="line">Last Changed Date: 2009-05-02 16:07:37 -0700 (Sat, 02 May 2009)</span><br></pre></td></tr></table></figure>
<p>This is like <code>blame</code> and <code>log</code> in that it runs offline and is up to date only as of the last time you communicated with the Subversion server.</p>
<h5 id="Ignoring-What-Subversion-Ignores"><a href="#Ignoring-What-Subversion-Ignores" class="headerlink" title="Ignoring What Subversion Ignores"></a>Ignoring What Subversion Ignores</h5><p>If you clone a Subversion repository that has <code>svn:ignore</code> properties set anywhere, you’ll likely want to set corresponding <code>.gitignore</code> files so you don’t accidentally commit files that you shouldn’t. <code>git svn</code> has two commands to help with this issue. The first is <code>git svn create-ignore</code>, which automatically creates corresponding <code>.gitignore</code> files for you so your next commit can include them.</p>
<p>The second command is <code>git svn show-ignore</code>, which prints to stdout the lines you need to put in a <code>.gitignore</code> file so you can redirect the output into your project exclude file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git svn show-ignore &gt; .git/info/exclude</span><br></pre></td></tr></table></figure>
<p>That way, you don’t litter the project with <code>.gitignore</code> files. This is a good option if you’re the only Git user on a Subversion team, and your teammates don’t want <code>.gitignore</code> files in the project.</p>
<h4 id="Git-Svn-Summary"><a href="#Git-Svn-Summary" class="headerlink" title="Git-Svn Summary"></a>Git-Svn Summary</h4><p>The <code>git svn</code> tools are useful if you’re stuck with a Subversion server, or are otherwise in a development environment that necessitates running a Subversion server. You should consider it crippled Git, however, or you’ll hit issues in translation that may confuse you and your collaborators. To stay out of trouble, try to follow these guidelines:</p>
<ul>
<li>Keep a linear Git history that doesn’t contain merge commits made by <code>git merge</code>. Rebase any work you do outside of your mainline branch back onto it; don’t merge it in.</li>
<li>Don’t set up and collaborate on a separate Git server. Possibly have one to speed up clones for new developers, but don’t push anything to it that doesn’t have a <code>git-svn-id</code> entry. You may even want to add a <code>pre-receive</code> hook that checks each commit message for a <code>git-svn-id</code> and rejects pushes that contain commits without it.<br>If you follow those guidelines, working with a Subversion server can be more bearable. However, if it’s possible to move to a real Git server, doing so can gain your team a lot more.</li>
</ul>
<h3 id="Git-and-Mercurial"><a href="#Git-and-Mercurial" class="headerlink" title="Git and Mercurial"></a>Git and Mercurial</h3><p>The DVCS universe is larger than just Git. In fact, there are many other systems in this space, each with their own angle on how to do distributed version control correctly. Apart from Git, the most popular is Mercurial, and the two are very similar in many respects.</p>
<p>The good news, if you prefer Git’s client-side behavior but are working with a project whose source code is controlled with Mercurial, is that there’s a way to use Git as a client for a Mercurial-hosted repository. Since the way Git talks to server repositories is through remotes, it should come as no surprise that this bridge is implemented as a remote helper. The project’s name is git-remote-hg, and it can be found at &lt;<a href="https://github.com/felipec/git-remote-hg" target="_blank" rel="noopener">https://github.com/felipec/git-remote-hg</a>&gt;.</p>
<h4 id="git-remote-hg"><a href="#git-remote-hg" class="headerlink" title="git-remote-hg"></a>git-remote-hg</h4><p>First, you need to install git-remote-hg. This basically entails dropping its file somewhere in your path, like so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl -o ~/bin/git-remote-hg \</span><br><span class="line">  [https://raw.githubusercontent.com/felipec/git-remote-hg/master/git-remote-hg](https://raw.githubusercontent.com/felipec/git-remote-hg/master/git-remote-hg)</span><br><span class="line">$ chmod +x ~/bin/git-remote-hg</span><br></pre></td></tr></table></figure>
<p>…assuming <code>~/bin</code> is in your <code>$PATH</code>. Git-remote-hg has one other dependency: the <code>mercurial</code> library for Python. If you have Python installed, this is as simple as:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install mercurial</span><br></pre></td></tr></table></figure>
<p>(If you don’t have Python installed, visit &lt;<a href="https://www.python.org/" target="_blank" rel="noopener">https://www.python.org/</a>&gt; and get it first.)</p>
<p>The last thing you’ll need is the Mercurial client. Go to &lt;<a href="https://www.mercurial-scm.org/" target="_blank" rel="noopener">https://www.mercurial-scm.org/</a>&gt; and install it if you haven’t already.</p>
<p>Now you’re ready to rock. All you need is a Mercurial repository you can push to. Fortunately, every Mercurial repository can act this way, so we’ll just use the “hello world” repository everyone uses to learn Mercurial:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hg <span class="built_in">clone</span> [http://selenic.com/repo/hello](http://selenic.com/repo/hello) /tmp/hello</span><br></pre></td></tr></table></figure>
<h4 id="Getting-Started-2"><a href="#Getting-Started-2" class="headerlink" title="Getting Started"></a>Getting Started</h4><p>Now that we have a suitable “server-side” repository, we can go through a typical workflow. As you’ll see, these two systems are similar enough that there isn’t much friction.</p>
<p>As always with Git, first we clone:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> hg::/tmp/hello /tmp/hello-git</span><br><span class="line">$ <span class="built_in">cd</span> /tmp/hello-git</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate</span><br><span class="line">* ac7955c (HEAD, origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master, master) Create a makefile</span><br><span class="line">* 65bb417 Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>You’ll notice that working with a Mercurial repository uses the standard <code>git clone</code> command. That’s because git-remote-hg is working at a fairly low level, using a similar mechanism to how Git’s HTTP/S protocol is implemented (remote helpers). Since Git and Mercurial are both designed for every client to have a full copy of the repository history, this command makes a full clone, including all the project’s history, and does it fairly quickly.</p>
<p>The log command shows two commits, the latest of which is pointed to by a whole slew of refs. It turns out some of these aren’t actually there. Let’s take a look at what’s actually in the <code>.git</code> directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ tree .git/refs</span><br><span class="line">.git/refs</span><br><span class="line">├── heads</span><br><span class="line">│  └── master</span><br><span class="line">├── hg</span><br><span class="line">│  └── origin</span><br><span class="line">│      ├── bookmarks</span><br><span class="line">│      │  └── master</span><br><span class="line">│      └── branches</span><br><span class="line">│          └── default</span><br><span class="line">├── notes</span><br><span class="line">│  └── hg</span><br><span class="line">├── remotes</span><br><span class="line">│  └── origin</span><br><span class="line">│      └── HEAD</span><br><span class="line">└── tags</span><br><span class="line"></span><br><span class="line">9 directories, 5 files</span><br></pre></td></tr></table></figure>
<p>Git-remote-hg is trying to make things more idiomatically Git-esque, but under the hood it’s managing the conceptual mapping between two slightly different systems. The <code>refs/hg</code> directory is where the actual remote refs are stored. For example, the <code>refs/hg/origin/branches/default</code> is a Git ref file that contains the SHA-1 starting with “ac7955c”, which is the commit that <code>master</code> points to. So the <code>refs/hg</code> directory is kind of like a fake <code>refs/remotes/origin</code>, but it has the added distinction between bookmarks and branches.</p>
<p>The <code>notes/hg</code> file is the starting point for how git-remote-hg maps Git commit hashes to Mercurial changeset IDs. Let’s explore a bit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat notes/hg</span><br><span class="line">d4c10386...</span><br><span class="line"></span><br><span class="line">$ git cat-file -p d4c10386...</span><br><span class="line">tree 1781c96...</span><br><span class="line">author remote-hg &lt;&gt; 1408066400 -0800</span><br><span class="line">committer remote-hg &lt;&gt; 1408066400 -0800</span><br><span class="line"></span><br><span class="line">Notes <span class="keyword">for</span> master</span><br><span class="line"></span><br><span class="line">$ git ls-tree 1781c96...</span><br><span class="line">100644 blob ac9117f...	65bb417...</span><br><span class="line">100644 blob 485e178...	ac7955c...</span><br><span class="line"></span><br><span class="line">$ git cat-file -p ac9117f</span><br><span class="line">0a04b987be5ae354b710cefeba0e2d9de7ad41a9</span><br></pre></td></tr></table></figure>
<p>So <code>refs/notes/hg</code> points to a tree, which in the Git object database is a list of other objects with names. <code>git ls-tree</code> outputs the mode, type, object hash, and filename for items inside a tree. Once we dig down to one of the tree items, we find that inside it is a blob named “ac9117f” (the SHA-1 hash of the commit pointed to by <code>master</code>), with contents “0a04b98” (which is the ID of the Mercurial changeset at the tip of the <code>default</code> branch).</p>
<p>The good news is that we mostly don’t have to worry about all of this. The typical workflow won’t be very different from working with a Git remote.</p>
<p>There’s one more thing we should attend to before we continue: ignores. Mercurial and Git use a very similar mechanism for this, but it’s likely you don’t want to actually commit a <code>.gitignore</code> file into a Mercurial repository. Fortunately, Git has a way to ignore files that’s local to an on-disk repository, and the Mercurial format is compatible with Git, so you just have to copy it over:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp .hgignore .git/info/exclude</span><br></pre></td></tr></table></figure>
<p>The <code>.git/info/exclude</code> file acts just like a <code>.gitignore</code>, but isn’t included in commits.</p>
<h4 id="Workflow"><a href="#Workflow" class="headerlink" title="Workflow"></a>Workflow</h4><p>Let’s assume we’ve done some work and made some commits on the <code>master</code> branch, and you’re ready to push it to the remote repository. Here’s what our repository looks like right now:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate</span><br><span class="line">* ba04a2a (HEAD, master) Update makefile</span><br><span class="line">* d25d16f Goodbye</span><br><span class="line">* ac7955c (origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master) Create a makefile</span><br><span class="line">* 65bb417 Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>Our <code>master</code> branch is two commits ahead of <code>origin/master</code>, but those two commits exist only on our local machine. Let’s see if anyone else has been doing important work at the same time:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch</span><br><span class="line">From hg::/tmp/hello</span><br><span class="line">   ac7955c..df85e87  master     -&gt; origin/master</span><br><span class="line">   ac7955c..df85e87  branches/default -&gt; origin/branches/default</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 7b07969 (refs/notes/hg) Notes <span class="keyword">for</span> default</span><br><span class="line">* d4c1038 Notes <span class="keyword">for</span> master</span><br><span class="line">* df85e87 (origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master) Add some documentation</span><br><span class="line">| * ba04a2a (HEAD, master) Update makefile</span><br><span class="line">| * d25d16f Goodbye</span><br><span class="line">|/</span><br><span class="line">* ac7955c Create a makefile</span><br><span class="line">* 65bb417 Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>Since we used the <code>--all</code> flag, we see the “notes” refs that are used internally by git-remote-hg, but we can ignore them. The rest is what we expected; <code>origin/master</code> has advanced by one commit, and our history has now diverged. Unlike the other systems we work with in this chapter, Mercurial is capable of handling merges, so we’re not going to do anything fancy.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git merge origin/master</span><br><span class="line">Auto-merging hello.c</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> hello.c | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate</span><br><span class="line">*   0c64627 (HEAD, master) Merge remote-tracking branch <span class="string">'origin/master'</span></span><br><span class="line">|\</span><br><span class="line">| * df85e87 (origin/master, origin/branches/default, origin/HEAD, refs/hg/origin/branches/default, refs/hg/origin/bookmarks/master) Add some documentation</span><br><span class="line">* | ba04a2a Update makefile</span><br><span class="line">* | d25d16f Goodbye</span><br><span class="line">|/</span><br><span class="line">* ac7955c Create a makefile</span><br><span class="line">* 65bb417 Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>Perfect. We run the tests and everything passes, so we’re ready to share our work with the rest of the team:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git push</span><br><span class="line">To hg::/tmp/hello</span><br><span class="line">   df85e87..0c64627  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>That’s it! If you take a look at the Mercurial repository, you’ll see that this did what we’d expect:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ hg <span class="built_in">log</span> -G --style compact</span><br><span class="line">o    5[tip]:4,2   dc8fa4f932b8   2014-08-14 19:33 -0700   ben</span><br><span class="line">|\     Merge remote-tracking branch <span class="string">'origin/master'</span></span><br><span class="line">| |</span><br><span class="line">| o  4   64f27bcefc35   2014-08-14 19:27 -0700   ben</span><br><span class="line">| |    Update makefile</span><br><span class="line">| |</span><br><span class="line">| o  3:1   4256fc29598f   2014-08-14 19:27 -0700   ben</span><br><span class="line">| |    Goodbye</span><br><span class="line">| |</span><br><span class="line">@ |  2   7db0b4848b3c   2014-08-14 19:30 -0700   ben</span><br><span class="line">|/     Add some documentation</span><br><span class="line">|</span><br><span class="line">o  1   82e55d328c8c   2005-08-26 01:21 -0700   mpm</span><br><span class="line">|    Create a makefile</span><br><span class="line">|</span><br><span class="line">o  0   0a04b987be5a   2005-08-26 01:20 -0700   mpm</span><br><span class="line">     Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>The changeset numbered <em>2</em> was made by Mercurial, and the changesets numbered <em>3</em> and <em>4</em> were made by git-remote-hg, by pushing commits made with Git.</p>
<h4 id="Branches-and-Bookmarks"><a href="#Branches-and-Bookmarks" class="headerlink" title="Branches and Bookmarks"></a>Branches and Bookmarks</h4><p>Git has only one kind of branch: a reference that moves when commits are made. In Mercurial, this kind of a reference is called a “bookmark,” and it behaves in much the same way as a Git branch.</p>
<p>Mercurial’s concept of a “branch” is more heavyweight. The branch that a changeset is made on is recorded <em>with the changeset</em>, which means it will always be in the repository history. Here’s an example of a commit that was made on the <code>develop</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ hg <span class="built_in">log</span> -l 1</span><br><span class="line">changeset:   6:8f65e5e02793</span><br><span class="line">branch:      develop</span><br><span class="line">tag:         tip</span><br><span class="line">user:        Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">date:        Thu Aug 14 20:06:38 2014 -0700</span><br><span class="line">summary:     More documentation</span><br></pre></td></tr></table></figure>
<p>Note the line that begins with “branch”. Git can’t really replicate this (and doesn’t need to; both types of branch can be represented as a Git ref), but git-remote-hg needs to understand the difference, because Mercurial cares.</p>
<p>Creating Mercurial bookmarks is as easy as creating Git branches. On the Git side:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b featureA</span><br><span class="line">Switched to a new branch <span class="string">'featureA'</span></span><br><span class="line">$ git push origin featureA</span><br><span class="line">To hg::/tmp/hello</span><br><span class="line"> * [new branch]      featureA -&gt; featureA</span><br></pre></td></tr></table></figure>
<p>That’s all there is to it. On the Mercurial side, it looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ hg bookmarks</span><br><span class="line">   featureA                  5:bd5ac26f11f9</span><br><span class="line">$ hg <span class="built_in">log</span> --style compact -G</span><br><span class="line">@  6[tip]   8f65e5e02793   2014-08-14 20:06 -0700   ben</span><br><span class="line">|    More documentation</span><br><span class="line">|</span><br><span class="line">o    5[featureA]:4,2   bd5ac26f11f9   2014-08-14 20:02 -0700   ben</span><br><span class="line">|\     Merge remote-tracking branch <span class="string">'origin/master'</span></span><br><span class="line">| |</span><br><span class="line">| o  4   0434aaa6b91f   2014-08-14 20:01 -0700   ben</span><br><span class="line">| |    update makefile</span><br><span class="line">| |</span><br><span class="line">| o  3:1   318914536c86   2014-08-14 20:00 -0700   ben</span><br><span class="line">| |    goodbye</span><br><span class="line">| |</span><br><span class="line">o |  2   f098c7f45c4f   2014-08-14 20:01 -0700   ben</span><br><span class="line">|/     Add some documentation</span><br><span class="line">|</span><br><span class="line">o  1   82e55d328c8c   2005-08-26 01:21 -0700   mpm</span><br><span class="line">|    Create a makefile</span><br><span class="line">|</span><br><span class="line">o  0   0a04b987be5a   2005-08-26 01:20 -0700   mpm</span><br><span class="line">     Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>Note the new <code>[featureA]</code> tag on revision 5. These act exactly like Git branches on the Git side, with one exception: you can’t delete a bookmark from the Git side (this is a limitation of remote helpers).</p>
<p>You can work on a “heavyweight” Mercurial branch also: just put a branch in the <code>branches</code> namespace:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b branches/permanent</span><br><span class="line">Switched to a new branch <span class="string">'branches/permanent'</span></span><br><span class="line">$ vi Makefile</span><br><span class="line">$ git commit -am <span class="string">'A permanent change'</span></span><br><span class="line">$ git push origin branches/permanent</span><br><span class="line">To hg::/tmp/hello</span><br><span class="line"> * [new branch]      branches/permanent -&gt; branches/permanent</span><br></pre></td></tr></table></figure>
<p>Here’s what that looks like on the Mercurial side:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ hg branches</span><br><span class="line">permanent                      7:a4529d07aad4</span><br><span class="line">develop                        6:8f65e5e02793</span><br><span class="line">default                        5:bd5ac26f11f9 (inactive)</span><br><span class="line">$ hg <span class="built_in">log</span> -G</span><br><span class="line">o  changeset:   7:a4529d07aad4</span><br><span class="line">|  branch:      permanent</span><br><span class="line">|  tag:         tip</span><br><span class="line">|  parent:      5:bd5ac26f11f9</span><br><span class="line">|  user:        Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">|  date:        Thu Aug 14 20:21:09 2014 -0700</span><br><span class="line">|  summary:     A permanent change</span><br><span class="line">|</span><br><span class="line">| @  changeset:   6:8f65e5e02793</span><br><span class="line">|/   branch:      develop</span><br><span class="line">|    user:        Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">|    date:        Thu Aug 14 20:06:38 2014 -0700</span><br><span class="line">|    summary:     More documentation</span><br><span class="line">|</span><br><span class="line">o    changeset:   5:bd5ac26f11f9</span><br><span class="line">|\   bookmark:    featureA</span><br><span class="line">| |  parent:      4:0434aaa6b91f</span><br><span class="line">| |  parent:      2:f098c7f45c4f</span><br><span class="line">| |  user:        Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">| |  date:        Thu Aug 14 20:02:21 2014 -0700</span><br><span class="line">| |  summary:     Merge remote-tracking branch <span class="string">'origin/master'</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>The branch name “permanent” was recorded with the changeset marked <em>7</em>.</p>
<p>From the Git side, working with either of these branch styles is the same: just checkout, commit, fetch, merge, pull, and push as you normally would. One thing you should know is that Mercurial doesn’t support rewriting history, only adding to it. Here’s what our Mercurial repository looks like after an interactive rebase and a force-push:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ hg <span class="built_in">log</span> --style compact -G</span><br><span class="line">o  10[tip]   99611176cbc9   2014-08-14 20:21 -0700   ben</span><br><span class="line">|    A permanent change</span><br><span class="line">|</span><br><span class="line">o  9   f23e12f939c3   2014-08-14 20:01 -0700   ben</span><br><span class="line">|    Add some documentation</span><br><span class="line">|</span><br><span class="line">o  8:1   c16971d33922   2014-08-14 20:00 -0700   ben</span><br><span class="line">|    goodbye</span><br><span class="line">|</span><br><span class="line">| o  7:5   a4529d07aad4   2014-08-14 20:21 -0700   ben</span><br><span class="line">| |    A permanent change</span><br><span class="line">| |</span><br><span class="line">| | @  6   8f65e5e02793   2014-08-14 20:06 -0700   ben</span><br><span class="line">| |/     More documentation</span><br><span class="line">| |</span><br><span class="line">| o    5[featureA]:4,2   bd5ac26f11f9   2014-08-14 20:02 -0700   ben</span><br><span class="line">| |\     Merge remote-tracking branch <span class="string">'origin/master'</span></span><br><span class="line">| | |</span><br><span class="line">| | o  4   0434aaa6b91f   2014-08-14 20:01 -0700   ben</span><br><span class="line">| | |    update makefile</span><br><span class="line">| | |</span><br><span class="line">+---o  3:1   318914536c86   2014-08-14 20:00 -0700   ben</span><br><span class="line">| |      goodbye</span><br><span class="line">| |</span><br><span class="line">| o  2   f098c7f45c4f   2014-08-14 20:01 -0700   ben</span><br><span class="line">|/     Add some documentation</span><br><span class="line">|</span><br><span class="line">o  1   82e55d328c8c   2005-08-26 01:21 -0700   mpm</span><br><span class="line">|    Create a makefile</span><br><span class="line">|</span><br><span class="line">o  0   0a04b987be5a   2005-08-26 01:20 -0700   mpm</span><br><span class="line">     Create a standard <span class="string">"hello, world"</span> program</span><br></pre></td></tr></table></figure>
<p>Changesets <em>8</em>, <em>9</em>, and <em>10</em> have been created and belong to the <code>permanent</code> branch, but the old changesets are still there. This can be <strong>very</strong> confusing for your teammates who are using Mercurial, so try to avoid it.</p>
<h4 id="Mercurial-Summary"><a href="#Mercurial-Summary" class="headerlink" title="Mercurial Summary"></a>Mercurial Summary</h4><p>Git and Mercurial are similar enough that working across the boundary is fairly painless. If you avoid changing history that’s left your machine (as is generally recommended), you may not even be aware that the other end is Mercurial.</p>
<h3 id="Git-and-Bazaar"><a href="#Git-and-Bazaar" class="headerlink" title="Git and Bazaar"></a>Git and Bazaar</h3><p>Among the DVCS, another famous one is <a href="http://bazaar.canonical.com/" target="_blank" rel="noopener">Bazaar</a>. Bazaar is free and open source, and is part of the <a href="http://www.gnu.org/" target="_blank" rel="noopener">GNU Project</a>. It behaves very differently from Git. Sometimes, to do the same thing as with Git, you have to use a different keyword, and some keywords that are common don’t have the same meaning. In particular, the branch management is very different and may cause confusion, especially when someone comes from Git’s universe. Nevertheless, it is possible to work on a Bazaar repository from a Git one.</p>
<p>There are many projects that allow you to use Git as a Bazaar client. Here we’ll use Felipe Contreras’ project that you may find at &lt;<a href="https://github.com/felipec/git-remote-bzr" target="_blank" rel="noopener">https://github.com/felipec/git-remote-bzr</a>&gt;. To install it, you just have to download the file git-remote-bzr in a folder contained in your <code>$PATH</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget [https://raw.github.com/felipec/git-remote-bzr/master/git-remote-bzr](https://raw.github.com/felipec/git-remote-bzr/master/git-remote-bzr) -O ~/bin/git-remote-bzr</span><br><span class="line">$ chmod +x ~/bin/git-remote-bzr</span><br></pre></td></tr></table></figure>
<p>You also need to have Bazaar installed. That’s all!</p>
<h4 id="Create-a-Git-repository-from-a-Bazaar-repository"><a href="#Create-a-Git-repository-from-a-Bazaar-repository" class="headerlink" title="Create a Git repository from a Bazaar repository"></a>Create a Git repository from a Bazaar repository</h4><p>It is simple to use. It is enough to clone a Bazaar repository prefixing it by <code>bzr::</code>. Since Git and Bazaar both do full clones to your machine, it’s possible to attach a Git clone to your local Bazaar clone, but it isn’t recommended. It’s much easier to attach your Git clone directly to the same place your Bazaar clone is attached to ‒ the central repository.</p>
<p>Let’s suppose that you worked with a remote repository which is at address <code>bzr+ssh://developer@mybazaarserver:myproject</code>. Then you must clone it in the following way:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> bzr::bzr+ssh://developer@mybazaarserver:myproject myProject-Git</span><br><span class="line">$ <span class="built_in">cd</span> myProject-Git</span><br></pre></td></tr></table></figure>
<p>At this point, your Git repository is created but it is not compacted for optimal disk use. That’s why you should also clean and compact your Git repository, especially if it is a big one:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git gc --aggressive</span><br></pre></td></tr></table></figure>
<h4 id="Bazaar-branches"><a href="#Bazaar-branches" class="headerlink" title="Bazaar branches"></a>Bazaar branches</h4><p>Bazaar only allows you to clone branches, but a repository may contain several branches, and <code>git-remote-bzr</code> can clone both. For example, to clone a branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> bzr::bzr://bzr.savannah.gnu.org/emacs/trunk emacs-trunk</span><br></pre></td></tr></table></figure>
<p>And to clone the whole repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> bzr::bzr://bzr.savannah.gnu.org/emacs emacs</span><br></pre></td></tr></table></figure>
<p>The second command clones all the branches contained in the emacs repository; nevertheless, it is possible to point out some branches:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config remote-bzr.branches <span class="string">'trunk, xwindow'</span></span><br></pre></td></tr></table></figure>
<p>Some remote repositories don’t allow you to list their branches, in which case you have to manually specify them, and even though you could specify the configuration in the cloning command, you may find this easier:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git init emacs</span><br><span class="line">$ git remote add origin bzr::bzr://bzr.savannah.gnu.org/emacs</span><br><span class="line">$ git config remote-bzr.branches <span class="string">'trunk, xwindow'</span></span><br><span class="line">$ git fetch</span><br></pre></td></tr></table></figure>
<h4 id="Ignore-what-is-ignored-with-bzrignore"><a href="#Ignore-what-is-ignored-with-bzrignore" class="headerlink" title="Ignore what is ignored with .bzrignore"></a>Ignore what is ignored with .bzrignore</h4><p>Since you are working on a project managed with Bazaar, you shouldn’t create a <code>.gitignore</code> file because you <em>may</em> accidentally set it under version control and the other people working with Bazaar would be disturbed. The solution is to create the <code>.git/info/exclude</code> file either as a symbolic link or as a regular file. We’ll see later on how to solve this question.</p>
<p>Bazaar uses the same model as Git to ignore files, but also has two features which don’t have an equivalent into Git. The complete description may be found in <a href="http://doc.bazaar.canonical.com/bzr.2.7/en/user-reference/ignore-help.html" target="_blank" rel="noopener">the documentation</a>. The two features are:</p>
<ol start="2">
<li>“!!” allows you to ignore certain file patterns even if they’re specified using a “!” rule.</li>
<li><p>“RE:” at the beginning of a line allows you to specify a <a href="https://docs.python.org/3/library/re.html" target="_blank" rel="noopener">Python regular expression</a> (Git only allows shell globs).<br>As a consequence, there are two different situations to consider:</p>
</li>
<li><p>If the <code>.bzrignore</code> file does not contain any of these two specific prefixes, then you can simply make a symbolic link to it in the repository: <code>ln -s .bzrignore .git/info/exclude</code></p>
</li>
<li>Otherwise, you must create the <code>.git/info/exclude</code> file and adapt it to ignore exactly the same files in <code>.bzrignore</code>.<br>Whatever the case is, you will have to remain vigilant against any change of <code>.bzrignore</code> to make sure that the <code>.git/info/exclude</code> file always reflects <code>.bzrignore</code>. Indeed, if the <code>.bzrignore</code> file were to change and contained one or more lines starting with “!!” or “RE:”, Git not being able to interpret these lines, you’ll have to adapt your <code>.git/info/exclude</code> file to ignore the same files as the ones ignored with <code>.bzrignore</code>. Moreover, if the <code>.git/info/exclude</code> file was a symbolic link, you’ll have to first delete the symbolic link, copy <code>.bzrignore</code> to <code>.git/info/exclude</code> and then adapt the latter. However, be careful with its creation because with Git it is impossible to re-include a file if a parent directory of that file is excluded.</li>
</ol>
<h4 id="Fetch-the-changes-of-the-remote-repository"><a href="#Fetch-the-changes-of-the-remote-repository" class="headerlink" title="Fetch the changes of the remote repository"></a>Fetch the changes of the remote repository</h4><p>To fetch the changes of the remote, you pull changes as usually, using Git commands. Supposing that your changes are on the <code>master</code> branch, you merge or rebase your work on the <code>origin/master</code> branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git pull --rebase origin</span><br></pre></td></tr></table></figure>
<h4 id="Push-your-work-on-the-remote-repository"><a href="#Push-your-work-on-the-remote-repository" class="headerlink" title="Push your work on the remote repository"></a>Push your work on the remote repository</h4><p>Because Bazaar also has the concept of merge commits, there will be no problem if you push a merge commit. So you can work on a branch, merge the changes into <code>master</code> and push your work. Then, you create your branches, you test and commit your work as usual. You finally push your work to the Bazaar repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<h4 id="Caveats"><a href="#Caveats" class="headerlink" title="Caveats"></a>Caveats</h4><p>Git’s remote-helpers framework has some limitations that apply. In particular, these commands don’t work:</p>
<ul>
<li>git push origin :branch-to-delete (Bazaar can’t accept ref deletions in this way.)</li>
<li>git push origin old:new (it will push <em>old</em>)</li>
<li>git push –dry-run origin branch (it will push)</li>
</ul>
<h4 id="Summary-10"><a href="#Summary-10" class="headerlink" title="Summary"></a>Summary</h4><p>Since Git’s and Bazaar’s models are similar, there isn’t a lot of resistance when working across the boundary. As long as you watch out for the limitations, and are always aware that the remote repository isn’t natively Git, you’ll be fine.</p>
<h3 id="Git-and-Perforce"><a href="#Git-and-Perforce" class="headerlink" title="Git and Perforce"></a>Git and Perforce</h3><p>Perforce is a very popular version-control system in corporate environments. It’s been around since 1995, which makes it the oldest system covered in this chapter. As such, it’s designed with the constraints of its day; it assumes you’re always connected to a single central server, and only one version is kept on the local disk. To be sure, its features and constraints are well-suited to several specific problems, but there are lots of projects using Perforce where Git would actually work better.</p>
<p>There are two options if you’d like to mix your use of Perforce and Git. The first one we’ll cover is the “Git Fusion” bridge from the makers of Perforce, which lets you expose subtrees of your Perforce depot as read-write Git repositories. The second is git-p4, a client-side bridge that lets you use Git as a Perforce client, without requiring any reconfiguration of the Perforce server.</p>
<h4 id="Git-Fusion"><a href="#Git-Fusion" class="headerlink" title="Git Fusion"></a>Git Fusion</h4><p>Perforce provides a product called Git Fusion (available at &lt;<a href="http://www.perforce.com/git-fusion" target="_blank" rel="noopener">http://www.perforce.com/git-fusion</a>&gt;), which synchronizes a Perforce server with Git repositories on the server side.</p>
<h5 id="Setting-Up-1"><a href="#Setting-Up-1" class="headerlink" title="Setting Up"></a>Setting Up</h5><p>For our examples, we’ll be using the easiest installation method for Git Fusion, which is downloading a virtual machine that runs the Perforce daemon and Git Fusion. You can get the virtual machine image from &lt;<a href="http://www.perforce.com/downloads/Perforce/20-User" target="_blank" rel="noopener">http://www.perforce.com/downloads/Perforce/20-User</a>&gt;, and once it’s finished downloading, import it into your favorite virtualization software (we’ll use VirtualBox).</p>
<p>Upon first starting the machine, it asks you to customize the password for three Linux users (<code>root</code>, <code>perforce</code>, and <code>git</code>), and provide an instance name, which can be used to distinguish this installation from others on the same network. When that has all completed, you’ll see this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclxrrs3j20m80ismxi.jpg" alt="The Git Fusion virtual machine boot screen.">  Figure 1. The Git Fusion virtual machine boot screen.  You should take note of the IP address that’s shown here, we’ll be using it later on. Next, we’ll create a Perforce user. Select the “Login” option at the bottom and press enter (or SSH to the machine), and log in as <code>root</code>. Then use these commands to create a user:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ p4 -p localhost:1666 -u super user -f john</span><br><span class="line">$ p4 -p localhost:1666 -u john passwd</span><br><span class="line">$ <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<p>The first one will open a VI editor to customize the user, but you can accept the defaults by typing <code>:wq</code> and hitting enter. The second one will prompt you to enter a password twice. That’s all we need to do with a shell prompt, so exit out of the session.</p>
<p>The next thing you’ll need to do to follow along is to tell Git not to verify SSL certificates. The Git Fusion image comes with a certificate, but it’s for a domain that won’t match your virtual machine’s IP address, so Git will reject the HTTPS connection. If this is going to be a permanent installation, consult the Perforce Git Fusion manual to install a different certificate; for our example purposes, this will suffice:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> GIT_SSL_NO_VERIFY=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Now we can test that everything is working.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://10.0.1.254/Talkhouse](https://10.0.1.254/Talkhouse)</span><br><span class="line">Cloning into <span class="string">'Talkhouse'</span>...</span><br><span class="line">Username <span class="keyword">for</span> <span class="string">'[https://10.0.1.254](https://10.0.1.254)'</span>: john</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'[https://john@10.0.1.254](https://john@10.0.1.254)'</span>:</span><br><span class="line">remote: Counting objects: 630, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (581/581), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 630 (delta 172), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (630/630), 1.22 MiB | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (172/172), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br></pre></td></tr></table></figure>
<p>The virtual-machine image comes equipped with a sample project that you can clone. Here we’re cloning over HTTPS, with the <code>john</code> user that we created above; Git asks for credentials for this connection, but the credential cache will allow us to skip this step for any subsequent requests.</p>
<h5 id="Fusion-Configuration"><a href="#Fusion-Configuration" class="headerlink" title="Fusion Configuration"></a>Fusion Configuration</h5><p>Once you’ve got Git Fusion installed, you’ll want to tweak the configuration. This is actually fairly easy to do using your favorite Perforce client; just map the <code>//.git-fusion</code> directory on the Perforce server into your workspace. The file structure looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── objects</span><br><span class="line">│  ├── repos</span><br><span class="line">│  │  └── [...]</span><br><span class="line">│  └── trees</span><br><span class="line">│      └── [...]</span><br><span class="line">│</span><br><span class="line">├── p4gf_config</span><br><span class="line">├── repos</span><br><span class="line">│  └── Talkhouse</span><br><span class="line">│      └── p4gf_config</span><br><span class="line">└── users</span><br><span class="line">    └── p4gf_usermap</span><br><span class="line"></span><br><span class="line">498 directories, 287 files</span><br></pre></td></tr></table></figure>
<p>The <code>objects</code> directory is used internally by Git Fusion to map Perforce objects to Git and vice versa, you won’t have to mess with anything in there. There’s a global <code>p4gf_config</code> file in this directory, as well as one for each repository – these are the configuration files that determine how Git Fusion behaves. Let’s take a look at the file in the root:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[repo-creation]</span><br><span class="line">charset = utf8</span><br><span class="line"></span><br><span class="line">[git-to-perforce]</span><br><span class="line">change-owner = author</span><br><span class="line"><span class="built_in">enable</span>-git-branch-creation = yes</span><br><span class="line"><span class="built_in">enable</span>-swarm-reviews = yes</span><br><span class="line"><span class="built_in">enable</span>-git-merge-commits = yes</span><br><span class="line"><span class="built_in">enable</span>-git-submodules = yes</span><br><span class="line">preflight-commit = none</span><br><span class="line">ignore-author-permissions = no</span><br><span class="line"><span class="built_in">read</span>-permission-check = none</span><br><span class="line">git-merge-avoidance-after-change-num = 12107</span><br><span class="line"></span><br><span class="line">[perforce-to-git]</span><br><span class="line">http-url = none</span><br><span class="line">ssh-url = none</span><br><span class="line"></span><br><span class="line">[@features]</span><br><span class="line">imports = False</span><br><span class="line">chunked-push = False</span><br><span class="line">matrix2 = False</span><br><span class="line">parallel-push = False</span><br><span class="line"></span><br><span class="line">[authentication]</span><br><span class="line">email-case-sensitivity = no</span><br></pre></td></tr></table></figure>
<p>We won’t go into the meanings of these flags here, but note that this is just an INI-formatted text file, much like Git uses for configuration. This file specifies the global options, which can then be overridden by repository-specific configuration files, like <code>repos/Talkhouse/p4gf_config</code>. If you open this file, you’ll see a <code>[@repo]</code> section with some settings that are different from the global defaults. You’ll also see sections that look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Talkhouse-master]</span><br><span class="line">git-branch-name = master</span><br><span class="line">view = //depot/Talkhouse/main-dev/... ...</span><br></pre></td></tr></table></figure>
<p>This is a mapping between a Perforce branch and a Git branch. The section can be named whatever you like, so long as the name is unique. <code>git-branch-name</code> lets you convert a depot path that would be cumbersome under Git to a more friendly name. The <code>view</code> setting controls how Perforce files are mapped into the Git repository, using the standard view mapping syntax. More than one mapping can be specified, like in this example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[multi-project-mapping]</span><br><span class="line">git-branch-name = master</span><br><span class="line">view = //depot/project1/main/... project1/...</span><br><span class="line">       //depot/project2/mainline/... project2/...</span><br></pre></td></tr></table></figure>
<p>This way, if your normal workspace mapping includes changes in the structure of the directories, you can replicate that with a Git repository.</p>
<p>The last file we’ll discuss is <code>users/p4gf_usermap</code>, which maps Perforce users to Git users, and which you may not even need. When converting from a Perforce changeset to a Git commit, Git Fusion’s default behavior is to look up the Perforce user, and use the email address and full name stored there for the author/committer field in Git. When converting the other way, the default is to look up the Perforce user with the email address stored in the Git commit’s author field, and submit the changeset as that user (with permissions applying). In most cases, this behavior will do just fine, but consider the following mapping file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">john john@example.com <span class="string">"John Doe"</span></span><br><span class="line">john johnny@appleseed.net <span class="string">"John Doe"</span></span><br><span class="line">bob employeeX@example.com <span class="string">"Anon X. Mouse"</span></span><br><span class="line">joe employeeY@example.com <span class="string">"Anon Y. Mouse"</span></span><br></pre></td></tr></table></figure>
<p>Each line is of the format <code>&lt;user&gt; &lt;email&gt; &quot;&lt;full name&gt;&quot;</code>, and creates a single user mapping. The first two lines map two distinct email addresses to the same Perforce user account. This is useful if you’ve created Git commits under several different email addresses (or change email addresses), but want them to be mapped to the same Perforce user. When creating a Git commit from a Perforce changeset, the first line matching the Perforce user is used for Git authorship information.</p>
<p>The last two lines mask Bob and Joe’s actual names and email addresses from the Git commits that are created. This is nice if you want to open-source an internal project, but don’t want to publish your employee directory to the entire world. Note that the email addresses and full names should be unique, unless you want all the Git commits to be attributed to a single fictional author.</p>
<h5 id="Workflow-1"><a href="#Workflow-1" class="headerlink" title="Workflow"></a>Workflow</h5><p>Perforce Git Fusion is a two-way bridge between Perforce and Git version control. Let’s have a look at how it feels to work from the Git side. We’ll assume we’ve mapped in the “Jam” project using a configuration file as shown above, which we can clone like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://10.0.1.254/Jam](https://10.0.1.254/Jam)</span><br><span class="line">Cloning into <span class="string">'Jam'</span>...</span><br><span class="line">Username <span class="keyword">for</span> <span class="string">'[https://10.0.1.254](https://10.0.1.254)'</span>: john</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'[https://john@10.0.1.254](https://john@10.0.1.254)'</span>:</span><br><span class="line">remote: Counting objects: 2070, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (1704/1704), <span class="keyword">done</span>.</span><br><span class="line">Receiving objects: 100% (2070/2070), 1.21 MiB | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 2070 (delta 1242), reused 0 (delta 0)</span><br><span class="line">Resolving deltas: 100% (1242/1242), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line">$ git branch -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/master</span><br><span class="line">  remotes/origin/master</span><br><span class="line">  remotes/origin/rel2.1</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* 0a38c33 (origin/rel2.1) Create Jam 2.1 release branch.</span><br><span class="line">| * d254865 (HEAD, origin/master, origin/HEAD, master) Upgrade to latest metrowerks on Beos -- the Intel one.</span><br><span class="line">| * bd2f54a Put <span class="keyword">in</span> fix <span class="keyword">for</span> jam<span class="string">'s NT handle leak.</span></span><br><span class="line"><span class="string">| * c0f29e7 Fix URL in a jam doc</span></span><br><span class="line"><span class="string">| * cc644ac Radstone'</span>s lynx port.</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>
<p>The first time you do this, it may take some time. What’s happening is that Git Fusion is converting all the applicable changesets in the Perforce history into Git commits. This happens locally on the server, so it’s relatively fast, but if you have a lot of history, it can still take some time. Subsequent fetches do incremental conversion, so it’ll feel more like Git’s native speed.</p>
<p>As you can see, our repository looks exactly like any other Git repository you might work with. There are three branches, and Git has helpfully created a local <code>master</code> branch that tracks <code>origin/master</code>. Let’s do a bit of work, and create a couple of new commits:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* cfd46ab (HEAD, master) Add documentation <span class="keyword">for</span> new feature</span><br><span class="line">* a730d77 Whitespace</span><br><span class="line">* d254865 (origin/master, origin/HEAD) Upgrade to latest metrowerks on Beos -- the Intel one.</span><br><span class="line">* bd2f54a Put <span class="keyword">in</span> fix <span class="keyword">for</span> jam<span class="string">'s NT handle leak.</span></span><br><span class="line"><span class="string">[...]</span></span><br></pre></td></tr></table></figure>
<p>We have two new commits. Now let’s check if anyone else has been working:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch</span><br><span class="line">remote: Counting objects: 5, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3 (delta 2), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">From [https://10.0.1.254/Jam](https://10.0.1.254/Jam)</span><br><span class="line">   d254865..6afeb15  master     -&gt; origin/master</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* 6afeb15 (origin/master, origin/HEAD) Update copyright</span><br><span class="line">| * cfd46ab (HEAD, master) Add documentation <span class="keyword">for</span> new feature</span><br><span class="line">| * a730d77 Whitespace</span><br><span class="line">|/</span><br><span class="line">* d254865 Upgrade to latest metrowerks on Beos -- the Intel one.</span><br><span class="line">* bd2f54a Put <span class="keyword">in</span> fix <span class="keyword">for</span> jam<span class="string">'s NT handle leak.</span></span><br><span class="line"><span class="string">[...]</span></span><br></pre></td></tr></table></figure>
<p>It looks like someone was! You wouldn’t know it from this view, but the <code>6afeb15</code> commit was actually created using a Perforce client. It just looks like another commit from Git’s point of view, which is exactly the point. Let’s see how the Perforce server deals with a merge commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git merge origin/master</span><br><span class="line">Auto-merging README</span><br><span class="line">Merge made by the <span class="string">'recursive'</span> strategy.</span><br><span class="line"> README | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">$ git push</span><br><span class="line">Counting objects: 9, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (9/9), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (9/9), 917 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 9 (delta 6), reused 0 (delta 0)</span><br><span class="line">remote: Perforce: 100% (3/3) Loading commit tree into memory...</span><br><span class="line">remote: Perforce: 100% (5/5) Finding child commits...</span><br><span class="line">remote: Perforce: Running git fast-export...</span><br><span class="line">remote: Perforce: 100% (3/3) Checking commits...</span><br><span class="line">remote: Processing will <span class="built_in">continue</span> even <span class="keyword">if</span> connection is closed.</span><br><span class="line">remote: Perforce: 100% (3/3) Copying changelists...</span><br><span class="line">remote: Perforce: Submitting new Git commit objects to Perforce: 4</span><br><span class="line">To [https://10.0.1.254/Jam](https://10.0.1.254/Jam)</span><br><span class="line">   6afeb15..89cba2b  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>Git thinks it worked. Let’s take a look at the history of the <code>README</code> file from Perforce’s point of view, using the revision graph feature of <code>p4v</code>:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgciyiinsj20m80clwff.jpg" alt="Perforce revision graph resulting from Git push.">  Figure 2. Perforce revision graph resulting from Git push.  If you’ve never seen this view before, it may seem confusing, but it shows the same concepts as a graphical viewer for Git history. We’re looking at the history of the <code>README</code> file, so the directory tree at top left only shows that file as it surfaces in various branches. At top right, we have a visual graph of how different revisions of the file are related, and the big-picture view of this graph is at bottom right. The rest of the view is given to the details view for the selected revision (<code>2</code> in this case).</p>
<p>One thing to notice is that the graph looks exactly like the one in Git’s history. Perforce didn’t have a named branch to store the <code>1</code> and <code>2</code> commits, so it made an “anonymous” branch in the <code>.git-fusion</code> directory to hold it. This will also happen for named Git branches that don’t correspond to a named Perforce branch (and you can later map them to a Perforce branch using the configuration file).</p>
<p>Most of this happens behind the scenes, but the end result is that one person on a team can be using Git, another can be using Perforce, and neither of them will know about the other’s choice.</p>
<h5 id="Git-Fusion-Summary"><a href="#Git-Fusion-Summary" class="headerlink" title="Git-Fusion Summary"></a>Git-Fusion Summary</h5><p>If you have (or can get) access to your Perforce server, Git Fusion is a great way to make Git and Perforce talk to each other. There’s a bit of configuration involved, but the learning curve isn’t very steep. This is one of the few sections in this chapter where cautions about using Git’s full power will not appear. That’s not to say that Perforce will be happy with everything you throw at it – if you try to rewrite history that’s already been pushed, Git Fusion will reject it – but Git Fusion tries very hard to feel native. You can even use Git submodules (though they’ll look strange to Perforce users), and merge branches (this will be recorded as an integration on the Perforce side).</p>
<p>If you can’t convince the administrator of your server to set up Git Fusion, there is still a way to use these tools together.</p>
<h4 id="Git-p4"><a href="#Git-p4" class="headerlink" title="Git-p4"></a>Git-p4</h4><p>Git-p4 is a two-way bridge between Git and Perforce. It runs entirely inside your Git repository, so you won’t need any kind of access to the Perforce server (other than user credentials, of course). Git-p4 isn’t as flexible or complete a solution as Git Fusion, but it does allow you to do most of what you’d want to do without being invasive to the server environment.</p>
<p>You’ll need the <code>p4</code> tool somewhere in your <code>PATH</code> to work with git-p4. As of this writing, it is freely available at &lt;<a href="http://www.perforce.com/downloads/Perforce/20-User" target="_blank" rel="noopener">http://www.perforce.com/downloads/Perforce/20-User</a>&gt;.</p>
<h5 id="Setting-Up-2"><a href="#Setting-Up-2" class="headerlink" title="Setting Up"></a>Setting Up</h5><p>For example purposes, we’ll be running the Perforce server from the Git Fusion OVA as shown above, but we’ll bypass the Git Fusion server and go directly to the Perforce version control.</p>
<p>In order to use the <code>p4</code> command-line client (which git-p4 depends on), you’ll need to set a couple of environment variables:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> P4PORT=10.0.1.254:1666</span><br><span class="line">$ <span class="built_in">export</span> P4USER=john</span><br></pre></td></tr></table></figure>
<h5 id="Getting-Started-3"><a href="#Getting-Started-3" class="headerlink" title="Getting Started"></a>Getting Started</h5><p>As with anything in Git, the first command is to clone:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 <span class="built_in">clone</span> //depot/www/live www-shallow</span><br><span class="line">Importing from //depot/www/live into www-shallow</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /private/tmp/www-shallow/.git/</span><br><span class="line">Doing initial import of //depot/www/live/ from revision <span class="comment">#head into refs/remotes/p4/master</span></span><br></pre></td></tr></table></figure>
<p>This creates what in Git terms is a “shallow” clone; only the very latest Perforce revision is imported into Git; remember, Perforce isn’t designed to give every revision to every user. This is enough to use Git as a Perforce client, but for other purposes it’s not enough.</p>
<p>Once it’s finished, we have a fully-functional Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> myproject</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* 70eaf78 (HEAD, p4/master, p4/HEAD, master) Initial import of //depot/www/live/ from the state at revision <span class="comment">#head</span></span><br></pre></td></tr></table></figure>
<p>Note how there’s a “p4” remote for the Perforce server, but everything else looks like a standard clone. Actually, that’s a bit misleading; there isn’t actually a remote there.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br></pre></td></tr></table></figure>
<p>No remotes exist in this repository at all. Git-p4 has created some refs to represent the state of the server, and they look like remote refs to <code>git log</code>, but they’re not managed by Git itself, and you can’t push to them.</p>
<h5 id="Workflow-2"><a href="#Workflow-2" class="headerlink" title="Workflow"></a>Workflow</h5><p>Okay, let’s do some work. Let’s assume you’ve made some progress on a very important feature, and you’re ready to show it to the rest of your team.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* 018467c (HEAD, master) Change page title</span><br><span class="line">* c0fb617 Update link</span><br><span class="line">* 70eaf78 (p4/master, p4/HEAD) Initial import of //depot/www/live/ from the state at revision <span class="comment">#head</span></span><br></pre></td></tr></table></figure>
<p>We’ve made two new commits that we’re ready to submit to the Perforce server. Let’s check if anyone else was working today:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 sync</span><br><span class="line">git p4 sync</span><br><span class="line">Performing incremental import into refs/remotes/p4/master git branch</span><br><span class="line">Depot paths: //depot/www/live/</span><br><span class="line">Import destination: refs/remotes/p4/master</span><br><span class="line">Importing revision 12142 (100%)</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* 75cd059 (p4/master, p4/HEAD) Update copyright</span><br><span class="line">| * 018467c (HEAD, master) Change page title</span><br><span class="line">| * c0fb617 Update link</span><br><span class="line">|/</span><br><span class="line">* 70eaf78 Initial import of //depot/www/live/ from the state at revision <span class="comment">#head</span></span><br></pre></td></tr></table></figure>
<p>Looks like they were, and <code>master</code> and <code>p4/master</code> have diverged. Perforce’s branching system is <em>nothing</em> like Git’s, so submitting merge commits doesn’t make any sense. Git-p4 recommends that you rebase your commits, and even comes with a shortcut to do so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 rebase</span><br><span class="line">Performing incremental import into refs/remotes/p4/master git branch</span><br><span class="line">Depot paths: //depot/www/live/</span><br><span class="line">No changes to import!</span><br><span class="line">Rebasing the current branch onto remotes/p4/master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: Update link</span><br><span class="line">Applying: Change page title</span><br><span class="line"> index.html | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br></pre></td></tr></table></figure>
<p>You can probably tell from the output, but <code>git p4 rebase</code> is a shortcut for <code>git p4 sync</code> followed by <code>git rebase p4/master</code>. It’s a bit smarter than that, especially when working with multiple branches, but this is a good approximation.</p>
<p>Now our history is linear again, and we’re ready to contribute our changes back to Perforce. The <code>git p4 submit</code> command will try to create a new Perforce revision for every Git commit between <code>p4/master</code> and <code>master</code>. Running it drops us into our favorite editor, and the contents of the file look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A Perforce Change Specification.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Change:      The change number. 'new' on a new changelist.</span></span><br><span class="line"><span class="comment">#  Date:        The date this specification was last modified.</span></span><br><span class="line"><span class="comment">#  Client:      The client on which the changelist was created.  Read-only.</span></span><br><span class="line"><span class="comment">#  User:        The user who created the changelist.</span></span><br><span class="line"><span class="comment">#  Status:      Either 'pending' or 'submitted'. Read-only.</span></span><br><span class="line"><span class="comment">#  Type:        Either 'public' or 'restricted'. Default is 'public'.</span></span><br><span class="line"><span class="comment">#  Description: Comments about the changelist.  Required.</span></span><br><span class="line"><span class="comment">#  Jobs:        What opened jobs are to be closed by this changelist.</span></span><br><span class="line"><span class="comment">#               You may delete jobs from this list.  (New changelists only.)</span></span><br><span class="line"><span class="comment">#  Files:       What opened files from the default changelist are to be added</span></span><br><span class="line"><span class="comment">#               to this changelist.  You may delete files from this list.</span></span><br><span class="line"><span class="comment">#               (New changelists only.)</span></span><br><span class="line"></span><br><span class="line">Change:  new</span><br><span class="line"></span><br><span class="line">Client:  john_bens-mbp_8487</span><br><span class="line"></span><br><span class="line">User: john</span><br><span class="line"></span><br><span class="line">Status:  new</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">   Update link</span><br><span class="line"></span><br><span class="line">Files:</span><br><span class="line">   //depot/www/live/index.html   <span class="comment"># edit</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">######## git author ben@straub.cc does not match your p4 account.</span></span><br><span class="line"><span class="comment">######## Use option --preserve-user to modify authorship.</span></span><br><span class="line"><span class="comment">######## Variable git-p4.skipUserNameCheck hides this message.</span></span><br><span class="line"><span class="comment">######## everything below this line is just the diff </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######</span></span><br><span class="line">--- //depot/www/live/index.html  2014-08-31 18:26:05.000000000 0000</span><br><span class="line">+++ /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/index.html   2014-08-31 18:26:05.000000000 0000</span><br><span class="line">@@ -60,7 +60,7 @@</span><br><span class="line"> &lt;/td&gt;</span><br><span class="line"> &lt;td valign=top&gt;</span><br><span class="line"> Source and documentation <span class="keyword">for</span></span><br><span class="line">-&lt;a href=<span class="string">"[http://www.perforce.com/jam/jam.html](http://www.perforce.com/jam/jam.html)"</span>&gt;</span><br><span class="line">+&lt;a href=<span class="string">"jam.html"</span>&gt;</span><br><span class="line"> Jam/MR&lt;/a&gt;,</span><br><span class="line"> a software build tool.</span><br><span class="line"> &lt;/td&gt;</span><br></pre></td></tr></table></figure>
<p>This is mostly the same content you’d see by running <code>p4 submit</code>, except the stuff at the end which git-p4 has helpfully included. Git-p4 tries to honor your Git and Perforce settings individually when it has to provide a name for a commit or changeset, but in some cases you want to override it. For example, if the Git commit you’re importing was written by a contributor who doesn’t have a Perforce user account, you may still want the resulting changeset to look like they wrote it (and not you).</p>
<p>Git-p4 has helpfully imported the message from the Git commit as the content for this Perforce changeset, so all we have to do is save and quit, twice (once for each commit). The resulting shell output will look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 submit</span><br><span class="line">Perforce checkout <span class="keyword">for</span> depot path //depot/www/live/ located at /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/</span><br><span class="line">Synchronizing p4 checkout...</span><br><span class="line">... - file(s) up-to-date.</span><br><span class="line">Applying dbac45b Update link</span><br><span class="line">//depot/www/live/index.html<span class="comment">#4 - opened for edit</span></span><br><span class="line">Change 12143 created with 1 open file(s).</span><br><span class="line">Submitting change 12143.</span><br><span class="line">Locking 1 files ...</span><br><span class="line">edit //depot/www/live/index.html<span class="comment">#5</span></span><br><span class="line">Change 12143 submitted.</span><br><span class="line">Applying 905ec6a Change page title</span><br><span class="line">//depot/www/live/index.html<span class="comment">#5 - opened for edit</span></span><br><span class="line">Change 12144 created with 1 open file(s).</span><br><span class="line">Submitting change 12144.</span><br><span class="line">Locking 1 files ...</span><br><span class="line">edit //depot/www/live/index.html<span class="comment">#6</span></span><br><span class="line">Change 12144 submitted.</span><br><span class="line">All commits applied!</span><br><span class="line">Performing incremental import into refs/remotes/p4/master git branch</span><br><span class="line">Depot paths: //depot/www/live/</span><br><span class="line">Import destination: refs/remotes/p4/master</span><br><span class="line">Importing revision 12144 (100%)</span><br><span class="line">Rebasing the current branch onto remotes/p4/master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* 775a46f (HEAD, p4/master, p4/HEAD, master) Change page title</span><br><span class="line">* 05f1ade Update link</span><br><span class="line">* 75cd059 Update copyright</span><br><span class="line">* 70eaf78 Initial import of //depot/www/live/ from the state at revision <span class="comment">#head</span></span><br></pre></td></tr></table></figure>
<p>The result is as though we just did a <code>git push</code>, which is the closest analogy to what actually did happen.</p>
<p>Note that during this process every Git commit is turned into a Perforce changeset; if you want to squash them down into a single changeset, you can do that with an interactive rebase before running <code>git p4 submit</code>. Also note that the SHA-1 hashes of all the commits that were submitted as changesets have changed; this is because git-p4 adds a line to the end of each commit it converts:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -1</span><br><span class="line">commit 775a46f630d8b46535fc9983cf3ebe6b9aa53145</span><br><span class="line">Author: John Doe &lt;john@example.com&gt;</span><br><span class="line">Date:   Sun Aug 31 10:31:44 2014 -0800</span><br><span class="line"></span><br><span class="line">    Change page title</span><br><span class="line"></span><br><span class="line">    [git-p4: depot-paths = <span class="string">"//depot/www/live/"</span>: change = 12144]</span><br></pre></td></tr></table></figure>
<p>What happens if you try to submit a merge commit? Let’s give it a try. Here’s the situation we’ve gotten ourselves into:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* 3be6fd8 (HEAD, master) Correct email address</span><br><span class="line">*   1dcbf21 Merge remote-tracking branch <span class="string">'p4/master'</span></span><br><span class="line">|\</span><br><span class="line">| * c4689fc (p4/master, p4/HEAD) Grammar fix</span><br><span class="line">* | cbacd0a Table borders: yes please</span><br><span class="line">* | b4959b6 Trademark</span><br><span class="line">|/</span><br><span class="line">* 775a46f Change page title</span><br><span class="line">* 05f1ade Update link</span><br><span class="line">* 75cd059 Update copyright</span><br><span class="line">* 70eaf78 Initial import of //depot/www/live/ from the state at revision <span class="comment">#head</span></span><br></pre></td></tr></table></figure>
<p>The Git and Perforce history diverge after 775a46f. The Git side has two commits, then a merge commit with the Perforce head, then another commit. We’re going to try to submit these on top of a single changeset on the Perforce side. Let’s see what would happen if we tried to submit now:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 submit -n</span><br><span class="line">Perforce checkout <span class="keyword">for</span> depot path //depot/www/live/ located at /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/</span><br><span class="line">Would synchronize p4 checkout <span class="keyword">in</span> /Users/ben/john_bens-mbp_8487/john_bens-mbp_8487/depot/www/live/</span><br><span class="line">Would apply</span><br><span class="line">  b4959b6 Trademark</span><br><span class="line">  cbacd0a Table borders: yes please</span><br><span class="line">  3be6fd8 Correct email address</span><br></pre></td></tr></table></figure>
<p>The <code>-n</code> flag is short for <code>--dry-run</code>, which tries to report what would happen if the submit command were run for real. In this case, it looks like we’d be creating three Perforce changesets, which correspond to the three non-merge commits that don’t yet exist on the Perforce server. That sounds like exactly what we want, let’s see how it turns out:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 submit</span><br><span class="line">[…]</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* dadbd89 (HEAD, p4/master, p4/HEAD, master) Correct email address</span><br><span class="line">* 1b79a80 Table borders: yes please</span><br><span class="line">* 0097235 Trademark</span><br><span class="line">* c4689fc Grammar fix</span><br><span class="line">* 775a46f Change page title</span><br><span class="line">* 05f1ade Update link</span><br><span class="line">* 75cd059 Update copyright</span><br><span class="line">* 70eaf78 Initial import of //depot/www/live/ from the state at revision <span class="comment">#head</span></span><br></pre></td></tr></table></figure>
<p>Our history became linear, just as though we had rebased before submitting (which is in fact exactly what happened). This means you can be free to create, work on, throw away, and merge branches on the Git side without fear that your history will somehow become incompatible with Perforce. If you can rebase it, you can contribute it to a Perforce server.</p>
<h5 id="Branching"><a href="#Branching" class="headerlink" title="Branching"></a>Branching</h5><p>If your Perforce project has multiple branches, you’re not out of luck; git-p4 can handle that in a way that makes it feel like Git. Let’s say your Perforce depot is laid out like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//depot</span><br><span class="line">  └── project</span><br><span class="line">      ├── main</span><br><span class="line">      └── dev</span><br></pre></td></tr></table></figure>
<p>And let’s say you have a <code>dev</code> branch, which has a view spec that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//depot/project/main/... //depot/project/dev/...</span><br></pre></td></tr></table></figure>
<p>Git-p4 can automatically detect that situation and do the right thing:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git p4 <span class="built_in">clone</span> --detect-branches //depot/project@all</span><br><span class="line">Importing from //depot/project@all into project</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /private/tmp/project/.git/</span><br><span class="line">Importing revision 20 (50%)</span><br><span class="line">    Importing new branch project/dev</span><br><span class="line"></span><br><span class="line">    Resuming with change 20</span><br><span class="line">Importing revision 22 (100%)</span><br><span class="line">Updated branches: main dev</span><br><span class="line">$ <span class="built_in">cd</span> project; git <span class="built_in">log</span> --oneline --all --graph --decorate</span><br><span class="line">* eae77ae (HEAD, p4/master, p4/HEAD, master) main</span><br><span class="line">| * 10d55fb (p4/project/dev) dev</span><br><span class="line">| * a43cfae Populate //depot/project/main/... //depot/project/dev/....</span><br><span class="line">|/</span><br><span class="line">* 2b83451 Project init</span><br></pre></td></tr></table></figure>
<p>Note the “@all” specifier in the depot path; that tells git-p4 to clone not just the latest changeset for that subtree, but all changesets that have ever touched those paths. This is closer to Git’s concept of a clone, but if you’re working on a project with a long history, it could take a while.</p>
<p>The <code>--detect-branches</code> flag tells git-p4 to use Perforce’s branch specs to map the branches to Git refs. If these mappings aren’t present on the Perforce server (which is a perfectly valid way to use Perforce), you can tell git-p4 what the branch mappings are, and you get the same result:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git init project</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /tmp/project/.git/</span><br><span class="line">$ <span class="built_in">cd</span> project</span><br><span class="line">$ git config git-p4.branchList main:dev</span><br><span class="line">$ git <span class="built_in">clone</span> --detect-branches //depot/project@all .</span><br></pre></td></tr></table></figure>
<p>Setting the <code>git-p4.branchList</code> configuration variable to <code>main:dev</code> tells git-p4 that “main” and “dev” are both branches, and the second one is a child of the first one.</p>
<p>If we now <code>git checkout -b dev p4/project/dev</code> and make some commits, git-p4 is smart enough to target the right branch when we do <code>git p4 submit</code>. Unfortunately, git-p4 can’t mix shallow clones and multiple branches; if you have a huge project and want to work on more than one branch, you’ll have to <code>git p4 clone</code> once for each branch you want to submit to.</p>
<p>For creating or integrating branches, you’ll have to use a Perforce client. Git-p4 can only sync and submit to existing branches, and it can only do it one linear changeset at a time. If you merge two branches in Git and try to submit the new changeset, all that will be recorded is a bunch of file changes; the metadata about which branches are involved in the integration will be lost.</p>
<h4 id="Git-and-Perforce-Summary"><a href="#Git-and-Perforce-Summary" class="headerlink" title="Git and Perforce Summary"></a>Git and Perforce Summary</h4><p>Git-p4 makes it possible to use a Git workflow with a Perforce server, and it’s pretty good at it. However, it’s important to remember that Perforce is in charge of the source, and you’re only using Git to work locally. Just be really careful about sharing Git commits; if you have a remote that other people use, don’t push any commits that haven’t already been submitted to the Perforce server.</p>
<p>If you want to freely mix the use of Perforce and Git as clients for source control, and you can convince the server administrator to install it, Git Fusion makes using Git a first-class version-control client for a Perforce server.</p>
<h3 id="Git-and-TFS"><a href="#Git-and-TFS" class="headerlink" title="Git and TFS"></a>Git and TFS</h3><p>Git is becoming popular with Windows developers, and if you’re writing code on Windows, there’s a good chance you’re using Microsoft’s Team Foundation Server (TFS). TFS is a collaboration suite that includes defect and work-item tracking, process support for Scrum and others, code review, and version control. There’s a bit of confusion ahead: <strong>TFS</strong> is the server, which supports controlling source code using both Git and their own custom VCS, which they’ve dubbed <strong>TFVC</strong> (Team Foundation Version Control). Git support is a somewhat new feature for TFS (shipping with the 2013 version), so all of the tools that predate that refer to the version-control portion as “TFS”, even though they’re mostly working with TFVC.</p>
<p>If you find yourself on a team that’s using TFVC but you’d rather use Git as your version-control client, there’s a project for you.</p>
<h4 id="Which-Tool"><a href="#Which-Tool" class="headerlink" title="Which Tool"></a>Which Tool</h4><p>In fact, there are two: git-tf and git-tfs.</p>
<p>Git-tfs (found at &lt;<a href="https://github.com/git-tfs/git-tfs" target="_blank" rel="noopener">https://github.com/git-tfs/git-tfs</a>&gt;) is a .NET project, and (as of this writing) it only runs on Windows. To work with Git repositories, it uses the .NET bindings for libgit2, a library-oriented implementation of Git which is highly performant and allows a lot of flexibility with the guts of a Git repository. Libgit2 is not a complete implementation of Git, so to cover the difference git-tfs will actually call the command-line Git client for some operations, so there are no artificial limits on what it can do with Git repositories. Its support of TFVC features is very mature, since it uses the Visual Studio assemblies for operations with servers. This does mean you’ll need access to those assemblies, which means you need to install a recent version of Visual Studio (any edition since version 2010, including Express since version 2012), or the Visual Studio SDK.</p>
<p>Git-tf (whose home is at &lt;<a href="https://gittf.codeplex.com" target="_blank" rel="noopener">https://gittf.codeplex.com</a>&gt;) is a Java project, and as such runs on any computer with a Java runtime environment. It interfaces with Git repositories through JGit (a JVM implementation of Git), which means it has virtually no limitations in terms of Git functions. However, its support for TFVC is limited as compared to git-tfs – it does not support branches, for instance.</p>
<p>So each tool has pros and cons, and there are plenty of situations that favor one over the other. We’ll cover the basic usage of both of them in this book.</p>
<p>You’ll need access to a TFVC-based repository to follow along with these instructions. These aren’t as plentiful in the wild as Git or Subversion repositories, so you may need to create one of your own. Codeplex (&lt;<a href="https://www.codeplex.com" target="_blank" rel="noopener">https://www.codeplex.com</a>&gt;) or Visual Studio Online (&lt;<a href="http://www.visualstudio.com" target="_blank" rel="noopener">http://www.visualstudio.com</a>&gt;) are both good choices for this.</p>
<h4 id="Getting-Started-git-tf"><a href="#Getting-Started-git-tf" class="headerlink" title="Getting Started: git-tf"></a>Getting Started: <code>git-tf</code></h4><p>The first thing you do, just as with any Git project, is clone. Here’s what that looks like with <code>git-tf</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tf <span class="built_in">clone</span> [https://tfs.codeplex.com:443/tfs/TFS13](https://tfs.codeplex.com:443/tfs/TFS13) $/myproject/Main project_git</span><br></pre></td></tr></table></figure>
<p>The first argument is the URL of a TFVC collection, the second is of the form <code>$/project/branch</code>, and the third is the path to the local Git repository that is to be created (this last one is optional). Git-tf can only work with one branch at a time; if you want to make checkins on a different TFVC branch, you’ll have to make a new clone from that branch.</p>
<p>This creates a fully functional Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> project_git</span><br><span class="line">$ git <span class="built_in">log</span> --all --oneline --decorate</span><br><span class="line">512e75a (HEAD, tag: TFS_C35190, origin_tfs/tfs, master) Checkin message</span><br></pre></td></tr></table></figure>
<p>This is called a <em>shallow</em> clone, meaning that only the latest changeset has been downloaded. TFVC isn’t designed for each client to have a full copy of the history, so git-tf defaults to only getting the latest version, which is much faster.</p>
<p>If you have some time, it’s probably worth it to clone the entire project history, using the <code>--deep</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git tf <span class="built_in">clone</span> [https://tfs.codeplex.com:443/tfs/TFS13](https://tfs.codeplex.com:443/tfs/TFS13) $/myproject/Main \</span><br><span class="line">  project_git --deep</span><br><span class="line">Username: domain\user</span><br><span class="line">Password:</span><br><span class="line">Connecting to TFS...</span><br><span class="line">Cloning $/myproject into /tmp/project_git: 100%, <span class="keyword">done</span>.</span><br><span class="line">Cloned 4 changesets. Cloned last changeset 35190 as d44b17a</span><br><span class="line">$ <span class="built_in">cd</span> project_git</span><br><span class="line">$ git <span class="built_in">log</span> --all --oneline --decorate</span><br><span class="line">d44b17a (HEAD, tag: TFS_C35190, origin_tfs/tfs, master) Goodbye</span><br><span class="line">126aa7b (tag: TFS_C35189)</span><br><span class="line">8f77431 (tag: TFS_C35178) FIRST</span><br><span class="line">0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</span><br><span class="line">        Team Project Creation Wizard</span><br></pre></td></tr></table></figure>
<p>Notice the tags with names like <code>TFS_C35189</code>; this is a feature that helps you know which Git commits are associated with TFVC changesets. This is a nice way to represent it, since you can see with a simple log command which of your commits is associated with a snapshot that also exists in TFVC. They aren’t necessary (and in fact you can turn them off with <code>git config git-tf.tag false</code>) – git-tf keeps the real commit-changeset mappings in the <code>.git/git-tf</code> file.</p>
<h4 id="Getting-Started-git-tfs"><a href="#Getting-Started-git-tfs" class="headerlink" title="Getting Started: git-tfs"></a>Getting Started: <code>git-tfs</code></h4><p>Git-tfs cloning behaves a bit differently. Observe:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git tfs <span class="built_in">clone</span> --with-branches \</span><br><span class="line">    [https://username.visualstudio.com/DefaultCollection](https://username.visualstudio.com/DefaultCollection) \</span><br><span class="line">    $/project/Trunk project_git</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> C:/Users/ben/project_git/.git/</span><br><span class="line">C15 = b75da1aba1ffb359d00e85c52acb261e4586b0c9</span><br><span class="line">C16 = c403405f4989d73a2c3c119e79021cb2104ce44a</span><br><span class="line">Tfs branches found:</span><br><span class="line">- $/tfvc-test/featureA</span><br><span class="line">The name of the <span class="built_in">local</span> branch will be : featureA</span><br><span class="line">C17 = d202b53f67bde32171d5078968c644e562f1c439</span><br><span class="line">C18 = 44cd729d8df868a8be20438fdeeefb961958b674</span><br></pre></td></tr></table></figure>
<p>Notice the <code>--with-branches</code> flag. Git-tfs is capable of mapping TFVC branches to Git branches, and this flag tells it to set up a local Git branch for every TFVC branch. This is highly recommended if you’ve ever branched or merged in TFS, but it won’t work with a server older than TFS 2010 – before that release, “branches” were just folders, so git-tfs can’t tell them from regular folders.</p>
<p>Let’s take a look at the resulting Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 44cd729 (tfs/featureA, featureA) Goodbye</span><br><span class="line">* d202b53 Branched from $/tfvc-test/Trunk</span><br><span class="line">* c403405 (HEAD, tfs/default, master) Hello</span><br><span class="line">* b75da1a New project</span><br><span class="line">PS&gt; git <span class="built_in">log</span> -1</span><br><span class="line">commit c403405f4989d73a2c3c119e79021cb2104ce44a</span><br><span class="line">Author: Ben Straub &lt;ben@straub.cc&gt;</span><br><span class="line">Date:   Fri Aug 1 03:41:59 2014 +0000</span><br><span class="line"></span><br><span class="line">    Hello</span><br><span class="line"></span><br><span class="line">    git-tfs-id: [https://username.visualstudio.com/DefaultCollection]$/myproject/Trunk;C16</span><br></pre></td></tr></table></figure>
<p>There are two local branches, <code>master</code> and <code>featureA</code>, which represent the initial starting point of the clone (<code>Trunk</code> in TFVC) and a child branch (<code>featureA</code> in TFVC). You can also see that the <code>tfs</code> “remote” has a couple of refs too: <code>default</code> and <code>featureA</code>, which represent TFVC branches. Git-tfs maps the branch you cloned from to <code>tfs/default</code>, and others get their own names.</p>
<p>Another thing to notice is the <code>git-tfs-id:</code> lines in the commit messages. Instead of tags, git-tfs uses these markers to relate TFVC changesets to Git commits. This has the implication that your Git commits will have a different SHA-1 hash before and after they have been pushed to TFVC.</p>
<h4 id="Git-tf-s-Workflow"><a href="#Git-tf-s-Workflow" class="headerlink" title="Git-tf[s] Workflow"></a>Git-tf[s] Workflow</h4><p>Regardless of which tool you’re using, you should set a couple of Git configuration values to avoid running into issues.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config <span class="built_in">set</span> --<span class="built_in">local</span> core.ignorecase=<span class="literal">true</span></span><br><span class="line">$ git config <span class="built_in">set</span> --<span class="built_in">local</span> core.autocrlf=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>The obvious next thing you’re going to want to do is work on the project. TFVC and TFS have several features that may add complexity to your workflow:</p>
<ol start="2">
<li>Feature branches that aren’t represented in TFVC add a bit of complexity. This has to do with the <strong>very</strong> different ways that TFVC and Git represent branches.</li>
<li>Be aware that TFVC allows users to “checkout” files from the server, locking them so nobody else can edit them. This obviously won’t stop you from editing them in your local repository, but it could get in the way when it comes time to push your changes up to the TFVC server.</li>
<li>TFS has the concept of “gated” checkins, where a TFS build-test cycle has to complete successfully before the checkin is allowed. This uses the “shelve” function in TFVC, which we don’t cover in detail here. You can fake this in a manual fashion with git-tf, and git-tfs provides the <code>checkintool</code> command which is gate-aware.<br>In the interest of brevity, what we’ll cover here is the happy path, which sidesteps or avoids most of these issues.</li>
</ol>
<h4 id="Workflow-git-tf"><a href="#Workflow-git-tf" class="headerlink" title="Workflow: git-tf"></a>Workflow: <code>git-tf</code></h4><p>Let’s say you’ve done some work, made a couple of Git commits on <code>master</code>, and you’re ready to share your progress on the TFVC server. Here’s our Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 4178a82 (HEAD, master) update code</span><br><span class="line">* 9df2ae3 update readme</span><br><span class="line">* d44b17a (tag: TFS_C35190, origin_tfs/tfs) Goodbye</span><br><span class="line">* 126aa7b (tag: TFS_C35189)</span><br><span class="line">* 8f77431 (tag: TFS_C35178) FIRST</span><br><span class="line">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</span><br><span class="line">          Team Project Creation Wizard</span><br></pre></td></tr></table></figure>
<p>We want to take the snapshot that’s in the <code>4178a82</code> commit and push it up to the TFVC server. First things first: let’s see if any of our teammates did anything since we last connected:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git tf fetch</span><br><span class="line">Username: domain\user</span><br><span class="line">Password:</span><br><span class="line">Connecting to TFS...</span><br><span class="line">Fetching $/myproject at latest changeset: 100%, <span class="keyword">done</span>.</span><br><span class="line">Downloaded changeset 35320 as commit 8ef06a8. Updated FETCH_HEAD.</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 8ef06a8 (tag: TFS_C35320, origin_tfs/tfs) just some text</span><br><span class="line">| * 4178a82 (HEAD, master) update code</span><br><span class="line">| * 9df2ae3 update readme</span><br><span class="line">|/</span><br><span class="line">* d44b17a (tag: TFS_C35190) Goodbye</span><br><span class="line">* 126aa7b (tag: TFS_C35189)</span><br><span class="line">* 8f77431 (tag: TFS_C35178) FIRST</span><br><span class="line">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</span><br><span class="line">          Team Project Creation Wizard</span><br></pre></td></tr></table></figure>
<p>Looks like someone else is working, too, and now we have divergent history. This is where Git shines, but we have two choices of how to proceed:</p>
<ol start="2">
<li>Making a merge commit feels natural as a Git user (after all, that’s what <code>git pull</code> does), and git-tf can do this for you with a simple <code>git tf pull</code>. Be aware, however, that TFVC doesn’t think this way, and if you push merge commits your history will start to look different on both sides, which can be confusing. However, if you plan on submitting all of your changes as one changeset, this is probably the easiest choice.</li>
<li>Rebasing makes our commit history linear, which means we have the option of converting each of our Git commits into a TFVC changeset. Since this leaves the most options open, we recommend you do it this way; git-tf even makes it easy for you with <code>git tf pull --rebase</code>.<br>The choice is yours. For this example, we’ll be rebasing:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase FETCH_HEAD</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: update readme</span><br><span class="line">Applying: update code</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 5a0e25e (HEAD, master) update code</span><br><span class="line">* 6eb3eb5 update readme</span><br><span class="line">* 8ef06a8 (tag: TFS_C35320, origin_tfs/tfs) just some text</span><br><span class="line">* d44b17a (tag: TFS_C35190) Goodbye</span><br><span class="line">* 126aa7b (tag: TFS_C35189)</span><br><span class="line">* 8f77431 (tag: TFS_C35178) FIRST</span><br><span class="line">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</span><br><span class="line">          Team Project Creation Wizard</span><br></pre></td></tr></table></figure>
<p>Now we’re ready to make a checkin to the TFVC server. Git-tf gives you the choice of making a single changeset that represents all the changes since the last one (<code>--shallow</code>, which is the default) and creating a new changeset for each Git commit (<code>--deep</code>). For this example, we’ll just create one changeset:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git tf checkin -m <span class="string">'Updating readme and code'</span></span><br><span class="line">Username: domain\user</span><br><span class="line">Password:</span><br><span class="line">Connecting to TFS...</span><br><span class="line">Checking <span class="keyword">in</span> to $/myproject: 100%, <span class="keyword">done</span>.</span><br><span class="line">Checked commit 5a0e25e <span class="keyword">in</span> as changeset 35348</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 5a0e25e (HEAD, tag: TFS_C35348, origin_tfs/tfs, master) update code</span><br><span class="line">* 6eb3eb5 update readme</span><br><span class="line">* 8ef06a8 (tag: TFS_C35320) just some text</span><br><span class="line">* d44b17a (tag: TFS_C35190) Goodbye</span><br><span class="line">* 126aa7b (tag: TFS_C35189)</span><br><span class="line">* 8f77431 (tag: TFS_C35178) FIRST</span><br><span class="line">* 0745a25 (tag: TFS_C35177) Created team project folder $/tfvctest via the \</span><br><span class="line">          Team Project Creation Wizard</span><br></pre></td></tr></table></figure>
<p>There’s a new <code>TFS_C35348</code> tag, indicating that TFVC is storing the exact same snapshot as the <code>5a0e25e</code> commit. It’s important to note that not every Git commit needs to have an exact counterpart in TFVC; the <code>6eb3eb5</code> commit, for example, doesn’t exist anywhere on the server.</p>
<p>That’s the main workflow. There are a couple of other considerations you’ll want to keep in mind:</p>
<ul>
<li>There is no branching. Git-tf can only create Git repositories from one TFVC branch at a time.</li>
<li>Collaborate using either TFVC or Git, but not both. Different git-tf clones of the same TFVC repository may have different commit SHA-1 hashes, which will cause no end of headaches.</li>
<li>If your team’s workflow includes collaborating in Git and syncing periodically with TFVC, only connect to TFVC with one of the Git repositories.</li>
</ul>
<h4 id="Workflow-git-tfs"><a href="#Workflow-git-tfs" class="headerlink" title="Workflow: git-tfs"></a>Workflow: <code>git-tfs</code></h4><p>Let’s walk through the same scenario using git-tfs. Here are the new commits we’ve made to the <code>master</code> branch in our Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git <span class="built_in">log</span> --oneline --graph --all --decorate</span><br><span class="line">* c3bd3ae (HEAD, master) update code</span><br><span class="line">* d85e5a2 update readme</span><br><span class="line">| * 44cd729 (tfs/featureA, featureA) Goodbye</span><br><span class="line">| * d202b53 Branched from $/tfvc-test/Trunk</span><br><span class="line">|/</span><br><span class="line">* c403405 (tfs/default) Hello</span><br><span class="line">* b75da1a New project</span><br></pre></td></tr></table></figure>
<p>Now let’s see if anyone else has done work while we were hacking away:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git tfs fetch</span><br><span class="line">C19 = aea74a0313de0a391940c999e51c5c15c381d91d</span><br><span class="line">PS&gt; git <span class="built_in">log</span> --all --oneline --graph --decorate</span><br><span class="line">* aea74a0 (tfs/default) update documentation</span><br><span class="line">| * c3bd3ae (HEAD, master) update code</span><br><span class="line">| * d85e5a2 update readme</span><br><span class="line">|/</span><br><span class="line">| * 44cd729 (tfs/featureA, featureA) Goodbye</span><br><span class="line">| * d202b53 Branched from $/tfvc-test/Trunk</span><br><span class="line">|/</span><br><span class="line">* c403405 Hello</span><br><span class="line">* b75da1a New project</span><br></pre></td></tr></table></figure>
<p>Yes, it turns out our coworker has added a new TFVC changeset, which shows up as the new <code>aea74a0</code> commit, and the <code>tfs/default</code> remote branch has moved.</p>
<p>As with git-tf, we have two fundamental options for how to resolve this divergent history:</p>
<ol start="2">
<li>Rebase to preserve a linear history.</li>
<li>Merge to preserve what actually happened.<br>In this case, we’re going to do a “deep” checkin, where every Git commit becomes a TFVC changeset, so we want to rebase.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git rebase tfs/default</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: update readme</span><br><span class="line">Applying: update code</span><br><span class="line">PS&gt; git <span class="built_in">log</span> --all --oneline --graph --decorate</span><br><span class="line">* 10a75ac (HEAD, master) update code</span><br><span class="line">* 5cec4ab update readme</span><br><span class="line">* aea74a0 (tfs/default) update documentation</span><br><span class="line">| * 44cd729 (tfs/featureA, featureA) Goodbye</span><br><span class="line">| * d202b53 Branched from $/tfvc-test/Trunk</span><br><span class="line">|/</span><br><span class="line">* c403405 Hello</span><br><span class="line">* b75da1a New project</span><br></pre></td></tr></table></figure>
<p>Now we’re ready to complete our contribution by checking in our code to the TFVC server. We’ll use the <code>rcheckin</code> command here to create a TFVC changeset for each Git commit in the path from HEAD to the first <code>tfs</code> remote branch found (the <code>checkin</code> command would only create one changeset, sort of like squashing Git commits).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git tfs rcheckin</span><br><span class="line">Working with tfs remote: default</span><br><span class="line">Fetching changes from TFS to minimize possibility of late conflict...</span><br><span class="line">Starting checkin of 5cec4ab4 <span class="string">'update readme'</span></span><br><span class="line"> add README.md</span><br><span class="line">C20 = 71a5ddce274c19f8fdc322b4f165d93d89121017</span><br><span class="line">Done with 5cec4ab4b213c354341f66c80cd650ab98dcf1ed, rebasing tail onto new TFS-commit...</span><br><span class="line">Rebase <span class="keyword">done</span> successfully.</span><br><span class="line">Starting checkin of b1bf0f99 <span class="string">'update code'</span></span><br><span class="line"> edit .git\tfs\default\workspace\ConsoleApplication1/ConsoleApplication1/Program.cs</span><br><span class="line">C21 = ff04e7c35dfbe6a8f94e782bf5e0031cee8d103b</span><br><span class="line">Done with b1bf0f9977b2d48bad611ed4a03d3738df05ea5d, rebasing tail onto new TFS-commit...</span><br><span class="line">Rebase <span class="keyword">done</span> successfully.</span><br><span class="line">No more to rcheckin.</span><br><span class="line">PS&gt; git <span class="built_in">log</span> --all --oneline --graph --decorate</span><br><span class="line">* ff04e7c (HEAD, tfs/default, master) update code</span><br><span class="line">* 71a5ddc update readme</span><br><span class="line">* aea74a0 update documentation</span><br><span class="line">| * 44cd729 (tfs/featureA, featureA) Goodbye</span><br><span class="line">| * d202b53 Branched from $/tfvc-test/Trunk</span><br><span class="line">|/</span><br><span class="line">* c403405 Hello</span><br><span class="line">* b75da1a New project</span><br></pre></td></tr></table></figure>
<p>Notice how after every successful checkin to the TFVC server, git-tfs is rebasing the remaining work onto what it just did. That’s because it’s adding the <code>git-tfs-id</code> field to the bottom of the commit messages, which changes the SHA-1 hashes. This is exactly as designed, and there’s nothing to worry about, but you should be aware that it’s happening, especially if you’re sharing Git commits with others.</p>
<p>TFS has many features that integrate with its version control system, such as work items, designated reviewers, gated checkins, and so on. It can be cumbersome to work with these features using only a command-line tool, but fortunately git-tfs lets you launch a graphical checkin tool very easily:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git tfs checkintool</span><br><span class="line">PS&gt; git tfs ct</span><br></pre></td></tr></table></figure>
<p>It looks a bit like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcljonsqj20m80cujrs.jpg" alt="The git-tfs checkin tool.">  Figure 3. The git-tfs checkin tool.  This will look familiar to TFS users, as it’s the same dialog that’s launched from within Visual Studio.</p>
<p>Git-tfs also lets you control TFVC branches from your Git repository. As an example, let’s create one:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git tfs branch $/tfvc-test/featureBee</span><br><span class="line">The name of the <span class="built_in">local</span> branch will be : featureBee</span><br><span class="line">C26 = 1d54865c397608c004a2cadce7296f5edc22a7e5</span><br><span class="line">PS&gt; git <span class="built_in">log</span> --oneline --graph --decorate --all</span><br><span class="line">* 1d54865 (tfs/featureBee) Creation branch $/myproject/featureBee</span><br><span class="line">* ff04e7c (HEAD, tfs/default, master) update code</span><br><span class="line">* 71a5ddc update readme</span><br><span class="line">* aea74a0 update documentation</span><br><span class="line">| * 44cd729 (tfs/featureA, featureA) Goodbye</span><br><span class="line">| * d202b53 Branched from $/tfvc-test/Trunk</span><br><span class="line">|/</span><br><span class="line">* c403405 Hello</span><br><span class="line">* b75da1a New project</span><br></pre></td></tr></table></figure>
<p>Creating a branch in TFVC means adding a changeset where that branch now exists, and this is projected as a Git commit. Note also that git-tfs <strong>created</strong> the <code>tfs/featureBee</code> remote branch, but <code>HEAD</code> is still pointing to <code>master</code>. If you want to work on the newly-minted branch, you’ll want to base your new commits on the <code>1d54865</code> commit, perhaps by creating a topic branch from that commit.</p>
<h4 id="Git-and-TFS-Summary"><a href="#Git-and-TFS-Summary" class="headerlink" title="Git and TFS Summary"></a>Git and TFS Summary</h4><p>Git-tf and Git-tfs are both great tools for interfacing with a TFVC server. They allow you to use the power of Git locally, avoid constantly having to round-trip to the central TFVC server, and make your life as a developer much easier, without forcing your entire team to migrate to Git. If you’re working on Windows (which is likely if your team is using TFS), you’ll probably want to use git-tfs, since its feature set is more complete, but if you’re working on another platform, you’ll be using git-tf, which is more limited. As with most of the tools in this chapter, you should choose one of these version-control systems to be canonical, and use the other one in a subordinate fashion – either Git or TFVC should be the center of collaboration, but not both.</p>
<h2 id="Migrating-to-Git"><a href="#Migrating-to-Git" class="headerlink" title="Migrating to Git"></a>Migrating to Git</h2><p>If you have an existing codebase in another VCS but you’ve decided to start using Git, you must migrate your project one way or another. This section goes over some importers for common systems, and then demonstrates how to develop your own custom importer. You’ll learn how to import data from several of the bigger professionally used SCM systems, because they make up the majority of users who are switching, and because high-quality tools for them are easy to come by.</p>
<h3 id="Subversion"><a href="#Subversion" class="headerlink" title="Subversion"></a>Subversion</h3><p>If you read the previous section about using <code>git svn</code>, you can easily use those instructions to <code>git svn clone</code> a repository; then, stop using the Subversion server, push to a new Git server, and start using that. If you want the history, you can accomplish that as quickly as you can pull the data out of the Subversion server (which may take a while).</p>
<p>However, the import isn’t perfect; and because it will take so long, you may as well do it right. The first problem is the author information. In Subversion, each person committing has a user on the system who is recorded in the commit information. The examples in the previous section show <code>schacon</code> in some places, such as the <code>blame</code> output and the <code>git svn log</code>. If you want to map this to better Git author data, you need a mapping from the Subversion users to the Git authors. Create a file called <code>users.txt</code> that has this mapping in a format like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">schacon = Scott Chacon &lt;schacon@geemail.com&gt;</span><br><span class="line">selse = Someo Nelse &lt;selse@geemail.com&gt;</span><br></pre></td></tr></table></figure>
<p>To get a list of the author names that SVN uses, you can run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ svn <span class="built_in">log</span> --xml --quiet | grep author | sort -u | \</span><br><span class="line">  perl -pe <span class="string">'s/.*&gt;(.*?)&lt;.*/$1 = /'</span></span><br></pre></td></tr></table></figure>
<p>That generates the log output in XML format, then keeps only the lines with author information, discards duplicates, strips out the XML tags. (Obviously this only works on a machine with <code>grep</code>, <code>sort</code>, and <code>perl</code> installed.) Then, redirect that output into your <code>users.txt</code> file so you can add the equivalent Git user data next to each entry.</p>
<p>You can provide this file to <code>git svn</code> to help it map the author data more accurately. You can also tell <code>git svn</code> not to include the metadata that Subversion normally imports, by passing <code>--no-metadata</code> to the <code>clone</code> or <code>init</code> command (though if you want to keep the synchronisation-metadata, feel free to omit this parameter). This makes your <code>import</code> command look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git svn <span class="built_in">clone</span> [http://my-project.googlecode.com/svn/](http://my-project.googlecode.com/svn/) \</span><br><span class="line">      --authors-file=users.txt --no-metadata --prefix <span class="string">""</span> -s my_project</span><br><span class="line">$ <span class="built_in">cd</span> my_project</span><br></pre></td></tr></table></figure>
<p>Now you should have a nicer Subversion import in your <code>my_project</code> directory. Instead of commits that look like this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">commit 37efa680e8473b615de980fa935944215428a35a</span><br><span class="line">Author: schacon &lt;schacon@4c93b258-373f-11de-be05-5f7a86268029&gt;</span><br><span class="line">Date:   Sun May 3 00:12:22 2009 +0000</span><br><span class="line"></span><br><span class="line">    fixed install - go to trunk</span><br><span class="line"></span><br><span class="line">    git-svn-id: [https://my-project.googlecode.com/svn/trunk@94](https://my-project.googlecode.com/svn/trunk@94) 4c93b258-373f-11de-</span><br><span class="line">    be05-5f7a86268029</span><br></pre></td></tr></table></figure>
<p>they look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">commit 03a8785f44c8ea5cdb0e8834b7c8e6c469be2ff2</span><br><span class="line">Author: Scott Chacon &lt;schacon@geemail.com&gt;</span><br><span class="line">Date:   Sun May 3 00:12:22 2009 +0000</span><br><span class="line"></span><br><span class="line">    fixed install - go to trunk</span><br></pre></td></tr></table></figure>
<p>Not only does the Author field look a lot better, but the <code>git-svn-id</code> is no longer there, either.</p>
<p>You should also do a bit of post-import cleanup. For one thing, you should clean up the weird references that <code>git svn</code> set up. First you’ll move the tags so they’re actual tags rather than strange remote branches, and then you’ll move the rest of the branches so they’re local.</p>
<p>To move the tags to be proper Git tags, run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> t <span class="keyword">in</span> $(git <span class="keyword">for</span>-each-ref --format=<span class="string">'%(refname:short)'</span> refs/remotes/tags); <span class="keyword">do</span> git tag <span class="variable">$&#123;t/tags\//&#125;</span> <span class="variable">$t</span> &amp;&amp; git branch -D -r <span class="variable">$t</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>This takes the references that were remote branches that started with <code>refs/remotes/tags/</code> and makes them real (lightweight) tags.</p>
<p>Next, move the rest of the references under <code>refs/remotes</code> to be local branches:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> b <span class="keyword">in</span> $(git <span class="keyword">for</span>-each-ref --format=<span class="string">'%(refname:short)'</span> refs/remotes); <span class="keyword">do</span> git branch <span class="variable">$b</span> refs/remotes/<span class="variable">$b</span> &amp;&amp; git branch -D -r <span class="variable">$b</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>It may happen that you’ll see some extra branches which are suffixed by <code>@xxx</code> (where xxx is a number), while in Subversion you only see one branch. This is actually a Subversion feature called “peg-revisions”, which is something that Git simply has no syntactical counterpart for. Hence, <code>git svn</code> simply adds the svn version number to the branch name just in the same way as you would have written it in svn to address the peg-revision of that branch. If you do not care anymore about the peg-revisions, simply remove them:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> p <span class="keyword">in</span> $(git <span class="keyword">for</span>-each-ref --format=<span class="string">'%(refname:short)'</span> | grep @); <span class="keyword">do</span> git branch -D <span class="variable">$p</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>Now all the old branches are real Git branches and all the old tags are real Git tags.</p>
<p>There’s one last thing to clean up. Unfortunately, <code>git svn</code> creates an extra branch named <code>trunk</code>, which maps to Subversion’s default branch, but the <code>trunk</code> ref points to the same place as <code>master</code>. Since <code>master</code> is more idiomatically Git, here’s how to remove the extra branch:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d trunk</span><br></pre></td></tr></table></figure>
<p>The last thing to do is add your new Git server as a remote and push to it. Here is an example of adding your server as a remote:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@my-git-server:myrepository.git</span><br></pre></td></tr></table></figure>
<p>Because you want all your branches and tags to go up, you can now run this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --all</span><br><span class="line">$ git push origin --tags</span><br></pre></td></tr></table></figure>
<p>All your branches and tags should be on your new Git server in a nice, clean import.</p>
<h3 id="Mercurial"><a href="#Mercurial" class="headerlink" title="Mercurial"></a>Mercurial</h3><p>Since Mercurial and Git have fairly similar models for representing versions, and since Git is a bit more flexible, converting a repository from Mercurial to Git is fairly straightforward, using a tool called “hg-fast-export”, which you’ll need a copy of:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [https://github.com/frej/fast-export.git](https://github.com/frej/fast-export.git)</span><br></pre></td></tr></table></figure>
<p>The first step in the conversion is to get a full clone of the Mercurial repository you want to convert:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hg <span class="built_in">clone</span> &lt;remote repo URL&gt; /tmp/hg-repo</span><br></pre></td></tr></table></figure>
<p>The next step is to create an author mapping file. Mercurial is a bit more forgiving than Git for what it will put in the author field for changesets, so this is a good time to clean house. Generating this is a one-line command in a <code>bash</code> shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /tmp/hg-repo</span><br><span class="line">$ hg <span class="built_in">log</span> | grep user: | sort | uniq | sed <span class="string">'s/user: *//'</span> &gt; ../authors</span><br></pre></td></tr></table></figure>
<p>This will take a few seconds, depending on how long your project’s history is, and afterwards the <code>/tmp/authors</code> file will look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bob</span><br><span class="line">bob@localhost</span><br><span class="line">bob &lt;bob@company.com&gt;</span><br><span class="line">bob jones &lt;bob &lt;AT&gt; company &lt;DOT&gt; com&gt;</span><br><span class="line">Bob Jones &lt;bob@company.com&gt;</span><br><span class="line">Joe Smith &lt;joe@company.com&gt;</span><br></pre></td></tr></table></figure>
<p>In this example, the same person (Bob) has created changesets under four different names, one of which actually looks correct, and one of which would be completely invalid for a Git commit. Hg-fast-export lets us fix this by turning each line into a rule: <code>&quot;&lt;input&gt;&quot;=&quot;&lt;output&gt;&quot;</code>, mapping an <code>&lt;input&gt;</code> to an <code>&lt;output&gt;</code>. Inside the <code>&lt;input&gt;</code> and <code>&lt;output&gt;</code> strings, all escape sequences understood by the python <code>string_escape</code> encoding are supported. If the author mapping file does not contain a matching <code>&lt;input&gt;</code>, that author will be sent on to Git unmodified. If all the usernames look fine, we won’t need this file at all. In this example, we want our file to look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"bob"</span>=<span class="string">"Bob Jones &lt;bob@company.com&gt;"</span></span><br><span class="line"><span class="string">"bob@localhost"</span>=<span class="string">"Bob Jones &lt;bob@company.com&gt;"</span></span><br><span class="line"><span class="string">"bob &lt;bob@company.com&gt;"</span>=<span class="string">"Bob Jones &lt;bob@company.com&gt;"</span></span><br><span class="line"><span class="string">"bob jones &lt;bob &lt;AT&gt; company &lt;DOT&gt; com&gt;"</span>=<span class="string">"Bob Jones &lt;bob@company.com&gt;"</span></span><br></pre></td></tr></table></figure>
<p>The same kind of mapping file can be used to rename branches and tags when the Mercurial name is not allowed by Git.</p>
<p>The next step is to create our new Git repository, and run the export script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git init /tmp/converted</span><br><span class="line">$ <span class="built_in">cd</span> /tmp/converted</span><br><span class="line">$ /tmp/fast-export/hg-fast-export.sh -r /tmp/hg-repo -A /tmp/authors</span><br></pre></td></tr></table></figure>
<p>The <code>-r</code> flag tells hg-fast-export where to find the Mercurial repository we want to convert, and the <code>-A</code> flag tells it where to find the author-mapping file (branch and tag mapping files are specified by the <code>-B</code> and <code>-T</code> flags respectively). The script parses Mercurial changesets and converts them into a script for Git’s “fast-import” feature (which we’ll discuss in detail a bit later on). This takes a bit (though it’s <em>much</em> faster than it would be over the network), and the output is fairly verbose:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ /tmp/fast-export/hg-fast-export.sh -r /tmp/hg-repo -A /tmp/authors</span><br><span class="line">Loaded 4 authors</span><br><span class="line">master: Exporting full revision 1/22208 with 13/0/0 added/changed/removed files</span><br><span class="line">master: Exporting simple delta revision 2/22208 with 1/1/0 added/changed/removed files</span><br><span class="line">master: Exporting simple delta revision 3/22208 with 0/1/0 added/changed/removed files</span><br><span class="line">[…]</span><br><span class="line">master: Exporting simple delta revision 22206/22208 with 0/4/0 added/changed/removed files</span><br><span class="line">master: Exporting simple delta revision 22207/22208 with 0/2/0 added/changed/removed files</span><br><span class="line">master: Exporting thorough delta revision 22208/22208 with 3/213/0 added/changed/removed files</span><br><span class="line">Exporting tag [0.4c] at [hg r9] [git :10]</span><br><span class="line">Exporting tag [0.4d] at [hg r16] [git :17]</span><br><span class="line">[…]</span><br><span class="line">Exporting tag [3.1-rc] at [hg r21926] [git :21927]</span><br><span class="line">Exporting tag [3.1] at [hg r21973] [git :21974]</span><br><span class="line">Issued 22315 commands</span><br><span class="line">git-fast-import statistics:</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Alloc<span class="string">'d objects:     120000</span></span><br><span class="line"><span class="string">Total objects:       115032 (    208171 duplicates                  )</span></span><br><span class="line"><span class="string">      blobs  :        40504 (    205320 duplicates      26117 deltas of      39602 attempts)</span></span><br><span class="line"><span class="string">      trees  :        52320 (      2851 duplicates      47467 deltas of      47599 attempts)</span></span><br><span class="line"><span class="string">      commits:        22208 (         0 duplicates          0 deltas of          0 attempts)</span></span><br><span class="line"><span class="string">      tags   :            0 (         0 duplicates          0 deltas of          0 attempts)</span></span><br><span class="line"><span class="string">Total branches:         109 (         2 loads     )</span></span><br><span class="line"><span class="string">      marks:        1048576 (     22208 unique    )</span></span><br><span class="line"><span class="string">      atoms:           1952</span></span><br><span class="line"><span class="string">Memory total:          7860 KiB</span></span><br><span class="line"><span class="string">       pools:          2235 KiB</span></span><br><span class="line"><span class="string">     objects:          5625 KiB</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------</span></span><br><span class="line"><span class="string">pack_report: getpagesize()            =       4096</span></span><br><span class="line"><span class="string">pack_report: core.packedGitWindowSize = 1073741824</span></span><br><span class="line"><span class="string">pack_report: core.packedGitLimit      = 8589934592</span></span><br><span class="line"><span class="string">pack_report: pack_used_ctr            =      90430</span></span><br><span class="line"><span class="string">pack_report: pack_mmap_calls          =      46771</span></span><br><span class="line"><span class="string">pack_report: pack_open_windows        =          1 /          1</span></span><br><span class="line"><span class="string">pack_report: pack_mapped              =  340852700 /  340852700</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ git shortlog -sn</span></span><br><span class="line"><span class="string">   369  Bob Jones</span></span><br><span class="line"><span class="string">   365  Joe Smith</span></span><br></pre></td></tr></table></figure>
<p>That’s pretty much all there is to it. All of the Mercurial tags have been converted to Git tags, and Mercurial branches and bookmarks have been converted to Git branches. Now you’re ready to push the repository up to its new server-side home:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@my-git-server:myrepository.git</span><br><span class="line">$ git push origin --all</span><br></pre></td></tr></table></figure>
<h3 id="Bazaar"><a href="#Bazaar" class="headerlink" title="Bazaar"></a>Bazaar</h3><p>Bazaar is a DVCS tool much like Git, and as a result it’s pretty straightforward to convert a Bazaar repository into a Git one. To accomplish this, you’ll need to import the <code>bzr-fastimport</code> plugin.</p>
<h4 id="Getting-the-bzr-fastimport-plugin"><a href="#Getting-the-bzr-fastimport-plugin" class="headerlink" title="Getting the bzr-fastimport plugin"></a>Getting the bzr-fastimport plugin</h4><p>The procedure for installing the fastimport plugin is different on UNIX-like operating systems and on Windows. In the first case, the simplest is to install the <code>bzr-fastimport</code> package that will install all the required dependencies.</p>
<p>For example, with Debian and derived, you would do the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install bzr-fastimport</span><br></pre></td></tr></table></figure>
<p>With RHEL, you would do the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install bzr-fastimport</span><br></pre></td></tr></table></figure>
<p>With Fedora, since release 22, the new package manager is dnf:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dnf install bzr-fastimport</span><br></pre></td></tr></table></figure>
<p>If the package is not available, you may install it as a plugin:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir --parents ~/.bazaar/plugins     <span class="comment"># creates the necessary folders for the plugins</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/.bazaar/plugins</span><br><span class="line">$ bzr branch lp:bzr-fastimport fastimport   <span class="comment"># imports the fastimport plugin</span></span><br><span class="line">$ <span class="built_in">cd</span> fastimport</span><br><span class="line">$ sudo python setup.py install --record=files.txt   <span class="comment"># installs the plugin</span></span><br></pre></td></tr></table></figure>
<p>For this plugin to work, you’ll also need the <code>fastimport</code> Python module. You can check whether it is present or not and install it with the following commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python -c <span class="string">"import fastimport"</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;string&gt;"</span>, line 1, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ImportError: No module named fastimport</span><br><span class="line">$ pip install fastimport</span><br></pre></td></tr></table></figure>
<p>If it is not available, you can download it at address &lt;<a href="https://pypi.python.org/pypi/fastimport/" target="_blank" rel="noopener">https://pypi.python.org/pypi/fastimport/</a>&gt;.</p>
<p>In the second case (on Windows), <code>bzr-fastimport</code> is automatically installed with the standalone version and the default installation (let all the checkboxes checked). So in this case you have nothing to do.</p>
<p>At this point, the way to import a Bazaar repository differs according to that you have a single branch or you are working with a repository that has several branches.</p>
<h4 id="Project-with-a-single-branch"><a href="#Project-with-a-single-branch" class="headerlink" title="Project with a single branch"></a>Project with a single branch</h4><p>Now <code>cd</code> in the directory that contains your Bazaar repository and initialize the Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /path/to/the/bzr/repository</span><br><span class="line">$ git init</span><br></pre></td></tr></table></figure>
<p>Now, you can simply export your Bazaar repository and convert it into a Git repository using the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bzr fast-export --plain . | git fast-import</span><br></pre></td></tr></table></figure>
<p>Depending on the size of the project, your Git repository is built in a lapse from a few seconds to a few minutes.</p>
<h4 id="Case-of-a-project-with-a-main-branch-and-a-working-branch"><a href="#Case-of-a-project-with-a-main-branch-and-a-working-branch" class="headerlink" title="Case of a project with a main branch and a working branch"></a>Case of a project with a main branch and a working branch</h4><p>You can also import a Bazaar repository that contains branches. Let us suppose that you have two branches: one represents the main branch (myProject.trunk), the other one is the working branch (myProject.work).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">myProject.trunk myProject.work</span><br></pre></td></tr></table></figure>
<p>Create the Git repository and <code>cd</code> into it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git init git-repo</span><br><span class="line">$ <span class="built_in">cd</span> git-repo</span><br></pre></td></tr></table></figure>
<p>Pull the master branch into git:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bzr fast-export --<span class="built_in">export</span>-marks=../marks.bzr ../myProject.trunk | \</span><br><span class="line">git fast-import --<span class="built_in">export</span>-marks=../marks.git</span><br></pre></td></tr></table></figure>
<p>Pull the working branch into Git:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ bzr fast-export --marks=../marks.bzr --git-branch=work ../myProject.work | \</span><br><span class="line">git fast-import --import-marks=../marks.git --<span class="built_in">export</span>-marks=../marks.git</span><br></pre></td></tr></table></figure>
<p>Now <code>git branch</code> shows you the <code>master</code> branch as well as the <code>work</code> branch. Check the logs to make sure they’re complete and get rid of the <code>marks.bzr</code> and <code>marks.git</code> files.</p>
<h4 id="Synchronizing-the-staging-area"><a href="#Synchronizing-the-staging-area" class="headerlink" title="Synchronizing the staging area"></a>Synchronizing the staging area</h4><p>Whatever the number of branches you had and the import method you used, your staging area is not synchronized with <code>HEAD</code>, and with the import of several branches, your working directory is not synchronized either. This situation is easily solved by the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard HEAD</span><br></pre></td></tr></table></figure>
<h4 id="Ignoring-the-files-that-were-ignored-with-bzrignore"><a href="#Ignoring-the-files-that-were-ignored-with-bzrignore" class="headerlink" title="Ignoring the files that were ignored with .bzrignore"></a>Ignoring the files that were ignored with .bzrignore</h4><p>Now let’s have a look at the files to ignore. The first thing to do is to rename <code>.bzrignore</code> into <code>.gitignore</code>. If the <code>.bzrignore</code> file contains one or several lines starting with “!!” or “RE:”, you’ll have to modify it and perhaps create several <code>.gitignore</code> files in order to ignore exactly the same files that Bazaar was ignoring.</p>
<p>Finally, you will have to create a commit that contains this modification for the migration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git mv .bzrignore .gitignore</span><br><span class="line">$ <span class="comment"># modify .gitignore if needed</span></span><br><span class="line">$ git commit -am <span class="string">'Migration from Bazaar to Git'</span></span><br></pre></td></tr></table></figure>
<h4 id="Sending-your-repository-to-the-server"><a href="#Sending-your-repository-to-the-server" class="headerlink" title="Sending your repository to the server"></a>Sending your repository to the server</h4><p>Here we are! Now you can push the repository onto its new home server:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@my-git-server:mygitrepository.git</span><br><span class="line">$ git push origin --all</span><br><span class="line">$ git push origin --tags</span><br></pre></td></tr></table></figure>
<p>Your Git repository is ready to use.</p>
<h3 id="Perforce"><a href="#Perforce" class="headerlink" title="Perforce"></a>Perforce</h3><p>The next system you’ll look at importing from is Perforce. As we discussed above, there are two ways to let Git and Perforce talk to each other: git-p4 and Perforce Git Fusion.</p>
<h4 id="Perforce-Git-Fusion"><a href="#Perforce-Git-Fusion" class="headerlink" title="Perforce Git Fusion"></a>Perforce Git Fusion</h4><p>Git Fusion makes this process fairly painless. Just configure your project settings, user mappings, and branches using a configuration file (as discussed in 【Git Fusion】), and clone the repository. Git Fusion leaves you with what looks like a native Git repository, which is then ready to push to a native Git host if you desire. You could even use Perforce as your Git host if you like.</p>
<h4 id="Git-p4-1"><a href="#Git-p4-1" class="headerlink" title="Git-p4"></a>Git-p4</h4><p>Git-p4 can also act as an import tool. As an example, we’ll import the Jam project from the Perforce Public Depot. To set up your client, you must export the P4PORT environment variable to point to the Perforce depot:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> P4PORT=public.perforce.com:1666</span><br></pre></td></tr></table></figure>
<p>In order to follow along, you’ll need a Perforce depot to connect with. We’ll be using the public depot at public.perforce.com for our examples, but you can use any depot you have access to.</p>
<p>Run the <code>git p4 clone</code> command to import the Jam project from the Perforce server, supplying the depot and project path and the path into which you want to import the project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git-p4 <span class="built_in">clone</span> //guest/perforce_software/jam@all p4import</span><br><span class="line">Importing from //guest/perforce_software/jam@all into p4import</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /private/tmp/p4import/.git/</span><br><span class="line">Import destination: refs/remotes/p4/master</span><br><span class="line">Importing revision 9957 (100%)</span><br></pre></td></tr></table></figure>
<p>This particular project has only one branch, but if you have branches that are configured with branch views (or just a set of directories), you can use the <code>--detect-branches</code> flag to <code>git p4 clone</code> to import all the project’s branches as well. See 【Branching】 for a bit more detail on this.</p>
<p>At this point you’re almost done. If you go to the <code>p4import</code> directory and run <code>git log</code>, you can see your imported work:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -2</span><br><span class="line">commit e5da1c909e5db3036475419f6379f2c73710c4e6</span><br><span class="line">Author: giles &lt;giles@giles@perforce.com&gt;</span><br><span class="line">Date:   Wed Feb 8 03:13:27 2012 -0800</span><br><span class="line"></span><br><span class="line">    Correction to line 355; change &lt;/UL&gt; to &lt;/OL&gt;.</span><br><span class="line"></span><br><span class="line">    [git-p4: depot-paths = <span class="string">"//public/jam/src/"</span>: change = 8068]</span><br><span class="line"></span><br><span class="line">commit aa21359a0a135dda85c50a7f7cf249e4f7b8fd98</span><br><span class="line">Author: kwirth &lt;kwirth@perforce.com&gt;</span><br><span class="line">Date:   Tue Jul 7 01:35:51 2009 -0800</span><br><span class="line"></span><br><span class="line">    Fix spelling error on Jam doc page (cummulative -&gt; cumulative).</span><br><span class="line"></span><br><span class="line">    [git-p4: depot-paths = <span class="string">"//public/jam/src/"</span>: change = 7304]</span><br></pre></td></tr></table></figure>
<p>You can see that <code>git-p4</code> has left an identifier in each commit message. It’s fine to keep that identifier there, in case you need to reference the Perforce change number later. However, if you’d like to remove the identifier, now is the time to do so – before you start doing work on the new repository. You can use <code>git filter-branch</code> to remove the identifier strings en masse:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git filter-branch --msg-filter <span class="string">'sed -e "/^\[git-p4:/d"'</span></span><br><span class="line">Rewrite e5da1c909e5db3036475419f6379f2c73710c4e6 (125/125)</span><br><span class="line">Ref <span class="string">'refs/heads/master'</span> was rewritten</span><br></pre></td></tr></table></figure>
<p>If you run <code>git log</code>, you can see that all the SHA-1 checksums for the commits have changed, but the <code>git-p4</code> strings are no longer in the commit messages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -2</span><br><span class="line">commit b17341801ed838d97f7800a54a6f9b95750839b7</span><br><span class="line">Author: giles &lt;giles@giles@perforce.com&gt;</span><br><span class="line">Date:   Wed Feb 8 03:13:27 2012 -0800</span><br><span class="line"></span><br><span class="line">    Correction to line 355; change &lt;/UL&gt; to &lt;/OL&gt;.</span><br><span class="line"></span><br><span class="line">commit 3e68c2e26cd89cb983eb52c024ecdfba1d6b3fff</span><br><span class="line">Author: kwirth &lt;kwirth@perforce.com&gt;</span><br><span class="line">Date:   Tue Jul 7 01:35:51 2009 -0800</span><br><span class="line"></span><br><span class="line">    Fix spelling error on Jam doc page (cummulative -&gt; cumulative).</span><br></pre></td></tr></table></figure>
<p>Your import is ready to push up to your new Git server.</p>
<h3 id="TFS"><a href="#TFS" class="headerlink" title="TFS"></a>TFS</h3><p>If your team is converting their source control from TFVC to Git, you’ll want the highest-fidelity conversion you can get. This means that, while we covered both git-tfs and git-tf for the interop section, we’ll only be covering git-tfs for this part, because git-tfs supports branches, and this is prohibitively difficult using git-tf.</p>
<p>This is a one-way conversion. The resulting Git repository won’t be able to connect with the original TFVC project.</p>
<p>The first thing to do is map usernames. TFVC is fairly liberal with what goes into the author field for changesets, but Git wants a human-readable name and email address. You can get this information from the <code>tf</code> command-line client, like so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; tf <span class="built_in">history</span> $/myproject -recursive &gt; AUTHORS_TMP</span><br></pre></td></tr></table></figure>
<p>This grabs all of the changesets in the history of the project and put it in the AUTHORS_TMP file that we will process to extract the data of the <em>User</em> column (the 2nd one). Open the file and find at which characters start and end the column and replace, in the following command-line, the parameters <code>11-20</code> of the <code>cut</code> command with the ones found:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; cat AUTHORS_TMP | cut -b 11-20 | tail -n+3 | sort | uniq &gt; AUTHORS</span><br></pre></td></tr></table></figure>
<p>The <code>cut</code> command keeps only the characters between 11 and 20 from each line. The <code>tail</code> command skips the first two lines, which are field headers and ASCII-art underlines. The result of all of this is piped to <code>sort</code> and <code>uniq</code> to eliminate duplicates, and saved to a file named <code>AUTHORS</code>. The next step is manual; in order for git-tfs to make effective use of this file, each line must be in this format:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DOMAIN\username = User Name &lt;email@address.com&gt;</span><br></pre></td></tr></table></figure>
<p>The portion on the left is the “User” field from TFVC, and the portion on the right side of the equals sign is the user name that will be used for Git commits.</p>
<p>Once you have this file, the next thing to do is make a full clone of the TFVC project you’re interested in:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git tfs <span class="built_in">clone</span> --with-branches --authors=AUTHORS [https://username.visualstudio.com/DefaultCollection](https://username.visualstudio.com/DefaultCollection) $/project/Trunk project_git</span><br></pre></td></tr></table></figure>
<p>Next you’ll want to clean the <code>git-tfs-id</code> sections from the bottom of the commit messages. The following command will do that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; git filter-branch -f --msg-filter <span class="string">'sed "s/^git-tfs-id:.*$//g"'</span> <span class="string">'--'</span> --all</span><br></pre></td></tr></table></figure>
<p>That uses the <code>sed</code> command from the Git-bash environment to replace any line starting with “git-tfs-id:” with emptiness, which Git will then ignore.</p>
<p>Once that’s all done, you’re ready to add a new remote, push all your branches up, and have your team start working from Git.</p>
<h3 id="A-Custom-Importer"><a href="#A-Custom-Importer" class="headerlink" title="A Custom Importer"></a>A Custom Importer</h3><p>If your system isn’t one of the above, you should look for an importer online – quality importers are available for many other systems, including CVS, Clear Case, Visual Source Safe, even a directory of archives. If none of these tools works for you, you have a more obscure tool, or you otherwise need a more custom importing process, you should use <code>git fast-import</code>. This command reads simple instructions from stdin to write specific Git data. It’s much easier to create Git objects this way than to run the raw Git commands or try to write the raw objects (see 【Git Internals】 for more information). This way, you can write an import script that reads the necessary information out of the system you’re importing from and prints straightforward instructions to stdout. You can then run this program and pipe its output through <code>git fast-import</code>.</p>
<p>To quickly demonstrate, you’ll write a simple importer. Suppose you work in <code>current</code>, you back up your project by occasionally copying the directory into a time-stamped <code>back_YYYY_MM_DD</code> backup directory, and you want to import this into Git. Your directory structure looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ls /opt/import_from</span><br><span class="line">back_2014_01_02</span><br><span class="line">back_2014_01_04</span><br><span class="line">back_2014_01_14</span><br><span class="line">back_2014_02_03</span><br><span class="line">current</span><br></pre></td></tr></table></figure>
<p>In order to import a Git directory, you need to review how Git stores its data. As you may remember, Git is fundamentally a linked list of commit objects that point to a snapshot of content. All you have to do is tell <code>fast-import</code> what the content snapshots are, what commit data points to them, and the order they go in. Your strategy will be to go through the snapshots one at a time and create commits with the contents of each directory, linking each commit back to the previous one.</p>
<p>As we did in 【An Example Git-Enforced Policy】, we’ll write this in Ruby, because it’s what we generally work with and it tends to be easy to read. You can write this example pretty easily in anything you’re familiar with – it just needs to print the appropriate information to <code>stdout</code>. And, if you are running on Windows, this means you’ll need to take special care to not introduce carriage returns at the end your lines – <code>git fast-import</code> is very particular about just wanting line feeds (LF) not the carriage return line feeds (CRLF) that Windows uses.</p>
<p>To begin, you’ll change into the target directory and identify every subdirectory, each of which is a snapshot that you want to import as a commit. You’ll change into each subdirectory and print the commands necessary to export it. Your basic main loop looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">last_mark = nil</span><br><span class="line"></span><br><span class="line"><span class="comment"># loop through the directories</span></span><br><span class="line">Dir.chdir(ARGV[0]) <span class="keyword">do</span></span><br><span class="line">  Dir.glob(<span class="string">"*"</span>).each <span class="keyword">do</span> |dir|</span><br><span class="line">    next <span class="keyword">if</span> File.file?(dir)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># move into the target directory</span></span><br><span class="line">    Dir.chdir(dir) <span class="keyword">do</span></span><br><span class="line">      last_mark = print_export(dir, last_mark)</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>You run <code>print_export</code> inside each directory, which takes the manifest and mark of the previous snapshot and returns the manifest and mark of this one; that way, you can link them properly. “Mark” is the <code>fast-import</code> term for an identifier you give to a commit; as you create commits, you give each one a mark that you can use to link to it from other commits. So, the first thing to do in your <code>print_export</code> method is generate a mark from the directory name:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mark = convert_dir_to_mark(dir)</span><br></pre></td></tr></table></figure>
<p>You’ll do this by creating an array of directories and using the index value as the mark, because a mark must be an integer. Your method looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$marks</span> = []</span><br><span class="line">def convert_dir_to_mark(dir)</span><br><span class="line">  <span class="keyword">if</span> !<span class="variable">$marks</span>.include?(dir)</span><br><span class="line">    <span class="variable">$marks</span> &lt;&lt; dir</span><br><span class="line">  end</span><br><span class="line">  (<span class="variable">$marks</span>.index(dir) + 1).to_s</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Now that you have an integer representation of your commit, you need a date for the commit metadata. Because the date is expressed in the name of the directory, you’ll parse it out. The next line in your <code>print_export</code> file is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date = convert_dir_to_date(dir)</span><br></pre></td></tr></table></figure>
<p>where <code>convert_dir_to_date</code> is defined as:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def convert_dir_to_date(dir)</span><br><span class="line">  <span class="keyword">if</span> dir == <span class="string">'current'</span></span><br><span class="line">    <span class="built_in">return</span> Time.now().to_i</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    dir = dir.gsub(<span class="string">'back_'</span>, <span class="string">''</span>)</span><br><span class="line">    (year, month, day) = dir.split(<span class="string">'_'</span>)</span><br><span class="line">    <span class="built_in">return</span> Time.local(year, month, day).to_i</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>That returns an integer value for the date of each directory. The last piece of meta-information you need for each commit is the committer data, which you hardcode in a global variable:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$author</span> = <span class="string">'John Doe &lt;john@example.com&gt;'</span></span><br></pre></td></tr></table></figure>
<p>Now you’re ready to begin printing out the commit data for your importer. The initial information states that you’re defining a commit object and what branch it’s on, followed by the mark you’ve generated, the committer information and commit message, and then the previous commit, if any. The code looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># print the import information</span></span><br><span class="line">puts <span class="string">'commit refs/heads/master'</span></span><br><span class="line">puts <span class="string">'mark :'</span> + mark</span><br><span class="line">puts <span class="string">"committer #&#123;<span class="variable">$author</span>&#125; #&#123;date&#125; -0700"</span></span><br><span class="line">export_data(<span class="string">'imported from '</span> + dir)</span><br><span class="line">puts <span class="string">'from :'</span> + last_mark <span class="keyword">if</span> last_mark</span><br></pre></td></tr></table></figure>
<p>You hardcode the time zone (-0700) because doing so is easy. If you’re importing from another system, you must specify the time zone as an offset. The commit message must be expressed in a special format:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data (size)\n(contents)</span><br></pre></td></tr></table></figure>
<p>The format consists of the word data, the size of the data to be read, a newline, and finally the data. Because you need to use the same format to specify the file contents later, you create a helper method, <code>export_data</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def export_data(string)</span><br><span class="line">  <span class="built_in">print</span> <span class="string">"data #&#123;string.size&#125;\n#&#123;string&#125;"</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>All that’s left is to specify the file contents for each snapshot. This is easy, because you have each one in a directory – you can print out the <code>deleteall</code> command followed by the contents of each file in the directory. Git will then record each snapshot appropriately:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">puts <span class="string">'deleteall'</span></span><br><span class="line">Dir.glob(<span class="string">"**/*"</span>).each <span class="keyword">do</span> |file|</span><br><span class="line">  next <span class="keyword">if</span> !File.file?(file)</span><br><span class="line">  inline_data(file)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>Note: Because many systems think of their revisions as changes from one commit to another, fast-import can also take commands with each commit to specify which files have been added, removed, or modified and what the new contents are. You could calculate the differences between snapshots and provide only this data, but doing so is more complex – you may as well give Git all the data and let it figure it out. If this is better suited to your data, check the <code>fast-import</code> man page for details about how to provide your data in this manner.</p>
<p>The format for listing the new file contents or specifying a modified file with the new contents is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">M 644 inline path/to/file</span><br><span class="line">data (size)</span><br><span class="line">(file contents)</span><br></pre></td></tr></table></figure>
<p>Here, 644 is the mode (if you have executable files, you need to detect and specify 755 instead), and inline says you’ll list the contents immediately after this line. Your <code>inline_data</code> method looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def inline_data(file, code = <span class="string">'M'</span>, mode = <span class="string">'644'</span>)</span><br><span class="line">  content = File.read(file)</span><br><span class="line">  puts <span class="string">"#&#123;code&#125; #&#123;mode&#125; inline #&#123;file&#125;"</span></span><br><span class="line">  export_data(content)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>You reuse the <code>export_data</code> method you defined earlier, because it’s the same as the way you specified your commit message data.</p>
<p>The last thing you need to do is to return the current mark so it can be passed to the next iteration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">return</span> mark</span><br></pre></td></tr></table></figure>
<p>If you are running on Windows you’ll need to make sure that you add one extra step. As mentioned before, Windows uses CRLF for new line characters while <code>git fast-import</code> expects only LF. To get around this problem and make <code>git fast-import</code> happy, you need to tell ruby to use LF instead of CRLF:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stdout</span>.binmode</span><br></pre></td></tr></table></figure>
<p>That’s it. Here’s the script in its entirety:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env ruby</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$stdout</span>.binmode</span><br><span class="line"><span class="variable">$author</span> = <span class="string">"John Doe &lt;john@example.com&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$marks</span> = []</span><br><span class="line">def convert_dir_to_mark(dir)</span><br><span class="line">    <span class="keyword">if</span> !<span class="variable">$marks</span>.include?(dir)</span><br><span class="line">        <span class="variable">$marks</span> &lt;&lt; dir</span><br><span class="line">    end</span><br><span class="line">    (<span class="variable">$marks</span>.index(dir)+1).to_s</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def convert_dir_to_date(dir)</span><br><span class="line">    <span class="keyword">if</span> dir == <span class="string">'current'</span></span><br><span class="line">        <span class="built_in">return</span> Time.now().to_i</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        dir = dir.gsub(<span class="string">'back_'</span>, <span class="string">''</span>)</span><br><span class="line">        (year, month, day) = dir.split(<span class="string">'_'</span>)</span><br><span class="line">        <span class="built_in">return</span> Time.local(year, month, day).to_i</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def export_data(string)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">"data #&#123;string.size&#125;\n#&#123;string&#125;"</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def inline_data(file, code=<span class="string">'M'</span>, mode=<span class="string">'644'</span>)</span><br><span class="line">    content = File.read(file)</span><br><span class="line">    puts <span class="string">"#&#123;code&#125; #&#123;mode&#125; inline #&#123;file&#125;"</span></span><br><span class="line">    export_data(content)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def print_export(dir, last_mark)</span><br><span class="line">    date = convert_dir_to_date(dir)</span><br><span class="line">    mark = convert_dir_to_mark(dir)</span><br><span class="line"></span><br><span class="line">    puts <span class="string">'commit refs/heads/master'</span></span><br><span class="line">    puts <span class="string">"mark :#&#123;mark&#125;"</span></span><br><span class="line">    puts <span class="string">"committer #&#123;<span class="variable">$author</span>&#125; #&#123;date&#125; -0700"</span></span><br><span class="line">    export_data(<span class="string">"imported from #&#123;dir&#125;"</span>)</span><br><span class="line">    puts <span class="string">"from :#&#123;last_mark&#125;"</span> <span class="keyword">if</span> last_mark</span><br><span class="line"></span><br><span class="line">    puts <span class="string">'deleteall'</span></span><br><span class="line">    Dir.glob(<span class="string">"**/*"</span>).each <span class="keyword">do</span> |file|</span><br><span class="line">        next <span class="keyword">if</span> !File.file?(file)</span><br><span class="line">        inline_data(file)</span><br><span class="line">    end</span><br><span class="line">    mark</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="comment"># Loop through the directories</span></span><br><span class="line">last_mark = nil</span><br><span class="line">Dir.chdir(ARGV[0]) <span class="keyword">do</span></span><br><span class="line">    Dir.glob(<span class="string">"*"</span>).each <span class="keyword">do</span> |dir|</span><br><span class="line">        next <span class="keyword">if</span> File.file?(dir)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># move into the target directory</span></span><br><span class="line">        Dir.chdir(dir) <span class="keyword">do</span></span><br><span class="line">            last_mark = print_export(dir, last_mark)</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>If you run this script, you’ll get content that looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ ruby import.rb /opt/import_from</span><br><span class="line">commit refs/heads/master</span><br><span class="line">mark :1</span><br><span class="line">committer John Doe &lt;john@example.com&gt; 1388649600 -0700</span><br><span class="line">data 29</span><br><span class="line">imported from back_2014_01_02deleteall</span><br><span class="line">M 644 inline README.md</span><br><span class="line">data 28</span><br><span class="line"><span class="comment"># Hello</span></span><br><span class="line"></span><br><span class="line">This is my readme.</span><br><span class="line">commit refs/heads/master</span><br><span class="line">mark :2</span><br><span class="line">committer John Doe &lt;john@example.com&gt; 1388822400 -0700</span><br><span class="line">data 29</span><br><span class="line">imported from back_2014_01_04from :1</span><br><span class="line">deleteall</span><br><span class="line">M 644 inline main.rb</span><br><span class="line">data 34</span><br><span class="line"><span class="comment">#!/bin/env ruby</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"Hey there"</span></span><br><span class="line">M 644 inline README.md</span><br><span class="line">(...)</span><br></pre></td></tr></table></figure>
<p>To run the importer, pipe this output through <code>git fast-import</code> while in the Git directory you want to import into. You can create a new directory and then run <code>git init</code> in it for a starting point, and then run your script:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /opt/import_to/.git/</span><br><span class="line">$ ruby import.rb /opt/import_from | git fast-import</span><br><span class="line">git-fast-import statistics:</span><br><span class="line">---------------------------------------------------------------------</span><br><span class="line">Alloc<span class="string">'d objects:       5000</span></span><br><span class="line"><span class="string">Total objects:           13 (         6 duplicates                  )</span></span><br><span class="line"><span class="string">      blobs  :            5 (         4 duplicates          3 deltas of          5 attempts)</span></span><br><span class="line"><span class="string">      trees  :            4 (         1 duplicates          0 deltas of          4 attempts)</span></span><br><span class="line"><span class="string">      commits:            4 (         1 duplicates          0 deltas of          0 attempts)</span></span><br><span class="line"><span class="string">      tags   :            0 (         0 duplicates          0 deltas of          0 attempts)</span></span><br><span class="line"><span class="string">Total branches:           1 (         1 loads     )</span></span><br><span class="line"><span class="string">      marks:           1024 (         5 unique    )</span></span><br><span class="line"><span class="string">      atoms:              2</span></span><br><span class="line"><span class="string">Memory total:          2344 KiB</span></span><br><span class="line"><span class="string">       pools:          2110 KiB</span></span><br><span class="line"><span class="string">     objects:           234 KiB</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------</span></span><br><span class="line"><span class="string">pack_report: getpagesize()            =       4096</span></span><br><span class="line"><span class="string">pack_report: core.packedGitWindowSize = 1073741824</span></span><br><span class="line"><span class="string">pack_report: core.packedGitLimit      = 8589934592</span></span><br><span class="line"><span class="string">pack_report: pack_used_ctr            =         10</span></span><br><span class="line"><span class="string">pack_report: pack_mmap_calls          =          5</span></span><br><span class="line"><span class="string">pack_report: pack_open_windows        =          2 /          2</span></span><br><span class="line"><span class="string">pack_report: pack_mapped              =       1457 /       1457</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<p>As you can see, when it completes successfully, it gives you a bunch of statistics about what it accomplished. In this case, you imported 13 objects total for 4 commits into 1 branch. Now, you can run <code>git log</code> to see your new history:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -2</span><br><span class="line">commit 3caa046d4aac682a55867132ccdfbe0d3fdee498</span><br><span class="line">Author: John Doe &lt;john@example.com&gt;</span><br><span class="line">Date:   Tue Jul 29 19:39:04 2014 -0700</span><br><span class="line"></span><br><span class="line">    imported from current</span><br><span class="line"></span><br><span class="line">commit 4afc2b945d0d3c8cd00556fbe2e8224569dc9def</span><br><span class="line">Author: John Doe &lt;john@example.com&gt;</span><br><span class="line">Date:   Mon Feb 3 01:00:00 2014 -0700</span><br><span class="line"></span><br><span class="line">    imported from back_2014_02_03</span><br></pre></td></tr></table></figure>
<p>There you go – a nice, clean Git repository. It’s important to note that nothing is checked out – you don’t have any files in your working directory at first. To get them, you must reset your branch to where <code>master</code> is now:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">$ git reset --hard master</span><br><span class="line">HEAD is now at 3caa046 imported from current</span><br><span class="line">$ ls</span><br><span class="line">README.md main.rb</span><br></pre></td></tr></table></figure>
<p>You can do a lot more with the <code>fast-import</code> tool – handle different modes, binary data, multiple branches and merging, tags, progress indicators, and more. A number of examples of more complex scenarios are available in the <code>contrib/fast-import</code> directory of the Git source code.</p>
<h2 id="Summary-11"><a href="#Summary-11" class="headerlink" title="Summary"></a>Summary</h2><p>You should feel comfortable using Git as a client for other version-control systems, or importing nearly any existing repository into Git without losing data. In the next chapter, we’ll cover the raw internals of Git so you can craft every single byte, if need be.</p>
<h1 id="Git-Internals"><a href="#Git-Internals" class="headerlink" title="Git Internals"></a><strong>Git</strong> <strong>Internals</strong></h1><p>You may have skipped to this chapter from a much earlier chapter, or you may have gotten here after sequentially reading the entire book up to this point — in either case, this is where we’ll go over the inner workings and implementation of Git. We found that understanding this information was fundamentally important to appreciating how useful and powerful Git is, but others have argued to us that it can be confusing and unnecessarily complex for beginners. Thus, we’ve made this discussion the last chapter in the book so you could read it early or later in your learning process. We leave it up to you to decide.</p>
<p>Now that you’re here, let’s get started. First, if it isn’t yet clear, Git is fundamentally a content-addressable filesystem with a VCS user interface written on top of it. You’ll learn more about what this means in a bit.</p>
<p>In the early days of Git (mostly pre 1.5), the user interface was much more complex because it emphasized this filesystem rather than a polished VCS. In the last few years, the UI has been refined until it’s as clean and easy to use as any system out there; however, the stereotype lingers about the early Git UI that was complex and difficult to learn.</p>
<p>The content-addressable filesystem layer is amazingly cool, so we’ll cover that first in this chapter; then, you’ll learn about the transport mechanisms and the repository maintenance tasks that you may eventually have to deal with.</p>
<h2 id="Plumbing-and-Porcelain"><a href="#Plumbing-and-Porcelain" class="headerlink" title="Plumbing and Porcelain"></a>Plumbing and Porcelain</h2><p>This book covers primarily how to use Git with 30 or so subcommands such as <code>checkout</code>, <code>branch</code>, <code>remote</code>, and so on. But because Git was initially a toolkit for a version control system rather than a full user-friendly VCS, it has a number of subcommands that do low-level work and were designed to be chained together UNIX-style or called from scripts. These commands are generally referred to as Git’s “plumbing” commands, while the more user-friendly commands are called “porcelain” commands.</p>
<p>As you will have noticed by now, this book’s first nine chapters deal almost exclusively with porcelain commands. But in this chapter, you’ll be dealing mostly with the lower-level plumbing commands, because they give you access to the inner workings of Git, and help demonstrate how and why Git does what it does. Many of these commands aren’t meant to be used manually on the command line, but rather to be used as building blocks for new tools and custom scripts.</p>
<p>When you run <code>git init</code> in a new or existing directory, Git creates the <code>.git</code> directory, which is where almost everything that Git stores and manipulates is located. If you want to back up or clone your repository, copying this single directory elsewhere gives you nearly everything you need. This entire chapter basically deals with what you can see in this directory. Here’s what a newly-initialized <code>.git</code> directory typically looks like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ls -F1</span><br><span class="line">config</span><br><span class="line">description</span><br><span class="line">HEAD</span><br><span class="line">hooks/</span><br><span class="line">info/</span><br><span class="line">objects/</span><br><span class="line">refs/</span><br></pre></td></tr></table></figure>
<p>Depending on your version of Git, you may see some additional content there, but this is a fresh <code>git init</code> repository — it’s what you see by default. The <code>description</code> file is used only by the GitWeb program, so don’t worry about it. The <code>config</code> file contains your project-specific configuration options, and the <code>info</code> directory keeps a global exclude file for ignored patterns that you don’t want to track in a <code>.gitignore</code> file. The <code>hooks</code> directory contains your client- or server-side hook scripts, which are discussed in detail in 【Git Hooks】.</p>
<p>This leaves four important entries: the <code>HEAD</code> and (yet to be created) <code>index</code> files, and the <code>objects</code> and <code>refs</code> directories. These are the core parts of Git. The <code>objects</code> directory stores all the content for your database, the <code>refs</code> directory stores pointers into commit objects in that data (branches, tags, remotes and more), the <code>HEAD</code> file points to the branch you currently have checked out, and the <code>index</code> file is where Git stores your staging area information. You’ll now look at each of these sections in detail to see how Git operates.</p>
<h2 id="Git-Objects"><a href="#Git-Objects" class="headerlink" title="Git Objects"></a>Git Objects</h2><p>Git is a content-addressable filesystem. Great. What does that mean? It means that at the core of Git is a simple key-value data store. What this means is that you can insert any kind of content into a Git repository, for which Git will hand you back a unique key you can use later to retrieve that content.</p>
<p>As a demonstration, let’s look at the plumbing command <code>git hash-object</code>, which takes some data, stores it in your <code>.git/objects</code> directory (the <em>object database</em>), and gives you back the unique key that now refers to that data object.</p>
<p>First, you initialize a new Git repository and verify that there is (predictably) nothing in the <code>objects</code> directory:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git init <span class="built_in">test</span></span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /tmp/<span class="built_in">test</span>/.git/</span><br><span class="line">$ <span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">$ find .git/objects</span><br><span class="line">.git/objects</span><br><span class="line">.git/objects/info</span><br><span class="line">.git/objects/pack</span><br><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br></pre></td></tr></table></figure>
<p>Git has initialized the <code>objects</code> directory and created <code>pack</code> and <code>info</code> subdirectories in it, but there are no regular files. Now, let’s use <code>git hash-object</code> to create a new data object and manually store it in your new Git database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'test content'</span> | git <span class="built_in">hash</span>-object -w --stdin</span><br><span class="line">d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure>
<p>In its simplest form, <code>git hash-object</code> would take the content you handed to it and merely return the unique key that <em>would</em> be used to store it in your Git database. The <code>-w</code> option then tells the command to not simply return the key, but to write that object to the database. Finally, the <code>--stdin</code> option tells <code>git hash-object</code> to get the content to be processed from stdin; otherwise, the command would expect a filename argument at the end of the command containing the content to be used.</p>
<p>The output from the above command is a 40-character checksum hash. This is the SHA-1 hash — a checksum of the content you’re storing plus a header, which you’ll learn about in a bit. Now you can see how Git has stored your data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure>
<p>If you again examine your <code>objects</code> directory, you can see that it now contains a file for that new content. This is how Git stores the content initially — as a single file per piece of content, named with the SHA-1 checksum of the content and its header. The subdirectory is named with the first 2 characters of the SHA-1, and the filename is the remaining 38 characters.</p>
<p>Once you have content in your object database, you can examine that content with the <code>git cat-file</code> command. This command is sort of a Swiss army knife for inspecting Git objects. Passing <code>-p</code> to <code>cat-file</code> instructs the command to first figure out the type of content, then display it appropriately:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line"><span class="built_in">test</span> content</span><br></pre></td></tr></table></figure>
<p>Now, you can add content to Git and pull it back out again. You can also do this with content in files. For example, you can do some simple version control on a file. First, create a new file and save its contents in your database:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'version 1'</span> &gt; test.txt</span><br><span class="line">$ git <span class="built_in">hash</span>-object -w test.txt</span><br><span class="line">83baae61804e65cc73a7201a7252750c76066a30</span><br></pre></td></tr></table></figure>
<p>Then, write some new content to the file, and save it again:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'version 2'</span> &gt; test.txt</span><br><span class="line">$ git <span class="built_in">hash</span>-object -w test.txt</span><br><span class="line">1f7a7a472abf3dd9643fd615f6da379c4acb3e3a</span><br></pre></td></tr></table></figure>
<p>Your object database now contains both versions of this new file (as well as the first content you stored there):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a</span><br><span class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure>
<p>At this point, you can delete your local copy of that <code>test.txt</code> file, then use Git to retrieve, from the object database, either the first version you saved:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 83baae61804e65cc73a7201a7252750c76066a30 &gt; test.txt</span><br><span class="line">$ cat test.txt</span><br><span class="line">version 1</span><br></pre></td></tr></table></figure>
<p>or the second version:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a &gt; test.txt</span><br><span class="line">$ cat test.txt</span><br><span class="line">version 2</span><br></pre></td></tr></table></figure>
<p>But remembering the SHA-1 key for each version of your file isn’t practical; plus, you aren’t storing the filename in your system — just the content. This object type is called a <em>blob</em>. You can have Git tell you the object type of any object in Git, given its SHA-1 key, with <code>git cat-file -t</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a</span><br><span class="line">blob</span><br></pre></td></tr></table></figure>
<h3 id="Tree-Objects"><a href="#Tree-Objects" class="headerlink" title="Tree Objects"></a>Tree Objects</h3><p>The next type of Git object we’ll examine is the <em>tree</em>, which solves the problem of storing the filename and also allows you to store a group of files together. Git stores content in a manner similar to a UNIX filesystem, but a bit simplified. All the content is stored as tree and blob objects, with trees corresponding to UNIX directory entries and blobs corresponding more or less to inodes or file contents. A single tree object contains one or more tree entries, each of which contains a SHA-1 pointer to a blob or subtree with its associated mode, type, and filename. For example, the most recent tree in a project may look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p master^&#123;tree&#125;</span><br><span class="line">100644 blob a906cb2a4a904a152e80877d4088654daad0c859      README</span><br><span class="line">100644 blob 8f94139338f9404f26296befa88755fc2598c289      Rakefile</span><br><span class="line">040000 tree 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0      lib</span><br></pre></td></tr></table></figure>
<p>The <code>master^{tree}</code> syntax specifies the tree object that is pointed to by the last commit on your <code>master</code> branch. Notice that the <code>lib</code> subdirectory isn’t a blob but a pointer to another tree:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 99f1a6d12cb4b6f19c8655fca46c3ecf317074e0</span><br><span class="line">100644 blob 47c6340d6459e05787f644c2447d2595f5d3a54b      simplegit.rb</span><br></pre></td></tr></table></figure>
<p>Depending on what shell you use, you may encounter errors when using the <code>master^{tree}</code> syntax.</p>
<p>In CMD on Windows, the <code>^</code> character is used for escaping, so you have to double it to avoid this: <code>git cat-file -p master^^{tree}</code>. When using PowerShell, parameters using {} characters have to be quoted to avoid the parameter being parsed incorrectly: <code>git cat-file -p &#39;master^{tree}&#39;</code>.</p>
<p>If you’re using ZSH, the <code>^</code> character is used for globbing, so you have to enclose the whole expression in quotes: <code>git cat-file -p &quot;master^{tree}&quot;</code>.</p>
<p>Conceptually, the data that Git is storing looks something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmceohnj20m80gh3yo.jpg" alt="Simple version of the Git data model.">  Figure 1. Simple version of the Git data model.  You can fairly easily create your own tree. Git normally creates a tree by taking the state of your staging area or index and writing a series of tree objects from it. So, to create a tree object, you first have to set up an index by staging some files. To create an index with a single entry — the first version of your <code>test.txt</code> file — you can use the plumbing command <code>git update-index</code>. You use this command to artificially add the earlier version of the <code>test.txt</code> file to a new staging area. You must pass it the <code>--add</code> option because the file doesn’t yet exist in your staging area (you don’t even have a staging area set up yet) and <code>--cacheinfo</code> because the file you’re adding isn’t in your directory but is in your database. Then, you specify the mode, SHA-1, and filename:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git update-index --add --cacheinfo 100644 \</span><br><span class="line">  83baae61804e65cc73a7201a7252750c76066a30 test.txt</span><br></pre></td></tr></table></figure>
<p>In this case, you’re specifying a mode of <code>100644</code>, which means it’s a normal file. Other options are <code>100755</code>, which means it’s an executable file; and <code>120000</code>, which specifies a symbolic link. The mode is taken from normal UNIX modes but is much less flexible — these three modes are the only ones that are valid for files (blobs) in Git (although other modes are used for directories and submodules).</p>
<p>Now, you can use <code>git write-tree</code> to write the staging area out to a tree object. No <code>-w</code> option is needed — calling this command automatically creates a tree object from the state of the index if that tree doesn’t yet exist:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git write-tree</span><br><span class="line">d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">$ git cat-file -p d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">100644 blob 83baae61804e65cc73a7201a7252750c76066a30      test.txt</span><br></pre></td></tr></table></figure>
<p>You can also verify that this is a tree object using the same <code>git cat-file</code> command you saw earlier:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">tree</span><br></pre></td></tr></table></figure>
<p>You’ll now create a new tree with the second version of <code>test.txt</code> and a new file as well:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'new file'</span> &gt; new.txt</span><br><span class="line">$ git update-index --add --cacheinfo 100644 \</span><br><span class="line">  1f7a7a472abf3dd9643fd615f6da379c4acb3e3a test.txt</span><br><span class="line">$ git update-index --add new.txt</span><br></pre></td></tr></table></figure>
<p>Your staging area now has the new version of <code>test.txt</code> as well as the new file <code>new.txt</code>. Write out that tree (recording the state of the staging area or index to a tree object) and see what it looks like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git write-tree</span><br><span class="line">0155eb4229851634a0f03eb265b69f5a2d56f341</span><br><span class="line">$ git cat-file -p 0155eb4229851634a0f03eb265b69f5a2d56f341</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt</span><br></pre></td></tr></table></figure>
<p>Notice that this tree has both file entries and also that the <code>test.txt</code> SHA-1 is the “version 2” SHA-1 from earlier (<code>1f7a7a</code>). Just for fun, you’ll add the first tree as a subdirectory into this one. You can read trees into your staging area by calling <code>git read-tree</code>. In this case, you can read an existing tree into your staging area as a subtree by using the <code>--prefix</code> option with this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">read</span>-tree --prefix=bak d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">$ git write-tree</span><br><span class="line">3c4e9cd789d88d8d89c1073707c3585e41b0e614</span><br><span class="line">$ git cat-file -p 3c4e9cd789d88d8d89c1073707c3585e41b0e614</span><br><span class="line">040000 tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579      bak</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 1f7a7a472abf3dd9643fd615f6da379c4acb3e3a      test.txt</span><br></pre></td></tr></table></figure>
<p>If you created a working directory from the new tree you just wrote, you would get the two files in the top level of the working directory and a subdirectory named <code>bak</code> that contained the first version of the <code>test.txt</code> file. You can think of the data that Git contains for these structures as being like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcn7zq9qj20m80gh74m.jpg" alt="The content structure of your current Git data.">  Figure 2. The content structure of your current Git data.</p>
<h3 id="Commit-Objects"><a href="#Commit-Objects" class="headerlink" title="Commit Objects"></a>Commit Objects</h3><p>If you’ve done all of the above, you now have three trees that represent the different snapshots of your project that you want to track, but the earlier problem remains: you must remember all three SHA-1 values in order to recall the snapshots. You also don’t have any information about who saved the snapshots, when they were saved, or why they were saved. This is the basic information that the commit object stores for you.</p>
<p>To create a commit object, you call <code>commit-tree</code> and specify a single tree SHA-1 and which commit objects, if any, directly preceded it. Start with the first tree you wrote:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'first commit'</span> | git commit-tree d8329f</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d</span><br></pre></td></tr></table></figure>
<p>You will get a different hash value because of different creation time and author data. Replace commit and tag hashes with your own checksums further in this chapter. Now you can look at your new commit object with <code>git cat-file</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p fdf4fc3</span><br><span class="line">tree d8329fc1cc938780ffdd9f94e0d364e0ea74f579</span><br><span class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1243040974 -0700</span><br><span class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1243040974 -0700</span><br><span class="line"></span><br><span class="line">first commit</span><br></pre></td></tr></table></figure>
<p>The format for a commit object is simple: it specifies the top-level tree for the snapshot of the project at that point; the author/committer information (which uses your <code>user.name</code> and <code>user.email</code> configuration settings and a timestamp); a blank line, and then the commit message.</p>
<p>Next, you’ll write the other two commit objects, each referencing the commit that came directly before it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'second commit'</span> | git commit-tree 0155eb -p fdf4fc3</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'third commit'</span>  | git commit-tree 3c4e9c -p cac0cab</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9</span><br></pre></td></tr></table></figure>
<p>Each of the three commit objects points to one of the three snapshot trees you created. Oddly enough, you have a real Git history now that you can view with the <code>git log</code> command, if you run it on the last commit SHA-1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span> 1a410e</span><br><span class="line">commit 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:15:24 2009 -0700</span><br><span class="line"></span><br><span class="line">	third commit</span><br><span class="line"></span><br><span class="line"> bak/test.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">commit cac0cab538b970a37ea1e769cbbde608743bc96d</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:14:29 2009 -0700</span><br><span class="line"></span><br><span class="line">	second commit</span><br><span class="line"></span><br><span class="line"> new.txt  | 1 +</span><br><span class="line"> test.txt | 2 +-</span><br><span class="line"> 2 files changed, 2 insertions(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">commit fdf4fc3344e67ab068f836878b6c4951e3b15f3d</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:09:34 2009 -0700</span><br><span class="line"></span><br><span class="line">    first commit</span><br><span class="line"></span><br><span class="line"> test.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<p>Amazing. You’ve just done the low-level operations to build up a Git history without using any of the front end commands. This is essentially what Git does when you run the <code>git add</code> and <code>git commit</code> commands — it stores blobs for the files that have changed, updates the index, writes out trees, and writes commit objects that reference the top-level trees and the commits that came immediately before them. These three main Git objects — the blob, the tree, and the commit — are initially stored as separate files in your <code>.git/objects</code> directory. Here are all the objects in the example directory now, commented with what they store:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 <span class="comment"># tree 2</span></span><br><span class="line">.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 <span class="comment"># commit 3</span></span><br><span class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a <span class="comment"># test.txt v2</span></span><br><span class="line">.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 <span class="comment"># tree 3</span></span><br><span class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 <span class="comment"># test.txt v1</span></span><br><span class="line">.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d <span class="comment"># commit 2</span></span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 <span class="comment"># 'test content'</span></span><br><span class="line">.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 <span class="comment"># tree 1</span></span><br><span class="line">.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 <span class="comment"># new.txt</span></span><br><span class="line">.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d <span class="comment"># commit 1</span></span><br></pre></td></tr></table></figure>
<p>If you follow all the internal pointers, you get an object graph something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnc13avj20m80gj0t7.jpg" alt="All the reachable objects in your Git directory.">  Figure 3. All the reachable objects in your Git directory.</p>
<h3 id="Object-Storage"><a href="#Object-Storage" class="headerlink" title="Object Storage"></a>Object Storage</h3><p>We mentioned earlier that there is a header stored with every object you commit to your Git object database. Let’s take a minute to see how Git stores its objects. You’ll see how to store a blob object — in this case, the string “what is up, doc?” — interactively in the Ruby scripting language.</p>
<p>You can start up interactive Ruby mode with the <code>irb</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ irb</span><br><span class="line">&gt;&gt; content = <span class="string">"what is up, doc?"</span></span><br><span class="line">=&gt; <span class="string">"what is up, doc?"</span></span><br></pre></td></tr></table></figure>
<p>Git first constructs a header which starts by identifying the type of object — in this case, a blob. To that first part of the header, Git adds a space followed by the size in bytes of the content, and adding a final null byte:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; header = <span class="string">"blob #&#123;content.length&#125;\0"</span></span><br><span class="line">=&gt; <span class="string">"blob 16\u0000"</span></span><br></pre></td></tr></table></figure>
<p>Git concatenates the header and the original content and then calculates the SHA-1 checksum of that new content. You can calculate the SHA-1 value of a string in Ruby by including the SHA1 digest library with the <code>require</code> command and then calling <code>Digest::SHA1.hexdigest()</code> with the string:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; store = header + content</span><br><span class="line">=&gt; <span class="string">"blob 16\u0000what is up, doc?"</span></span><br><span class="line">&gt;&gt; require <span class="string">'digest/sha1'</span></span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">&gt;&gt; sha1 = Digest::SHA1.hexdigest(store)</span><br><span class="line">=&gt; <span class="string">"bd9dbf5aae1a3862dd1526723246b20206e5fc37"</span></span><br></pre></td></tr></table></figure>
<p>Let’s compare that to the output of <code>git hash-object</code>. Here we use <code>echo -n</code> to prevent adding a newline to the input.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -n <span class="string">"what is up, doc?"</span> | git <span class="built_in">hash</span>-object --stdin</span><br><span class="line">bd9dbf5aae1a3862dd1526723246b20206e5fc37</span><br></pre></td></tr></table></figure>
<p>Git compresses the new content with zlib, which you can do in Ruby with the zlib library. First, you need to require the library and then run <code>Zlib::Deflate.deflate()</code> on the content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; require <span class="string">'zlib'</span></span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">&gt;&gt; zlib_content = Zlib::Deflate.deflate(store)</span><br><span class="line">=&gt; <span class="string">"x\x9CK\xCA\xC9OR04c(\xCFH,Q\xC8,V(-\xD0QH\xC9O\xB6\a\x00_\x1C\a\x9D"</span></span><br></pre></td></tr></table></figure>
<p>Finally, you’ll write your zlib-deflated content to an object on disk. You’ll determine the path of the object you want to write out (the first two characters of the SHA-1 value being the subdirectory name, and the last 38 characters being the filename within that directory). In Ruby, you can use the <code>FileUtils.mkdir_p()</code> function to create the subdirectory if it doesn’t exist. Then, open the file with <code>File.open()</code> and write out the previously zlib-compressed content to the file with a <code>write()</code> call on the resulting file handle:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; path = <span class="string">'.git/objects/'</span> + sha1[0,2] + <span class="string">'/'</span> + sha1[2,38]</span><br><span class="line">=&gt; <span class="string">".git/objects/bd/9dbf5aae1a3862dd1526723246b20206e5fc37"</span></span><br><span class="line">&gt;&gt; require <span class="string">'fileutils'</span></span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">&gt;&gt; FileUtils.mkdir_p(File.dirname(path))</span><br><span class="line">=&gt; <span class="string">".git/objects/bd"</span></span><br><span class="line">&gt;&gt; File.open(path, <span class="string">'w'</span>) &#123; |f| f.write zlib_content &#125;</span><br><span class="line">=&gt; 32</span><br></pre></td></tr></table></figure>
<p>Let’s check the content of the object using <code>git cat-file</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">$ git cat-file -p bd9dbf5aae1a3862dd1526723246b20206e5fc37</span><br><span class="line">what is up, doc?</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>That’s it – you’ve created a valid Git blob object.</p>
<p>All Git objects are stored the same way, just with different types – instead of the string blob, the header will begin with commit or tree. Also, although the blob content can be nearly anything, the commit and tree content are very specifically formatted.</p>
<h2 id="Git-References"><a href="#Git-References" class="headerlink" title="Git References"></a>Git References</h2><p>If you were interested in seeing the history of your repository reachable from commit, say, <code>1a410e</code>, you could run something like <code>git log 1a410e</code> to display that history, but you would still have to remember that <code>1a410e</code> is the commit you want to use as the starting point for that history. Instead, it would be easier if you had a file in which you could store that SHA-1 value under a simple name so you could use that simple name rather than the raw SHA-1 value.</p>
<p>In Git, these simple names are called “references” or “refs”; you can find the files that contain those SHA-1 values in the <code>.git/refs</code> directory. In the current project, this directory contains no files, but it does contain a simple structure:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/refs</span><br><span class="line">.git/refs</span><br><span class="line">.git/refs/heads</span><br><span class="line">.git/refs/tags</span><br><span class="line">$ find .git/refs -<span class="built_in">type</span> f</span><br></pre></td></tr></table></figure>
<p>To create a new reference that will help you remember where your latest commit is, you can technically do something as simple as this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> 1a410efbd13591db07496601ebc7a059dd55cfe9 &gt; .git/refs/heads/master</span><br></pre></td></tr></table></figure>
<p>Now, you can use the head reference you just created instead of the SHA-1 value in your Git commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=oneline master</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>
<p>You aren’t encouraged to directly edit the reference files; instead, Git provides the safer command <code>git update-ref</code> to do this if you want to update a reference:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref refs/heads/master 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br></pre></td></tr></table></figure>
<p>That’s basically what a branch in Git is: a simple pointer or reference to the head of a line of work. To create a branch back at the second commit, you can do this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref refs/heads/<span class="built_in">test</span> cac0ca</span><br></pre></td></tr></table></figure>
<p>Your branch will contain only work from that commit down:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=oneline <span class="built_in">test</span></span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>
<p>Now, your Git database conceptually looks something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcmewfluj20m80brwes.jpg" alt="Git directory objects with branch head references included.">  Figure 4. Git directory objects with branch head references included.  When you run commands like <code>git branch &lt;branch&gt;</code>, Git basically runs that <code>update-ref</code> command to add the SHA-1 of the last commit of the branch you’re on into whatever new reference you want to create.</p>
<h3 id="The-HEAD-1"><a href="#The-HEAD-1" class="headerlink" title="The HEAD"></a>The HEAD</h3><p>The question now is, when you run <code>git branch &lt;branch&gt;</code>, how does Git know the SHA-1 of the last commit? The answer is the HEAD file.</p>
<p>The HEAD file is a symbolic reference to the branch you’re currently on. By symbolic reference, we mean that unlike a normal reference, it doesn’t generally contain a SHA-1 value but rather a pointer to another reference. If you look at the file, you’ll normally see something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>
<p>If you run <code>git checkout test</code>, Git updates the file to look like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>When you run <code>git commit</code>, it creates the commit object, specifying the parent of that commit object to be whatever SHA-1 value the reference in HEAD points to.</p>
<p>You can also manually edit this file, but again a safer command exists to do so: <code>git symbolic-ref</code>. You can read the value of your HEAD via this command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git symbolic-ref HEAD</span><br><span class="line">refs/heads/master</span><br></pre></td></tr></table></figure>
<p>You can also set the value of HEAD using the same command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git symbolic-ref HEAD refs/heads/<span class="built_in">test</span></span><br><span class="line">$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>You can’t set a symbolic reference outside of the refs style:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git symbolic-ref HEAD <span class="built_in">test</span></span><br><span class="line">fatal: Refusing to point HEAD outside of refs/</span><br></pre></td></tr></table></figure>
<h3 id="Tags"><a href="#Tags" class="headerlink" title="Tags"></a>Tags</h3><p>We just finished discussing Git’s three main object types (<em>blobs</em>, <em>trees</em> and <em>commits</em>), but there is a fourth. The <em>tag</em> object is very much like a commit object — it contains a tagger, a date, a message, and a pointer. The main difference is that a tag object generally points to a commit rather than a tree. It’s like a branch reference, but it never moves — it always points to the same commit but gives it a friendlier name.</p>
<p>As discussed in 【Git Basics】, there are two types of tags: annotated and lightweight. You can make a lightweight tag by running something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git update-ref refs/tags/v1.0 cac0cab538b970a37ea1e769cbbde608743bc96d</span><br></pre></td></tr></table></figure>
<p>That is all a lightweight tag is — a reference that never moves. An annotated tag is more complex, however. If you create an annotated tag, Git creates a tag object and then writes a reference to point to it rather than directly to the commit. You can see this by creating an annotated tag (using the <code>-a</code> option):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v1.1 1a410efbd13591db07496601ebc7a059dd55cfe9 -m <span class="string">'test tag'</span></span><br></pre></td></tr></table></figure>
<p>Here’s the object SHA-1 value it created:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/tags/v1.1</span><br><span class="line">9585191f37f7b0fb9444f35a9bf50de191beadc2</span><br></pre></td></tr></table></figure>
<p>Now, run <code>git cat-file -p</code> on that SHA-1 value:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 9585191f37f7b0fb9444f35a9bf50de191beadc2</span><br><span class="line">object 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line"><span class="built_in">type</span> commit</span><br><span class="line">tag v1.1</span><br><span class="line">tagger Scott Chacon &lt;schacon@gmail.com&gt; Sat May 23 16:48:58 2009 -0700</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> tag</span><br></pre></td></tr></table></figure>
<p>Notice that the object entry points to the commit SHA-1 value that you tagged. Also notice that it doesn’t need to point to a commit; you can tag any Git object. In the Git source code, for example, the maintainer has added their GPG public key as a blob object and then tagged it. You can view the public key by running this in a clone of the Git repository:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file blob junio-gpg-pub</span><br></pre></td></tr></table></figure>
<p>The Linux kernel repository also has a non-commit-pointing tag object — the first tag created points to the initial tree of the import of the source code.</p>
<h3 id="Remotes"><a href="#Remotes" class="headerlink" title="Remotes"></a>Remotes</h3><p>The third type of reference that you’ll see is a remote reference. If you add a remote and push to it, Git stores the value you last pushed to that remote for each branch in the <code>refs/remotes</code> directory. For instance, you can add a remote called <code>origin</code> and push your <code>master</code> branch to it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:schacon/simplegit-progit.git</span><br><span class="line">$ git push origin master</span><br><span class="line">Counting objects: 11, <span class="keyword">done</span>.</span><br><span class="line">Compressing objects: 100% (5/5), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (7/7), 716 bytes, <span class="keyword">done</span>.</span><br><span class="line">Total 7 (delta 2), reused 4 (delta 1)</span><br><span class="line">To git@github.com:schacon/simplegit-progit.git</span><br><span class="line">  a11bef0..ca82a6d  master -&gt; master</span><br></pre></td></tr></table></figure>
<p>Then, you can see what the <code>master</code> branch on the <code>origin</code> remote was the last time you communicated with the server, by checking the <code>refs/remotes/origin/master</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/remotes/origin/master</span><br><span class="line">ca82a6dff817ec66f44342007202690a93763949</span><br></pre></td></tr></table></figure>
<p>Remote references differ from branches (<code>refs/heads</code> references) mainly in that they’re considered read-only. You can <code>git checkout</code> to one, but Git won’t point HEAD at one, so you’ll never update it with a <code>commit</code> command. Git manages them as bookmarks to the last known state of where those branches were on those servers.</p>
<h2 id="Packfiles"><a href="#Packfiles" class="headerlink" title="Packfiles"></a>Packfiles</h2><p>If you followed all of the instructions in the example from the previous section, you should now have a test Git repository with 11 objects — four blobs, three trees, three commits, and one tag:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/01/55eb4229851634a0f03eb265b69f5a2d56f341 <span class="comment"># tree 2</span></span><br><span class="line">.git/objects/1a/410efbd13591db07496601ebc7a059dd55cfe9 <span class="comment"># commit 3</span></span><br><span class="line">.git/objects/1f/7a7a472abf3dd9643fd615f6da379c4acb3e3a <span class="comment"># test.txt v2</span></span><br><span class="line">.git/objects/3c/4e9cd789d88d8d89c1073707c3585e41b0e614 <span class="comment"># tree 3</span></span><br><span class="line">.git/objects/83/baae61804e65cc73a7201a7252750c76066a30 <span class="comment"># test.txt v1</span></span><br><span class="line">.git/objects/95/85191f37f7b0fb9444f35a9bf50de191beadc2 <span class="comment"># tag</span></span><br><span class="line">.git/objects/ca/c0cab538b970a37ea1e769cbbde608743bc96d <span class="comment"># commit 2</span></span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4 <span class="comment"># 'test content'</span></span><br><span class="line">.git/objects/d8/329fc1cc938780ffdd9f94e0d364e0ea74f579 <span class="comment"># tree 1</span></span><br><span class="line">.git/objects/fa/49b077972391ad58037050f2a75f74e3671e92 <span class="comment"># new.txt</span></span><br><span class="line">.git/objects/fd/f4fc3344e67ab068f836878b6c4951e3b15f3d <span class="comment"># commit 1</span></span><br></pre></td></tr></table></figure>
<p>Git compresses the contents of these files with zlib, and you’re not storing much, so all these files collectively take up only 925 bytes. Now you’ll add some more sizable content to the repository to demonstrate an interesting feature of Git. To demonstrate, we’ll add the <code>repo.rb</code> file from the Grit library — this is about a 22K source code file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ curl [https://raw.githubusercontent.com/mojombo/grit/master/lib/grit/repo.rb](https://raw.githubusercontent.com/mojombo/grit/master/lib/grit/repo.rb) &gt; repo.rb</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git add repo.rb</span><br><span class="line">$ git commit -m <span class="string">'added repo.rb'</span></span><br><span class="line">[master 484a592] added repo.rb</span><br><span class="line"> 3 files changed, 709 insertions(+), 2 deletions(-)</span><br><span class="line"> delete mode 100644 bak/test.txt</span><br><span class="line"> create mode 100644 repo.rb</span><br><span class="line"> rewrite test.txt (100%)</span><br></pre></td></tr></table></figure>
<p>If you look at the resulting tree, you can see the SHA-1 value that was calculated for your new <code>repo.rb</code> blob object:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p master^&#123;tree&#125;</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob 033b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5      repo.rb</span><br><span class="line">100644 blob e3f094f522629ae358806b17daf78246c27c007b      test.txt</span><br></pre></td></tr></table></figure>
<p>You can then use <code>git cat-file</code> to see how large that object is:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -s 033b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5</span><br><span class="line">22044</span><br></pre></td></tr></table></figure>
<p>At this point, modify that file a little, and see what happens:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'# testing'</span> &gt;&gt; repo.rb</span><br><span class="line">$ git commit -am <span class="string">'modified repo a bit'</span></span><br><span class="line">[master 2431da6] modified repo.rb a bit</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>
<p>Check the tree created by that last commit, and you see something interesting:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p master^&#123;tree&#125;</span><br><span class="line">100644 blob fa49b077972391ad58037050f2a75f74e3671e92      new.txt</span><br><span class="line">100644 blob b042a60ef7dff760008df33cee372b945b6e884e      repo.rb</span><br><span class="line">100644 blob e3f094f522629ae358806b17daf78246c27c007b      test.txt</span><br></pre></td></tr></table></figure>
<p>The blob is now a different blob, which means that although you added only a single line to the end of a 400-line file, Git stored that new content as a completely new object:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -s b042a60ef7dff760008df33cee372b945b6e884e</span><br><span class="line">22054</span><br></pre></td></tr></table></figure>
<p>You have two nearly identical 22K objects on your disk (each compressed to approximately 7K). Wouldn’t it be nice if Git could store one of them in full but then the second object only as the delta between it and the first?</p>
<p>It turns out that it can. The initial format in which Git saves objects on disk is called a “loose” object format. However, occasionally Git packs up several of these objects into a single binary file called a “packfile” in order to save space and be more efficient. Git does this if you have too many loose objects around, if you run the <code>git gc</code> command manually, or if you push to a remote server. To see what happens, you can manually ask Git to pack up the objects by calling the <code>git gc</code> command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git gc</span><br><span class="line">Counting objects: 18, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (14/14), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (18/18), <span class="keyword">done</span>.</span><br><span class="line">Total 18 (delta 3), reused 0 (delta 0)</span><br></pre></td></tr></table></figure>
<p>If you look in your <code>objects</code> directory, you’ll find that most of your objects are gone, and a new pair of files has appeared:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -<span class="built_in">type</span> f</span><br><span class="line">.git/objects/bd/9dbf5aae1a3862dd1526723246b20206e5fc37</span><br><span class="line">.git/objects/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line">.git/objects/info/packs</span><br><span class="line">.git/objects/pack/pack-978e03944f5c581011e6998cd0e9e30000905586.idx</span><br><span class="line">.git/objects/pack/pack-978e03944f5c581011e6998cd0e9e30000905586.pack</span><br></pre></td></tr></table></figure>
<p>The objects that remain are the blobs that aren’t pointed to by any commit — in this case, the “what is up, doc?” example and the “test content” example blobs you created earlier. Because you never added them to any commits, they’re considered dangling and aren’t packed up in your new packfile.</p>
<p>The other files are your new packfile and an index. The packfile is a single file containing the contents of all the objects that were removed from your filesystem. The index is a file that contains offsets into that packfile so you can quickly seek to a specific object. What is cool is that although the objects on disk before you ran the <code>gc</code> command were collectively about 15K in size, the new packfile is only 7K. You’ve cut your disk usage by half by packing your objects.</p>
<p>How does Git do this? When Git packs objects, it looks for files that are named and sized similarly, and stores just the deltas from one version of the file to the next. You can look into the packfile and see what Git did to save space. The <code>git verify-pack</code> plumbing command allows you to see what was packed up:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ git verify-pack -v .git/objects/pack/pack-978e03944f5c581011e6998cd0e9e30000905586.idx</span><br><span class="line">2431da676938450a4d72e260db3bf7b0f587bbc1 commit 223 155 12</span><br><span class="line">69bcdaff5328278ab1c0812ce0e07fa7d26a96d7 commit 214 152 167</span><br><span class="line">80d02664cb23ed55b226516648c7ad5d0a3deb90 commit 214 145 319</span><br><span class="line">43168a18b7613d1281e5560855a83eb8fde3d687 commit 213 146 464</span><br><span class="line">092917823486a802e94d727c820a9024e14a1fc2 commit 214 146 610</span><br><span class="line">702470739ce72005e2edff522fde85d52a65df9b commit 165 118 756</span><br><span class="line">d368d0ac0678cbe6cce505be58126d3526706e54 tag    130 122 874</span><br><span class="line">fe879577cb8cffcdf25441725141e310dd7d239b tree   136 136 996</span><br><span class="line">d8329fc1cc938780ffdd9f94e0d364e0ea74f579 tree   36 46 1132</span><br><span class="line">deef2e1b793907545e50a2ea2ddb5ba6c58c4506 tree   136 136 1178</span><br><span class="line">d982c7cb2c2a972ee391a85da481fc1f9127a01d tree   6 17 1314 1 \</span><br><span class="line">  deef2e1b793907545e50a2ea2ddb5ba6c58c4506</span><br><span class="line">3c4e9cd789d88d8d89c1073707c3585e41b0e614 tree   8 19 1331 1 \</span><br><span class="line">  deef2e1b793907545e50a2ea2ddb5ba6c58c4506</span><br><span class="line">0155eb4229851634a0f03eb265b69f5a2d56f341 tree   71 76 1350</span><br><span class="line">83baae61804e65cc73a7201a7252750c76066a30 blob   10 19 1426</span><br><span class="line">fa49b077972391ad58037050f2a75f74e3671e92 blob   9 18 1445</span><br><span class="line">b042a60ef7dff760008df33cee372b945b6e884e blob   22054 5799 1463</span><br><span class="line">033b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5 blob   9 20 7262 1 \</span><br><span class="line">  b042a60ef7dff760008df33cee372b945b6e884e</span><br><span class="line">1f7a7a472abf3dd9643fd615f6da379c4acb3e3a blob   10 19 7282</span><br><span class="line">non delta: 15 objects</span><br><span class="line">chain length = 1: 3 objects</span><br><span class="line">.git/objects/pack/pack-978e03944f5c581011e6998cd0e9e30000905586.pack: ok</span><br></pre></td></tr></table></figure>
<p>Here, the <code>033b4</code> blob, which if you remember was the first version of your <code>repo.rb</code> file, is referencing the <code>b042a</code> blob, which was the second version of the file. The third column in the output is the size of the object in the pack, so you can see that <code>b042a</code> takes up 22K of the file, but that <code>033b4</code> only takes up 9 bytes. What is also interesting is that the second version of the file is the one that is stored intact, whereas the original version is stored as a delta — this is because you’re most likely to need faster access to the most recent version of the file.</p>
<p>The really nice thing about this is that it can be repacked at any time. Git will occasionally repack your database automatically, always trying to save more space, but you can also manually repack at any time by running <code>git gc</code> by hand.</p>
<h2 id="The-Refspec"><a href="#The-Refspec" class="headerlink" title="The Refspec"></a>The Refspec</h2><p>Throughout this book, we’ve used simple mappings from remote branches to local references, but they can be more complex. Suppose you were following along with the last couple sections and had created a small local Git repository, and now wanted to add a <em>remote</em> to it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin [https://github.com/schacon/simplegit-progit](https://github.com/schacon/simplegit-progit)</span><br></pre></td></tr></table></figure>
<p>Running the command above adds a section to your repository’s <code>.git/config</code> file, specifying the name of the remote (<code>origin</code>), the URL of the remote repository, and the <em>refspec</em> to be used for fetching:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = [https://github.com/schacon/simplegit-progit](https://github.com/schacon/simplegit-progit)</span><br><span class="line">	fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure>
<p>The format of the refspec is, first, an optional <code>+</code>, followed by <code>&lt;src&gt;:&lt;dst&gt;</code>, where <code>&lt;src&gt;</code> is the pattern for references on the remote side and <code>&lt;dst&gt;</code> is where those references will be tracked locally. The <code>+</code> tells Git to update the reference even if it isn’t a fast-forward.</p>
<p>In the default case that is automatically written by a <code>git remote add</code> command, Git fetches all the references under <code>refs/heads/</code> on the server and writes them to <code>refs/remotes/origin/</code> locally. So, if there is a <code>master</code> branch on the server, you can access the log of that branch locally via any of the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> origin/master</span><br><span class="line">$ git <span class="built_in">log</span> remotes/origin/master</span><br><span class="line">$ git <span class="built_in">log</span> refs/remotes/origin/master</span><br></pre></td></tr></table></figure>
<p>They’re all equivalent, because Git expands each of them to <code>refs/remotes/origin/master</code>.</p>
<p>If you want Git instead to pull down only the <code>master</code> branch each time, and not every other branch on the remote server, you can change the fetch line to refer to that branch only:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch = +refs/heads/master:refs/remotes/origin/master</span><br></pre></td></tr></table></figure>
<p>This is just the default refspec for <code>git fetch</code> for that remote. If you want to do a one-time only fetch, you can specify the specific refspec on the command line, too. To pull the <code>master</code> branch on the remote down to <code>origin/mymaster</code> locally, you can run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/mymaster</span><br></pre></td></tr></table></figure>
<p>You can also specify multiple refspecs. On the command line, you can pull down several branches like so:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin master:refs/remotes/origin/mymaster \</span><br><span class="line">	 topic:refs/remotes/origin/topic</span><br><span class="line">From git@github.com:schacon/simplegit</span><br><span class="line"> ! [rejected]        master     -&gt; origin/mymaster  (non fast forward)</span><br><span class="line"> * [new branch]      topic      -&gt; origin/topic</span><br></pre></td></tr></table></figure>
<p>In this case, the <code>master</code> branch pull was rejected because it wasn’t listed as a fast-forward reference. You can override that by specifying the <code>+</code> in front of the refspec.</p>
<p>You can also specify multiple refspecs for fetching in your configuration file. If you want to always fetch the <code>master</code> and <code>experiment</code> branches from the <code>origin</code> remote, add two lines:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = [https://github.com/schacon/simplegit-progit](https://github.com/schacon/simplegit-progit)</span><br><span class="line">	fetch = +refs/heads/master:refs/remotes/origin/master</span><br><span class="line">	fetch = +refs/heads/experiment:refs/remotes/origin/experiment</span><br></pre></td></tr></table></figure>
<p>You can’t use partial globs in the pattern, so this would be invalid:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch = +refs/heads/qa*:refs/remotes/origin/qa*</span><br></pre></td></tr></table></figure>
<p>However, you can use namespaces (or directories) to accomplish something like that. If you have a QA team that pushes a series of branches, and you want to get the <code>master</code> branch and any of the QA team’s branches but nothing else, you can use a config section like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = [https://github.com/schacon/simplegit-progit](https://github.com/schacon/simplegit-progit)</span><br><span class="line">	fetch = +refs/heads/master:refs/remotes/origin/master</span><br><span class="line">	fetch = +refs/heads/qa/*:refs/remotes/origin/qa/*</span><br></pre></td></tr></table></figure>
<p>If you have a complex workflow process that has a QA team pushing branches, developers pushing branches, and integration teams pushing and collaborating on remote branches, you can namespace them easily this way.</p>
<h3 id="Pushing-Refspecs"><a href="#Pushing-Refspecs" class="headerlink" title="Pushing Refspecs"></a>Pushing Refspecs</h3><p>It’s nice that you can fetch namespaced references that way, but how does the QA team get their branches into a <code>qa/</code> namespace in the first place? You accomplish that by using refspecs to push.</p>
<p>If the QA team wants to push their <code>master</code> branch to <code>qa/master</code> on the remote server, they can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master:refs/heads/qa/master</span><br></pre></td></tr></table></figure>
<p>If they want Git to do that automatically each time they run <code>git push origin</code>, they can add a <code>push</code> value to their config file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">	url = [https://github.com/schacon/simplegit-progit](https://github.com/schacon/simplegit-progit)</span><br><span class="line">	fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">	push = refs/heads/master:refs/heads/qa/master</span><br></pre></td></tr></table></figure>
<p>Again, this will cause a <code>git push origin</code> to push the local <code>master</code> branch to the remote <code>qa/master</code> branch by default.</p>
<h3 id="Deleting-References"><a href="#Deleting-References" class="headerlink" title="Deleting References"></a>Deleting References</h3><p>You can also use the refspec to delete references from the remote server by running something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin :topic</span><br></pre></td></tr></table></figure>
<p>Because the refspec is <code>&lt;src&gt;:&lt;dst&gt;</code>, by leaving off the <code>&lt;src&gt;</code> part, this basically says to make the <code>topic</code> branch on the remote nothing, which deletes it.</p>
<p>Or you can use the newer syntax (available since Git v1.7.0):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --delete topic</span><br></pre></td></tr></table></figure>
<h2 id="Transfer-Protocols"><a href="#Transfer-Protocols" class="headerlink" title="Transfer Protocols"></a>Transfer Protocols</h2><p>Git can transfer data between two repositories in two major ways: the “dumb” protocol and the “smart” protocol. This section will quickly cover how these two main protocols operate.</p>
<h3 id="The-Dumb-Protocol"><a href="#The-Dumb-Protocol" class="headerlink" title="The Dumb Protocol"></a>The Dumb Protocol</h3><p>If you’re setting up a repository to be served read-only over HTTP, the dumb protocol is likely what will be used. This protocol is called “dumb” because it requires no Git-specific code on the server side during the transport process; the fetch process is a series of HTTP <code>GET</code> requests, where the client can assume the layout of the Git repository on the server.</p>
<p>The dumb protocol is fairly rarely used these days. It’s difficult to secure or make private, so most Git hosts (both cloud-based and on-premises) will refuse to use it. It’s generally advised to use the smart protocol, which we describe a bit further on.</p>
<p>Let’s follow the <code>http-fetch</code> process for the simplegit library:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> [http://server/simplegit-progit.git](http://server/simplegit-progit.git)</span><br></pre></td></tr></table></figure>
<p>The first thing this command does is pull down the <code>info/refs</code> file. This file is written by the <code>update-server-info</code> command, which is why you need to enable that as a <code>post-receive</code> hook in order for the HTTP transport to work properly:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET info/refs</span><br><span class="line">ca82a6dff817ec66f44342007202690a93763949     refs/heads/master</span><br></pre></td></tr></table></figure>
<p>Now you have a list of the remote references and SHA-1s. Next, you look for what the HEAD reference is so you know what to check out when you’re finished:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>
<p>You need to check out the <code>master</code> branch when you’ve completed the process. At this point, you’re ready to start the walking process. Because your starting point is the <code>ca82a6</code> commit object you saw in the <code>info/refs</code> file, you start by fetching that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/ca/82a6dff817ec66f44342007202690a93763949</span><br><span class="line">(179 bytes of binary data)</span><br></pre></td></tr></table></figure>
<p>You get an object back – that object is in loose format on the server, and you fetched it over a static HTTP GET request. You can zlib-uncompress it, strip off the header, and look at the commit content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p ca82a6dff817ec66f44342007202690a93763949</span><br><span class="line">tree cfda3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">parent 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">author Scott Chacon &lt;schacon@gmail.com&gt; 1205815931 -0700</span><br><span class="line">committer Scott Chacon &lt;schacon@gmail.com&gt; 1240030591 -0700</span><br><span class="line"></span><br><span class="line">changed the version number</span><br></pre></td></tr></table></figure>
<p>Next, you have two more objects to retrieve – <code>cfda3b</code>, which is the tree of content that the commit we just retrieved points to; and <code>085bb3</code>, which is the parent commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/08/5bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">(179 bytes of data)</span><br></pre></td></tr></table></figure>
<p>That gives you your next commit object. Grab the tree object:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/cf/da3bf379e4f8dba8717dee55aab78aef7f4daf</span><br><span class="line">(404 - Not Found)</span><br></pre></td></tr></table></figure>
<p>Oops – it looks like that tree object isn’t in loose format on the server, so you get a 404 response back. There are a couple of reasons for this – the object could be in an alternate repository, or it could be in a packfile in this repository. Git checks for any listed alternates first:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/info/http-alternates</span><br><span class="line">(empty file)</span><br></pre></td></tr></table></figure>
<p>If this comes back with a list of alternate URLs, Git checks for loose files and packfiles there – this is a nice mechanism for projects that are forks of one another to share objects on disk. However, because no alternates are listed in this case, your object must be in a packfile. To see what packfiles are available on this server, you need to get the <code>objects/info/packs</code> file, which contains a listing of them (also generated by <code>update-server-info</code>):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/info/packs</span><br><span class="line">P pack-816a9b2334da9953e530f27bcac22082a9f5b835.pack</span><br></pre></td></tr></table></figure>
<p>There is only one packfile on the server, so your object is obviously in there, but you’ll check the index file to make sure. This is also useful if you have multiple packfiles on the server, so you can see which packfile contains the object you need:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/pack/pack-816a9b2334da9953e530f27bcac22082a9f5b835.idx</span><br><span class="line">(4k of binary data)</span><br></pre></td></tr></table></figure>
<p>Now that you have the packfile index, you can see if your object is in it – because the index lists the SHA-1s of the objects contained in the packfile and the offsets to those objects. Your object is there, so go ahead and get the whole packfile:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET objects/pack/pack-816a9b2334da9953e530f27bcac22082a9f5b835.pack</span><br><span class="line">(13k of binary data)</span><br></pre></td></tr></table></figure>
<p>You have your tree object, so you continue walking your commits. They’re all also within the packfile you just downloaded, so you don’t have to do any more requests to your server. Git checks out a working copy of the <code>master</code> branch that was pointed to by the HEAD reference you downloaded at the beginning.</p>
<h3 id="The-Smart-Protocol"><a href="#The-Smart-Protocol" class="headerlink" title="The Smart Protocol"></a>The Smart Protocol</h3><p>The dumb protocol is simple but a bit inefficient, and it can’t handle writing of data from the client to the server. The smart protocol is a more common method of transferring data, but it requires a process on the remote end that is intelligent about Git – it can read local data, figure out what the client has and needs, and generate a custom packfile for it. There are two sets of processes for transferring data: a pair for uploading data and a pair for downloading data.</p>
<h4 id="Uploading-Data"><a href="#Uploading-Data" class="headerlink" title="Uploading Data"></a>Uploading Data</h4><p>To upload data to a remote process, Git uses the <code>send-pack</code> and <code>receive-pack</code> processes. The <code>send-pack</code> process runs on the client and connects to a <code>receive-pack</code> process on the remote side.</p>
<h5 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h5><p>For example, say you run <code>git push origin master</code> in your project, and <code>origin</code> is defined as a URL that uses the SSH protocol. Git fires up the <code>send-pack</code> process, which initiates a connection over SSH to your server. It tries to run a command on the remote server via an SSH call that looks something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -x git@server <span class="string">"git-receive-pack 'simplegit-progit.git'"</span></span><br><span class="line">00a5ca82a6dff817ec66f4437202690a93763949 refs/heads/master□report-status \</span><br><span class="line">	delete-refs side-band-64k quiet ofs-delta \</span><br><span class="line">	agent=git/2:2.1.1+github-607-gfba4028 delete-refs</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<p>The <code>git-receive-pack</code> command immediately responds with one line for each reference it currently has – in this case, just the <code>master</code> branch and its SHA-1. The first line also has a list of the server’s capabilities (here, <code>report-status</code>, <code>delete-refs</code>, and some others, including the client identifier).</p>
<p>Each line starts with a 4-character hex value specifying how long the rest of the line is. Your first line starts with 00a5, which is hexadecimal for 165, meaning that 165 bytes remain on that line. The next line is 0000, meaning the server is done with its references listing.</p>
<p>Now that it knows the server’s state, your <code>send-pack</code> process determines what commits it has that the server doesn’t. For each reference that this push will update, the <code>send-pack</code> process tells the <code>receive-pack</code> process that information. For instance, if you’re updating the <code>master</code> branch and adding an <code>experiment</code> branch, the <code>send-pack</code> response may look something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0076ca82a6dff817ec66f44342007202690a93763949 15027957951b64cf874c3557a0f3547bd83b3ff6 \</span><br><span class="line">	refs/heads/master report-status</span><br><span class="line">006c0000000000000000000000000000000000000000 cdfdb42577e2506715f8cfeacdbabc092bf63e8d \</span><br><span class="line">	refs/heads/experiment</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<p>Git sends a line for each reference you’re updating with the line’s length, the old SHA-1, the new SHA-1, and the reference that is being updated. The first line also has the client’s capabilities. The SHA-1 value of all ‘0’s means that nothing was there before – because you’re adding the experiment reference. If you were deleting a reference, you would see the opposite: all ‘0’s on the right side.</p>
<p>Next, the client sends a packfile of all the objects the server doesn’t have yet. Finally, the server responds with a success (or failure) indication:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000eunpack ok</span><br></pre></td></tr></table></figure>
<h5 id="HTTP-S"><a href="#HTTP-S" class="headerlink" title="HTTP(S)"></a>HTTP(S)</h5><p>This process is mostly the same over HTTP, though the handshaking is a bit different. The connection is initiated with this request:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET [http://server/simplegit-progit.git/info/refs?service=git-receive-pack](http://server/simplegit-progit.git/info/refs?service=git-receive-pack)</span><br><span class="line">001f<span class="comment"># service=git-receive-pack</span></span><br><span class="line">00ab6c5f0e45abd7832bf23074a333f739977c9e8188 refs/heads/master□report-status \</span><br><span class="line">	delete-refs side-band-64k quiet ofs-delta \</span><br><span class="line">	agent=git/2:2.1.1~vmg-bitmaps-bugaloo-608-g116744e</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<p>That’s the end of the first client-server exchange. The client then makes another request, this time a <code>POST</code>, with the data that <code>send-pack</code> provides.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=&gt; POST [http://server/simplegit-progit.git/git-receive-pack](http://server/simplegit-progit.git/git-receive-pack)</span><br></pre></td></tr></table></figure>
<p>The <code>POST</code> request includes the <code>send-pack</code> output and the packfile as its payload. The server then indicates success or failure with its HTTP response.</p>
<h4 id="Downloading-Data"><a href="#Downloading-Data" class="headerlink" title="Downloading Data"></a>Downloading Data</h4><p>When you download data, the <code>fetch-pack</code> and <code>upload-pack</code> processes are involved. The client initiates a <code>fetch-pack</code> process that connects to an <code>upload-pack</code> process on the remote side to negotiate what data will be transferred down.</p>
<h5 id="SSH-1"><a href="#SSH-1" class="headerlink" title="SSH"></a>SSH</h5><p>If you’re doing the fetch over SSH, <code>fetch-pack</code> runs something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -x git@server <span class="string">"git-upload-pack 'simplegit-progit.git'"</span></span><br></pre></td></tr></table></figure>
<p>After <code>fetch-pack</code> connects, <code>upload-pack</code> sends back something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00dfca82a6dff817ec66f44342007202690a93763949 HEAD□multi_ack thin-pack \</span><br><span class="line">	side-band side-band-64k ofs-delta shallow no-progress include-tag \</span><br><span class="line">	multi_ack_detailed symref=HEAD:refs/heads/master \</span><br><span class="line">	agent=git/2:2.1.1+github-607-gfba4028</span><br><span class="line">003fe2409a098dc3e53539a9028a94b6224db9d6a6b6 refs/heads/master</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<p>This is very similar to what <code>receive-pack</code> responds with, but the capabilities are different. In addition, it sends back what HEAD points to (<code>symref=HEAD:refs/heads/master</code>) so the client knows what to check out if this is a clone.</p>
<p>At this point, the <code>fetch-pack</code> process looks at what objects it has and responds with the objects that it needs by sending “want” and then the SHA-1 it wants. It sends all the objects it already has with “have” and then the SHA-1. At the end of this list, it writes “done” to initiate the <code>upload-pack</code> process to begin sending the packfile of the data it needs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">003cwant ca82a6dff817ec66f44342007202690a93763949 ofs-delta</span><br><span class="line">0032have 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7</span><br><span class="line">0009done</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<h5 id="HTTP-S-1"><a href="#HTTP-S-1" class="headerlink" title="HTTP(S)"></a>HTTP(S)</h5><p>The handshake for a fetch operation takes two HTTP requests. The first is a <code>GET</code> to the same endpoint used in the dumb protocol:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">=&gt; GET <span class="variable">$GIT_URL</span>/info/refs?service=git-upload-pack</span><br><span class="line">001e<span class="comment"># service=git-upload-pack</span></span><br><span class="line">00e7ca82a6dff817ec66f44342007202690a93763949 HEAD□multi_ack thin-pack \</span><br><span class="line">	side-band side-band-64k ofs-delta shallow no-progress include-tag \</span><br><span class="line">	multi_ack_detailed no-done symref=HEAD:refs/heads/master \</span><br><span class="line">	agent=git/2:2.1.1+github-607-gfba4028</span><br><span class="line">003fca82a6dff817ec66f44342007202690a93763949 refs/heads/master</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<p>This is very similar to invoking <code>git-upload-pack</code> over an SSH connection, but the second exchange is performed as a separate request:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">=&gt; POST <span class="variable">$GIT_URL</span>/git-upload-pack HTTP/1.0</span><br><span class="line">0032want 0a53e9ddeaddad63ad106860237bbf53411d11a7</span><br><span class="line">0032have 441b40d833fdfa93eb2908e52742248faf0ee993</span><br><span class="line">0000</span><br></pre></td></tr></table></figure>
<p>Again, this is the same format as above. The response to this request indicates success or failure, and includes the packfile.</p>
<h3 id="Protocols-Summary"><a href="#Protocols-Summary" class="headerlink" title="Protocols Summary"></a>Protocols Summary</h3><p>This section contains a very basic overview of the transfer protocols. The protocol includes many other features, such as <code>multi_ack</code> or <code>side-band</code> capabilities, but covering them is outside the scope of this book. We’ve tried to give you a sense of the general back-and-forth between client and server; if you need more knowledge than this, you’ll probably want to take a look at the Git source code.</p>
<h2 id="Maintenance-and-Data-Recovery"><a href="#Maintenance-and-Data-Recovery" class="headerlink" title="Maintenance and Data Recovery"></a>Maintenance and Data Recovery</h2><p>Occasionally, you may have to do some cleanup – make a repository more compact, clean up an imported repository, or recover lost work. This section will cover some of these scenarios.</p>
<h3 id="Maintenance"><a href="#Maintenance" class="headerlink" title="Maintenance"></a>Maintenance</h3><p>Occasionally, Git automatically runs a command called “auto gc”. Most of the time, this command does nothing. However, if there are too many loose objects (objects not in a packfile) or too many packfiles, Git launches a full-fledged <code>git gc</code> command. The “gc” stands for garbage collect, and the command does a number of things: it gathers up all the loose objects and places them in packfiles, it consolidates packfiles into one big packfile, and it removes objects that aren’t reachable from any commit and are a few months old.</p>
<p>You can run auto gc manually as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git gc --auto</span><br></pre></td></tr></table></figure>
<p>Again, this generally does nothing. You must have around 7,000 loose objects or more than 50 packfiles for Git to fire up a real gc command. You can modify these limits with the <code>gc.auto</code> and <code>gc.autopacklimit</code> config settings, respectively.</p>
<p>The other thing <code>gc</code> will do is pack up your references into a single file. Suppose your repository contains the following branches and tags:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/refs -<span class="built_in">type</span> f</span><br><span class="line">.git/refs/heads/experiment</span><br><span class="line">.git/refs/heads/master</span><br><span class="line">.git/refs/tags/v1.0</span><br><span class="line">.git/refs/tags/v1.1</span><br></pre></td></tr></table></figure>
<p>If you run <code>git gc</code>, you’ll no longer have these files in the <code>refs</code> directory. Git will move them for the sake of efficiency into a file named <code>.git/packed-refs</code> that looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/packed-refs</span><br><span class="line"><span class="comment"># pack-refs with: peeled fully-peeled</span></span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d refs/heads/experiment</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b refs/heads/master</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d refs/tags/v1.0</span><br><span class="line">9585191f37f7b0fb9444f35a9bf50de191beadc2 refs/tags/v1.1</span><br><span class="line">^1a410efbd13591db07496601ebc7a059dd55cfe9</span><br></pre></td></tr></table></figure>
<p>If you update a reference, Git doesn’t edit this file but instead writes a new file to <code>refs/heads</code>. To get the appropriate SHA-1 for a given reference, Git checks for that reference in the <code>refs</code> directory and then checks the <code>packed-refs</code> file as a fallback. However, if you can’t find a reference in the <code>refs</code> directory, it’s probably in your <code>packed-refs</code> file.</p>
<p>Notice the last line of the file, which begins with a <code>^</code>. This means the tag directly above is an annotated tag and that line is the commit that the annotated tag points to.</p>
<h3 id="Data-Recovery"><a href="#Data-Recovery" class="headerlink" title="Data Recovery"></a>Data Recovery</h3><p>At some point in your Git journey, you may accidentally lose a commit. Generally, this happens because you force-delete a branch that had work on it, and it turns out you wanted the branch after all; or you hard-reset a branch, thus abandoning commits that you wanted something from. Assuming this happens, how can you get your commits back?</p>
<p>Here’s an example that hard-resets the master branch in your test repository to an older commit and then recovers the lost commits. First, let’s review where your repository is at this point:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b modified repo a bit</span><br><span class="line">484a59275031909e19aadb7c92262719cfcdf19a added repo.rb</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>
<p>Now, move the <code>master</code> branch back to the middle commit:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">HEAD is now at 1a410ef third commit</span><br><span class="line">$ git <span class="built_in">log</span> --pretty=oneline</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>
<p>You’ve effectively lost the top two commits – you have no branch from which those commits are reachable. You need to find the latest commit SHA-1 and then add a branch that points to it. The trick is finding that latest commit SHA-1 – it’s not like you’ve memorized it, right?</p>
<p>Often, the quickest way is to use a tool called <code>git reflog</code>. As you’re working, Git silently records what your HEAD is every time you change it. Each time you commit or change branches, the reflog is updated. The reflog is also updated by the <code>git update-ref</code> command, which is another reason to use it instead of just writing the SHA-1 value to your ref files, as we covered in 【Git References】. You can see where you’ve been at any time by running <code>git reflog</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br><span class="line">1a410ef HEAD@&#123;0&#125;: reset: moving to 1a410ef</span><br><span class="line">ab1afef HEAD@&#123;1&#125;: commit: modified repo.rb a bit</span><br><span class="line">484a592 HEAD@&#123;2&#125;: commit: added repo.rb</span><br></pre></td></tr></table></figure>
<p>Here we can see the two commits that we have had checked out, however there is not much information here. To see the same information in a much more useful way, we can run <code>git log -g</code>, which will give you a normal log output for your reflog.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -g</span><br><span class="line">commit 1a410efbd13591db07496601ebc7a059dd55cfe9</span><br><span class="line">Reflog: HEAD@&#123;0&#125; (Scott Chacon &lt;schacon@gmail.com&gt;)</span><br><span class="line">Reflog message: updating HEAD</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:22:37 2009 -0700</span><br><span class="line"></span><br><span class="line">		third commit</span><br><span class="line"></span><br><span class="line">commit ab1afef80fac8e34258ff41fc1b867c702daa24b</span><br><span class="line">Reflog: HEAD@&#123;1&#125; (Scott Chacon &lt;schacon@gmail.com&gt;)</span><br><span class="line">Reflog message: updating HEAD</span><br><span class="line">Author: Scott Chacon &lt;schacon@gmail.com&gt;</span><br><span class="line">Date:   Fri May 22 18:15:24 2009 -0700</span><br><span class="line"></span><br><span class="line">       modified repo.rb a bit</span><br></pre></td></tr></table></figure>
<p>It looks like the bottom commit is the one you lost, so you can recover it by creating a new branch at that commit. For example, you can start a branch named <code>recover-branch</code> at that commit (ab1afef):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git branch recover-branch ab1afef</span><br><span class="line">$ git <span class="built_in">log</span> --pretty=oneline recover-branch</span><br><span class="line">ab1afef80fac8e34258ff41fc1b867c702daa24b modified repo a bit</span><br><span class="line">484a59275031909e19aadb7c92262719cfcdf19a added repo.rb</span><br><span class="line">1a410efbd13591db07496601ebc7a059dd55cfe9 third commit</span><br><span class="line">cac0cab538b970a37ea1e769cbbde608743bc96d second commit</span><br><span class="line">fdf4fc3344e67ab068f836878b6c4951e3b15f3d first commit</span><br></pre></td></tr></table></figure>
<p>Cool – now you have a branch named <code>recover-branch</code> that is where your <code>master</code> branch used to be, making the first two commits reachable again. Next, suppose your loss was for some reason not in the reflog – you can simulate that by removing <code>recover-branch</code> and deleting the reflog. Now the first two commits aren’t reachable by anything:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -D recover-branch</span><br><span class="line">$ rm -Rf .git/logs/</span><br></pre></td></tr></table></figure>
<p>Because the reflog data is kept in the <code>.git/logs/</code> directory, you effectively have no reflog. How can you recover that commit at this point? One way is to use the <code>git fsck</code> utility, which checks your database for integrity. If you run it with the <code>--full</code> option, it shows you all objects that aren’t pointed to by another object:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git fsck --full</span><br><span class="line">Checking object directories: 100% (256/256), <span class="keyword">done</span>.</span><br><span class="line">Checking objects: 100% (18/18), <span class="keyword">done</span>.</span><br><span class="line">dangling blob d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line">dangling commit ab1afef80fac8e34258ff41fc1b867c702daa24b</span><br><span class="line">dangling tree aea790b9a58f6cf6f2804eeac9f0abbe9631e4c9</span><br><span class="line">dangling blob 7108f7ecb345ee9d0084193f147cdad4d2998293</span><br></pre></td></tr></table></figure>
<p>In this case, you can see your missing commit after the string “dangling commit”. You can recover it the same way, by adding a branch that points to that SHA-1.</p>
<h3 id="Removing-Objects"><a href="#Removing-Objects" class="headerlink" title="Removing Objects"></a>Removing Objects</h3><p>There are a lot of great things about Git, but one feature that can cause issues is the fact that a <code>git clone</code> downloads the entire history of the project, including every version of every file. This is fine if the whole thing is source code, because Git is highly optimized to compress that data efficiently. However, if someone at any point in the history of your project added a single huge file, every clone for all time will be forced to download that large file, even if it was removed from the project in the very next commit. Because it’s reachable from the history, it will always be there.</p>
<p>This can be a huge problem when you’re converting Subversion or Perforce repositories into Git. Because you don’t download the whole history in those systems, this type of addition carries few consequences. If you did an import from another system or otherwise find that your repository is much larger than it should be, here is how you can find and remove large objects.</p>
<p><strong>Be warned: this technique is destructive to your commit history.</strong> It rewrites every commit object since the earliest tree you have to modify to remove a large file reference. If you do this immediately after an import, before anyone has started to base work on the commit, you’re fine – otherwise, you have to notify all contributors that they must rebase their work onto your new commits.</p>
<p>To demonstrate, you’ll add a large file into your test repository, remove it in the next commit, find it, and remove it permanently from the repository. First, add a large object to your history:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ curl [https://www.kernel.org/pub/software/scm/git/git-2.1.0.tar.gz](https://www.kernel.org/pub/software/scm/git/git-2.1.0.tar.gz) &gt; git.tgz</span><br><span class="line">$ git add git.tgz</span><br><span class="line">$ git commit -m <span class="string">'add git tarball'</span></span><br><span class="line">[master 7b30847] add git tarball</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 git.tgz</span><br></pre></td></tr></table></figure>
<p>Oops – you didn’t want to add a huge tarball to your project. Better get rid of it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git rm git.tgz</span><br><span class="line">rm <span class="string">'git.tgz'</span></span><br><span class="line">$ git commit -m <span class="string">'oops - removed large tarball'</span></span><br><span class="line">[master dadf725] oops - removed large tarball</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> delete mode 100644 git.tgz</span><br></pre></td></tr></table></figure>
<p>Now, <code>gc</code> your database and see how much space you’re using:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git gc</span><br><span class="line">Counting objects: 17, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (13/13), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (17/17), <span class="keyword">done</span>.</span><br><span class="line">Total 17 (delta 1), reused 10 (delta 0)</span><br></pre></td></tr></table></figure>
<p>You can run the <code>count-objects</code> command to quickly see how much space you’re using:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git count-objects -v</span><br><span class="line">count: 7</span><br><span class="line">size: 32</span><br><span class="line"><span class="keyword">in</span>-pack: 17</span><br><span class="line">packs: 1</span><br><span class="line">size-pack: 4868</span><br><span class="line">prune-packable: 0</span><br><span class="line">garbage: 0</span><br><span class="line">size-garbage: 0</span><br></pre></td></tr></table></figure>
<p>The <code>size-pack</code> entry is the size of your packfiles in kilobytes, so you’re using almost 5MB. Before the last commit, you were using closer to 2K – clearly, removing the file from the previous commit didn’t remove it from your history. Every time anyone clones this repository, they will have to clone all 5MB just to get this tiny project, because you accidentally added a big file. Let’s get rid of it.</p>
<p>First you have to find it. In this case, you already know what file it is. But suppose you didn’t; how would you identify what file or files were taking up so much space? If you run <code>git gc</code>, all the objects are in a packfile; you can identify the big objects by running another plumbing command called <code>git verify-pack</code> and sorting on the third field in the output, which is file size. You can also pipe it through the <code>tail</code> command because you’re only interested in the last few largest files:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git verify-pack -v .git/objects/pack/pack-29…69.idx \</span><br><span class="line">  | sort -k 3 -n \</span><br><span class="line">  | tail -3</span><br><span class="line">dadf7258d699da2c8d89b09ef6670edb7d5f91b4 commit 229 159 12</span><br><span class="line">033b4468fa6b2a9547a70d88d1bbe8bf3f9ed0d5 blob   22044 5792 4977696</span><br><span class="line">82c99a3e86bb1267b236a4b6eff7868d97489af1 blob   4975916 4976258 1438</span><br></pre></td></tr></table></figure>
<p>The big object is at the bottom: 5MB. To find out what file it is, you’ll use the <code>rev-list</code> command, which you used briefly in 【Enforcing a Specific Commit-Message Format】. If you pass <code>--objects</code> to <code>rev-list</code>, it lists all the commit SHA-1s and also the blob SHA-1s with the file paths associated with them. You can use this to find your blob’s name:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git rev-list --objects --all | grep 82c99a3</span><br><span class="line">82c99a3e86bb1267b236a4b6eff7868d97489af1 git.tgz</span><br></pre></td></tr></table></figure>
<p>Now, you need to remove this file from all trees in your past. You can easily see what commits modified this file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --branches -- git.tgz</span><br><span class="line">dadf725 oops - removed large tarball</span><br><span class="line">7b30847 add git tarball</span><br></pre></td></tr></table></figure>
<p>You must rewrite all the commits downstream from <code>7b30847</code> to fully remove this file from your Git history. To do so, you use <code>filter-branch</code>, which you used in 【Rewriting History】:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git filter-branch --index-filter \</span><br><span class="line">  <span class="string">'git rm --ignore-unmatch --cached git.tgz'</span> -- 7b30847^..</span><br><span class="line">Rewrite 7b30847d080183a1ab7d18fb202473b3096e9f34 (1/2)rm <span class="string">'git.tgz'</span></span><br><span class="line">Rewrite dadf7258d699da2c8d89b09ef6670edb7d5f91b4 (2/2)</span><br><span class="line">Ref <span class="string">'refs/heads/master'</span> was rewritten</span><br></pre></td></tr></table></figure>
<p>The <code>--index-filter</code> option is similar to the <code>--tree-filter</code> option used in 【Rewriting History】, except that instead of passing a command that modifies files checked out on disk, you’re modifying your staging area or index each time.</p>
<p>Rather than remove a specific file with something like <code>rm file</code>, you have to remove it with <code>git rm --cached</code> – you must remove it from the index, not from disk. The reason to do it this way is speed – because Git doesn’t have to check out each revision to disk before running your filter, the process can be much, much faster. You can accomplish the same task with <code>--tree-filter</code> if you want. The <code>--ignore-unmatch</code> option to <code>git rm</code> tells it not to error out if the pattern you’re trying to remove isn’t there. Finally, you ask <code>filter-branch</code> to rewrite your history only from the <code>7b30847</code> commit up, because you know that is where this problem started. Otherwise, it will start from the beginning and will unnecessarily take longer.</p>
<p>Your history no longer contains a reference to that file. However, your reflog and a new set of refs that Git added when you did the <code>filter-branch</code> under <code>.git/refs/original</code> still do, so you have to remove them and then repack the database. You need to get rid of anything that has a pointer to those old commits before you repack:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ rm -Rf .git/refs/original</span><br><span class="line">$ rm -Rf .git/logs/</span><br><span class="line">$ git gc</span><br><span class="line">Counting objects: 15, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (15/15), <span class="keyword">done</span>.</span><br><span class="line">Total 15 (delta 1), reused 12 (delta 0)</span><br></pre></td></tr></table></figure>
<p>Let’s see how much space you saved.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git count-objects -v</span><br><span class="line">count: 11</span><br><span class="line">size: 4904</span><br><span class="line"><span class="keyword">in</span>-pack: 15</span><br><span class="line">packs: 1</span><br><span class="line">size-pack: 8</span><br><span class="line">prune-packable: 0</span><br><span class="line">garbage: 0</span><br><span class="line">size-garbage: 0</span><br></pre></td></tr></table></figure>
<p>The packed repository size is down to 8K, which is much better than 5MB. You can see from the size value that the big object is still in your loose objects, so it’s not gone; but it won’t be transferred on a push or subsequent clone, which is what is important. If you really wanted to, you could remove the object completely by running <code>git prune</code> with the <code>--expire</code> option:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git prune --expire now</span><br><span class="line">$ git count-objects -v</span><br><span class="line">count: 0</span><br><span class="line">size: 0</span><br><span class="line"><span class="keyword">in</span>-pack: 15</span><br><span class="line">packs: 1</span><br><span class="line">size-pack: 8</span><br><span class="line">prune-packable: 0</span><br><span class="line">garbage: 0</span><br><span class="line">size-garbage: 0</span><br></pre></td></tr></table></figure>
<h2 id="Environment-Variables"><a href="#Environment-Variables" class="headerlink" title="Environment Variables"></a>Environment Variables</h2><p>Git always runs inside a <code>bash</code> shell, and uses a number of shell environment variables to determine how it behaves. Occasionally, it comes in handy to know what these are, and how they can be used to make Git behave the way you want it to. This isn’t an exhaustive list of all the environment variables Git pays attention to, but we’ll cover the most useful.</p>
<h3 id="Global-Behavior"><a href="#Global-Behavior" class="headerlink" title="Global Behavior"></a>Global Behavior</h3><p>Some of Git’s general behavior as a computer program depends on environment variables.</p>
<p><strong><code>GIT_EXEC_PATH</code></strong> determines where Git looks for its sub-programs (like <code>git-commit</code>, <code>git-diff</code>, and others). You can check the current setting by running <code>git --exec-path</code>.</p>
<p><strong><code>HOME</code></strong> isn’t usually considered customizable (too many other things depend on it), but it’s where Git looks for the global configuration file. If you want a truly portable Git installation, complete with global configuration, you can override <code>HOME</code> in the portable Git’s shell profile.</p>
<p><strong><code>PREFIX</code></strong> is similar, but for the system-wide configuration. Git looks for this file at <code>$PREFIX/etc/gitconfig</code>.</p>
<p><strong><code>GIT_CONFIG_NOSYSTEM</code></strong>, if set, disables the use of the system-wide configuration file. This is useful if your system config is interfering with your commands, but you don’t have access to change or remove it.</p>
<p><strong><code>GIT_PAGER</code></strong> controls the program used to display multi-page output on the command line. If this is unset, <code>PAGER</code> will be used as a fallback.</p>
<p><strong><code>GIT_EDITOR</code></strong> is the editor Git will launch when the user needs to edit some text (a commit message, for example). If unset, <code>EDITOR</code> will be used.</p>
<h3 id="Repository-Locations"><a href="#Repository-Locations" class="headerlink" title="Repository Locations"></a>Repository Locations</h3><p>Git uses several environment variables to determine how it interfaces with the current repository.</p>
<p><strong><code>GIT_DIR</code></strong> is the location of the <code>.git</code> folder. If this isn’t specified, Git walks up the directory tree until it gets to <code>~</code> or <code>/</code>, looking for a <code>.git</code> directory at every step.</p>
<p><strong><code>GIT_CEILING_DIRECTORIES</code></strong> controls the behavior of searching for a <code>.git</code> directory. If you access directories that are slow to load (such as those on a tape drive, or across a slow network connection), you may want to have Git stop trying earlier than it might otherwise, especially if Git is invoked when building your shell prompt.</p>
<p><strong><code>GIT_WORK_TREE</code></strong> is the location of the root of the working directory for a non-bare repository. If <code>--git-dir</code> or <code>GIT_DIR</code> is specified but none of <code>--work-tree</code>, <code>GIT_WORK_TREE</code> or <code>core.worktree</code> is specified, the current working directory is regarded as the top level of your working tree.</p>
<p><strong><code>GIT_INDEX_FILE</code></strong> is the path to the index file (non-bare repositories only).</p>
<p><strong><code>GIT_OBJECT_DIRECTORY</code></strong> can be used to specify the location of the directory that usually resides at <code>.git/objects</code>.</p>
<p><strong><code>GIT_ALTERNATE_OBJECT_DIRECTORIES</code></strong> is a colon-separated list (formatted like <code>/dir/one:/dir/two:…</code>) which tells Git where to check for objects if they aren’t in <code>GIT_OBJECT_DIRECTORY</code>. If you happen to have a lot of projects with large files that have the exact same contents, this can be used to avoid storing too many copies of them.</p>
<h3 id="Pathspecs"><a href="#Pathspecs" class="headerlink" title="Pathspecs"></a>Pathspecs</h3><p>A “pathspec” refers to how you specify paths to things in Git, including the use of wildcards. These are used in the <code>.gitignore</code> file, but also on the command-line (<code>git add *.c</code>).</p>
<p><strong><code>GIT_GLOB_PATHSPECS</code></strong> and <strong><code>GIT_NOGLOB_PATHSPECS</code></strong> control the default behavior of wildcards in pathspecs. If <code>GIT_GLOB_PATHSPECS</code> is set to 1, wildcard characters act as wildcards (which is the default); if <code>GIT_NOGLOB_PATHSPECS</code> is set to 1, wildcard characters only match themselves, meaning something like <code>*.c</code> would only match a file <em>named</em> “<em>.c”, rather than any file whose name ends with <code>.c</code>. You can override this in individual cases by starting the pathspec with <code>:(glob)</code> or <code>:(literal)</code>, as in `:(glob)</em>.c`.</p>
<p><strong><code>GIT_LITERAL_PATHSPECS</code></strong> disables both of the above behaviors; no wildcard characters will work, and the override prefixes are disabled as well.</p>
<p><strong><code>GIT_ICASE_PATHSPECS</code></strong> sets all pathspecs to work in a case-insensitive manner.</p>
<h3 id="Committing"><a href="#Committing" class="headerlink" title="Committing"></a>Committing</h3><p>The final creation of a Git commit object is usually done by <code>git-commit-tree</code>, which uses these environment variables as its primary source of information, falling back to configuration values only if these aren’t present.</p>
<p><strong><code>GIT_AUTHOR_NAME</code></strong> is the human-readable name in the “author” field.</p>
<p><strong><code>GIT_AUTHOR_EMAIL</code></strong> is the email for the “author” field.</p>
<p><strong><code>GIT_AUTHOR_DATE</code></strong> is the timestamp used for the “author” field.</p>
<p><strong><code>GIT_COMMITTER_NAME</code></strong> sets the human name for the “committer” field.</p>
<p><strong><code>GIT_COMMITTER_EMAIL</code></strong> is the email address for the “committer” field.</p>
<p><strong><code>GIT_COMMITTER_DATE</code></strong> is used for the timestamp in the “committer” field.</p>
<p><strong><code>EMAIL</code></strong> is the fallback email address in case the <code>user.email</code> configuration value isn’t set. If <em>this</em> isn’t set, Git falls back to the system user and host names.</p>
<h3 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h3><p>Git uses the <code>curl</code> library to do network operations over HTTP, so <strong><code>GIT_CURL_VERBOSE</code></strong> tells Git to emit all the messages generated by that library. This is similar to doing <code>curl -v</code> on the command line.</p>
<p><strong><code>GIT_SSL_NO_VERIFY</code></strong> tells Git not to verify SSL certificates. This can sometimes be necessary if you’re using a self-signed certificate to serve Git repositories over HTTPS, or you’re in the middle of setting up a Git server but haven’t installed a full certificate yet.</p>
<p>If the data rate of an HTTP operation is lower than <strong><code>GIT_HTTP_LOW_SPEED_LIMIT</code></strong> bytes per second for longer than <strong><code>GIT_HTTP_LOW_SPEED_TIME</code></strong> seconds, Git will abort that operation. These values override the <code>http.lowSpeedLimit</code> and <code>http.lowSpeedTime</code> configuration values.</p>
<p><strong><code>GIT_HTTP_USER_AGENT</code></strong> sets the user-agent string used by Git when communicating over HTTP. The default is a value like <code>git/2.0.0</code>.</p>
<h3 id="Diffing-and-Merging"><a href="#Diffing-and-Merging" class="headerlink" title="Diffing and Merging"></a>Diffing and Merging</h3><p><strong><code>GIT_DIFF_OPTS</code></strong> is a bit of a misnomer. The only valid values are <code>-u&lt;n&gt;</code> or <code>--unified=&lt;n&gt;</code>, which controls the number of context lines shown in a <code>git diff</code> command.</p>
<p><strong><code>GIT_EXTERNAL_DIFF</code></strong> is used as an override for the <code>diff.external</code> configuration value. If it’s set, Git will invoke this program when <code>git diff</code> is invoked.</p>
<p><strong><code>GIT_DIFF_PATH_COUNTER</code></strong> and <strong><code>GIT_DIFF_PATH_TOTAL</code></strong> are useful from inside the program specified by <code>GIT_EXTERNAL_DIFF</code> or <code>diff.external</code>. The former represents which file in a series is being diffed (starting with 1), and the latter is the total number of files in the batch.</p>
<p><strong><code>GIT_MERGE_VERBOSITY</code></strong> controls the output for the recursive merge strategy. The allowed values are as follows:</p>
<ul>
<li>0 outputs nothing, except possibly a single error message.</li>
<li>1 shows only conflicts.</li>
<li>2 also shows file changes.</li>
<li>3 shows when files are skipped because they haven’t changed.</li>
<li>4 shows all paths as they are processed.</li>
<li>5 and above show detailed debugging information.<br>The default value is 2.</li>
</ul>
<h3 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h3><p>Want to <em>really</em> know what Git is up to? Git has a fairly complete set of traces embedded, and all you need to do is turn them on. The possible values of these variables are as follows:</p>
<ul>
<li>“true”, “1”, or “2” – the trace category is written to stderr.</li>
<li>An absolute path starting with <code>/</code> – the trace output will be written to that file.<br><strong><code>GIT_TRACE</code></strong> controls general traces, which don’t fit into any specific category. This includes the expansion of aliases, and delegation to other sub-programs.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ GIT_TRACE=<span class="literal">true</span> git lga</span><br><span class="line">20:12:49.877982 git.c:554               trace: <span class="built_in">exec</span>: <span class="string">'git-lga'</span></span><br><span class="line">20:12:49.878369 run-command.c:341       trace: run_command: <span class="string">'git-lga'</span></span><br><span class="line">20:12:49.879529 git.c:282               trace: <span class="built_in">alias</span> expansion: lga =&gt; <span class="string">'log'</span> <span class="string">'--graph'</span> <span class="string">'--pretty=oneline'</span> <span class="string">'--abbrev-commit'</span> <span class="string">'--decorate'</span> <span class="string">'--all'</span></span><br><span class="line">20:12:49.879885 git.c:349               trace: built-in: git <span class="string">'log'</span> <span class="string">'--graph'</span> <span class="string">'--pretty=oneline'</span> <span class="string">'--abbrev-commit'</span> <span class="string">'--decorate'</span> <span class="string">'--all'</span></span><br><span class="line">20:12:49.899217 run-command.c:341       trace: run_command: <span class="string">'less'</span></span><br><span class="line">20:12:49.899675 run-command.c:192       trace: <span class="built_in">exec</span>: <span class="string">'less'</span></span><br></pre></td></tr></table></figure>
<p><strong><code>GIT_TRACE_PACK_ACCESS</code></strong> controls tracing of packfile access. The first field is the packfile being accessed, the second is the offset within that file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ GIT_TRACE_PACK_ACCESS=<span class="literal">true</span> git status</span><br><span class="line">20:10:12.081397 sha1_file.c:2088        .git/objects/pack/pack-c3fa...291e.pack 12</span><br><span class="line">20:10:12.081886 sha1_file.c:2088        .git/objects/pack/pack-c3fa...291e.pack 34662</span><br><span class="line">20:10:12.082115 sha1_file.c:2088        .git/objects/pack/pack-c3fa...291e.pack 35175</span><br><span class="line"><span class="comment"># […]</span></span><br><span class="line">20:10:12.087398 sha1_file.c:2088        .git/objects/pack/pack-e80e...e3d2.pack 56914983</span><br><span class="line">20:10:12.087419 sha1_file.c:2088        .git/objects/pack/pack-e80e...e3d2.pack 14303666</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>
<p><strong><code>GIT_TRACE_PACKET</code></strong> enables packet-level tracing for network operations.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ GIT_TRACE_PACKET=<span class="literal">true</span> git ls-remote origin</span><br><span class="line">20:15:14.867043 pkt-line.c:46           packet:          git&lt; <span class="comment"># service=git-upload-pack</span></span><br><span class="line">20:15:14.867071 pkt-line.c:46           packet:          git&lt; 0000</span><br><span class="line">20:15:14.867079 pkt-line.c:46           packet:          git&lt; 97b8860c071898d9e162678ea1035a8ced2f8b1f HEAD\0multi_ack thin-pack side-band side-band-64k ofs-delta shallow no-progress include-tag multi_ack_detailed no-done symref=HEAD:refs/heads/master agent=git/2.0.4</span><br><span class="line">20:15:14.867088 pkt-line.c:46           packet:          git&lt; 0f20ae29889d61f2e93ae00fd34f1cdb53285702 refs/heads/ab/add-interactive-show-diff-func-name</span><br><span class="line">20:15:14.867094 pkt-line.c:46           packet:          git&lt; 36dc827bc9d17f80ed4f326de21247a5d1341fbc refs/heads/ah/doc-gitk-config</span><br><span class="line"><span class="comment"># […]</span></span><br></pre></td></tr></table></figure>
<p><strong><code>GIT_TRACE_PERFORMANCE</code></strong> controls logging of performance data. The output shows how long each particular <code>git</code> invocation takes.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ GIT_TRACE_PERFORMANCE=<span class="literal">true</span> git gc</span><br><span class="line">20:18:19.499676 trace.c:414             performance: 0.374835000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'pack-refs'</span> <span class="string">'--all'</span> <span class="string">'--prune'</span></span><br><span class="line">20:18:19.845585 trace.c:414             performance: 0.343020000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'reflog'</span> <span class="string">'expire'</span> <span class="string">'--all'</span></span><br><span class="line">Counting objects: 170994, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (43413/43413), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (170994/170994), <span class="keyword">done</span>.</span><br><span class="line">Total 170994 (delta 126176), reused 170524 (delta 125706)</span><br><span class="line">20:18:23.567927 trace.c:414             performance: 3.715349000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'pack-objects'</span> <span class="string">'--keep-true-parents'</span> <span class="string">'--honor-pack-keep'</span> <span class="string">'--non-empty'</span> <span class="string">'--all'</span> <span class="string">'--reflog'</span> <span class="string">'--unpack-unreachable=2.weeks.ago'</span> <span class="string">'--local'</span> <span class="string">'--delta-base-offset'</span> <span class="string">'.git/objects/pack/.tmp-49190-pack'</span></span><br><span class="line">20:18:23.584728 trace.c:414             performance: 0.000910000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'prune-packed'</span></span><br><span class="line">20:18:23.605218 trace.c:414             performance: 0.017972000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'update-server-info'</span></span><br><span class="line">20:18:23.606342 trace.c:414             performance: 3.756312000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'repack'</span> <span class="string">'-d'</span> <span class="string">'-l'</span> <span class="string">'-A'</span> <span class="string">'--unpack-unreachable=2.weeks.ago'</span></span><br><span class="line">Checking connectivity: 170994, <span class="keyword">done</span>.</span><br><span class="line">20:18:25.225424 trace.c:414             performance: 1.616423000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'prune'</span> <span class="string">'--expire'</span> <span class="string">'2.weeks.ago'</span></span><br><span class="line">20:18:25.232403 trace.c:414             performance: 0.001051000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'rerere'</span> <span class="string">'gc'</span></span><br><span class="line">20:18:25.233159 trace.c:414             performance: 6.112217000 s: git <span class="built_in">command</span>: <span class="string">'git'</span> <span class="string">'gc'</span></span><br></pre></td></tr></table></figure>
<p><strong><code>GIT_TRACE_SETUP</code></strong> shows information about what Git is discovering about the repository and environment it’s interacting with.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ GIT_TRACE_SETUP=<span class="literal">true</span> git status</span><br><span class="line">20:19:47.086765 trace.c:315             setup: git_dir: .git</span><br><span class="line">20:19:47.087184 trace.c:316             setup: worktree: /Users/ben/src/git</span><br><span class="line">20:19:47.087191 trace.c:317             setup: cwd: /Users/ben/src/git</span><br><span class="line">20:19:47.087194 trace.c:318             setup: prefix: (null)</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>
<h3 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h3><p><strong><code>GIT_SSH</code></strong>, if specified, is a program that is invoked instead of <code>ssh</code> when Git tries to connect to an SSH host. It is invoked like <code>$GIT_SSH [username@]host [-p &lt;port&gt;] &lt;command&gt;</code>. Note that this isn’t the easiest way to customize how <code>ssh</code> is invoked; it won’t support extra command-line parameters, so you’d have to write a wrapper script and set <code>GIT_SSH</code> to point to it. It’s probably easier just to use the <code>~/.ssh/config</code> file for that.</p>
<p><strong><code>GIT_ASKPASS</code></strong> is an override for the <code>core.askpass</code> configuration value. This is the program invoked whenever Git needs to ask the user for credentials, which can expect a text prompt as a command-line argument, and should return the answer on <code>stdout</code>. (See 【Credential Storage】 for more on this subsystem.)</p>
<p><strong><code>GIT_NAMESPACE</code></strong> controls access to namespaced refs, and is equivalent to the <code>--namespace</code> flag. This is mostly useful on the server side, where you may want to store multiple forks of a single repository in one repository, only keeping the refs separate.</p>
<p><strong><code>GIT_FLUSH</code></strong> can be used to force Git to use non-buffered I/O when writing incrementally to stdout. A value of 1 causes Git to flush more often, a value of 0 causes all output to be buffered. The default value (if this variable is not set) is to choose an appropriate buffering scheme depending on the activity and the output mode.</p>
<p><strong><code>GIT_REFLOG_ACTION</code></strong> lets you specify the descriptive text written to the reflog. Here’s an example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ GIT_REFLOG_ACTION=<span class="string">"my action"</span> git commit --allow-empty -m <span class="string">'my message'</span></span><br><span class="line">[master 9e3d55a] my message</span><br><span class="line">$ git reflog -1</span><br><span class="line">9e3d55a HEAD@&#123;0&#125;: my action: my message</span><br></pre></td></tr></table></figure>
<h2 id="Summary-12"><a href="#Summary-12" class="headerlink" title="Summary"></a>Summary</h2><p>At this point, you should have a pretty good understanding of what Git does in the background and, to some degree, how it’s implemented. This chapter has covered a number of plumbing commands — commands that are lower level and simpler than the porcelain commands you’ve learned about in the rest of the book. Understanding how Git works at a lower level should make it easier to understand why it’s doing what it’s doing and also to write your own tools and helper scripts to make your specific workflow work for you.</p>
<p>Git as a content-addressable filesystem is a very powerful tool that you can easily use as more than just a VCS. We hope you can use your newfound knowledge of Git internals to implement your own cool application of this technology and feel more comfortable using Git in more advanced ways.</p>
<h1 id="Git-in-Other-Environments"><a href="#Git-in-Other-Environments" class="headerlink" title="Git in Other Environments"></a><strong>Git</strong> <strong>in</strong> <strong>Other</strong> <strong>Environments</strong></h1><p>If you read through the whole book, you’ve learned a lot about how to use Git at the command line. You can work with local files, connect your repository to others over a network, and work effectively with others. But the story doesn’t end there; Git is usually used as part of a larger ecosystem, and the terminal isn’t always the best way to work with it. Now we’ll take a look at some of the other kinds of environments where Git can be useful, and how other applications (including yours) work alongside Git.</p>
<h2 id="Graphical-Interfaces"><a href="#Graphical-Interfaces" class="headerlink" title="Graphical Interfaces"></a>Graphical Interfaces</h2><p>Git’s native environment is in the terminal. New features show up there first, and only at the command line is the full power of Git completely at your disposal. But plain text isn’t the best choice for all tasks; sometimes a visual representation is what you need, and some users are much more comfortable with a point-and-click interface.</p>
<p>It’s important to note that different interfaces are tailored for different workflows. Some clients expose only a carefully curated subset of Git functionality, in order to support a specific way of working that the author considers effective. When viewed in this light, none of these tools can be called “better” than any of the others, they’re simply more fit for their intended purpose. Also note that there’s nothing these graphical clients can do that the command-line client can’t; the command-line is still where you’ll have the most power and control when working with your repositories.</p>
<h3 id="gitk-and-git-gui"><a href="#gitk-and-git-gui" class="headerlink" title="gitk and git-gui"></a><code>gitk</code> and <code>git-gui</code></h3><p>When you install Git, you also get its visual tools, <code>gitk</code> and <code>git-gui</code>.</p>
<p><code>gitk</code> is a graphical history viewer. Think of it like a powerful GUI shell over <code>git log</code> and <code>git grep</code>. This is the tool to use when you’re trying to find something that happened in the past, or visualize your project’s history.</p>
<p>Gitk is easiest to invoke from the command-line. Just <code>cd</code> into a Git repository, and type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gitk [git <span class="built_in">log</span> options]</span><br></pre></td></tr></table></figure>
<p>Gitk accepts many command-line options, most of which are passed through to the underlying <code>git log</code> action. Probably one of the most useful is the <code>--all</code> flag, which tells gitk to show commits reachable from <em>any</em> ref, not just HEAD. Gitk’s interface looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclzfmnuj20m80g3mzg.jpg" alt="The `gitk` history viewer.">  Figure 1. The <code>gitk</code> history viewer.  On the top is something that looks a bit like the output of <code>git log --graph</code>; each dot represents a commit, the lines represent parent relationships, and refs are shown as colored boxes. The yellow dot represents HEAD, and the red dot represents changes that are yet to become a commit. At the bottom is a view of the selected commit; the comments and patch on the left, and a summary view on the right. In between is a collection of controls used for searching history.</p>
<p><code>git-gui</code>, on the other hand, is primarily a tool for crafting commits. It, too, is easiest to invoke from the command line:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git gui</span><br></pre></td></tr></table></figure>
<p>And it looks something like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco6p620j20m80czab5.jpg" alt="The `git-gui` commit tool.">  Figure 2. The <code>git-gui</code> commit tool.  On the left is the index; unstaged changes are on top, staged changes on the bottom. You can move entire files between the two states by clicking on their icons, or you can select a file for viewing by clicking on its name.</p>
<p>At top right is the diff view, which shows the changes for the currently-selected file. You can stage individual hunks (or individual lines) by right-clicking in this area.</p>
<p>At the bottom right is the message and action area. Type your message into the text box and click “Commit” to do something similar to <code>git commit</code>. You can also choose to amend the last commit by choosing the “Amend” radio button, which will update the “Staged Changes” area with the contents of the last commit. Then you can simply stage or unstage some changes, alter the commit message, and click “Commit” again to replace the old commit with a new one.</p>
<p><code>gitk</code> and <code>git-gui</code> are examples of task-oriented tools. Each of them is tailored for a specific purpose (viewing history and creating commits, respectively), and omit the features not necessary for that task.</p>
<h3 id="GitHub-for-Mac-and-Windows"><a href="#GitHub-for-Mac-and-Windows" class="headerlink" title="GitHub for Mac and Windows"></a>GitHub for Mac and Windows</h3><p>GitHub has created two workflow-oriented Git clients: one for Windows, and one for Mac. These clients are a good example of workflow-oriented tools – rather than expose <em>all</em> of Git’s functionality, they instead focus on a curated set of commonly-used features that work well together. They look like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgci31zpsj20m80ckmy2.jpg" alt="GitHub for Mac.">  Figure 3. GitHub for Mac.    <img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgchqiknsj20m80c7js6.jpg" alt="GitHub for Windows.">  Figure 4. GitHub for Windows.  They are designed to look and work very much alike, so we’ll treat them like a single product in this chapter. We won’t be doing a detailed rundown of these tools (they have their own documentation), but a quick tour of the “changes” view (which is where you’ll spend most of your time) is in order.</p>
<ul>
<li>On the left is the list of repositories the client is tracking; you can add a repository (either by cloning or attaching locally) by clicking the “+” icon at the top of this area.</li>
<li>In the center is a commit-input area, which lets you input a commit message, and select which files should be included. (On Windows, the commit history is displayed directly below this; on Mac, it’s on a separate tab.)</li>
<li>On the right is a diff view, which shows what’s changed in your working directory, or which changes were included in the selected commit.</li>
<li>The last thing to notice is the “Sync” button at the top-right, which is the primary way you interact over the network.<br>You don’t need a GitHub account to use these tools. While they’re designed to highlight GitHub’s service and recommended workflow, they will happily work with any repository, and do network operations with any Git host.</li>
</ul>
<h4 id="Installation-1"><a href="#Installation-1" class="headerlink" title="Installation"></a>Installation</h4><p>GitHub for Windows can be downloaded from &lt;<a href="https://windows.github.com" target="_blank" rel="noopener">https://windows.github.com</a>&gt;, and GitHub for Mac from &lt;<a href="https://mac.github.com" target="_blank" rel="noopener">https://mac.github.com</a>&gt;. When the applications are first run, they walk you through all the first-time Git setup, such as configuring your name and email address, and both set up sane defaults for many common configuration options, such as credential caches and CRLF behavior.</p>
<p>Both are “evergreen” – updates are downloaded and installed in the background while the applications are open. This helpfully includes a bundled version of Git, which means you probably won’t have to worry about manually updating it again. On Windows, the client includes a shortcut to launch Powershell with Posh-git, which we’ll talk more about later in this chapter.</p>
<p>The next step is to give the tool some repositories to work with. The client shows you a list of the repositories you have access to on GitHub, and can clone them in one step. If you already have a local repository, just drag its directory from the Finder or Windows Explorer into the GitHub client window, and it will be included in the list of repositories on the left.</p>
<h4 id="Recommended-Workflow"><a href="#Recommended-Workflow" class="headerlink" title="Recommended Workflow"></a>Recommended Workflow</h4><p>Once it’s installed and configured, you can use the GitHub client for many common Git tasks. The intended workflow for this tool is sometimes called the “GitHub Flow.” We cover this in more detail in 【The GitHub Flow】, but the general gist is that (a) you’ll be committing to a branch, and (b) you’ll be syncing up with a remote repository fairly regularly.</p>
<p>Branch management is one of the areas where the two tools diverge. On Mac, there’s a button at the top of the window for creating a new branch:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcnkpjisj205y024dft.jpg" alt="``Create Branch&#39;&#39; button on Mac.">  Figure 5. “Create Branch” button on Mac.  On Windows, this is done by typing the new branch’s name in the branch-switching widget:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgclg90r9j208w04hdfn.jpg" alt="Creating a branch on Windows.">  Figure 6. Creating a branch on Windows.  Once your branch is created, making new commits is fairly straightforward. Make some changes in your working directory, and when you switch to the GitHub client window, it will show you which files changed. Enter a commit message, select the files you’d like to include, and click the “Commit” button (ctrl-enter or ⌘-enter).</p>
<p>The main way you interact with other repositories over the network is through the “Sync” feature. Git internally has separate operations for pushing, fetching, merging, and rebasing, but the GitHub clients collapse all of these into one multi-step feature. Here’s what happens when you click the Sync button:</p>
<ol start="2">
<li><code>git pull --rebase</code>. If this fails because of a merge conflict, fall back to <code>git pull --no-rebase</code>.</li>
<li><code>git push</code>.<br>This is the most common sequence of network commands when working in this style, so squashing them into one command saves a lot of time.</li>
</ol>
<h4 id="Summary-13"><a href="#Summary-13" class="headerlink" title="Summary"></a>Summary</h4><p>These tools are very well-suited for the workflow they’re designed for. Developers and non-developers alike can be collaborating on a project within minutes, and many of the best practices for this kind of workflow are baked into the tools. However, if your workflow is different, or you want more control over how and when network operations are done, we recommend you use another client or the command line.</p>
<h3 id="Other-GUIs"><a href="#Other-GUIs" class="headerlink" title="Other GUIs"></a>Other GUIs</h3><p>There are a number of other graphical Git clients, and they run the gamut from specialized, single-purpose tools all the way to apps that try to expose everything Git can do. The official Git website has a curated list of the most popular clients at &lt;<a href="http://git-scm.com/downloads/guis" target="_blank" rel="noopener">http://git-scm.com/downloads/guis</a>&gt;. A more comprehensive list is available on the Git wiki site, at <a href="https://git.wiki.kernel.org/index.php/Interfaces,_frontends,_and_tools#Graphical_Interfaces" target="_blank" rel="noopener">https://git.wiki.kernel.org/index.php/Interfaces,_frontends,_and_tools#Graphical_Interfaces</a>.</p>
<h2 id="Git-in-Visual-Studio"><a href="#Git-in-Visual-Studio" class="headerlink" title="Git in Visual Studio"></a>Git in Visual Studio</h2><p>Starting with Visual Studio 2013 Update 1, Visual Studio users have a Git client built directly into their IDE. Visual Studio has had source-control integration features for quite some time, but they were oriented towards centralized, file-locking systems, and Git was not a good match for this workflow. Visual Studio 2013’s Git support has been separated from this older feature, and the result is a much better fit between Studio and Git.</p>
<p>To locate the feature, open a project that’s controlled by Git (or just <code>git init</code> an existing project), and select View &gt; Team Explorer from the menu. You’ll see the “Connect” view, which looks a bit like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcipvh53j209u09uglk.jpg" alt="Connecting to a Git repository from Team Explorer.">  Figure 7. Connecting to a Git repository from Team Explorer.  Visual Studio remembers all of the projects you’ve opened that are Git-controlled, and they’re available in the list at the bottom. If you don’t see the one you want there, click the “Add” link and type in the path to the working directory. Double clicking on one of the local Git repositories leads you to the Home view, which looks like 【The “Home” view for a Git repository in Visual Studio.】. This is a hub for performing Git actions; when you’re <em>writing</em> code, you’ll probably spend most of your time in the “Changes” view, but when it comes time to pull down changes made by your teammates, you’ll use the “Unsynced Commits” and “Branches” views.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcl2qvpdj209h059web.jpg" alt="The Home view for a Git repository in Visual Studio.">  Figure 8. The “Home” view for a Git repository in Visual Studio.  Visual Studio now has a powerful task-focused UI for Git. It includes a linear history view, a diff viewer, remote commands, and many other capabilities. For complete documentation of this feature (which doesn’t fit here), go to &lt;<a href="http://msdn.microsoft.com/en-us/library/hh850437.aspx" target="_blank" rel="noopener">http://msdn.microsoft.com/en-us/library/hh850437.aspx</a>&gt;.</p>
<h2 id="Git-in-Eclipse"><a href="#Git-in-Eclipse" class="headerlink" title="Git in Eclipse"></a>Git in Eclipse</h2><p>Eclipse ships with a plugin called Egit, which provides a fairly-complete interface to Git operations. It’s accessed by switching to the Git Perspective (Window &gt; Open Perspective &gt; Other…, and select “Git”).</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcof1pbfj20m80f2di2.jpg" alt="Eclipse&#39;s EGit environment.">  Figure 9. Eclipse’s EGit environment.  EGit comes with plenty of great documentation, which you can find by going to Help &gt; Help Contents, and choosing the “EGit Documentation” node from the contents listing.</p>
<h2 id="Git-in-Bash"><a href="#Git-in-Bash" class="headerlink" title="Git in Bash"></a>Git in Bash</h2><p>If you’re a Bash user, you can tap into some of your shell’s features to make your experience with Git a lot friendlier. Git actually ships with plugins for several shells, but it’s not turned on by default.</p>
<p>First, you need to get a copy of the <code>contrib/completion/git-completion.bash</code> file out of the Git source code. Copy it somewhere handy, like your home directory, and add this to your <code>.bashrc</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. ~/git-completion.bash</span><br></pre></td></tr></table></figure>
<p>Once that’s done, change your directory to a Git repository, and type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git chec&lt;tab&gt;</span><br></pre></td></tr></table></figure>
<p>…and Bash will auto-complete to <code>git checkout</code>. This works with all of Git’s subcommands, command-line parameters, and remotes and ref names where appropriate.</p>
<p>It’s also useful to customize your prompt to show information about the current directory’s Git repository. This can be as simple or complex as you want, but there are generally a few key pieces of information that most people want, like the current branch, and the status of the working directory. To add these to your prompt, just copy the <code>contrib/completion/git-prompt.sh</code> file from Git’s source repository to your home directory, add something like this to your <code>.bashrc</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. ~/git-prompt.sh</span><br><span class="line"><span class="built_in">export</span> GIT_PS1_SHOWDIRTYSTATE=1</span><br><span class="line"><span class="built_in">export</span> PS1=<span class="string">'\w$(__git_ps1 " (%s)")\$ '</span></span><br></pre></td></tr></table></figure>
<p>The <code>\w</code> means print the current working directory, the <code>\$</code> prints the <code>$</code> part of the prompt, and <code>__git_ps1 &quot; (%s)&quot;</code> calls the function provided by <code>git-prompt.sh</code> with a formatting argument. Now your bash prompt will look like this when you’re anywhere inside a Git-controlled project:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgckz6k41j20gu05gt8j.jpg" alt="Customized `bash` prompt.">  Figure 10. Customized <code>bash</code> prompt.  Both of these scripts come with helpful documentation; take a look at the contents of <code>git-completion.bash</code> and <code>git-prompt.sh</code> for more information.</p>
<h2 id="Git-in-Zsh"><a href="#Git-in-Zsh" class="headerlink" title="Git in Zsh"></a>Git in Zsh</h2><p>Zsh also ships with a tab-completion library for Git. To use it, simply run <code>autoload -Uz compinit &amp;&amp; compinit</code> in your <code>.zshrc</code>. Zsh’s interface is a bit more powerful than Bash’s:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git che&lt;tab&gt;</span><br><span class="line">check-attr        -- display gitattributes information</span><br><span class="line">check-ref-format  -- ensure that a reference name is well formed</span><br><span class="line">checkout          -- checkout branch or paths to working tree</span><br><span class="line">checkout-index    -- copy files from index to working directory</span><br><span class="line">cherry            -- find commits not merged upstream</span><br><span class="line">cherry-pick       -- apply changes introduced by some existing commits</span><br></pre></td></tr></table></figure>
<p>Ambiguous tab-completions aren’t just listed; they have helpful descriptions, and you can graphically navigate the list by repeatedly hitting tab. This works with Git commands, their arguments, and names of things inside the repository (like refs and remotes), as well as filenames and all the other things Zsh knows how to tab-complete.</p>
<p>Zsh ships with a framework for getting information from version control systems, called <code>vcs_info</code>. To include the branch name in the prompt on the right side, add these lines to your <code>~/.zshrc</code> file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">autoload</span> -Uz vcs_info</span><br><span class="line"><span class="function"><span class="title">precmd_vcs_info</span></span>() &#123; vcs_info &#125;</span><br><span class="line">precmd_functions+=( precmd_vcs_info )</span><br><span class="line"><span class="built_in">setopt</span> prompt_subst</span><br><span class="line">RPROMPT=\<span class="variable">$vcs_info_msg_0_</span></span><br><span class="line"><span class="comment"># PROMPT=\$vcs_info_msg_0_'%# '</span></span><br><span class="line"><span class="built_in">zstyle</span> <span class="string">':vcs_info:git:*'</span> formats <span class="string">'%b'</span></span><br></pre></td></tr></table></figure>
<p>This results in a display of the current branch on the right-hand side of the terminal window, whenever your shell is inside a Git repository. (The left side is supported as well, of course; just uncomment the assignment to PROMPT.) It looks a bit like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgck0qwbfj20m80e0jrv.jpg" alt="Customized `zsh` prompt.">  Figure 11. Customized <code>zsh</code> prompt.  For more information on vcs_info, check out its documentation in the <code>zshcontrib(1)</code> manual page, or online at &lt;<a href="http://zsh.sourceforge.net/Doc/Release/User-Contributions.html#Version-Control-Information" target="_blank" rel="noopener">http://zsh.sourceforge.net/Doc/Release/User-Contributions.html#Version-Control-Information</a>&gt;.</p>
<p>Instead of vcs_info, you might prefer the prompt customization script that ships with Git, called <code>git-prompt.sh</code>; see &lt;<a href="https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh" target="_blank" rel="noopener">https://github.com/git/git/blob/master/contrib/completion/git-prompt.sh</a>&gt; for details. <code>git-prompt.sh</code> is compatible with both Bash and Zsh.</p>
<p>Zsh is powerful enough that there are entire frameworks dedicated to making it better. One of them is called “oh-my-zsh”, and it can be found at &lt;<a href="https://github.com/robbyrussell/oh-my-zsh" target="_blank" rel="noopener">https://github.com/robbyrussell/oh-my-zsh</a>&gt;. oh-my-zsh’s plugin system comes with powerful git tab-completion, and it has a variety of prompt “themes”, many of which display version-control data. 【An example of an oh-my-zsh theme.】 is just one example of what can be done with this system.</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgco2dz2zj20ie062web.jpg" alt="An example of an oh-my-zsh theme.">  Figure 12. An example of an oh-my-zsh theme.</p>
<h2 id="Git-in-Powershell"><a href="#Git-in-Powershell" class="headerlink" title="Git in Powershell"></a>Git in Powershell</h2><p>The legacy command-line terminal on Windows (<code>cmd.exe</code>) isn’t really capable of a customized Git experience, but if you’re using Powershell, you’re in luck. This also works if you’re running PowerShell on a non-Windows platform like Debian. A package called Posh-Git (&lt;<a href="https://github.com/dahlbyk/posh-git" target="_blank" rel="noopener">https://github.com/dahlbyk/posh-git</a>&gt;) provides powerful tab-completion facilities, as well as an enhanced prompt to help you stay on top of your repository status. It looks like this:</p>
<p><img src="https://wx1.sinaimg.cn/large/6a9fdecaly1fsgcib8fuaj20bk06u3yc.jpg" alt="Powershell with Posh-git.">  Figure 13. Powershell with Posh-git.</p>
<h3 id="Installation-2"><a href="#Installation-2" class="headerlink" title="Installation"></a>Installation</h3><h4 id="Prerequisites-Windows-only"><a href="#Prerequisites-Windows-only" class="headerlink" title="Prerequisites (Windows only)"></a>Prerequisites (Windows only)</h4><p>Before you’re able to run PowerShell scripts on your machine, you need to set your local ExecutionPolicy to RemoteSigned (Basically anything except Undefined and Restricted). If you choose AllSigned instead of RemoteSigned, also local scripts (your own) need to be digitally signed in order to be executed. With RemoteSigned, only Scripts having the “ZoneIdentifier” set to Internet (were downloaded from the web) need to be signed, others not. If you’re an administrator and want to set it for all Users on that machine, use “-Scope LocalMachine”. If you’re a normal user, without administrative rights, you can use “-Scope CurrentUser” to set it only for you. More about PowerShell Scopes: (&lt;<a href="https://technet.microsoft.com/de-de/library/hh847849.aspx" target="_blank" rel="noopener">https://technet.microsoft.com/de-de/library/hh847849.aspx</a>&gt;) More about PowerShell ExecutionPolicy: (&lt;<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy</a>&gt;)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; Set-ExecutionPolicy -Scope LocalMachine -ExecutionPolicy RemoteSigned -Force</span><br></pre></td></tr></table></figure>
<h4 id="PowerShell-Gallery"><a href="#PowerShell-Gallery" class="headerlink" title="PowerShell Gallery"></a>PowerShell Gallery</h4><p>If you have at least PowerShell 5 or PowerShell 4 with PackageManagement installed, you can use the package manager to fetch Posh-Git for you. More information about the requirements: (<a href="https://docs.microsoft.com/en-us/powershell/gallery/psget/get_psget_module" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/powershell/gallery/psget/get_psget_module</a>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; Set-PSRepository -Name PSGallery -InstallationPolicy Trusted</span><br><span class="line">&gt; Update-Module PowerShellGet -Force</span><br><span class="line">&gt; Install-Module Posh-Git -Scope AllUsers</span><br></pre></td></tr></table></figure>
<p>If you want to install Posh-Git only for the current user and not globally, use “-Scope CurrentUser” instead. If the second command fails with an error like <code>Module &#39;PowerShellGet&#39; was not installed by using Install-Module</code>, you’ll need to run another command first:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; Install-Module PowerShellGet -Force -SkipPublisherCheck</span><br></pre></td></tr></table></figure>
<p>Then you can go back and try again. This happens, because the modules that ship with Windows Powershell are signed with a different publishment certificate.</p>
<h4 id="Update-PowerShell-Prompt"><a href="#Update-PowerShell-Prompt" class="headerlink" title="Update PowerShell Prompt"></a>Update PowerShell Prompt</h4><p>To include git information in your prompt, posh-git needs to be imported. To do this automatically, include the import statement into you $profile script. This script is executed everytime you open a new PowerShell prompt. Keep in mind, that there are multiple $profile scripts. E. g. one for the console and a separate one for the ISE.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; New-Item -Name $(Split-Path -Path <span class="variable">$profile</span>) -ItemType Directory -Force</span><br><span class="line">&gt; <span class="string">'Import-Module Posh-Git'</span> | Out-File -Append -Encoding default -FilePath <span class="variable">$profile</span></span><br></pre></td></tr></table></figure>
<h4 id="From-Source"><a href="#From-Source" class="headerlink" title="From Source"></a>From Source</h4><p>Just download a Posh-Git release from (&lt;<a href="https://github.com/dahlbyk/posh-git" target="_blank" rel="noopener">https://github.com/dahlbyk/posh-git</a>&gt;), and uncompress it to the <code>WindowsPowershell</code> directory. Then open a Powershell prompt as an administrator, and do this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cd</span> ~\Documents\WindowsPowerShell\Module\posh-git</span><br><span class="line">&gt; .\install.ps1</span><br></pre></td></tr></table></figure>
<p>This will add the proper line to your <code>profile.ps1</code> file, and posh-git will be active the next time you open your prompt.</p>
<h2 id="Summary-14"><a href="#Summary-14" class="headerlink" title="Summary"></a>Summary</h2><p>You’ve learned how to harness Git’s power from inside the tools that you use during your everyday work, and also how to access Git repositories from your own programs.</p>
<h1 id="Embedding-Git-in-your-Applications"><a href="#Embedding-Git-in-your-Applications" class="headerlink" title="Embedding Git in your Applications"></a><strong>Embedding</strong> <strong>Git</strong> <strong>in</strong> <strong>your</strong> <strong>Applications</strong></h1><p>If your application is for developers, chances are good that it could benefit from integration with source control. Even non-developer applications, such as document editors, could potentially benefit from version-control features, and Git’s model works very well for many different scenarios.</p>
<p>If you need to integrate Git with your application, you have essentially two options: spawn a shell and call the <code>git</code> command-line program, or embed a Git library into your application. Here we’ll cover command-line integration and several of the most popular embeddable Git libraries.</p>
<h2 id="Command-line-Git"><a href="#Command-line-Git" class="headerlink" title="Command-line Git"></a>Command-line Git</h2><p>One option is to spawn a shell process and use the Git command-line tool to do the work. This has the benefit of being canonical, and all of Git’s features are supported. This also happens to be fairly easy, as most runtime environments have a relatively simple facility for invoking a process with command-line arguments. However, this approach does have some downsides.</p>
<p>One is that all the output is in plain text. This means that you’ll have to parse Git’s occasionally-changing output format to read progress and result information, which can be inefficient and error-prone.</p>
<p>Another is the lack of error recovery. If a repository is corrupted somehow, or the user has a malformed configuration value, Git will simply refuse to perform many operations.</p>
<p>Yet another is process management. Git requires you to maintain a shell environment on a separate process, which can add unwanted complexity. Trying to coordinate many of these processes (especially when potentially accessing the same repository from several processes) can be quite a challenge.</p>
<h2 id="Libgit2"><a href="#Libgit2" class="headerlink" title="Libgit2"></a>Libgit2</h2><p>Another option at your disposal is to use Libgit2. Libgit2 is a dependency-free implementation of Git, with a focus on having a nice API for use within other programs. You can find it at &lt;<a href="http://libgit2.github.com" target="_blank" rel="noopener">http://libgit2.github.com</a>&gt;.</p>
<p>First, let’s take a look at what the C API looks like. Here’s a whirlwind tour:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// Open a repository</span><br><span class="line">git_repository *repo;</span><br><span class="line">int error = git_repository_open(&amp;repo, <span class="string">"/path/to/repository"</span>);</span><br><span class="line"></span><br><span class="line">// Dereference HEAD to a commit</span><br><span class="line">git_object *head_commit;</span><br><span class="line">error = git_revparse_single(&amp;head_commit, repo, <span class="string">"HEAD^&#123;commit&#125;"</span>);</span><br><span class="line">git_commit *commit = (git_commit*)head_commit;</span><br><span class="line"></span><br><span class="line">// Print some of the commit<span class="string">'s properties</span></span><br><span class="line"><span class="string">printf("%s", git_commit_message(commit));</span></span><br><span class="line"><span class="string">const git_signature *author = git_commit_author(commit);</span></span><br><span class="line"><span class="string">printf("%s &lt;%s&gt;\n", author-&gt;name, author-&gt;email);</span></span><br><span class="line"><span class="string">const git_oid *tree_id = git_commit_tree_id(commit);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Cleanup</span></span><br><span class="line"><span class="string">git_commit_free(commit);</span></span><br><span class="line"><span class="string">git_repository_free(repo);</span></span><br></pre></td></tr></table></figure>
<p>The first couple of lines open a Git repository. The <code>git_repository</code> type represents a handle to a repository with a cache in memory. This is the simplest method, for when you know the exact path to a repository’s working directory or <code>.git</code> folder. There’s also the <code>git_repository_open_ext</code> which includes options for searching, <code>git_clone</code> and friends for making a local clone of a remote repository, and <code>git_repository_init</code> for creating an entirely new repository.</p>
<p>The second chunk of code uses rev-parse syntax (see 【Branch References】 for more on this) to get the commit that HEAD eventually points to. The type returned is a <code>git_object</code> pointer, which represents something that exists in the Git object database for a repository. <code>git_object</code> is actually a “parent” type for several different kinds of objects; the memory layout for each of the “child” types is the same as for <code>git_object</code>, so you can safely cast to the right one. In this case, <code>git_object_type(commit)</code> would return <code>GIT_OBJ_COMMIT</code>, so it’s safe to cast to a <code>git_commit</code> pointer.</p>
<p>The next chunk shows how to access the commit’s properties. The last line here uses a <code>git_oid</code> type; this is Libgit2’s representation for a SHA-1 hash.</p>
<p>From this sample, a couple of patterns have started to emerge:</p>
<ul>
<li>If you declare a pointer and pass a reference to it into a Libgit2 call, that call will probably return an integer error code. A <code>0</code> value indicates success; anything less is an error.</li>
<li>If Libgit2 populates a pointer for you, you’re responsible for freeing it.</li>
<li>If Libgit2 returns a <code>const</code> pointer from a call, you don’t have to free it, but it will become invalid when the object it belongs to is freed.</li>
<li>Writing C is a bit painful.<br>That last one means it isn’t very probable that you’ll be writing C when using Libgit2. Fortunately, there are a number of language-specific bindings available that make it fairly easy to work with Git repositories from your specific language and environment. Let’s take a look at the above example written using the Ruby bindings for Libgit2, which are named Rugged, and can be found at &lt;<a href="https://github.com/libgit2/rugged" target="_blank" rel="noopener">https://github.com/libgit2/rugged</a>&gt;.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">repo = Rugged::Repository.new(<span class="string">'path/to/repository'</span>)</span><br><span class="line">commit = repo.head.target</span><br><span class="line">puts commit.message</span><br><span class="line">puts <span class="string">"#&#123;commit.author[:name]&#125; &lt;#&#123;commit.author[:email]&#125;&gt;"</span></span><br><span class="line">tree = commit.tree</span><br></pre></td></tr></table></figure>
<p>As you can see, the code is much less cluttered. Firstly, Rugged uses exceptions; it can raise things like <code>ConfigError</code> or <code>ObjectError</code> to signal error conditions. Secondly, there’s no explicit freeing of resources, since Ruby is garbage-collected. Let’s take a look at a slightly more complicated example: crafting a commit from scratch</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">blob_id = repo.write(<span class="string">"Blob contents"</span>, :blob) ①</span><br><span class="line"></span><br><span class="line">index = repo.index</span><br><span class="line">index.read_tree(repo.head.target.tree)</span><br><span class="line">index.add(:path =&gt; <span class="string">'newfile.txt'</span>, :oid =&gt; blob_id) ②</span><br><span class="line"></span><br><span class="line">sig = &#123;</span><br><span class="line">    :email =&gt; <span class="string">"bob@example.com"</span>,</span><br><span class="line">    :name =&gt; <span class="string">"Bob User"</span>,</span><br><span class="line">    :time =&gt; Time.now,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">commit_id = Rugged::Commit.create(repo,</span><br><span class="line">    :tree =&gt; index.write_tree(repo), ③</span><br><span class="line">    :author =&gt; sig,</span><br><span class="line">    :committer =&gt; sig, ④</span><br><span class="line">    :message =&gt; <span class="string">"Add newfile.txt"</span>, ⑤</span><br><span class="line">    :parents =&gt; repo.empty? ? [] : [ repo.head.target ].compact, ⑥</span><br><span class="line">    :update_ref =&gt; <span class="string">'HEAD'</span>, ⑦</span><br><span class="line">)</span><br><span class="line">commit = repo.lookup(commit_id) ⑧</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><em>①</em> Create a new blob, which contains the contents of a new file.</li>
<li><em>②</em> Populate the index with the head commit’s tree, and add the new file at the path <code>newfile.txt</code>.</li>
<li><em>③</em> This creates a new tree in the ODB, and uses it for the new commit.</li>
<li><em>④</em> We use the same signature for both the author and committer fields.</li>
<li><em>⑤</em> The commit message.</li>
<li><em>⑥</em> When creating a commit, you have to specify the new commit’s parents. This uses the tip of HEAD for the single parent.</li>
<li><em>⑦</em> Rugged (and Libgit2) can optionally update a reference when making a commit.</li>
<li><em>⑧</em> The return value is the SHA-1 hash of a new commit object, which you can then use to get a <code>Commit</code> object.<br>The Ruby code is nice and clean, but since Libgit2 is doing the heavy lifting, this code will run pretty fast, too. If you’re not a rubyist, we touch on some other bindings in 【Other Bindings】.</li>
</ol>
<h3 id="Advanced-Functionality"><a href="#Advanced-Functionality" class="headerlink" title="Advanced Functionality"></a>Advanced Functionality</h3><p>Libgit2 has a couple of capabilities that are outside the scope of core Git. One example is pluggability: Libgit2 allows you to provide custom “backends” for several types of operation, so you can store things in a different way than stock Git does. Libgit2 allows custom backends for configuration, ref storage, and the object database, among other things.</p>
<p>Let’s take a look at how this works. The code below is borrowed from the set of backend examples provided by the Libgit2 team (which can be found at &lt;<a href="https://github.com/libgit2/libgit2-backends" target="_blank" rel="noopener">https://github.com/libgit2/libgit2-backends</a>&gt;). Here’s how a custom backend for the object database is set up:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git_odb *odb;</span><br><span class="line">int error = git_odb_new(&amp;odb); ①</span><br><span class="line"></span><br><span class="line">git_odb_backend *my_backend;</span><br><span class="line">error = git_odb_backend_mine(&amp;my_backend, /*…*/); ②</span><br><span class="line"></span><br><span class="line">error = git_odb_add_backend(odb, my_backend, 1); ③</span><br><span class="line"></span><br><span class="line">git_repository *repo;</span><br><span class="line">error = git_repository_open(&amp;repo, <span class="string">"some-path"</span>);</span><br><span class="line">error = git_repository_set_odb(odb); ④</span><br></pre></td></tr></table></figure>
<p><em>(Note that errors are captured, but not handled. We hope your code is better than ours.)</em></p>
<ol start="2">
<li><em>①</em> Initialize an empty object database (ODB) “frontend,” which will act as a container for the “backends” which are the ones doing the real work.</li>
<li><em>②</em> Initialize a custom ODB backend.</li>
<li><em>③</em> Add the backend to the frontend.</li>
<li><em>④</em> Open a repository, and set it to use our ODB to look up objects.<br>But what is this <code>git_odb_backend_mine</code> thing? Well, that’s the constructor for your own ODB implementation, and you can do whatever you want in there, so long as you fill in the <code>git_odb_backend</code> structure properly. Here’s what it <em>could</em> look like:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">    git_odb_backend parent;</span><br><span class="line"></span><br><span class="line">    // Some other stuff</span><br><span class="line">    void *custom_context;</span><br><span class="line">&#125; my_backend_struct;</span><br><span class="line"></span><br><span class="line">int git_odb_backend_mine(git_odb_backend **backend_out, /*…*/)</span><br><span class="line">&#123;</span><br><span class="line">    my_backend_struct *backend;</span><br><span class="line"></span><br><span class="line">    backend = calloc(1, sizeof (my_backend_struct));</span><br><span class="line"></span><br><span class="line">    backend-&gt;custom_context = …;</span><br><span class="line"></span><br><span class="line">    backend-&gt;parent.read = &amp;my_backend__read;</span><br><span class="line">    backend-&gt;parent.read_prefix = &amp;my_backend__read_prefix;</span><br><span class="line">    backend-&gt;parent.read_header = &amp;my_backend__read_header;</span><br><span class="line">    // …</span><br><span class="line"></span><br><span class="line">    *backend_out = (git_odb_backend *) backend;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> GIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The subtlest constraint here is that <code>my_backend_struct</code>‘s first member must be a <code>git_odb_backend</code> structure; this ensures that the memory layout is what the Libgit2 code expects it to be. The rest of it is arbitrary; this structure can be as large or small as you need it to be.</p>
<p>The initialization function allocates some memory for the structure, sets up the custom context, and then fills in the members of the <code>parent</code> structure that it supports. Take a look at the <code>include/git2/sys/odb_backend.h</code> file in the Libgit2 source for a complete set of call signatures; your particular use case will help determine which of these you’ll want to support.</p>
<h3 id="Other-Bindings"><a href="#Other-Bindings" class="headerlink" title="Other Bindings"></a>Other Bindings</h3><p>Libgit2 has bindings for many languages. Here we show a small example using a few of the more complete bindings packages as of this writing; libraries exist for many other languages, including C++, Go, Node.js, Erlang, and the JVM, all in various stages of maturity. The official collection of bindings can be found by browsing the repositories at &lt;<a href="https://github.com/libgit2" target="_blank" rel="noopener">https://github.com/libgit2</a>&gt;. The code we’ll write will return the commit message from the commit eventually pointed to by HEAD (sort of like <code>git log -1</code>).</p>
<h4 id="LibGit2Sharp"><a href="#LibGit2Sharp" class="headerlink" title="LibGit2Sharp"></a>LibGit2Sharp</h4><p>If you’re writing a .NET or Mono application, LibGit2Sharp (&lt;<a href="https://github.com/libgit2/libgit2sharp" target="_blank" rel="noopener">https://github.com/libgit2/libgit2sharp</a>&gt;) is what you’re looking for. The bindings are written in C#, and great care has been taken to wrap the raw Libgit2 calls with native-feeling CLR APIs. Here’s what our example program looks like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Repository(@<span class="string">"C:\path\to\repo"</span>).Head.Tip.Message;</span><br></pre></td></tr></table></figure>
<p>For desktop Windows applications, there’s even a NuGet package that will help you get started quickly.</p>
<h4 id="objective-git"><a href="#objective-git" class="headerlink" title="objective-git"></a>objective-git</h4><p>If your application is running on an Apple platform, you’re likely using Objective-C as your implementation language. Objective-Git (&lt;<a href="https://github.com/libgit2/objective-git" target="_blank" rel="noopener">https://github.com/libgit2/objective-git</a>&gt;) is the name of the Libgit2 bindings for that environment. The example program looks like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GTRepository *repo =</span><br><span class="line">    [[GTRepository alloc] initWithURL:[NSURL fileURLWithPath: @<span class="string">"/path/to/repo"</span>] error:NULL];</span><br><span class="line">NSString *msg = [[[repo headReferenceWithError:NULL] resolvedTarget] message];</span><br></pre></td></tr></table></figure>
<p>Objective-git is fully interoperable with Swift, so don’t fear if you’ve left Objective-C behind.</p>
<h4 id="pygit2"><a href="#pygit2" class="headerlink" title="pygit2"></a>pygit2</h4><p>The bindings for Libgit2 in Python are called Pygit2, and can be found at &lt;<a href="http://www.pygit2.org/" target="_blank" rel="noopener">http://www.pygit2.org/</a>&gt;. Our example program:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pygit2.Repository(<span class="string">"/path/to/repo"</span>) <span class="comment"># open repository</span></span><br><span class="line">    .head                          <span class="comment"># get the current branch</span></span><br><span class="line">    .peel(pygit2.Commit)           <span class="comment"># walk down to the commit</span></span><br><span class="line">    .message                       <span class="comment"># read the message</span></span><br></pre></td></tr></table></figure>
<h3 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h3><p>Of course, a full treatment of Libgit2’s capabilities is outside the scope of this book. If you want more information on Libgit2 itself, there’s API documentation at &lt;<a href="https://libgit2.github.com/libgit2" target="_blank" rel="noopener">https://libgit2.github.com/libgit2</a>&gt;, and a set of guides at &lt;<a href="https://libgit2.github.com/docs" target="_blank" rel="noopener">https://libgit2.github.com/docs</a>&gt;. For the other bindings, check the bundled README and tests; there are often small tutorials and pointers to further reading there.</p>
<h2 id="JGit"><a href="#JGit" class="headerlink" title="JGit"></a>JGit</h2><p>If you want to use Git from within a Java program, there is a fully featured Git library called JGit. JGit is a relatively full-featured implementation of Git written natively in Java, and is widely used in the Java community. The JGit project is under the Eclipse umbrella, and its home can be found at &lt;<a href="http://www.eclipse.org/jgit" target="_blank" rel="noopener">http://www.eclipse.org/jgit</a>&gt;.</p>
<h3 id="Getting-Set-Up"><a href="#Getting-Set-Up" class="headerlink" title="Getting Set Up"></a>Getting Set Up</h3><p>There are a number of ways to connect your project with JGit and start writing code against it. Probably the easiest is to use Maven – the integration is accomplished by adding the following snippet to the <code>&lt;dependencies&gt;</code> tag in your pom.xml file:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.eclipse.jgit&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;org.eclipse.jgit&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.0.201409260305-r&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>The <code>version</code> will most likely have advanced by the time you read this; check &lt;<a href="http://mvnrepository.com/artifact/org.eclipse.jgit/org.eclipse.jgit" target="_blank" rel="noopener">http://mvnrepository.com/artifact/org.eclipse.jgit/org.eclipse.jgit</a>&gt; for updated repository information. Once this step is done, Maven will automatically acquire and use the JGit libraries that you’ll need.</p>
<p>If you would rather manage the binary dependencies yourself, pre-built JGit binaries are available from &lt;<a href="http://www.eclipse.org/jgit/download" target="_blank" rel="noopener">http://www.eclipse.org/jgit/download</a>&gt;. You can build them into your project by running a command like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac -cp .:org.eclipse.jgit-3.5.0.201409260305-r.jar App.java</span><br><span class="line">java -cp .:org.eclipse.jgit-3.5.0.201409260305-r.jar App</span><br></pre></td></tr></table></figure>
<h3 id="Plumbing"><a href="#Plumbing" class="headerlink" title="Plumbing"></a>Plumbing</h3><p>JGit has two basic levels of API: plumbing and porcelain. The terminology for these comes from Git itself, and JGit is divided into roughly the same kinds of areas: porcelain APIs are a friendly front-end for common user-level actions (the sorts of things a normal user would use the Git command-line tool for), while the plumbing APIs are for interacting with low-level repository objects directly.</p>
<p>The starting point for most JGit sessions is the <code>Repository</code> class, and the first thing you’ll want to do is create an instance of it. For a filesystem-based repository (yes, JGit allows for other storage models), this is accomplished using <code>FileRepositoryBuilder</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Create a new repository</span><br><span class="line">Repository newlyCreatedRepo = FileRepositoryBuilder.create(</span><br><span class="line">    new File(<span class="string">"/tmp/new_repo/.git"</span>));</span><br><span class="line">newlyCreatedRepo.create();</span><br><span class="line"></span><br><span class="line">// Open an existing repository</span><br><span class="line">Repository existingRepo = new FileRepositoryBuilder()</span><br><span class="line">    .setGitDir(new File(<span class="string">"my_repo/.git"</span>))</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>The builder has a fluent API for providing all the things it needs to find a Git repository, whether or not your program knows exactly where it’s located. It can use environment variables (<code>.readEnvironment()</code>), start from a place in the working directory and search (<code>.setWorkTree(…).findGitDir()</code>), or just open a known <code>.git</code> directory as above.</p>
<p>Once you have a <code>Repository</code> instance, you can do all sorts of things with it. Here’s a quick sampling:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// Get a reference</span><br><span class="line">Ref master = repo.getRef(<span class="string">"master"</span>);</span><br><span class="line"></span><br><span class="line">// Get the object the reference points to</span><br><span class="line">ObjectId masterTip = master.getObjectId();</span><br><span class="line"></span><br><span class="line">// Rev-parse</span><br><span class="line">ObjectId obj = repo.resolve(<span class="string">"HEAD^&#123;tree&#125;"</span>);</span><br><span class="line"></span><br><span class="line">// Load raw object contents</span><br><span class="line">ObjectLoader loader = repo.open(masterTip);</span><br><span class="line">loader.copyTo(System.out);</span><br><span class="line"></span><br><span class="line">// Create a branch</span><br><span class="line">RefUpdate createBranch1 = repo.updateRef(<span class="string">"refs/heads/branch1"</span>);</span><br><span class="line">createBranch1.setNewObjectId(masterTip);</span><br><span class="line">createBranch1.update();</span><br><span class="line"></span><br><span class="line">// Delete a branch</span><br><span class="line">RefUpdate deleteBranch1 = repo.updateRef(<span class="string">"refs/heads/branch1"</span>);</span><br><span class="line">deleteBranch1.setForceUpdate(<span class="literal">true</span>);</span><br><span class="line">deleteBranch1.delete();</span><br><span class="line"></span><br><span class="line">// Config</span><br><span class="line">Config cfg = repo.getConfig();</span><br><span class="line">String name = cfg.getString(<span class="string">"user"</span>, null, <span class="string">"name"</span>);</span><br></pre></td></tr></table></figure>
<p>There’s quite a bit going on here, so let’s go through it one section at a time.</p>
<p>The first line gets a pointer to the <code>master</code> reference. JGit automatically grabs the <em>actual</em> master ref, which lives at <code>refs/heads/master</code>, and returns an object that lets you fetch information about the reference. You can get the name (<code>.getName()</code>), and either the target object of a direct reference (<code>.getObjectId()</code>) or the reference pointed to by a symbolic ref (<code>.getTarget()</code>). Ref objects are also used to represent tag refs and objects, so you can ask if the tag is “peeled,” meaning that it points to the final target of a (potentially long) string of tag objects.</p>
<p>The second line gets the target of the <code>master</code> reference, which is returned as an ObjectId instance. ObjectId represents the SHA-1 hash of an object, which might or might not exist in Git’s object database. The third line is similar, but shows how JGit handles the rev-parse syntax (for more on this, see 【Branch References】); you can pass any object specifier that Git understands, and JGit will return either a valid ObjectId for that object, or <code>null</code>.</p>
<p>The next two lines show how to load the raw contents of an object. In this example, we call <code>ObjectLoader.copyTo()</code> to stream the contents of the object directly to stdout, but ObjectLoader also has methods to read the type and size of an object, as well as return it as a byte array. For large objects (where <code>.isLarge()</code> returns <code>true</code>), you can call <code>.openStream()</code> to get an InputStream-like object that can read the raw object data without pulling it all into memory at once.</p>
<p>The next few lines show what it takes to create a new branch. We create a RefUpdate instance, configure some parameters, and call <code>.update()</code> to trigger the change. Directly following this is the code to delete that same branch. Note that <code>.setForceUpdate(true)</code> is required for this to work; otherwise the <code>.delete()</code> call will return <code>REJECTED</code>, and nothing will happen.</p>
<p>The last example shows how to fetch the <code>user.name</code> value from the Git configuration files. This Config instance uses the repository we opened earlier for local configuration, but will automatically detect the global and system configuration files and read values from them as well.</p>
<p>This is only a small sampling of the full plumbing API; there are many more methods and classes available. Also not shown here is the way JGit handles errors, which is through the use of exceptions. JGit APIs sometimes throw standard Java exceptions (such as <code>IOException</code>), but there are a host of JGit-specific exception types that are provided as well (such as <code>NoRemoteRepositoryException</code>, <code>CorruptObjectException</code>, and <code>NoMergeBaseException</code>).</p>
<h3 id="Porcelain"><a href="#Porcelain" class="headerlink" title="Porcelain"></a>Porcelain</h3><p>The plumbing APIs are rather complete, but it can be cumbersome to string them together to achieve common goals, like adding a file to the index, or making a new commit. JGit provides a higher-level set of APIs to help out with this, and the entry point to these APIs is the <code>Git</code> class:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Repository repo;</span><br><span class="line">// construct repo...</span><br><span class="line">Git git = new Git(repo);</span><br></pre></td></tr></table></figure>
<p>The Git class has a nice set of high-level <em>builder</em>-style methods that can be used to construct some pretty complex behavior. Let’s take a look at an example – doing something like <code>git ls-remote</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CredentialsProvider cp = new UsernamePasswordCredentialsProvider(<span class="string">"username"</span>, <span class="string">"p4ssw0rd"</span>);</span><br><span class="line">Collection&lt;Ref&gt; remoteRefs = git.lsRemote()</span><br><span class="line">    .setCredentialsProvider(cp)</span><br><span class="line">    .setRemote(<span class="string">"origin"</span>)</span><br><span class="line">    .setTags(<span class="literal">true</span>)</span><br><span class="line">    .setHeads(<span class="literal">false</span>)</span><br><span class="line">    .call();</span><br><span class="line"><span class="keyword">for</span> (Ref ref : remoteRefs) &#123;</span><br><span class="line">    System.out.println(ref.getName() + <span class="string">" -&gt; "</span> + ref.getObjectId().name());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is a common pattern with the Git class; the methods return a command object that lets you chain method calls to set parameters, which are executed when you call <code>.call()</code>. In this case, we’re asking the <code>origin</code> remote for tags, but not heads. Also notice the use of a <code>CredentialsProvider</code> object for authentication.</p>
<p>Many other commands are available through the Git class, including but not limited to <code>add</code>, <code>blame</code>, <code>commit</code>, <code>clean</code>, <code>push</code>, <code>rebase</code>, <code>revert</code>, and <code>reset</code>.</p>
<h3 id="Further-Reading-1"><a href="#Further-Reading-1" class="headerlink" title="Further Reading"></a>Further Reading</h3><p>This is only a small sampling of JGit’s full capabilities. If you’re interested and want to learn more, here’s where to look for information and inspiration:</p>
<ul>
<li>The official JGit API documentation can be found at &lt;<a href="http://www.eclipse.org/jgit/documentation/" target="_blank" rel="noopener">http://www.eclipse.org/jgit/documentation/</a>&gt;. These are standard Javadoc, so your favorite JVM IDE will be able to install them locally, as well.</li>
<li>The JGit Cookbook at &lt;<a href="https://github.com/centic9/jgit-cookbook" target="_blank" rel="noopener">https://github.com/centic9/jgit-cookbook</a>&gt; has many examples of how to do specific tasks with JGit.</li>
<li>There are several good resources pointed out at &lt;<a href="http://stackoverflow.com/questions/6861881" target="_blank" rel="noopener">http://stackoverflow.com/questions/6861881</a>&gt;.</li>
</ul>
<h2 id="go-git"><a href="#go-git" class="headerlink" title="go-git"></a>go-git</h2><p>In case you want to integrate Git into a service written in Golang, there also is a pure Go library implementation. This implementation does not have any native dependencies and thus is not prone to manual memory management errors. It is also transparent for the standard Golang performance analysis tooling like CPU, Memory profilers, race detector, etc.</p>
<p>go-git is focused on extensibility, compatibility and supports most of the plumbing APIs, which is documented at &lt;<a href="https://github.com/src-d/go-git/blob/master/COMPATIBILITY.md" target="_blank" rel="noopener">https://github.com/src-d/go-git/blob/master/COMPATIBILITY.md</a>&gt;.</p>
<p>Here is a basic example of using Go APIs:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import 	<span class="string">"gopkg.in/src-d/go-git.v4"</span></span><br><span class="line"></span><br><span class="line">r, err := git.PlainClone(<span class="string">"/tmp/foo"</span>, <span class="literal">false</span>, &amp;git.CloneOptions&#123;</span><br><span class="line">    URL:      <span class="string">"[https://github.com/src-d/go-git](https://github.com/src-d/go-git)"</span>,</span><br><span class="line">    Progress: os.Stdout,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>As soon as you have a <code>Repository</code> instance, you can access information and perform mutations on it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// retrieves the branch pointed by HEAD</span><br><span class="line">ref, err := r.Head()</span><br><span class="line"></span><br><span class="line">// get the commit object, pointed by ref</span><br><span class="line">commit, err := r.CommitObject(ref.Hash())</span><br><span class="line"></span><br><span class="line">// retrieves the commit <span class="built_in">history</span></span><br><span class="line"><span class="built_in">history</span>, err := commit.History()</span><br><span class="line"></span><br><span class="line">// iterates over the commits and <span class="built_in">print</span> each</span><br><span class="line"><span class="keyword">for</span> _, c := range <span class="built_in">history</span> &#123;</span><br><span class="line">    fmt.Println(c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Advanced-Functionality-1"><a href="#Advanced-Functionality-1" class="headerlink" title="Advanced Functionality"></a>Advanced Functionality</h3><p>go-git has few notable advanced features, one of which is a pluggable storage system, which is similar to Libgit2 backends. The default implementation is in-memory storage, which is very fast.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r, err := git.Clone(memory.NewStorage(), nil, &amp;git.CloneOptions&#123;</span><br><span class="line">    URL: <span class="string">"[https://github.com/src-d/go-git](https://github.com/src-d/go-git)"</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Pluggable storage provides many interesting options. For instance, <a href="https://github.com/src-d/go-git/tree/master/_examples/storage" target="_blank" rel="noopener">https://github.com/src-d/go-git/tree/master/_examples/storage</a> allows you to store references, objects, and configuration in an Aerospike database.</p>
<p>Another feature is a flexible filesystem abstraction. Using &lt;<a href="https://godoc.org/github.com/src-d/go-billy#Filesystem" target="_blank" rel="noopener">https://godoc.org/github.com/src-d/go-billy#Filesystem</a>&gt; it is easy to store all the files in different way i.e by packing all of them to a single archive on disk or by keeping them all in-memory.</p>
<p>Another advanced use-case includes a fine-tunable HTTP client, such as the one found at <a href="https://github.com/src-d/go-git/blob/master/_examples/custom_http/main.go" target="_blank" rel="noopener">https://github.com/src-d/go-git/blob/master/_examples/custom_http/main.go</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">customClient := &amp;http.Client&#123;</span><br><span class="line">	Transport: &amp;http.Transport&#123; // accept any certificate (might be useful <span class="keyword">for</span> testing)</span><br><span class="line">		TLSClientConfig: &amp;tls.Config&#123;InsecureSkipVerify: <span class="literal">true</span>&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">	Timeout: 15 * time.Second,  // 15 second timeout</span><br><span class="line">		CheckRedirect: func(req *http.Request, via []*http.Request) error &#123;</span><br><span class="line">		<span class="built_in">return</span> http.ErrUseLastResponse // don<span class="string">'t follow redirect</span></span><br><span class="line"><span class="string">	&#125;,</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Override http(s) default protocol to use our custom client</span></span><br><span class="line"><span class="string">client.InstallProtocol("https", githttp.NewClient(customClient))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Clone repository using the new client if the protocol is https://</span></span><br><span class="line"><span class="string">r, err := git.Clone(memory.NewStorage(), nil, &amp;git.CloneOptions&#123;URL: url&#125;)</span></span><br></pre></td></tr></table></figure>
<h3 id="Further-Reading-2"><a href="#Further-Reading-2" class="headerlink" title="Further Reading"></a>Further Reading</h3><p>A full treatment of go-git’s capabilities is outside the scope of this book. If you want more information on go-git, there’s API documentation at &lt;<a href="https://godoc.org/gopkg.in/src-d/go-git.v4" target="_blank" rel="noopener">https://godoc.org/gopkg.in/src-d/go-git.v4</a>&gt;, and a set of usage examples at <a href="https://github.com/src-d/go-git/tree/master/_examples" target="_blank" rel="noopener">https://github.com/src-d/go-git/tree/master/_examples</a>.</p>
<h1 id="Git-Commands"><a href="#Git-Commands" class="headerlink" title="Git Commands"></a><strong>Git</strong> <strong>Commands</strong></h1><p>Throughout the book we have introduced dozens of Git commands and have tried hard to introduce them within something of a narrative, adding more commands to the story slowly. However, this leaves us with examples of usage of the commands somewhat scattered throughout the whole book.</p>
<p>In this appendix, we’ll go through all the Git commands we addressed throughout the book, grouped roughly by what they’re used for. We’ll talk about what each command very generally does and then point out where in the book you can find us having used it.</p>
<h2 id="Setup-and-Config"><a href="#Setup-and-Config" class="headerlink" title="Setup and Config"></a>Setup and Config</h2><p>There are two commands that are used quite a lot, from the first invocations of Git to common every day tweaking and referencing, the <code>config</code> and <code>help</code> commands.</p>
<h3 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h3><p>Git has a default way of doing hundreds of things. For a lot of these things, you can tell Git to default to doing them a different way, or set your preferences. This involves everything from telling Git what your name is to specific terminal color preferences or what editor you use. There are several files this command will read from and write to so you can set values globally or down to specific repositories.</p>
<p>The <code>git config</code> command has been used in nearly every chapter of the book.</p>
<p>In 【First-Time Git Setup】 we used it to specify our name, email address and editor preference before we even got started using Git.</p>
<p>In 【Git Aliases】 we showed how you could use it to create shorthand commands that expand to long option sequences so you don’t have to type them every time.</p>
<p>In 【Rebasing】 we used it to make <code>--rebase</code> the default when you run <code>git pull</code>.</p>
<p>In 【Credential Storage】 we used it to set up a default store for your HTTP passwords.</p>
<p>In 【Keyword Expansion】 we showed how to set up smudge and clean filters on content coming in and out of Git.</p>
<p>Finally, basically the entirety of 【Git Configuration】 is dedicated to the command.</p>
<h3 id="git-help"><a href="#git-help" class="headerlink" title="git help"></a>git help</h3><p>The <code>git help</code> command is used to show you all the documentation shipped with Git about any command. While we’re giving a rough overview of most of the more popular ones in this appendix, for a full listing of all of the possible options and flags for every command, you can always run <code>git help &lt;command&gt;</code>.</p>
<p>We introduced the <code>git help</code> command in 【Getting Help】 and showed you how to use it to find more information about the <code>git shell</code> in 【Setting Up the Server】.</p>
<h2 id="Getting-and-Creating-Projects"><a href="#Getting-and-Creating-Projects" class="headerlink" title="Getting and Creating Projects"></a>Getting and Creating Projects</h2><p>There are two ways to get a Git repository. One is to copy it from an existing repository on the network or elsewhere and the other is to create a new one in an existing directory.</p>
<h3 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h3><p>To take a directory and turn it into a new Git repository so you can start version controlling it, you can simply run <code>git init</code>.</p>
<p>We first introduce this in 【Getting a Git Repository】, where we show creating a brand new repository to start working with.</p>
<p>We talk briefly about how you can change the default branch from “master” in 【Remote Branches】.</p>
<p>We use this command to create an empty bare repository for a server in 【Putting the Bare Repository on a Server】.</p>
<p>Finally, we go through some of the details of what it actually does behind the scenes in 【Plumbing and Porcelain】.</p>
<h3 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h3><p>The <code>git clone</code> command is actually something of a wrapper around several other commands. It creates a new directory, goes into it and runs <code>git init</code> to make it an empty Git repository, adds a remote (<code>git remote add</code>) to the URL that you pass it (by default named <code>origin</code>), runs a <code>git fetch</code> from that remote repository and then checks out the latest commit into your working directory with <code>git checkout</code>.</p>
<p>The <code>git clone</code> command is used in dozens of places throughout the book, but we’ll just list a few interesting places.</p>
<p>It’s basically introduced and explained in 【Cloning an Existing Repository】, where we go through a few examples.</p>
<p>In 【Getting Git on a Server】 we look at using the <code>--bare</code> option to create a copy of a Git repository with no working directory.</p>
<p>In 【Bundling】 we use it to unbundle a bundled Git repository.</p>
<p>Finally, in 【Cloning a Project with Submodules】 we learn the <code>--recurse-submodules</code> option to make cloning a repository with submodules a little simpler.</p>
<p>Though it’s used in many other places through the book, these are the ones that are somewhat unique or where it is used in ways that are a little different.</p>
<h2 id="Basic-Snapshotting"><a href="#Basic-Snapshotting" class="headerlink" title="Basic Snapshotting"></a>Basic Snapshotting</h2><p>For the basic workflow of staging content and committing it to your history, there are only a few basic commands.</p>
<h3 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h3><p>The <code>git add</code> command adds content from the working directory into the staging area (or “index”) for the next commit. When the <code>git commit</code> command is run, by default it only looks at this staging area, so <code>git add</code> is used to craft what exactly you would like your next commit snapshot to look like.</p>
<p>This command is an incredibly important command in Git and is mentioned or used dozens of times in this book. We’ll quickly cover some of the unique uses that can be found.</p>
<p>We first introduce and explain <code>git add</code> in detail in 【Tracking New Files】.</p>
<p>We mention how to use it to resolve merge conflicts in 【Basic Merge Conflicts】.</p>
<p>We go over using it to interactively stage only specific parts of a modified file in 【Interactive Staging】.</p>
<p>Finally, we emulate it at a low level in 【Tree Objects】, so you can get an idea of what it’s doing behind the scenes.</p>
<h3 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h3><p>The <code>git status</code> command will show you the different states of files in your working directory and staging area. Which files are modified and unstaged and which are staged but not yet committed. In its normal form, it also will show you some basic hints on how to move files between these stages.</p>
<p>We first cover <code>status</code> in 【Checking the Status of Your Files】, both in its basic and simplified forms. While we use it throughout the book, pretty much everything you can do with the <code>git status</code> command is covered there.</p>
<h3 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h3><p>The <code>git diff</code> command is used when you want to see differences between any two trees. This could be the difference between your working environment and your staging area (<code>git diff</code> by itself), between your staging area and your last commit (<code>git diff --staged</code>), or between two commits (<code>git diff master branchB</code>).</p>
<p>We first look at the basic uses of <code>git diff</code> in 【Viewing Your Staged and Unstaged Changes】, where we show how to see what changes are staged and which are not yet staged.</p>
<p>We use it to look for possible whitespace issues before committing with the <code>--check</code> option in 【Commit Guidelines】.</p>
<p>We see how to check the differences between branches more effectively with the <code>git diff A...B</code> syntax in 【Determining What Is Introduced】.</p>
<p>We use it to filter out whitespace differences with <code>-b</code> and how to compare different stages of conflicted files with <code>--theirs</code>, <code>--ours</code> and <code>--base</code> in 【Advanced Merging】.</p>
<p>Finally, we use it to effectively compare submodule changes with <code>--submodule</code> in 【Starting with Submodules】.</p>
<h3 id="git-difftool"><a href="#git-difftool" class="headerlink" title="git difftool"></a>git difftool</h3><p>The <code>git difftool</code> command simply launches an external tool to show you the difference between two trees in case you want to use something other than the built in <code>git diff</code> command.</p>
<p>We only briefly mention this in 【Viewing Your Staged and Unstaged Changes】.</p>
<h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h3><p>The <code>git commit</code> command takes all the file contents that have been staged with <code>git add</code> and records a new permanent snapshot in the database and then moves the branch pointer on the current branch up to it.</p>
<p>We first cover the basics of committing in 【Committing Your Changes】. There we also demonstrate how to use the <code>-a</code> flag to skip the <code>git add</code> step in daily workflows and how to use the <code>-m</code> flag to pass a commit message in on the command line instead of firing up an editor.</p>
<p>In 【Undoing Things】 we cover using the <code>--amend</code> option to redo the most recent commit.</p>
<p>In 【Branches in a Nutshell】, we go into much more detail about what <code>git commit</code> does and why it does it like that.</p>
<p>We looked at how to sign commits cryptographically with the <code>-S</code> flag in 【Signing Commits】.</p>
<p>Finally, we take a look at what the <code>git commit</code> command does in the background and how it’s actually implemented in 【Commit Objects】.</p>
<h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h3><p>The <code>git reset</code> command is primarily used to undo things, as you can possibly tell by the verb. It moves around the <code>HEAD</code> pointer and optionally changes the <code>index</code> or staging area and can also optionally change the working directory if you use <code>--hard</code>. This final option makes it possible for this command to lose your work if used incorrectly, so make sure you understand it before using it.</p>
<p>We first effectively cover the simplest use of <code>git reset</code> in 【Unstaging a Staged File】, where we use it to unstage a file we had run <code>git add</code> on.</p>
<p>We then cover it in quite some detail in 【Reset Demystified】, which is entirely devoted to explaining this command.</p>
<p>We use <code>git reset --hard</code> to abort a merge in 【Aborting a Merge】, where we also use <code>git merge --abort</code>, which is a bit of a wrapper for the <code>git reset</code> command.</p>
<h3 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h3><p>The <code>git rm</code> command is used to remove files from the staging area and working directory for Git. It is similar to <code>git add</code> in that it stages a removal of a file for the next commit.</p>
<p>We cover the <code>git rm</code> command in some detail in 【Removing Files】, including recursively removing files and only removing files from the staging area but leaving them in the working directory with <code>--cached</code>.</p>
<p>The only other differing use of <code>git rm</code> in the book is in 【Removing Objects】 where we briefly use and explain the <code>--ignore-unmatch</code> when running <code>git filter-branch</code>, which simply makes it not error out when the file we are trying to remove doesn’t exist. This can be useful for scripting purposes.</p>
<h3 id="git-mv"><a href="#git-mv" class="headerlink" title="git mv"></a>git mv</h3><p>The <code>git mv</code> command is a thin convenience command to move a file and then run <code>git add</code> on the new file and <code>git rm</code> on the old file.</p>
<p>We only briefly mention this command in 【Moving Files】.</p>
<h3 id="git-clean"><a href="#git-clean" class="headerlink" title="git clean"></a>git clean</h3><p>The <code>git clean</code> command is used to remove unwanted files from your working directory. This could include removing temporary build artifacts or merge conflict files.</p>
<p>We cover many of the options and scenarios in which you might used the clean command in 【Cleaning your Working Directory】.</p>
<h2 id="Branching-and-Merging"><a href="#Branching-and-Merging" class="headerlink" title="Branching and Merging"></a>Branching and Merging</h2><p>There are just a handful of commands that implement most of the branching and merging functionality in Git.</p>
<h3 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h3><p>The <code>git branch</code> command is actually something of a branch management tool. It can list the branches you have, create a new branch, delete branches and rename branches.</p>
<p>Most of 【Git Branching】 is dedicated to the <code>branch</code> command and it’s used throughout the entire chapter. We first introduce it in 【Creating a New Branch】 and we go through most of its other features (listing and deleting) in 【Branch Management】.</p>
<p>In 【Tracking Branches】 we use the <code>git branch -u</code> option to set up a tracking branch.</p>
<p>Finally, we go through some of what it does in the background in 【Git References】.</p>
<h3 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a>git checkout</h3><p>The <code>git checkout</code> command is used to switch branches and check content out into your working directory.</p>
<p>We first encounter the command in 【Switching Branches】 along with the <code>git branch</code> command.</p>
<p>We see how to use it to start tracking branches with the <code>--track</code> flag in 【Tracking Branches】.</p>
<p>We use it to reintroduce file conflicts with <code>--conflict=diff3</code> in 【Checking Out Conflicts】.</p>
<p>We go into closer detail on its relationship with <code>git reset</code> in 【Reset Demystified】.</p>
<p>Finally, we go into some implementation detail in 【The HEAD】.</p>
<h3 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a>git merge</h3><p>The <code>git merge</code> tool is used to merge one or more branches into the branch you have checked out. It will then advance the current branch to the result of the merge.</p>
<p>The <code>git merge</code> command was first introduced in 【Basic Branching】. Though it is used in various places in the book, there are very few variations of the <code>merge</code> command — generally just <code>git merge &lt;branch&gt;</code> with the name of the single branch you want to merge in.</p>
<p>We covered how to do a squashed merge (where Git merges the work but pretends like it’s just a new commit without recording the history of the branch you’re merging in) at the very end of 【Forked Public Project】.</p>
<p>We went over a lot about the merge process and command, including the <code>-Xignore-space-change</code> command and the <code>--abort</code> flag to abort a problem merge in 【Advanced Merging】.</p>
<p>We learned how to verify signatures before merging if your project is using GPG signing in 【Signing Commits】.</p>
<p>Finally, we learned about Subtree merging in 【Subtree Merging】.</p>
<h3 id="git-mergetool"><a href="#git-mergetool" class="headerlink" title="git mergetool"></a>git mergetool</h3><p>The <code>git mergetool</code> command simply launches an external merge helper in case you have issues with a merge in Git.</p>
<p>We mention it quickly in 【Basic Merge Conflicts】 and go into detail on how to implement your own external merge tool in 【External Merge and Diff Tools】.</p>
<h3 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h3><p>The <code>git log</code> command is used to show the reachable recorded history of a project from the most recent commit snapshot backwards. By default it will only show the history of the branch you’re currently on, but can be given different or even multiple heads or branches from which to traverse. It is also often used to show differences between two or more branches at the commit level.</p>
<p>This command is used in nearly every chapter of the book to demonstrate the history of a project.</p>
<p>We introduce the command and cover it in some depth in 【Viewing the Commit History】. There we look at the <code>-p</code> and <code>--stat</code> option to get an idea of what was introduced in each commit and the <code>--pretty</code> and <code>--oneline</code> options to view the history more concisely, along with some simple date and author filtering options.</p>
<p>In 【Creating a New Branch】 we use it with the <code>--decorate</code> option to easily visualize where our branch pointers are located and we also use the <code>--graph</code> option to see what divergent histories look like.</p>
<p>In 【Private Small Team】 and 【Commit Ranges】 we cover the <code>branchA..branchB</code> syntax to use the <code>git log</code> command to see what commits are unique to a branch relative to another branch. In 【Commit Ranges】 we go through this fairly extensively.</p>
<p>In 【Merge Log】 and 【Triple Dot】 we cover using the <code>branchA...branchB</code> format and the <code>--left-right</code> syntax to see what is in one branch or the other but not in both. In 【Merge Log】 we also look at how to use the <code>--merge</code> option to help with merge conflict debugging as well as using the <code>--cc</code> option to look at merge commit conflicts in your history.</p>
<p>In 【RefLog Shortnames】 we use the <code>-g</code> option to view the Git reflog through this tool instead of doing branch traversal.</p>
<p>In 【Searching】 we look at using the <code>-S</code> and <code>-L</code> options to do fairly sophisticated searches for something that happened historically in the code such as seeing the history of a function.</p>
<p>In 【Signing Commits】 we see how to use <code>--show-signature</code> to add a validation string to each commit in the <code>git log</code> output based on if it was validly signed or not.</p>
<h3 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h3><p>The <code>git stash</code> command is used to temporarily store uncommitted work in order to clean out your working directory without having to commit unfinished work on a branch.</p>
<p>This is basically entirely covered in 【Stashing and Cleaning】.</p>
<h3 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a>git tag</h3><p>The <code>git tag</code> command is used to give a permanent bookmark to a specific point in the code history. Generally this is used for things like releases.</p>
<p>This command is introduced and covered in detail in 【Tagging】 and we use it in practice in 【Tagging Your Releases】.</p>
<p>We also cover how to create a GPG signed tag with the <code>-s</code> flag and verify one with the <code>-v</code> flag in 【Signing Your Work】.</p>
<h2 id="Sharing-and-Updating-Projects"><a href="#Sharing-and-Updating-Projects" class="headerlink" title="Sharing and Updating Projects"></a>Sharing and Updating Projects</h2><p>There are not very many commands in Git that access the network, nearly all of the commands operate on the local database. When you are ready to share your work or pull changes from elsewhere, there are a handful of commands that deal with remote repositories.</p>
<h3 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h3><p>The <code>git fetch</code> command communicates with a remote repository and fetches down all the information that is in that repository that is not in your current one and stores it in your local database.</p>
<p>We first look at this command in 【Fetching and Pulling from Your Remotes】 and we continue to see examples of its use in 【Remote Branches】.</p>
<p>We also use it in several of the examples in 【Contributing to a Project】.</p>
<p>We use it to fetch a single specific reference that is outside of the default space in 【Pull Request Refs】 and we see how to fetch from a bundle in 【Bundling】.</p>
<p>We set up highly custom refspecs in order to make <code>git fetch</code> do something a little different than the default in 【The Refspec】.</p>
<h3 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h3><p>The <code>git pull</code> command is basically a combination of the <code>git fetch</code> and <code>git merge</code> commands, where Git will fetch from the remote you specify and then immediately try to merge it into the branch you’re on.</p>
<p>We introduce it quickly in 【Fetching and Pulling from Your Remotes】 and show how to see what it will merge if you run it in 【Inspecting a Remote】.</p>
<p>We also see how to use it to help with rebasing difficulties in 【Rebase When You Rebase】.</p>
<p>We show how to use it with a URL to pull in changes in a one-off fashion in 【Checking Out Remote Branches】.</p>
<p>Finally, we very quickly mention that you can use the <code>--verify-signatures</code> option to it in order to verify that commits you are pulling have been GPG signed in 【Signing Commits】.</p>
<h3 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h3><p>The <code>git push</code> command is used to communicate with another repository, calculate what your local database has that the remote one does not, and then pushes the difference into the other repository. It requires write access to the other repository and so normally is authenticated somehow.</p>
<p>We first look at the <code>git push</code> command in 【Pushing to Your Remotes】. Here we cover the basics of pushing a branch to a remote repository. In 【Pushing】 we go a little deeper into pushing specific branches and in 【Tracking Branches】 we see how to set up tracking branches to automatically push to. In 【Deleting Remote Branches】 we use the <code>--delete</code> flag to delete a branch on the server with <code>git push</code>.</p>
<p>Throughout 【Contributing to a Project】 we see several examples of using <code>git push</code> to share work on branches through multiple remotes.</p>
<p>We see how to use it to share tags that you have made with the <code>--tags</code> option in 【Sharing Tags】.</p>
<p>In 【Publishing Submodule Changes】 we use the <code>--recurse-submodules</code> option to check that all of our submodules work has been published before pushing the superproject, which can be really helpful when using submodules.</p>
<p>In 【Other Client Hooks】 we talk briefly about the <code>pre-push</code> hook, which is a script we can setup to run before a push completes to verify that it should be allowed to push.</p>
<p>Finally, in 【Pushing Refspecs】 we look at pushing with a full refspec instead of the general shortcuts that are normally used. This can help you be very specific about what work you wish to share.</p>
<h3 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h3><p>The <code>git remote</code> command is a management tool for your record of remote repositories. It allows you to save long URLs as short handles, such as “origin” so you don’t have to type them out all the time. You can have several of these and the <code>git remote</code> command is used to add, change and delete them.</p>
<p>This command is covered in detail in 【Working with Remotes】, including listing, adding, removing and renaming them.</p>
<p>It is used in nearly every subsequent chapter in the book too, but always in the standard <code>git remote add &lt;name&gt; &lt;url&gt;</code> format.</p>
<h3 id="git-archive"><a href="#git-archive" class="headerlink" title="git archive"></a>git archive</h3><p>The <code>git archive</code> command is used to create an archive file of a specific snapshot of the project.</p>
<p>We use <code>git archive</code> to create a tarball of a project for sharing in 【Preparing a Release】.</p>
<h3 id="git-submodule"><a href="#git-submodule" class="headerlink" title="git submodule"></a>git submodule</h3><p>The <code>git submodule</code> command is used to manage external repositories within a normal repositories. This could be for libraries or other types of shared resources. The <code>submodule</code> command has several sub-commands (<code>add</code>, <code>update</code>, <code>sync</code>, etc) for managing these resources.</p>
<p>This command is only mentioned and entirely covered in 【Submodules】.</p>
<h2 id="Inspection-and-Comparison"><a href="#Inspection-and-Comparison" class="headerlink" title="Inspection and Comparison"></a>Inspection and Comparison</h2><h3 id="git-show"><a href="#git-show" class="headerlink" title="git show"></a>git show</h3><p>The <code>git show</code> command can show a Git object in a simple and human readable way. Normally you would use this to show the information about a tag or a commit.</p>
<p>We first use it to show annotated tag information in 【Annotated Tags】.</p>
<p>Later we use it quite a bit in 【Revision Selection】 to show the commits that our various revision selections resolve to.</p>
<p>One of the more interesting things we do with <code>git show</code> is in 【Manual File Re-merging】 to extract specific file contents of various stages during a merge conflict.</p>
<h3 id="git-shortlog"><a href="#git-shortlog" class="headerlink" title="git shortlog"></a>git shortlog</h3><p>The <code>git shortlog</code> command is used to summarize the output of <code>git log</code>. It will take many of the same options that the <code>git log</code> command will but instead of listing out all of the commits it will present a summary of the commits grouped by author.</p>
<p>We showed how to use it to create a nice changelog in 【The Shortlog】.</p>
<h3 id="git-describe"><a href="#git-describe" class="headerlink" title="git describe"></a>git describe</h3><p>The <code>git describe</code> command is used to take anything that resolves to a commit and produces a string that is somewhat human-readable and will not change. It’s a way to get a description of a commit that is as unambiguous as a commit SHA-1 but more understandable.</p>
<p>We use <code>git describe</code> in 【Generating a Build Number】 and 【Preparing a Release】 to get a string to name our release file after.</p>
<h2 id="Debugging-1"><a href="#Debugging-1" class="headerlink" title="Debugging"></a>Debugging</h2><p>Git has a couple of commands that are used to help debug an issue in your code. This ranges from figuring out where something was introduced to figuring out who introduced it.</p>
<h3 id="git-bisect"><a href="#git-bisect" class="headerlink" title="git bisect"></a>git bisect</h3><p>The <code>git bisect</code> tool is an incredibly helpful debugging tool used to find which specific commit was the first one to introduce a bug or problem by doing an automatic binary search.</p>
<p>It is fully covered in 【Binary Search】 and is only mentioned in that section.</p>
<h3 id="git-blame"><a href="#git-blame" class="headerlink" title="git blame"></a>git blame</h3><p>The <code>git blame</code> command annotates the lines of any file with which commit was the last one to introduce a change to each line of the file and what person authored that commit. This is helpful in order to find the person to ask for more information about a specific section of your code.</p>
<p>It is covered in 【File Annotation】 and is only mentioned in that section.</p>
<h3 id="git-grep"><a href="#git-grep" class="headerlink" title="git grep"></a>git grep</h3><p>The <code>git grep</code> command can help you find any string or regular expression in any of the files in your source code, even older versions of your project.</p>
<p>It is covered in 【Git Grep】 and is only mentioned in that section.</p>
<h2 id="Patching"><a href="#Patching" class="headerlink" title="Patching"></a>Patching</h2><p>A few commands in Git are centered around the concept of thinking of commits in terms of the changes they introduce, as though the commit series is a series of patches. These commands help you manage your branches in this manner.</p>
<h3 id="git-cherry-pick"><a href="#git-cherry-pick" class="headerlink" title="git cherry-pick"></a>git cherry-pick</h3><p>The <code>git cherry-pick</code> command is used to take the change introduced in a single Git commit and try to re-introduce it as a new commit on the branch you’re currently on. This can be useful to only take one or two commits from a branch individually rather than merging in the branch which takes all the changes.</p>
<p>Cherry picking is described and demonstrated in 【Rebasing and Cherry-Picking Workflows】.</p>
<h3 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h3><p>The <code>git rebase</code> command is basically an automated <code>cherry-pick</code>. It determines a series of commits and then cherry-picks them one by one in the same order somewhere else.</p>
<p>Rebasing is covered in detail in 【Rebasing】, including covering the collaborative issues involved with rebasing branches that are already public.</p>
<p>We use it in practice during an example of splitting your history into two separate repositories in 【Replace】, using the <code>--onto</code> flag as well.</p>
<p>We go through running into a merge conflict during rebasing in 【Rerere】.</p>
<p>We also use it in an interactive scripting mode with the <code>-i</code> option in 【Changing Multiple Commit Messages】.</p>
<h3 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h3><p>The <code>git revert</code> command is essentially a reverse <code>git cherry-pick</code>. It creates a new commit that applies the exact opposite of the change introduced in the commit you’re targeting, essentially undoing or reverting it.</p>
<p>We use this in 【Reverse the commit】 to undo a merge commit.</p>
<h2 id="Email"><a href="#Email" class="headerlink" title="Email"></a>Email</h2><p>Many Git projects, including Git itself, are entirely maintained over mailing lists. Git has a number of tools built into it that help make this process easier, from generating patches you can easily email to applying those patches from an email box.</p>
<h3 id="git-apply"><a href="#git-apply" class="headerlink" title="git apply"></a>git apply</h3><p>The <code>git apply</code> command applies a patch created with the <code>git diff</code> or even GNU diff command. It is similar to what the <code>patch</code> command might do with a few small differences.</p>
<p>We demonstrate using it and the circumstances in which you might do so in 【Applying Patches from Email】.</p>
<h3 id="git-am"><a href="#git-am" class="headerlink" title="git am"></a>git am</h3><p>The <code>git am</code> command is used to apply patches from an email inbox, specifically one that is mbox formatted. This is useful for receiving patches over email and applying them to your project easily.</p>
<p>We covered usage and workflow around <code>git am</code> in 【Applying a Patch with <code>am</code>】 including using the <code>--resolved</code>, <code>-i</code> and <code>-3</code> options.</p>
<p>There are also a number of hooks you can use to help with the workflow around <code>git am</code> and they are all covered in 【Email Workflow Hooks】.</p>
<p>We also use it to apply patch formatted GitHub Pull Request changes in 【Email Notifications】.</p>
<h3 id="git-format-patch"><a href="#git-format-patch" class="headerlink" title="git format-patch"></a>git format-patch</h3><p>The <code>git format-patch</code> command is used to generate a series of patches in mbox format that you can use to send to a mailing list properly formatted.</p>
<p>We go through an example of contributing to a project using the <code>git format-patch</code> tool in 【Public Project over Email】.</p>
<h3 id="git-imap-send"><a href="#git-imap-send" class="headerlink" title="git imap-send"></a>git imap-send</h3><p>The <code>git imap-send</code> command uploads a mailbox generated with <code>git format-patch</code> into an IMAP drafts folder.</p>
<p>We go through an example of contributing to a project by sending patches with the <code>git imap-send</code> tool in 【Public Project over Email】.</p>
<h3 id="git-send-email"><a href="#git-send-email" class="headerlink" title="git send-email"></a>git send-email</h3><p>The <code>git send-email</code> command is used to send patches that are generated with <code>git format-patch</code> over email.</p>
<p>We go through an example of contributing to a project by sending patches with the <code>git send-email</code> tool in 【Public Project over Email】.</p>
<h3 id="git-request-pull"><a href="#git-request-pull" class="headerlink" title="git request-pull"></a>git request-pull</h3><p>The <code>git request-pull</code> command is simply used to generate an example message body to email to someone. If you have a branch on a public server and want to let someone know how to integrate those changes without sending the patches over email, you can run this command and send the output to the person you want to pull the changes in.</p>
<p>We demonstrate how to use <code>git request-pull</code> to generate a pull message in 【Forked Public Project】.</p>
<h2 id="External-Systems"><a href="#External-Systems" class="headerlink" title="External Systems"></a>External Systems</h2><p>Git comes with a few commands to integrate with other version control systems.</p>
<h3 id="git-svn-1"><a href="#git-svn-1" class="headerlink" title="git svn"></a>git svn</h3><p>The <code>git svn</code> command is used to communicate with the Subversion version control system as a client. This means you can use Git to checkout from and commit to a Subversion server.</p>
<p>This command is covered in depth in 【Git and Subversion】.</p>
<h3 id="git-fast-import"><a href="#git-fast-import" class="headerlink" title="git fast-import"></a>git fast-import</h3><p>For other version control systems or importing from nearly any format, you can use <code>git fast-import</code> to quickly map the other format to something Git can easily record.</p>
<p>This command is covered in depth in 【A Custom Importer】.</p>
<h2 id="Administration-1"><a href="#Administration-1" class="headerlink" title="Administration"></a>Administration</h2><p>If you’re administering a Git repository or need to fix something in a big way, Git provides a number of administrative commands to help you out.</p>
<h3 id="git-gc"><a href="#git-gc" class="headerlink" title="git gc"></a>git gc</h3><p>The <code>git gc</code> command runs “garbage collection” on your repository, removing unnecessary files in your database and packing up the remaining files into a more efficient format.</p>
<p>This command normally runs in the background for you, though you can manually run it if you wish. We go over some examples of this in 【Maintenance】.</p>
<h3 id="git-fsck"><a href="#git-fsck" class="headerlink" title="git fsck"></a>git fsck</h3><p>The <code>git fsck</code> command is used to check the internal database for problems or inconsistencies.</p>
<p>We only quickly use this once in 【Data Recovery】 to search for dangling objects.</p>
<h3 id="git-reflog"><a href="#git-reflog" class="headerlink" title="git reflog"></a>git reflog</h3><p>The <code>git reflog</code> command goes through a log of where all the heads of your branches have been as you work to find commits you may have lost through rewriting histories.</p>
<p>We cover this command mainly in 【RefLog Shortnames】, where we show normal usage to and how to use <code>git log -g</code> to view the same information with <code>git log</code> output.</p>
<p>We also go through a practical example of recovering such a lost branch in 【Data Recovery】.</p>
<h3 id="git-filter-branch"><a href="#git-filter-branch" class="headerlink" title="git filter-branch"></a>git filter-branch</h3><p>The <code>git filter-branch</code> command is used to rewrite loads of commits according to certain patterns, like removing a file everywhere or filtering the entire repository down to a single subdirectory for extracting a project.</p>
<p>In 【Removing a File from Every Commit】 we explain the command and explore several different options such as <code>--commit-filter</code>, <code>--subdirectory-filter</code> and <code>--tree-filter</code>.</p>
<p>In 【Git-p4】 and 【TFS】 we use it to fix up imported external repositories.</p>
<h2 id="Plumbing-Commands"><a href="#Plumbing-Commands" class="headerlink" title="Plumbing Commands"></a>Plumbing Commands</h2><p>There were also quite a number of lower level plumbing commands that we encountered in the book.</p>
<p>The first one we encounter is <code>ls-remote</code> in 【Pull Request Refs】 which we use to look at the raw references on the server.</p>
<p>We use <code>ls-files</code> in 【Manual File Re-merging】, 【Rerere】 and 【The Index】 to take a more raw look at what your staging area looks like.</p>
<p>We also mention <code>rev-parse</code> in 【Branch References】 to take just about any string and turn it into an object SHA-1.</p>
<p>However, most of the low level plumbing commands we cover are in 【Git Internals】, which is more or less what the chapter is focused on. We tried to avoid use of them throughout most of the rest of the book.</p>

      
    </div>
    
  </div>
  
    


    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/post/artbook/pixar-storytelling-rules-for-effective-storytelling-based-on-pixar’s-greatest-films/">
                    Pixar Storytelling: Rules for Effective Storytelling Based on Pixar’s Greatest Films
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/post/other/reinvent-yourself/">
                    Reinvent Yourself
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Licence"><span class="toc-text">Licence</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Preface-by-Scott-Chacon"><span class="toc-text">Preface by Scott Chacon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Preface-by-Ben-Straub"><span class="toc-text">Preface by Ben Straub</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Dedications"><span class="toc-text">Dedications</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Contributors"><span class="toc-text">Contributors</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Getting-Started"><span class="toc-text">Getting Started</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#About-Version-Control"><span class="toc-text">About Version Control</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Local-Version-Control-Systems"><span class="toc-text">Local Version Control Systems</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Centralized-Version-Control-Systems"><span class="toc-text">Centralized Version Control Systems</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Distributed-Version-Control-Systems"><span class="toc-text">Distributed Version Control Systems</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-Short-History-of-Git"><span class="toc-text">A Short History of Git</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Basics"><span class="toc-text">Git Basics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Snapshots-Not-Differences"><span class="toc-text">Snapshots, Not Differences</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nearly-Every-Operation-Is-Local"><span class="toc-text">Nearly Every Operation Is Local</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-Has-Integrity"><span class="toc-text">Git Has Integrity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-Generally-Only-Adds-Data"><span class="toc-text">Git Generally Only Adds Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Three-States"><span class="toc-text">The Three States</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Command-Line"><span class="toc-text">The Command Line</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Installing-Git"><span class="toc-text">Installing Git</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Installing-on-Linux"><span class="toc-text">Installing on Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Installing-on-Mac"><span class="toc-text">Installing on Mac</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Installing-on-Windows"><span class="toc-text">Installing on Windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Installing-from-Source"><span class="toc-text">Installing from Source</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#First-Time-Git-Setup"><span class="toc-text">First-Time Git Setup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Your-Identity"><span class="toc-text">Your Identity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Your-Editor"><span class="toc-text">Your Editor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Checking-Your-Settings"><span class="toc-text">Checking Your Settings</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-Help"><span class="toc-text">Getting Help</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-Basics-1"><span class="toc-text">Git Basics</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-a-Git-Repository"><span class="toc-text">Getting a Git Repository</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Initializing-a-Repository-in-an-Existing-Directory"><span class="toc-text">Initializing a Repository in an Existing Directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cloning-an-Existing-Repository"><span class="toc-text">Cloning an Existing Repository</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recording-Changes-to-the-Repository"><span class="toc-text">Recording Changes to the Repository</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Checking-the-Status-of-Your-Files"><span class="toc-text">Checking the Status of Your Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tracking-New-Files"><span class="toc-text">Tracking New Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Staging-Modified-Files"><span class="toc-text">Staging Modified Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Short-Status"><span class="toc-text">Short Status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ignoring-Files"><span class="toc-text">Ignoring Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Viewing-Your-Staged-and-Unstaged-Changes"><span class="toc-text">Viewing Your Staged and Unstaged Changes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Diff-in-an-External-Tool"><span class="toc-text">Git Diff in an External Tool</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Committing-Your-Changes"><span class="toc-text">Committing Your Changes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Skipping-the-Staging-Area"><span class="toc-text">Skipping the Staging Area</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Removing-Files"><span class="toc-text">Removing Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Moving-Files"><span class="toc-text">Moving Files</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Viewing-the-Commit-History"><span class="toc-text">Viewing the Commit History</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Limiting-Log-Output"><span class="toc-text">Limiting Log Output</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preventing-the-display-of-merge-commits"><span class="toc-text">Preventing the display of merge commits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Undoing-Things"><span class="toc-text">Undoing Things</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unstaging-a-Staged-File"><span class="toc-text">Unstaging a Staged File</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unmodifying-a-Modified-File"><span class="toc-text">Unmodifying a Modified File</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Working-with-Remotes"><span class="toc-text">Working with Remotes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Remote-repositories-can-be-on-your-local-machine"><span class="toc-text">Remote repositories can be on your local machine.</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Showing-Your-Remotes"><span class="toc-text">Showing Your Remotes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adding-Remote-Repositories"><span class="toc-text">Adding Remote Repositories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fetching-and-Pulling-from-Your-Remotes"><span class="toc-text">Fetching and Pulling from Your Remotes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pushing-to-Your-Remotes"><span class="toc-text">Pushing to Your Remotes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inspecting-a-Remote"><span class="toc-text">Inspecting a Remote</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Renaming-and-Removing-Remotes"><span class="toc-text">Renaming and Removing Remotes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tagging"><span class="toc-text">Tagging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Listing-Your-Tags"><span class="toc-text">Listing Your Tags</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Listing-tag-wildcards-requires-l-or-list-option"><span class="toc-text">Listing tag wildcards requires -l or --list option</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-Tags"><span class="toc-text">Creating Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Annotated-Tags"><span class="toc-text">Annotated Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lightweight-Tags"><span class="toc-text">Lightweight Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tagging-Later"><span class="toc-text">Tagging Later</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sharing-Tags"><span class="toc-text">Sharing Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Checking-out-Tags"><span class="toc-text">Checking out Tags</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Aliases"><span class="toc-text">Git Aliases</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-1"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-Branching"><span class="toc-text">Git Branching</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Branches-in-a-Nutshell"><span class="toc-text">Branches in a Nutshell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-a-New-Branch"><span class="toc-text">Creating a New Branch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Switching-Branches"><span class="toc-text">Switching Branches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Switching-branches-changes-files-in-your-working-directory"><span class="toc-text">Switching branches changes files in your working directory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic-Branching-and-Merging"><span class="toc-text">Basic Branching and Merging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Branching"><span class="toc-text">Basic Branching</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Merging"><span class="toc-text">Basic Merging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Merge-Conflicts"><span class="toc-text">Basic Merge Conflicts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Branch-Management"><span class="toc-text">Branch Management</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Branching-Workflows"><span class="toc-text">Branching Workflows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Long-Running-Branches"><span class="toc-text">Long-Running Branches</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Topic-Branches"><span class="toc-text">Topic Branches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Remote-Branches"><span class="toc-text">Remote Branches</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#“origin”-is-not-special"><span class="toc-text">“origin” is not special</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pushing"><span class="toc-text">Pushing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Don’t-type-your-password-every-time"><span class="toc-text">Don’t type your password every time</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tracking-Branches"><span class="toc-text">Tracking Branches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upstream-shorthand"><span class="toc-text">Upstream shorthand</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pulling"><span class="toc-text">Pulling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deleting-Remote-Branches"><span class="toc-text">Deleting Remote Branches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rebasing"><span class="toc-text">Rebasing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Basic-Rebase"><span class="toc-text">The Basic Rebase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#More-Interesting-Rebases"><span class="toc-text">More Interesting Rebases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Perils-of-Rebasing"><span class="toc-text">The Perils of Rebasing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rebase-When-You-Rebase"><span class="toc-text">Rebase When You Rebase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rebase-vs-Merge"><span class="toc-text">Rebase vs. Merge</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-2"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-on-the-Server"><span class="toc-text">Git on the Server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Protocols"><span class="toc-text">The Protocols</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Local-Protocol"><span class="toc-text">Local Protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Pros"><span class="toc-text">The Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Cons"><span class="toc-text">The Cons</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-HTTP-Protocols"><span class="toc-text">The HTTP Protocols</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Smart-HTTP"><span class="toc-text">Smart HTTP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dumb-HTTP"><span class="toc-text">Dumb HTTP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Pros-1"><span class="toc-text">The Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Cons-1"><span class="toc-text">The Cons</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-SSH-Protocol"><span class="toc-text">The SSH Protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Pros-2"><span class="toc-text">The Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Cons-2"><span class="toc-text">The Cons</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Git-Protocol"><span class="toc-text">The Git Protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Pros-3"><span class="toc-text">The Pros</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Cons-3"><span class="toc-text">The Cons</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-Git-on-a-Server"><span class="toc-text">Getting Git on a Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Putting-the-Bare-Repository-on-a-Server"><span class="toc-text">Putting the Bare Repository on a Server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Small-Setups"><span class="toc-text">Small Setups</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SSH-Access"><span class="toc-text">SSH Access</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generating-Your-SSH-Public-Key"><span class="toc-text">Generating Your SSH Public Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Up-the-Server"><span class="toc-text">Setting Up the Server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Daemon"><span class="toc-text">Git Daemon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Smart-HTTP-1"><span class="toc-text">Smart HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitWeb"><span class="toc-text">GitWeb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitLab"><span class="toc-text">GitLab</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Installation"><span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Administration"><span class="toc-text">Administration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Users"><span class="toc-text">Users</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Groups"><span class="toc-text">Groups</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Projects"><span class="toc-text">Projects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hooks"><span class="toc-text">Hooks</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Usage"><span class="toc-text">Basic Usage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Working-Together"><span class="toc-text">Working Together</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Third-Party-Hosted-Options"><span class="toc-text">Third Party Hosted Options</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-3"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Distributed-Git"><span class="toc-text">Distributed Git</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Distributed-Workflows"><span class="toc-text">Distributed Workflows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Centralized-Workflow"><span class="toc-text">Centralized Workflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Integration-Manager-Workflow"><span class="toc-text">Integration-Manager Workflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dictator-and-Lieutenants-Workflow"><span class="toc-text">Dictator and Lieutenants Workflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Workflows-Summary"><span class="toc-text">Workflows Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Contributing-to-a-Project"><span class="toc-text">Contributing to a Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Commit-Guidelines"><span class="toc-text">Commit Guidelines</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Do-as-we-say-not-as-we-do"><span class="toc-text">Do as we say, not as we do.</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Private-Small-Team"><span class="toc-text">Private Small Team</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Private-Managed-Team"><span class="toc-text">Private Managed Team</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Forked-Public-Project"><span class="toc-text">Forked Public Project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Public-Project-over-Email"><span class="toc-text">Public Project over Email</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-4"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Maintaining-a-Project"><span class="toc-text">Maintaining a Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Working-in-Topic-Branches"><span class="toc-text">Working in Topic Branches</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Applying-Patches-from-Email"><span class="toc-text">Applying Patches from Email</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Applying-a-Patch-with-apply"><span class="toc-text">Applying a Patch with apply</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Applying-a-Patch-with-am"><span class="toc-text">Applying a Patch with am</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Checking-Out-Remote-Branches"><span class="toc-text">Checking Out Remote Branches</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Determining-What-Is-Introduced"><span class="toc-text">Determining What Is Introduced</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Integrating-Contributed-Work"><span class="toc-text">Integrating Contributed Work</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Merging-Workflows"><span class="toc-text">Merging Workflows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Large-Merging-Workflows"><span class="toc-text">Large-Merging Workflows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rebasing-and-Cherry-Picking-Workflows"><span class="toc-text">Rebasing and Cherry-Picking Workflows</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Rerere"><span class="toc-text">Rerere</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tagging-Your-Releases"><span class="toc-text">Tagging Your Releases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Generating-a-Build-Number"><span class="toc-text">Generating a Build Number</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Preparing-a-Release"><span class="toc-text">Preparing a Release</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Shortlog"><span class="toc-text">The Shortlog</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-5"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GitHub"><span class="toc-text">GitHub</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Interfaces-Change"><span class="toc-text">Interfaces Change</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Account-Setup-and-Configuration"><span class="toc-text">Account Setup and Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH-Access-1"><span class="toc-text">SSH Access</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Your-Avatar"><span class="toc-text">Your Avatar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Your-Email-Addresses"><span class="toc-text">Your Email Addresses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Two-Factor-Authentication"><span class="toc-text">Two Factor Authentication</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Contributing-to-a-Project-1"><span class="toc-text">Contributing to a Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Forking-Projects"><span class="toc-text">Forking Projects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-GitHub-Flow"><span class="toc-text">The GitHub Flow</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Creating-a-Pull-Request"><span class="toc-text">Creating a Pull Request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Iterating-on-a-Pull-Request"><span class="toc-text">Iterating on a Pull Request</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Not-Only-Forks"><span class="toc-text">Not Only Forks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced-Pull-Requests"><span class="toc-text">Advanced Pull Requests</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pull-Requests-as-Patches"><span class="toc-text">Pull Requests as Patches</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Keeping-up-with-Upstream"><span class="toc-text">Keeping up with Upstream</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#References"><span class="toc-text">References</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitHub-Flavored-Markdown"><span class="toc-text">GitHub Flavored Markdown</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Task-Lists"><span class="toc-text">Task Lists</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Code-Snippets"><span class="toc-text">Code Snippets</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Emoji"><span class="toc-text">Emoji</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Images"><span class="toc-text">Images</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Maintaining-a-Project-1"><span class="toc-text">Maintaining a Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-a-New-Repository"><span class="toc-text">Creating a New Repository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Adding-Collaborators"><span class="toc-text">Adding Collaborators</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Managing-Pull-Requests"><span class="toc-text">Managing Pull Requests</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Email-Notifications"><span class="toc-text">Email Notifications</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Collaborating-on-the-Pull-Request"><span class="toc-text">Collaborating on the Pull Request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pull-Request-Refs"><span class="toc-text">Pull Request Refs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pull-Requests-on-Pull-Requests"><span class="toc-text">Pull Requests on Pull Requests</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mentions-and-Notifications"><span class="toc-text">Mentions and Notifications</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Notifications-Page"><span class="toc-text">The Notifications Page</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Web-Notifications"><span class="toc-text">Web Notifications</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Email-Notifications-1"><span class="toc-text">Email Notifications</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Special-Files"><span class="toc-text">Special Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#README"><span class="toc-text">README</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CONTRIBUTING"><span class="toc-text">CONTRIBUTING</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Project-Administration"><span class="toc-text">Project Administration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Changing-the-Default-Branch"><span class="toc-text">Changing the Default Branch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Transferring-a-Project"><span class="toc-text">Transferring a Project</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Managing-an-organization"><span class="toc-text">Managing an organization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Organization-Basics"><span class="toc-text">Organization Basics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Teams"><span class="toc-text">Teams</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Audit-Log"><span class="toc-text">Audit Log</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scripting-GitHub"><span class="toc-text">Scripting GitHub</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Services-and-Hooks"><span class="toc-text">Services and Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Services"><span class="toc-text">Services</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hooks-1"><span class="toc-text">Hooks</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-GitHub-API"><span class="toc-text">The GitHub API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Usage-1"><span class="toc-text">Basic Usage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Commenting-on-an-Issue"><span class="toc-text">Commenting on an Issue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Changing-the-Status-of-a-Pull-Request"><span class="toc-text">Changing the Status of a Pull Request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Octokit"><span class="toc-text">Octokit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-6"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-Tools"><span class="toc-text">Git Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Revision-Selection"><span class="toc-text">Revision Selection</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Single-Revisions"><span class="toc-text">Single Revisions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Short-SHA-1"><span class="toc-text">Short SHA-1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#A-SHORT-NOTE-ABOUT-SHA-1"><span class="toc-text">A SHORT NOTE ABOUT SHA-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Branch-References"><span class="toc-text">Branch References</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RefLog-Shortnames"><span class="toc-text">RefLog Shortnames</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Think-of-the-reflog-as-Git’s-version-of-shell-history"><span class="toc-text">Think of the reflog as Git’s version of shell history</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ancestry-References"><span class="toc-text">Ancestry References</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Escaping-the-caret-on-Windows"><span class="toc-text">Escaping the caret on Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Commit-Ranges"><span class="toc-text">Commit Ranges</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Double-Dot"><span class="toc-text">Double Dot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Multiple-Points"><span class="toc-text">Multiple Points</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Triple-Dot"><span class="toc-text">Triple Dot</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Interactive-Staging"><span class="toc-text">Interactive Staging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Staging-and-Unstaging-Files"><span class="toc-text">Staging and Unstaging Files</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Staging-Patches"><span class="toc-text">Staging Patches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stashing-and-Cleaning"><span class="toc-text">Stashing and Cleaning</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Migrating-to-git-stash-push"><span class="toc-text">Migrating to git stash push</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Stashing-Your-Work"><span class="toc-text">Stashing Your Work</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creative-Stashing"><span class="toc-text">Creative Stashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Creating-a-Branch-from-a-Stash"><span class="toc-text">Creating a Branch from a Stash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cleaning-your-Working-Directory"><span class="toc-text">Cleaning your Working Directory</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Signing-Your-Work"><span class="toc-text">Signing Your Work</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GPG-Introduction"><span class="toc-text">GPG Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Signing-Tags"><span class="toc-text">Signing Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Verifying-Tags"><span class="toc-text">Verifying Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Signing-Commits"><span class="toc-text">Signing Commits</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Everyone-Must-Sign"><span class="toc-text">Everyone Must Sign</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Searching"><span class="toc-text">Searching</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-Grep"><span class="toc-text">Git Grep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-Log-Searching"><span class="toc-text">Git Log Searching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Line-Log-Search"><span class="toc-text">Line Log Search</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rewriting-History"><span class="toc-text">Rewriting History</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Changing-the-Last-Commit"><span class="toc-text">Changing the Last Commit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#An-amended-commit-may-or-may-not-need-an-amended-commit-message"><span class="toc-text">An amended commit may (or may not) need an amended commit message</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Changing-Multiple-Commit-Messages"><span class="toc-text">Changing Multiple Commit Messages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reordering-Commits"><span class="toc-text">Reordering Commits</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Squashing-Commits"><span class="toc-text">Squashing Commits</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Splitting-a-Commit"><span class="toc-text">Splitting a Commit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Nuclear-Option-filter-branch"><span class="toc-text">The Nuclear Option: filter-branch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Removing-a-File-from-Every-Commit"><span class="toc-text">Removing a File from Every Commit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Making-a-Subdirectory-the-New-Root"><span class="toc-text">Making a Subdirectory the New Root</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Changing-Email-Addresses-Globally"><span class="toc-text">Changing Email Addresses Globally</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reset-Demystified"><span class="toc-text">Reset Demystified</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Three-Trees"><span class="toc-text">The Three Trees</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#The-HEAD"><span class="toc-text">The HEAD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Index"><span class="toc-text">The Index</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#The-Working-Directory"><span class="toc-text">The Working Directory</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Workflow"><span class="toc-text">The Workflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Role-of-Reset"><span class="toc-text">The Role of Reset</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-1-Move-HEAD"><span class="toc-text">Step 1: Move HEAD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-2-Updating-the-Index-–mixed"><span class="toc-text">Step 2: Updating the Index (–mixed)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-3-Updating-the-Working-Directory-–hard"><span class="toc-text">Step 3: Updating the Working Directory (–hard)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Recap"><span class="toc-text">Recap</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reset-With-a-Path"><span class="toc-text">Reset With a Path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Squashing"><span class="toc-text">Squashing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-It-Out"><span class="toc-text">Check It Out</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Without-Paths"><span class="toc-text">Without Paths</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#With-Paths"><span class="toc-text">With Paths</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summary-7"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Advanced-Merging"><span class="toc-text">Advanced Merging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Merge-Conflicts"><span class="toc-text">Merge Conflicts</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Aborting-a-Merge"><span class="toc-text">Aborting a Merge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ignoring-Whitespace"><span class="toc-text">Ignoring Whitespace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Manual-File-Re-merging"><span class="toc-text">Manual File Re-merging</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Checking-Out-Conflicts"><span class="toc-text">Checking Out Conflicts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Merge-Log"><span class="toc-text">Merge Log</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Combined-Diff-Format"><span class="toc-text">Combined Diff Format</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Undoing-Merges"><span class="toc-text">Undoing Merges</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Fix-the-references"><span class="toc-text">Fix the references</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reverse-the-commit"><span class="toc-text">Reverse the commit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Other-Types-of-Merges"><span class="toc-text">Other Types of Merges</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Our-or-Theirs-Preference"><span class="toc-text">Our or Theirs Preference</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Subtree-Merging"><span class="toc-text">Subtree Merging</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rerere-1"><span class="toc-text">Rerere</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debugging-with-Git"><span class="toc-text">Debugging with Git</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Annotation"><span class="toc-text">File Annotation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Binary-Search"><span class="toc-text">Binary Search</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Submodules"><span class="toc-text">Submodules</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Starting-with-Submodules"><span class="toc-text">Starting with Submodules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cloning-a-Project-with-Submodules"><span class="toc-text">Cloning a Project with Submodules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Working-on-a-Project-with-Submodules"><span class="toc-text">Working on a Project with Submodules</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Pulling-in-Upstream-Changes"><span class="toc-text">Pulling in Upstream Changes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Working-on-a-Submodule"><span class="toc-text">Working on a Submodule</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Publishing-Submodule-Changes"><span class="toc-text">Publishing Submodule Changes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Merging-Submodule-Changes"><span class="toc-text">Merging Submodule Changes</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Submodule-Tips"><span class="toc-text">Submodule Tips</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Submodule-Foreach"><span class="toc-text">Submodule Foreach</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Useful-Aliases"><span class="toc-text">Useful Aliases</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Issues-with-Submodules"><span class="toc-text">Issues with Submodules</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bundling"><span class="toc-text">Bundling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Replace"><span class="toc-text">Replace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Credential-Storage"><span class="toc-text">Credential Storage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Under-the-Hood"><span class="toc-text">Under the Hood</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-Custom-Credential-Cache"><span class="toc-text">A Custom Credential Cache</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-8"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Customizing-Git"><span class="toc-text">Customizing Git</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Configuration"><span class="toc-text">Git Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-Client-Configuration"><span class="toc-text">Basic Client Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#core-editor"><span class="toc-text">core.editor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#commit-template"><span class="toc-text">commit.template</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#core-pager"><span class="toc-text">core.pager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#user-signingkey"><span class="toc-text">user.signingkey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#core-excludesfile"><span class="toc-text">core.excludesfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#help-autocorrect"><span class="toc-text">help.autocorrect</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Colors-in-Git"><span class="toc-text">Colors in Git</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#color-ui"><span class="toc-text">color.ui</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#color"><span class="toc-text">color.*</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#External-Merge-and-Diff-Tools"><span class="toc-text">External Merge and Diff Tools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Formatting-and-Whitespace"><span class="toc-text">Formatting and Whitespace</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#core-autocrlf"><span class="toc-text">core.autocrlf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#core-whitespace"><span class="toc-text">core.whitespace</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Configuration"><span class="toc-text">Server Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#receive-fsckObjects"><span class="toc-text">receive.fsckObjects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#receive-denyNonFastForwards"><span class="toc-text">receive.denyNonFastForwards</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#receive-denyDeletes"><span class="toc-text">receive.denyDeletes</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Attributes"><span class="toc-text">Git Attributes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Binary-Files"><span class="toc-text">Binary Files</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Identifying-Binary-Files"><span class="toc-text">Identifying Binary Files</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Diffing-Binary-Files"><span class="toc-text">Diffing Binary Files</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keyword-Expansion"><span class="toc-text">Keyword Expansion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exporting-Your-Repository"><span class="toc-text">Exporting Your Repository</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#export-ignore"><span class="toc-text">export-ignore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#export-subst"><span class="toc-text">export-subst</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Merge-Strategies"><span class="toc-text">Merge Strategies</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Hooks"><span class="toc-text">Git Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Installing-a-Hook"><span class="toc-text">Installing a Hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client-Side-Hooks"><span class="toc-text">Client-Side Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Committing-Workflow-Hooks"><span class="toc-text">Committing-Workflow Hooks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Email-Workflow-Hooks"><span class="toc-text">Email Workflow Hooks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Other-Client-Hooks"><span class="toc-text">Other Client Hooks</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Side-Hooks"><span class="toc-text">Server-Side Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pre-receive"><span class="toc-text">pre-receive</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update"><span class="toc-text">update</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#post-receive"><span class="toc-text">post-receive</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#An-Example-Git-Enforced-Policy"><span class="toc-text">An Example Git-Enforced Policy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Server-Side-Hook"><span class="toc-text">Server-Side Hook</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Enforcing-a-Specific-Commit-Message-Format"><span class="toc-text">Enforcing a Specific Commit-Message Format</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Enforcing-a-User-Based-ACL-System"><span class="toc-text">Enforcing a User-Based ACL System</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Testing-It-Out"><span class="toc-text">Testing It Out</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Client-Side-Hooks-1"><span class="toc-text">Client-Side Hooks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-9"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-and-Other-Systems"><span class="toc-text">Git and Other Systems</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-as-a-Client"><span class="toc-text">Git as a Client</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-and-Subversion"><span class="toc-text">Git and Subversion</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#git-svn"><span class="toc-text">git svn</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Setting-Up"><span class="toc-text">Setting Up</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Started-1"><span class="toc-text">Getting Started</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Committing-Back-to-Subversion"><span class="toc-text">Committing Back to Subversion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pulling-in-New-Changes"><span class="toc-text">Pulling in New Changes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-Branching-Issues"><span class="toc-text">Git Branching Issues</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Subversion-Branching"><span class="toc-text">Subversion Branching</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Creating-a-New-SVN-Branch"><span class="toc-text">Creating a New SVN Branch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Switching-Active-Branches"><span class="toc-text">Switching Active Branches</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Subversion-Commands"><span class="toc-text">Subversion Commands</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SVN-Style-History"><span class="toc-text">SVN Style History</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SVN-Annotation"><span class="toc-text">SVN Annotation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SVN-Server-Information"><span class="toc-text">SVN Server Information</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Ignoring-What-Subversion-Ignores"><span class="toc-text">Ignoring What Subversion Ignores</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-Svn-Summary"><span class="toc-text">Git-Svn Summary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-and-Mercurial"><span class="toc-text">Git and Mercurial</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#git-remote-hg"><span class="toc-text">git-remote-hg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Started-2"><span class="toc-text">Getting Started</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Workflow"><span class="toc-text">Workflow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Branches-and-Bookmarks"><span class="toc-text">Branches and Bookmarks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mercurial-Summary"><span class="toc-text">Mercurial Summary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-and-Bazaar"><span class="toc-text">Git and Bazaar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Create-a-Git-repository-from-a-Bazaar-repository"><span class="toc-text">Create a Git repository from a Bazaar repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bazaar-branches"><span class="toc-text">Bazaar branches</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ignore-what-is-ignored-with-bzrignore"><span class="toc-text">Ignore what is ignored with .bzrignore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Fetch-the-changes-of-the-remote-repository"><span class="toc-text">Fetch the changes of the remote repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Push-your-work-on-the-remote-repository"><span class="toc-text">Push your work on the remote repository</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Caveats"><span class="toc-text">Caveats</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Summary-10"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-and-Perforce"><span class="toc-text">Git and Perforce</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-Fusion"><span class="toc-text">Git Fusion</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Setting-Up-1"><span class="toc-text">Setting Up</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Fusion-Configuration"><span class="toc-text">Fusion Configuration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Workflow-1"><span class="toc-text">Workflow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Git-Fusion-Summary"><span class="toc-text">Git-Fusion Summary</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-p4"><span class="toc-text">Git-p4</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Setting-Up-2"><span class="toc-text">Setting Up</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Getting-Started-3"><span class="toc-text">Getting Started</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Workflow-2"><span class="toc-text">Workflow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Branching"><span class="toc-text">Branching</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-and-Perforce-Summary"><span class="toc-text">Git and Perforce Summary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Git-and-TFS"><span class="toc-text">Git and TFS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Which-Tool"><span class="toc-text">Which Tool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Started-git-tf"><span class="toc-text">Getting Started: git-tf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-Started-git-tfs"><span class="toc-text">Getting Started: git-tfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-tf-s-Workflow"><span class="toc-text">Git-tf[s] Workflow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Workflow-git-tf"><span class="toc-text">Workflow: git-tf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Workflow-git-tfs"><span class="toc-text">Workflow: git-tfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-and-TFS-Summary"><span class="toc-text">Git and TFS Summary</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Migrating-to-Git"><span class="toc-text">Migrating to Git</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Subversion"><span class="toc-text">Subversion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mercurial"><span class="toc-text">Mercurial</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bazaar"><span class="toc-text">Bazaar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-the-bzr-fastimport-plugin"><span class="toc-text">Getting the bzr-fastimport plugin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Project-with-a-single-branch"><span class="toc-text">Project with a single branch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Case-of-a-project-with-a-main-branch-and-a-working-branch"><span class="toc-text">Case of a project with a main branch and a working branch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Synchronizing-the-staging-area"><span class="toc-text">Synchronizing the staging area</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ignoring-the-files-that-were-ignored-with-bzrignore"><span class="toc-text">Ignoring the files that were ignored with .bzrignore</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sending-your-repository-to-the-server"><span class="toc-text">Sending your repository to the server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Perforce"><span class="toc-text">Perforce</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Perforce-Git-Fusion"><span class="toc-text">Perforce Git Fusion</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Git-p4-1"><span class="toc-text">Git-p4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TFS"><span class="toc-text">TFS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#A-Custom-Importer"><span class="toc-text">A Custom Importer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-11"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-Internals"><span class="toc-text">Git Internals</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Plumbing-and-Porcelain"><span class="toc-text">Plumbing and Porcelain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-Objects"><span class="toc-text">Git Objects</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tree-Objects"><span class="toc-text">Tree Objects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Commit-Objects"><span class="toc-text">Commit Objects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Object-Storage"><span class="toc-text">Object Storage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-References"><span class="toc-text">Git References</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-HEAD-1"><span class="toc-text">The HEAD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tags"><span class="toc-text">Tags</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remotes"><span class="toc-text">Remotes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Packfiles"><span class="toc-text">Packfiles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Refspec"><span class="toc-text">The Refspec</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pushing-Refspecs"><span class="toc-text">Pushing Refspecs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deleting-References"><span class="toc-text">Deleting References</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transfer-Protocols"><span class="toc-text">Transfer Protocols</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Dumb-Protocol"><span class="toc-text">The Dumb Protocol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Smart-Protocol"><span class="toc-text">The Smart Protocol</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Uploading-Data"><span class="toc-text">Uploading Data</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH"><span class="toc-text">SSH</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP-S"><span class="toc-text">HTTP(S)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Downloading-Data"><span class="toc-text">Downloading Data</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH-1"><span class="toc-text">SSH</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP-S-1"><span class="toc-text">HTTP(S)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Protocols-Summary"><span class="toc-text">Protocols Summary</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Maintenance-and-Data-Recovery"><span class="toc-text">Maintenance and Data Recovery</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Maintenance"><span class="toc-text">Maintenance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Recovery"><span class="toc-text">Data Recovery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Removing-Objects"><span class="toc-text">Removing Objects</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Environment-Variables"><span class="toc-text">Environment Variables</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Global-Behavior"><span class="toc-text">Global Behavior</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Repository-Locations"><span class="toc-text">Repository Locations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pathspecs"><span class="toc-text">Pathspecs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Committing"><span class="toc-text">Committing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Networking"><span class="toc-text">Networking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Diffing-and-Merging"><span class="toc-text">Diffing and Merging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debugging"><span class="toc-text">Debugging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Miscellaneous"><span class="toc-text">Miscellaneous</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-12"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-in-Other-Environments"><span class="toc-text">Git in Other Environments</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Graphical-Interfaces"><span class="toc-text">Graphical Interfaces</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gitk-and-git-gui"><span class="toc-text">gitk and git-gui</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GitHub-for-Mac-and-Windows"><span class="toc-text">GitHub for Mac and Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Installation-1"><span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Recommended-Workflow"><span class="toc-text">Recommended Workflow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Summary-13"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Other-GUIs"><span class="toc-text">Other GUIs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-in-Visual-Studio"><span class="toc-text">Git in Visual Studio</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-in-Eclipse"><span class="toc-text">Git in Eclipse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-in-Bash"><span class="toc-text">Git in Bash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-in-Zsh"><span class="toc-text">Git in Zsh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-in-Powershell"><span class="toc-text">Git in Powershell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Installation-2"><span class="toc-text">Installation</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Prerequisites-Windows-only"><span class="toc-text">Prerequisites (Windows only)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PowerShell-Gallery"><span class="toc-text">PowerShell Gallery</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Update-PowerShell-Prompt"><span class="toc-text">Update PowerShell Prompt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#From-Source"><span class="toc-text">From Source</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary-14"><span class="toc-text">Summary</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Embedding-Git-in-your-Applications"><span class="toc-text">Embedding Git in your Applications</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Command-line-Git"><span class="toc-text">Command-line Git</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Libgit2"><span class="toc-text">Libgit2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced-Functionality"><span class="toc-text">Advanced Functionality</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Other-Bindings"><span class="toc-text">Other Bindings</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LibGit2Sharp"><span class="toc-text">LibGit2Sharp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#objective-git"><span class="toc-text">objective-git</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pygit2"><span class="toc-text">pygit2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Further-Reading"><span class="toc-text">Further Reading</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JGit"><span class="toc-text">JGit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-Set-Up"><span class="toc-text">Getting Set Up</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plumbing"><span class="toc-text">Plumbing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Porcelain"><span class="toc-text">Porcelain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Further-Reading-1"><span class="toc-text">Further Reading</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-git"><span class="toc-text">go-git</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Advanced-Functionality-1"><span class="toc-text">Advanced Functionality</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Further-Reading-2"><span class="toc-text">Further Reading</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Git-Commands"><span class="toc-text">Git Commands</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup-and-Config"><span class="toc-text">Setup and Config</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-config"><span class="toc-text">git config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-help"><span class="toc-text">git help</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-and-Creating-Projects"><span class="toc-text">Getting and Creating Projects</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-init"><span class="toc-text">git init</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-clone"><span class="toc-text">git clone</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic-Snapshotting"><span class="toc-text">Basic Snapshotting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-add"><span class="toc-text">git add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-status"><span class="toc-text">git status</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-diff"><span class="toc-text">git diff</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-difftool"><span class="toc-text">git difftool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-commit"><span class="toc-text">git commit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-reset"><span class="toc-text">git reset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-rm"><span class="toc-text">git rm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-mv"><span class="toc-text">git mv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-clean"><span class="toc-text">git clean</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Branching-and-Merging"><span class="toc-text">Branching and Merging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-branch"><span class="toc-text">git branch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-checkout"><span class="toc-text">git checkout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-merge"><span class="toc-text">git merge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-mergetool"><span class="toc-text">git mergetool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-log"><span class="toc-text">git log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-stash"><span class="toc-text">git stash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-tag"><span class="toc-text">git tag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sharing-and-Updating-Projects"><span class="toc-text">Sharing and Updating Projects</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-fetch"><span class="toc-text">git fetch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-pull"><span class="toc-text">git pull</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-push"><span class="toc-text">git push</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-remote"><span class="toc-text">git remote</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-archive"><span class="toc-text">git archive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-submodule"><span class="toc-text">git submodule</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inspection-and-Comparison"><span class="toc-text">Inspection and Comparison</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-show"><span class="toc-text">git show</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-shortlog"><span class="toc-text">git shortlog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-describe"><span class="toc-text">git describe</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debugging-1"><span class="toc-text">Debugging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-bisect"><span class="toc-text">git bisect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-blame"><span class="toc-text">git blame</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-grep"><span class="toc-text">git grep</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patching"><span class="toc-text">Patching</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-cherry-pick"><span class="toc-text">git cherry-pick</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-rebase"><span class="toc-text">git rebase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-revert"><span class="toc-text">git revert</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Email"><span class="toc-text">Email</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-apply"><span class="toc-text">git apply</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-am"><span class="toc-text">git am</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-format-patch"><span class="toc-text">git format-patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-imap-send"><span class="toc-text">git imap-send</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-send-email"><span class="toc-text">git send-email</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-request-pull"><span class="toc-text">git request-pull</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#External-Systems"><span class="toc-text">External Systems</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-svn-1"><span class="toc-text">git svn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-fast-import"><span class="toc-text">git fast-import</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Administration-1"><span class="toc-text">Administration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#git-gc"><span class="toc-text">git gc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-fsck"><span class="toc-text">git fsck</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-reflog"><span class="toc-text">git reflog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git-filter-branch"><span class="toc-text">git filter-branch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Plumbing-Commands"><span class="toc-text">Plumbing Commands</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
        if ($(".left-col").is(":hidden")) {
          $("#tocButton").attr("value", yiliaConfig.toc[1]);
        }
    </script>





    
		<section class="livere" id="comments">
<div id="lv-container" data-id="city" data-uid="MTAyMC8yODg2MC81NDMw">
  <script type="text/javascript">
    (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
    })(document, 'script');
  </script>
  <noscript>Please enable JavaScript to view the comments powered by <a href="https://livere.com/">LiveRe.</a></noscript>
</div>
</section>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/post/artbook/pixar-storytelling-rules-for-effective-storytelling-based-on-pixar’s-greatest-films/" title="上一篇: Pixar Storytelling: Rules for Effective Storytelling Based on Pixar’s Greatest Films">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/post/other/reinvent-yourself/" title="下一篇: Reinvent Yourself">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/writing/1001-questions-to-help-flesh-out-your-character/">1001 Questions to Help Flesh Out Your Character</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/abstract-art-painting-expressions-in-mixed-media/">Abstract Art Painting: Expressions in Mixed Media</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/acrylic-illuminations-reflective-luminous-acrylic-painting-techniques/">Acrylic Illuminations: Reflective and Luminous Acrylic Painting Techniques</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/acrylic-solutions-exploring-mixed-media-layer-by-layer/">Acrylic Solutions: Exploring Mixed Media Layer by Layer</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/art-journal-courage-fearless-mixed-media-techniques-for-journaling-bravely/">Art Journal Courage: Fearless Mixed Media Techniques for Journaling Bravely</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/becoming-a-writer/">Becoming a Writer</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/blogging-best-little-darn-guide-to-starting-a-profitable-blog-blogging-for-profit-book-1/">Blogging: The Best Little Darn Guide To Starting A Profitable Blog (Blogging For Profit Book 1)</a></li><li class="post-list-item"><a class="post-list-link" href="/post/economics/business-law-6th-edition-business-review-series/">Business Law, 6th edition (Business Review Series)</a></li><li class="post-list-item"><a class="post-list-link" href="/post/economics/capital-in-twenty-first-century/">Capital in the Twenty-First Century</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/comic-book-marketing-101/">Comic Book Marketing 101</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/creating-abstract-art-ideas-inspirations-for-passionate-art-making/">Creating Abstract Art: Ideas and Inspirations for Passionate Art-Making</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/creativegirl-mixed-media-techniques-for-an-artful-life/">creativeGIRL: Mixed Media Techniques for an Artful Life</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/delete/">Delete</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/digital-painting-with-krita-2-9-learn-all-of-tools-to-create-your-next-masterpiece/">Digital Painting with KRITA 2.9: Learn All of the Tools to Create Your Next Masterpiece</a></li><li class="post-list-item"><a class="post-list-link" href="/post/economics/economics-ethics/">Economics and Ethics</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/economics-of-digital-comics/">Economics of Digital Comics</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/elements-of-fiction-writing-conflict-suspense/">Elements of Fiction Writing - Conflict and Suspense</a></li><li class="post-list-item"><a class="post-list-link" href="/post/gtd/essential-time-hacks-turn-24-hours-into-48/">Essential Time Hacks: Turn 24 Hours Into 48</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/fiction-attack-insider-secrets-for-writing-selling-your-novels-stories-for-self-published-traditional-authors/">Fiction Attack! Insider Secrets for Writing and Selling Your Novels & Stories -- For Self-Published and Traditional Authors</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/find-your-passion-25-questions-you-must-ask-yourself/">Find Your Passion: 25 Questions You Must Ask Yourself</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/foundations-in-comic-book-art-scad-creative-essentials-fundamental-tools-techniques-for-sequential-artists/">Foundations in Comic Book Art: SCAD Creative Essentials (Fundamental Tools and Techniques for Sequential Artists)</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/four-seasons-of-creative-writing-1-000-prompts-to-stop-writers-block-story-prompts-for-journaling-blogging-beating-writers-block/">Four Seasons of Creative Writing: 1,000 Prompts to Stop Writer's Block (Story Prompts for Journaling, Blogging and Beating Writer's Block)</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/how-to-make-a-living-as-a-writer/">How to Make a Living as a Writer</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/how-to-self-publish-comics-not-just-create-them/">How to Self-Publish Comics: Not Just Create Them</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/how-to-write-dazzling-dialogue-fastest-way-to-improve-any-manuscript/">How to Write Dazzling Dialogue: The Fastest Way to Improve Any Manuscript</a></li><li class="post-list-item"><a class="post-list-link" href="/post/translation/introducing-translation-studies-theories-applications/">Introducing Translation Studies: Theories and Applications</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/justice/">Justice</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/make-comics-like-pros-inside-scoop-on-how-to-write-draw-sell-your-comic-books-graphic-novels/">Make Comics Like the Pros: The Inside Scoop on How to Write, Draw, and Sell Your Comic Books and Graphic Novels</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/no-excuses-watercolor-painting-techniques-for-sketching-journaling/">No Excuses Watercolor: Painting Techniques for Sketching and Journaling</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/not-nice-stop-people-pleasing-staying-silent-feeling-guilty-start-speaking-up-saying-no-asking-boldly-unapologetically-being-yourself/">Not Nice: Stop People Pleasing, Staying Silent, & Feeling Guilty... And Start Speaking Up, Saying No, Asking Boldly, And Unapologetically Being Yourself</a></li><li class="post-list-item"><a class="post-list-link" href="/post/artbook/pixar-storytelling-rules-for-effective-storytelling-based-on-pixar’s-greatest-films/">Pixar Storytelling: Rules for Effective Storytelling Based on Pixar’s Greatest Films</a></li><li class="post-list-item"><a class="post-list-link" href="/post/coding/pro-git/">Pro Git</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/reinvent-yourself/">Reinvent Yourself</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/revision-self-editing/">Revision And Self-Editing</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/secrets-of-successful-writers/">Secrets of Successful Writers</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/see-what-i-mean/">See What I Mean</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/short-notes-on-long-comics-10-great-examples-of-story-structure-in-graphic-novels/">Short Notes on Long Comics: 10 Great Examples of Story Structure in Graphic Novels</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/simple-steps-to-photographic-memory-even-average-joe-can-do-it-now/">Simple Steps to Photographic Memory: Even the average Joe can do it now</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/so-you-want-to-be-a-comic-book-artist/">So, You Want to Be a Comic Book Artist?</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/super-structure-key-to-unleashing-power-of-story/">Super Structure: The Key to Unleashing the Power of Story</a></li><li class="post-list-item"><a class="post-list-link" href="/post/art/surface-treatment-workshop-explore-45-mixed-media-techniques/">Surface Treatment Workshop: Explore 45 Mixed-Media Techniques</a></li><li class="post-list-item"><a class="post-list-link" href="/post/artbook/art-of-brave/">The Art of Brave</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/art-of-comic-book-writing-definitive-guide-to-outlining-scripting-pitching-your-sequential-art-stories/">The Art of Comic Book Writing: The Definitive Guide to Outlining, Scripting, and Pitching Your Sequential Art Stories</a></li><li class="post-list-item"><a class="post-list-link" href="/post/artbook/art-of-pixar-25th-anniversary-complete-color-scripts-select-art-from-25-years-of-animation/">The Art of Pixar: 25th Anniversary: The Complete Color Scripts and Select Art from 25 Years of Animation</a></li><li class="post-list-item"><a class="post-list-link" href="/post/artbook/art-of-zootopia/">The Art of Zootopia</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/author-training-manual-develop-marketable-ideas-craft-books-that-sell-become-author-publishers-want-self-publish-effectively/">The Author Training Manual: Develop Marketable Ideas, Craft Books That Sell, Become the Author Publishers Want, and Self-Publish Effectively</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/author-training-manual-develop-marketable-ideas-craft-books-that-sell-become-author-publishers-want-self-publish-effectively/">The Author Training Manual: Develop Marketable Ideas, Craft Books That Sell, Become the Author Publishers Want, and Self-Publish Effectively</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/body-thesaurus-a-fiction-writers-sourcebook-of-words-phrases-to-describe-characters/">The Body Thesaurus: A Fiction Writer's Sourcebook of Words and Phrases to Describe Characters</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/complete-guide-to-self-publishing-comics-how-to-create-sell-comic-books-manga-webcomics/">The Complete Guide to Self-Publishing Comics: How to Create and Sell Comic Books, Manga, and Webcomics</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/dc-comics-guide-to-digitally-drawing-comics/">The DC Comics Guide to Digitally Drawing Comics</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/dialogue-thesaurus-a-fiction-writers-sourcebook-of-dialogue-tags-phrases/">The Dialogue Thesaurus: A Fiction Writer's Sourcebook of Dialogue Tags and Phrases</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/joy-of-imperfection-a-stress-free-guide-to-silencing-your-inner-critic-conquering-perfectionism-becoming-best-version-of-yourself/">The Joy Of Imperfection: A Stress-Free Guide To Silencing Your Inner Critic, Conquering Perfectionism, and Becoming The Best Version Of Yourself!</a></li><li class="post-list-item"><a class="post-list-link" href="/post/methodology/manual-a-guide-to-ultimate-study-method-concentration-super-memory-speed-reading-note-taking-usm-rapid-mental-arithmetic-second-edition/">The Manual: A Guide to the Ultimate Study Method (Concentration, Super Memory, Speed Reading, Note-Taking, USM, & Rapid Mental Arithmetic), Second Edition</a></li><li class="post-list-item"><a class="post-list-link" href="/post/methodology/procrastination-cure-21-proven-tactics-for-conquering-your-inner-procrastinator-mastering-your-time-boosting-your-productivity/">The Procrastination Cure: 21 Proven Tactics For Conquering Your Inner Procrastinator, Mastering Your Time, And Boosting Your Productivity!</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/self-discipline-blueprint-a-simple-guide-to-beat-procrastination-achieve-your-goals-get-life-you-want/">The Self-Discipline Blueprint: A Simple Guide to Beat Procrastination, Achieve Your Goals, and Get the Life You Want</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/signal-noise/">The Signal and the Noise</a></li><li class="post-list-item"><a class="post-list-link" href="/post/other/solution-to-social-anxiety-break-free-from-shyness-that-holds-you-back/">The Solution To Social Anxiety: Break Free From The Shyness That Holds You Back</a></li><li class="post-list-item"><a class="post-list-link" href="/post/gtd/to-do-list-formula-a-stress-free-guide-to-creating-to-do-lists-that-work/">To-Do List Formula: A Stress-Free Guide To Creating To-Do Lists That Work!</a></li><li class="post-list-item"><a class="post-list-link" href="/post/comic/words-for-pictures-art-business-of-writing-comics-graphic-novels/">Words for Pictures: The Art and Business of Writing Comics and Graphic Novels</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/world-building-to-extreme-learn-how-to-build-your-fictional-world-how-much-of-my-world-do-i-build-sins-of-worldbuilding-world-building-101-fiction-writers-united/">WORLD BUILDING to the Extreme: Learn How to Build Your Fictional World, How Much of My World Do I Build?, Sins of Worldbuilding: World Building 101 (Fiction Writers United)</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/write-your-novel-from-middle-a-new-approach-for-plotters-pantsers-everyone-in-between/">Write Your Novel From The Middle: A New Approach for Plotters, Pantsers and Everyone in Between</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/writing-fiction-for-all-youre-worth-strategies-techniques-for-taking-your-fiction-to-next-level/">Writing Fiction for All You're Worth: Strategies and Techniques for Taking Your Fiction to the Next Level</a></li><li class="post-list-item"><a class="post-list-link" href="/post/writing/writing-love-scenes-professional-techniques-for-fiction-authors-writers-craft-book-27/">Writing Love Scenes: Professional Techniques for Fiction Authors (Writer's Craft Book 27)</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2015-2018 墨问非名
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_uv" style='display:none'>
                        <span id="site-visit" title="本站访客数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站总访问量">
                            
								<span>| </span>
							
							<i class="fa fa-eye animated infinite pulser" aria-hidden="true"></i>
							<span id="busuanzi_value_site_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    <script type="application/javascript">
      var hide = false, leftWidth = 400;
      function hideLeftCol() {
        if (hide) {
          $(".left-col").width(leftWidth);
          $(".left-col .intrude-less").css('display', '');
          $("#tocButton").css('display', '');
          ($('#switch-btn').css('display') === 'block' && $('#switch-area').css('display') === 'block') || $('#toc').slideDown(320);
          $(".hide-left-col").css("left", leftWidth).html('<i class="fa fa-angle-double-left"></i>');
          $(".mid-col").css("left", leftWidth)
          $("#post-nav-button").css("left", leftWidth)
          $("#post-nav-button > a:nth-child(2)").css("display", "block")
          hide = false
        } else {
          $(".left-col").width(0);
          $(".left-col .intrude-less").css('display', 'none');
          $("#toc").css('display', 'none');
          $("#tocButton").css('display', 'none');
          $(".hide-left-col").css("left", 0).html('<i class="fa fa-angle-double-right"></i>');
          $(".mid-col").css("left", 0)
          $("#post-nav-button").css("left", 0)
          $("#post-nav-button > a:nth-child(2)").css("display", "none")
          if ($(".post-list").is(":visible")) {
            $("#post-nav-button .fa-bars,#post-nav-button .fa-times").toggle();
            $(".post-list").toggle();
          }
          hide = true
        }
      }
      $(".hide-left-col").click(function() {
        hideLeftCol()
      });
    </script>
    
    <script src="/js/GithubRepoWidget.js"></script>

<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 6;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
             github: ".github-widget a", 
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

  </div>
<script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1530309046345')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end --></body>
</html>